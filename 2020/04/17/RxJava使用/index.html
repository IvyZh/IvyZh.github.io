<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>RxJava使用 | K的小屋</title><meta name="description" content="RxJava使用"><meta name="keywords" content="RxJava"><meta name="author" content="Kai"><meta name="copyright" content="Kai"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="RxJava使用"><meta name="twitter:description" content="RxJava使用"><meta name="twitter:image" content="https://www.google.com/img/assets/730e0cf3d7ca7bcb3e16f1a1b5096b63f724a8ca.jpg"><meta property="og:type" content="article"><meta property="og:title" content="RxJava使用"><meta property="og:url" content="https://www.google.com/2020/04/17/RxJava%E4%BD%BF%E7%94%A8/"><meta property="og:site_name" content="K的小屋"><meta property="og:description" content="RxJava使用"><meta property="og:image" content="https://www.google.com/img/assets/730e0cf3d7ca7bcb3e16f1a1b5096b63f724a8ca.jpg"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://www.google.com/2020/04/17/RxJava%E4%BD%BF%E7%94%A8/"><link rel="prev" title="Android超详细的生命周期图" href="https://www.google.com/2020/04/17/Android%E8%B6%85%E8%AF%A6%E7%BB%86%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%9B%BE/"><link rel="next" title="Android Studio3.x上使用Lombok" href="https://www.google.com/2020/04/16/Android%20Studio3.x%E4%B8%8A%E4%BD%BF%E7%94%A8Lombok/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: true
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">24</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">28</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">12</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第一篇-gt-：RxJava的基本使用"><span class="toc-number">1.</span> <span class="toc-text">&lt;第一篇&gt;：RxJava的基本使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#声明"><span class="toc-number">1.0.0.1.</span> <span class="toc-text">声明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-作用"><span class="toc-number">1.0.0.2.</span> <span class="toc-text">1.作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-前提"><span class="toc-number">1.0.0.3.</span> <span class="toc-text">2.前提</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-RxJava的引用"><span class="toc-number">1.0.0.4.</span> <span class="toc-text">3.RxJava的引用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-基本代码"><span class="toc-number">1.0.0.5.</span> <span class="toc-text">4.基本代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-几种创建被观察者的方式"><span class="toc-number">1.0.0.6.</span> <span class="toc-text">5.几种创建被观察者的方式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#方式1：create"><span class="toc-number">1.0.0.6.1.</span> <span class="toc-text">方式1：create</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#方式2：fromArray"><span class="toc-number">1.0.0.6.2.</span> <span class="toc-text">方式2：fromArray</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#方式3：just"><span class="toc-number">1.0.0.6.3.</span> <span class="toc-text">方式3：just</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#方式4：fromIterable"><span class="toc-number">1.0.0.6.4.</span> <span class="toc-text">方式4：fromIterable</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#方式5：fromCallable（线程有回调时：Callable-）"><span class="toc-number">1.0.0.6.5.</span> <span class="toc-text">方式5：fromCallable（线程有回调时：Callable ）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#方式6：fromFuture（线程有回调时：Future-）"><span class="toc-number">1.0.0.6.6.</span> <span class="toc-text">方式6：fromFuture（线程有回调时：Future ）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#方式7：继承Publisher"><span class="toc-number">1.0.0.6.7.</span> <span class="toc-text">方式7：继承Publisher</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#方式8：fromPublisher"><span class="toc-number">1.0.0.6.8.</span> <span class="toc-text">方式8：fromPublisher</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#方式9：defer"><span class="toc-number">1.0.0.6.9.</span> <span class="toc-text">方式9：defer</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第二篇-gt-：RxJava之Consumer和Action的使用"><span class="toc-number">2.</span> <span class="toc-text">&lt;第二篇&gt;：RxJava之Consumer和Action的使用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第三篇-gt-：RxJava之do操作符"><span class="toc-number">3.</span> <span class="toc-text">&lt;第三篇&gt;：RxJava之do操作符</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第四篇-gt-：RxJava之5种被观察者的创建"><span class="toc-number">4.</span> <span class="toc-text">&lt;第四篇&gt;：RxJava之5种被观察者的创建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#（1）Observable"><span class="toc-number">4.0.0.1.</span> <span class="toc-text">（1）Observable</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（2）Flowable"><span class="toc-number">4.0.0.2.</span> <span class="toc-text">（2）Flowable</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（3）Single"><span class="toc-number">4.0.0.3.</span> <span class="toc-text">（3）Single</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（4）Completable"><span class="toc-number">4.0.0.4.</span> <span class="toc-text">（4）Completable</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（5）Maybe"><span class="toc-number">4.0.0.5.</span> <span class="toc-text">（5）Maybe</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第五篇-gt-：RxJava之4种Subject"><span class="toc-number">5.</span> <span class="toc-text">&lt;第五篇&gt;：RxJava之4种Subject</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#（1）AsyncSubject"><span class="toc-number">5.0.0.1.</span> <span class="toc-text">（1）AsyncSubject</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（2）BehaviorSubject"><span class="toc-number">5.0.0.2.</span> <span class="toc-text">（2）BehaviorSubject</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（3）ReplaySubject"><span class="toc-number">5.0.0.3.</span> <span class="toc-text">（3）ReplaySubject</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（4）PublishSubject"><span class="toc-number">5.0.0.4.</span> <span class="toc-text">（4）PublishSubject</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第六篇-gt-：用RxJava实现EventBus"><span class="toc-number">6.</span> <span class="toc-text">&lt;第六篇&gt;：用RxJava实现EventBus</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（1）没有压背处理的Rxbus"><span class="toc-number">6.0.1.</span> <span class="toc-text">（1）没有压背处理的Rxbus</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（2）有压背处理的Rxbus"><span class="toc-number">6.0.2.</span> <span class="toc-text">（2）有压背处理的Rxbus</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第七篇-gt-：RxJava实现预加载"><span class="toc-number">7.</span> <span class="toc-text">&lt;第七篇&gt;：RxJava实现预加载</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第八篇-gt-：RxJava之创建操作符"><span class="toc-number">8.</span> <span class="toc-text">&lt;第八篇&gt;：RxJava之创建操作符</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#（1）create"><span class="toc-number">8.0.0.1.</span> <span class="toc-text">（1）create</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（2）just"><span class="toc-number">8.0.0.2.</span> <span class="toc-text">（2）just</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（3）from"><span class="toc-number">8.0.0.3.</span> <span class="toc-text">（3）from</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（4）range"><span class="toc-number">8.0.0.4.</span> <span class="toc-text">（4）range</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（5）-defer"><span class="toc-number">8.0.0.5.</span> <span class="toc-text">（5） defer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（6）interval"><span class="toc-number">8.0.0.6.</span> <span class="toc-text">（6）interval</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（7）timer"><span class="toc-number">8.0.0.7.</span> <span class="toc-text">（7）timer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（8）empty"><span class="toc-number">8.0.0.8.</span> <span class="toc-text">（8）empty</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（9）error"><span class="toc-number">8.0.0.9.</span> <span class="toc-text">（9）error</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（10）never"><span class="toc-number">8.0.0.10.</span> <span class="toc-text">（10）never</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第九篇-gt-：RxJava之Cold-Observable-和-Hot-Observable"><span class="toc-number">9.</span> <span class="toc-text">&lt;第九篇&gt;：RxJava之Cold Observable 和 Hot Observable</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#（1）Cold-Observable"><span class="toc-number">9.0.0.1.</span> <span class="toc-text">（1）Cold Observable</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（2）Hot-Observable"><span class="toc-number">9.0.0.2.</span> <span class="toc-text">（2）Hot Observable</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#总结："><span class="toc-number">9.0.0.2.1.</span> <span class="toc-text">总结：</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第十篇-gt-：RxJava之repeat系列"><span class="toc-number">10.</span> <span class="toc-text">&lt;第十篇&gt;：RxJava之repeat系列</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#（1）repeat-设置执行的次数"><span class="toc-number">10.0.0.1.</span> <span class="toc-text">（1）repeat 设置执行的次数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（2）repeatWhen-设置下次执行的时间"><span class="toc-number">10.0.0.2.</span> <span class="toc-text">（2）repeatWhen 设置下次执行的时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（3）repeatUntil-根据条件决定是否执行"><span class="toc-number">10.0.0.3.</span> <span class="toc-text">（3）repeatUntil 根据条件决定是否执行</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第十一篇-gt-：RxJava之变换操作符"><span class="toc-number">11.</span> <span class="toc-text">&lt;第十一篇&gt;：RxJava之变换操作符</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#（1）map"><span class="toc-number">11.0.0.1.</span> <span class="toc-text">（1）map</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（2）flatMap"><span class="toc-number">11.0.0.2.</span> <span class="toc-text">（2）flatMap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（3）ConcatMap"><span class="toc-number">11.0.0.3.</span> <span class="toc-text">（3）ConcatMap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（4）flatMapIterable"><span class="toc-number">11.0.0.4.</span> <span class="toc-text">（4）flatMapIterable</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（5）switchMap"><span class="toc-number">11.0.0.5.</span> <span class="toc-text">（5）switchMap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（6）scan"><span class="toc-number">11.0.0.6.</span> <span class="toc-text">（6）scan</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（7）groupBy"><span class="toc-number">11.0.0.7.</span> <span class="toc-text">（7）groupBy</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（8）buffer"><span class="toc-number">11.0.0.8.</span> <span class="toc-text">（8）buffer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（9）window"><span class="toc-number">11.0.0.9.</span> <span class="toc-text">（9）window</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（10）cast"><span class="toc-number">11.0.0.10.</span> <span class="toc-text">（10）cast</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第十二篇-gt-：RxJava之过滤操作符"><span class="toc-number">12.</span> <span class="toc-text">&lt;第十二篇&gt;：RxJava之过滤操作符</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#指定条件过滤事件"><span class="toc-number">12.0.0.1.</span> <span class="toc-text">指定条件过滤事件</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#（1）filter"><span class="toc-number">12.0.0.1.0.1.</span> <span class="toc-text">（1）filter</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（2）ofType"><span class="toc-number">12.0.0.1.0.2.</span> <span class="toc-text">（2）ofType</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（3）skip和skipLast"><span class="toc-number">12.0.0.1.0.3.</span> <span class="toc-text">（3）skip和skipLast</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（4）distinct和distinctUntilChanged"><span class="toc-number">12.0.0.1.0.4.</span> <span class="toc-text">（4）distinct和distinctUntilChanged</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#指定数量过滤事件"><span class="toc-number">12.0.0.2.</span> <span class="toc-text">指定数量过滤事件</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#（1）take和takeLast"><span class="toc-number">12.0.0.2.0.1.</span> <span class="toc-text">（1）take和takeLast</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#指定时间过滤事件"><span class="toc-number">12.0.0.3.</span> <span class="toc-text">指定时间过滤事件</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#（1）throttleFirst和throttleLast"><span class="toc-number">12.0.0.3.0.1.</span> <span class="toc-text">（1）throttleFirst和throttleLast</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（2）sample"><span class="toc-number">12.0.0.3.0.2.</span> <span class="toc-text">（2）sample</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（3）throttleWithTimeout和debounce"><span class="toc-number">12.0.0.3.0.3.</span> <span class="toc-text">（3）throttleWithTimeout和debounce</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#指定事件位置过滤事件"><span class="toc-number">12.0.0.4.</span> <span class="toc-text">指定事件位置过滤事件</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#（1）firstElement和lastElement"><span class="toc-number">12.0.0.4.0.1.</span> <span class="toc-text">（1）firstElement和lastElement</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（2）elementAt"><span class="toc-number">12.0.0.4.0.2.</span> <span class="toc-text">（2）elementAt</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（3）elementAtOrError"><span class="toc-number">12.0.0.4.0.3.</span> <span class="toc-text">（3）elementAtOrError</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第十三篇-gt-：RxJava之线程控制（切换-调度）"><span class="toc-number">13.</span> <span class="toc-text">&lt;第十三篇&gt;：RxJava之线程控制（切换&#x2F;调度）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#（1）默认情况下"><span class="toc-number">13.0.0.0.0.1.</span> <span class="toc-text">（1）默认情况下</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（2）Scheduler的种类"><span class="toc-number">13.0.0.0.0.2.</span> <span class="toc-text">（2）Scheduler的种类</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（3）subscribeOn的使用"><span class="toc-number">13.0.0.0.0.3.</span> <span class="toc-text">（3）subscribeOn的使用</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（4）observeOn的使用"><span class="toc-number">13.0.0.0.0.4.</span> <span class="toc-text">（4）observeOn的使用</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（5）subscribeOn和observeOn结合使用"><span class="toc-number">13.0.0.0.0.5.</span> <span class="toc-text">（5）subscribeOn和observeOn结合使用</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第十四篇-gt-：RxJava之条件-amp-布尔操作符"><span class="toc-number">14.</span> <span class="toc-text">&lt;第十四篇&gt;：RxJava之条件 &amp; 布尔操作符</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#（1）-all"><span class="toc-number">14.0.0.0.0.1.</span> <span class="toc-text">（1） all</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（2）takeWhile"><span class="toc-number">14.0.0.0.0.2.</span> <span class="toc-text">（2）takeWhile</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（3）skipWhile"><span class="toc-number">14.0.0.0.0.3.</span> <span class="toc-text">（3）skipWhile</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（4）takeUntil"><span class="toc-number">14.0.0.0.0.4.</span> <span class="toc-text">（4）takeUntil</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（5）skipUntil"><span class="toc-number">14.0.0.0.0.5.</span> <span class="toc-text">（5）skipUntil</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（6）SequenceEqual"><span class="toc-number">14.0.0.0.0.6.</span> <span class="toc-text">（6）SequenceEqual</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（7）contains"><span class="toc-number">14.0.0.0.0.7.</span> <span class="toc-text">（7）contains</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（8）isEmpty"><span class="toc-number">14.0.0.0.0.8.</span> <span class="toc-text">（8）isEmpty</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（9）amb"><span class="toc-number">14.0.0.0.0.9.</span> <span class="toc-text">（9）amb</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（10）defaultIfEmpty"><span class="toc-number">14.0.0.0.0.10.</span> <span class="toc-text">（10）defaultIfEmpty</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第十五篇-gt-：RxJava之组合-合并操作符"><span class="toc-number">15.</span> <span class="toc-text">&lt;第十五篇&gt;：RxJava之组合&#x2F;合并操作符</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#（1）concat和concatArray"><span class="toc-number">15.0.0.0.0.1.</span> <span class="toc-text">（1）concat和concatArray</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（2）merge和mergeArray"><span class="toc-number">15.0.0.0.0.2.</span> <span class="toc-text">（2）merge和mergeArray</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（3）concatDelayError和mergeDelayError"><span class="toc-number">15.0.0.0.0.3.</span> <span class="toc-text">（3）concatDelayError和mergeDelayError</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（4）zip"><span class="toc-number">15.0.0.0.0.4.</span> <span class="toc-text">（4）zip</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（5）combineLatest"><span class="toc-number">15.0.0.0.0.5.</span> <span class="toc-text">（5）combineLatest</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（6）combineLatestDelayError"><span class="toc-number">15.0.0.0.0.6.</span> <span class="toc-text">（6）combineLatestDelayError</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（7）reduce"><span class="toc-number">15.0.0.0.0.7.</span> <span class="toc-text">（7）reduce</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（8）collect"><span class="toc-number">15.0.0.0.0.8.</span> <span class="toc-text">（8）collect</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（9）startWith和startWithArray"><span class="toc-number">15.0.0.0.0.9.</span> <span class="toc-text">（9）startWith和startWithArray</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（10）count"><span class="toc-number">15.0.0.0.0.10.</span> <span class="toc-text">（10）count</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第十六篇-gt-：RxJava之从内存或本地或网络中获取数据"><span class="toc-number">16.</span> <span class="toc-text">&lt;第十六篇&gt;：RxJava之从内存或本地或网络中获取数据</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第十七篇-gt-：RxJava之页面数据展示（本地和网络）"><span class="toc-number">17.</span> <span class="toc-text">&lt;第十七篇&gt;：RxJava之页面数据展示（本地和网络）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第十八篇-gt-：RxJava之背压策略"><span class="toc-number">18.</span> <span class="toc-text">&lt;第十八篇&gt;：RxJava之背压策略</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#（1）背压的存在背景"><span class="toc-number">18.0.0.0.0.1.</span> <span class="toc-text">（1）背压的存在背景</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（2）Flowable-1"><span class="toc-number">18.0.0.0.0.2.</span> <span class="toc-text">（2）Flowable</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（3）BackpressureStrategy"><span class="toc-number">18.0.0.0.0.3.</span> <span class="toc-text">（3）BackpressureStrategy</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第十九篇-gt-：RxJava之使用CompositeDisposable来管理Disposable"><span class="toc-number">19.</span> <span class="toc-text">&lt;第十九篇&gt;：RxJava之使用CompositeDisposable来管理Disposable</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#关于disposable"><span class="toc-number">19.0.0.1.</span> <span class="toc-text">关于disposable</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CompositeDisposable类"><span class="toc-number">19.0.0.2.</span> <span class="toc-text">CompositeDisposable类</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第二十篇-gt-：Transformer在RxJava中的使用"><span class="toc-number">20.</span> <span class="toc-text">&lt;第二十篇&gt;：Transformer在RxJava中的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1）作用"><span class="toc-number">20.0.0.0.0.1.</span> <span class="toc-text">(1）作用</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（2）分类"><span class="toc-number">20.0.0.0.0.2.</span> <span class="toc-text">（2）分类</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（3）使用"><span class="toc-number">20.0.0.0.0.3.</span> <span class="toc-text">（3）使用</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第二十一篇-gt-：Android-第三方库RxLifecycle使用"><span class="toc-number">21.</span> <span class="toc-text">&lt;第二十一篇&gt;：Android 第三方库RxLifecycle使用</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#（1）前景"><span class="toc-number">21.0.0.0.0.1.</span> <span class="toc-text">（1）前景</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（2）作用"><span class="toc-number">21.0.0.0.0.2.</span> <span class="toc-text">（2）作用</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（3）添加依赖"><span class="toc-number">21.0.0.0.0.3.</span> <span class="toc-text">（3）添加依赖</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（4）分类"><span class="toc-number">21.0.0.0.0.4.</span> <span class="toc-text">（4）分类</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（5）Activity和Fragment的继承"><span class="toc-number">21.0.0.0.0.5.</span> <span class="toc-text">（5）Activity和Fragment的继承</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（6）让Observable发布的事件和当前的组件绑定"><span class="toc-number">21.0.0.0.0.6.</span> <span class="toc-text">（6）让Observable发布的事件和当前的组件绑定</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第二十二篇-gt-：RxJava之Android-第三方库AutoDispose使用"><span class="toc-number">22.</span> <span class="toc-text">&lt;第二十二篇&gt;：RxJava之Android 第三方库AutoDispose使用</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#（1）前景-1"><span class="toc-number">22.0.0.0.0.1.</span> <span class="toc-text">（1）前景</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（2）添加依赖"><span class="toc-number">22.0.0.0.0.2.</span> <span class="toc-text">（2）添加依赖</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（3）使用-1"><span class="toc-number">22.0.0.0.0.3.</span> <span class="toc-text">（3）使用</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第二十三篇-gt-：RxJava内存泄漏问题解决"><span class="toc-number">23.</span> <span class="toc-text">&lt;第二十三篇&gt;：RxJava内存泄漏问题解决</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1）存在内存泄漏问题"><span class="toc-number">23.0.0.0.0.1.</span> <span class="toc-text">1）存在内存泄漏问题</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（2）常规手动取消订阅（不推荐）"><span class="toc-number">23.0.0.0.0.2.</span> <span class="toc-text">（2）常规手动取消订阅（不推荐）</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（3）使用CompositeDisposable来管理Disposable"><span class="toc-number">23.0.0.0.0.3.</span> <span class="toc-text">（3）使用CompositeDisposable来管理Disposable</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（4）RxLifecycle-自动取消订阅-（推荐）"><span class="toc-number">23.0.0.0.0.4.</span> <span class="toc-text">（4）RxLifecycle(自动取消订阅)（推荐）</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#（5）AutoDispose-自动取消订阅-（推荐）"><span class="toc-number">23.0.0.0.0.5.</span> <span class="toc-text">（5）AutoDispose(自动取消订阅)（推荐）</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第二十四篇-gt-：RxJava之RxBinding3-0"><span class="toc-number">24.</span> <span class="toc-text">&lt;第二十四篇&gt;：RxJava之RxBinding3.0</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#（1）github"><span class="toc-number">24.0.0.0.1.</span> <span class="toc-text">（1）github</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（2）依赖"><span class="toc-number">24.0.0.0.2.</span> <span class="toc-text">（2）依赖</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（3）相关组件"><span class="toc-number">24.0.0.0.3.</span> <span class="toc-text">（3）相关组件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（4）RxView"><span class="toc-number">24.0.0.0.4.</span> <span class="toc-text">（4）RxView</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（5）RxTextView"><span class="toc-number">24.0.0.0.5.</span> <span class="toc-text">（5）RxTextView</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（6）RxViewGroup"><span class="toc-number">24.0.0.0.6.</span> <span class="toc-text">（6）RxViewGroup</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（7）RxToolbar"><span class="toc-number">24.0.0.0.7.</span> <span class="toc-text">（7）RxToolbar</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（8）RxMenuItem"><span class="toc-number">24.0.0.0.8.</span> <span class="toc-text">（8）RxMenuItem</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（9）RxRadioGroup"><span class="toc-number">24.0.0.0.9.</span> <span class="toc-text">（9）RxRadioGroup</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（10）RxCompoundButton"><span class="toc-number">24.0.0.0.10.</span> <span class="toc-text">（10）RxCompoundButton</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（11）RxAutoCompleteTextView"><span class="toc-number">24.0.0.0.11.</span> <span class="toc-text">（11）RxAutoCompleteTextView</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（12）RxPopupMenu"><span class="toc-number">24.0.0.0.12.</span> <span class="toc-text">（12）RxPopupMenu</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（13）RxAdapter、RxAbsListView、RxAdapterView"><span class="toc-number">24.0.0.0.13.</span> <span class="toc-text">（13）RxAdapter、RxAbsListView、RxAdapterView</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（14）RxSeekBar"><span class="toc-number">24.0.0.0.14.</span> <span class="toc-text">（14）RxSeekBar</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（15）RxRatingBar"><span class="toc-number">24.0.0.0.15.</span> <span class="toc-text">（15）RxRatingBar</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（16）RxSearchView"><span class="toc-number">24.0.0.0.16.</span> <span class="toc-text">（16）RxSearchView</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第二十五篇-gt-：RxJava之功能防抖（防暴力点击）"><span class="toc-number">25.</span> <span class="toc-text">&lt;第二十五篇&gt;：RxJava之功能防抖（防暴力点击）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第二十六篇-gt-：RxJava之联合判断"><span class="toc-number">26.</span> <span class="toc-text">&lt;第二十六篇&gt;：RxJava之联合判断</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第二十七篇-gt-：RxJava之搜索优化"><span class="toc-number">27.</span> <span class="toc-text">&lt;第二十七篇&gt;：RxJava之搜索优化</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第二十八篇-gt-：RxJava实现倒计时"><span class="toc-number">28.</span> <span class="toc-text">&lt;第二十八篇&gt;：RxJava实现倒计时</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第二十九篇-gt-：RxPermission"><span class="toc-number">29.</span> <span class="toc-text">&lt;第二十九篇&gt;：RxPermission</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#（1）如果只申请一个权限的情况下"><span class="toc-number">29.0.0.0.1.</span> <span class="toc-text">（1）如果只申请一个权限的情况下</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（2）如果一次性申请多个权限的情况下"><span class="toc-number">29.0.0.0.2.</span> <span class="toc-text">（2）如果一次性申请多个权限的情况下</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第三十篇-gt-：Android开发必须了解的Okhttp"><span class="toc-number">30.</span> <span class="toc-text">&lt;第三十篇&gt;：Android开发必须了解的Okhttp</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#（1）添加依赖库"><span class="toc-number">30.0.0.0.1.</span> <span class="toc-text">（1）添加依赖库</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（2）解决引入依赖库之后的异常"><span class="toc-number">30.0.0.0.2.</span> <span class="toc-text">（2）解决引入依赖库之后的异常</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（3）添加网络权限"><span class="toc-number">30.0.0.0.3.</span> <span class="toc-text">（3）添加网络权限</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（4）Get请求"><span class="toc-number">30.0.0.0.4.</span> <span class="toc-text">（4）Get请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（5）Post请求"><span class="toc-number">30.0.0.0.5.</span> <span class="toc-text">（5）Post请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（6）OkHttpClient"><span class="toc-number">30.0.0.0.6.</span> <span class="toc-text">（6）OkHttpClient</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（7）Request"><span class="toc-number">30.0.0.0.7.</span> <span class="toc-text">（7）Request</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（8）RequestBody和FormBody、-MultipartBody"><span class="toc-number">30.0.0.0.8.</span> <span class="toc-text">（8）RequestBody和FormBody、 MultipartBody</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（9）Call"><span class="toc-number">30.0.0.0.9.</span> <span class="toc-text">（9）Call</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（10）Response"><span class="toc-number">30.0.0.0.10.</span> <span class="toc-text">（10）Response</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第三十一篇-gt-：Android开发必须了解的Retrofit"><span class="toc-number">31.</span> <span class="toc-text">&lt;第三十一篇&gt;：Android开发必须了解的Retrofit</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#（1）依赖"><span class="toc-number">31.0.0.0.1.</span> <span class="toc-text">（1）依赖</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（2）一般用法"><span class="toc-number">31.0.0.0.2.</span> <span class="toc-text">（2）一般用法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（3）Retrofit的请求方式注解"><span class="toc-number">31.0.0.0.3.</span> <span class="toc-text">（3）Retrofit的请求方式注解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（4）Retrofit的请求参数注解"><span class="toc-number">31.0.0.0.4.</span> <span class="toc-text">（4）Retrofit的请求参数注解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（5）Retrofit响应格式注解"><span class="toc-number">31.0.0.0.5.</span> <span class="toc-text">（5）Retrofit响应格式注解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（6）Retrofit的请求头注解"><span class="toc-number">31.0.0.0.6.</span> <span class="toc-text">（6）Retrofit的请求头注解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（7）怎么跳出SSL证书校验？"><span class="toc-number">31.0.0.0.7.</span> <span class="toc-text">（7）怎么跳出SSL证书校验？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（8）转换器"><span class="toc-number">31.0.0.0.8.</span> <span class="toc-text">（8）转换器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（9）日志拦截器"><span class="toc-number">31.0.0.0.9.</span> <span class="toc-text">（9）日志拦截器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（10）自定义CookieJar"><span class="toc-number">31.0.0.0.10.</span> <span class="toc-text">（10）自定义CookieJar</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（11）取消请求"><span class="toc-number">31.0.0.0.11.</span> <span class="toc-text">（11）取消请求</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第三十二篇-gt-：RxJava-Retrofit-OkHttp-MVP"><span class="toc-number">32.</span> <span class="toc-text">&lt;第三十二篇&gt;：RxJava+Retrofit+OkHttp+MVP</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#（1）权限"><span class="toc-number">32.0.0.0.1.</span> <span class="toc-text">（1）权限</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（2）依赖-1"><span class="toc-number">32.0.0.0.2.</span> <span class="toc-text">（2）依赖</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（3）RxJava介绍"><span class="toc-number">32.0.0.0.3.</span> <span class="toc-text">（3）RxJava介绍</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（4）Retrofit介绍"><span class="toc-number">32.0.0.0.4.</span> <span class="toc-text">（4）Retrofit介绍</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（5）MVP介绍"><span class="toc-number">32.0.0.0.5.</span> <span class="toc-text">（5）MVP介绍</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（6）完整封装"><span class="toc-number">32.0.0.0.6.</span> <span class="toc-text">（6）完整封装</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lt-第三十四篇-gt-：Android开发需要了解的Dagger2"><span class="toc-number">33.</span> <span class="toc-text">&lt;第三十四篇&gt;：Android开发需要了解的Dagger2</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#（1）什么是Dagger2？"><span class="toc-number">33.0.0.0.1.</span> <span class="toc-text">（1）什么是Dagger2？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（2）存在的意义"><span class="toc-number">33.0.0.0.2.</span> <span class="toc-text">（2）存在的意义</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（3）注解之-Inject"><span class="toc-number">33.0.0.0.3.</span> <span class="toc-text">（3）注解之@Inject</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（4）注解之-Module"><span class="toc-number">33.0.0.0.4.</span> <span class="toc-text">（4）注解之@Module</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（5）注解之-Provides"><span class="toc-number">33.0.0.0.5.</span> <span class="toc-text">（5）注解之@Provides</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（6）注解之-Component"><span class="toc-number">33.0.0.0.6.</span> <span class="toc-text">（6）注解之@Component</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（7）添加依赖"><span class="toc-number">33.0.0.0.7.</span> <span class="toc-text">（7）添加依赖</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（8）-Inject和-Component使用"><span class="toc-number">33.0.0.0.8.</span> <span class="toc-text">（8）@Inject和@Component使用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（9）解决第（8）项构造方法中不能带参数的问题"><span class="toc-number">33.0.0.0.9.</span> <span class="toc-text">（9）解决第（8）项构造方法中不能带参数的问题</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（10）注入类拥有多个构造方法的情况"><span class="toc-number">33.0.0.0.10.</span> <span class="toc-text">（10）注入类拥有多个构造方法的情况</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（11）自定义注解替代-Named"><span class="toc-number">33.0.0.0.11.</span> <span class="toc-text">（11）自定义注解替代@Named</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（12）单例模式"><span class="toc-number">33.0.0.0.12.</span> <span class="toc-text">（12）单例模式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（13）自定义Scope"><span class="toc-number">33.0.0.0.13.</span> <span class="toc-text">（13）自定义Scope</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（14）延迟注入（Lazy）"><span class="toc-number">33.0.0.0.14.</span> <span class="toc-text">（14）延迟注入（Lazy）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（15）多个依赖的情况"><span class="toc-number">33.0.0.0.15.</span> <span class="toc-text">（15）多个依赖的情况</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（16）一个桥梁可以引用多个modules"><span class="toc-number">33.0.0.0.16.</span> <span class="toc-text">（16）一个桥梁可以引用多个modules</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（17）Component的依赖关系"><span class="toc-number">33.0.0.0.17.</span> <span class="toc-text">（17）Component的依赖关系</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#（18）可参考的其它博客"><span class="toc-number">33.0.0.0.18.</span> <span class="toc-text">（18）可参考的其它博客</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(/img/assets/730e0cf3d7ca7bcb3e16f1a1b5096b63f724a8ca.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">K的小屋</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">RxJava使用</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-04-17 23:00:00"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-04-17</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-04-26 19:21:24"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-04-26</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Android/">Android</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">38.3k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 178 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><p><img src="/" class="lazyload" data-src="/img/assets/%E4%B8%89%E5%B1%82%E6%9E%B6%E6%9E%84.png"  alt=""></p>
<p>&lt;第一篇&gt;：RxJava的基本使用</p>
<p>&lt;第二篇&gt;：RxJava之Consumer和Action的使用</p>
<p>&lt;第三篇&gt;：RxJava之do操作符</p>
<p>&lt;第四篇&gt;：RxJava之5种被观察者的创建</p>
<p>&lt;第五篇&gt;：RxJava之4种Subject</p>
<p>&lt;第六篇&gt;：用RxJava实现EventBus</p>
<p>&lt;第七篇&gt;：RxJava实现预加载</p>
<p>&lt;第八篇&gt;：RxJava之创建操作符</p>
<p>&lt;第九篇&gt;：RxJava之Cold Observable 和 Hot Observable</p>
<p>&lt;第十篇&gt;：RxJava之repeat系列</p>
<p>&lt;第十一篇&gt;：RxJava之变换操作符</p>
<h1 id="lt-第一篇-gt-：RxJava的基本使用"><a href="#lt-第一篇-gt-：RxJava的基本使用" class="headerlink" title="&lt;第一篇&gt;：RxJava的基本使用"></a>&lt;第一篇&gt;：RxJava的基本使用</h1><h4 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h4><p>本文主要针对RxJava的使用，不会对概念做过多的讲解。</p>
<h4 id="1-作用"><a href="#1-作用" class="headerlink" title="1.作用"></a>1.作用</h4><p>RxJava的目的是异步。</p>
<h4 id="2-前提"><a href="#2-前提" class="headerlink" title="2.前提"></a>2.前提</h4><p>学习RxJava之前最好对观察者设计模式的概念有所了解，下面是本人整理的博客<br><a href="https://www.jianshu.com/p/54c44d923072" target="_blank" rel="noopener">Android之观察者设计模式</a></p>
<p>观察者设计模式的使用步骤是：</p>
<ul>
<li>创建被观察者</li>
<li>创建观察者</li>
<li>观察者和被观察者之间的绑定</li>
</ul>
<p>这里需要再次提醒，想要深入了解Rxjava必须知道观察者设计模式，必须彻底理解观察者和被观察者的概念。</p>
<h4 id="3-RxJava的引用"><a href="#3-RxJava的引用" class="headerlink" title="3.RxJava的引用"></a>3.RxJava的引用</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'io.reactivex.rxjava2:rxjava:2.1.3'</span></span><br><span class="line">implementation <span class="string">'io.reactivex.rxjava2:rxandroid:2.0.1'</span></span><br></pre></td></tr></table></figure>

<h4 id="4-基本代码"><a href="#4-基本代码" class="headerlink" title="4.基本代码"></a>4.基本代码</h4><ul>
<li><p>创建被观察者</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;创建一个被观察者</span><br><span class="line">Observable&lt;String&gt; observable &#x3D; Observable.create(new ObservableOnSubscribe&lt;String&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void subscribe(ObservableEmitter&lt;String&gt; emitter) throws Exception &#123;</span><br><span class="line">        emitter.onNext(&quot;A&quot;);</span><br><span class="line">        emitter.onNext(&quot;B&quot;);</span><br><span class="line">        emitter.onNext(&quot;C&quot;);</span><br><span class="line">        emitter.onComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>分析以上代码<br>（1）Observable是rxjava封装的被观察者抽象类；<br>（2）create方法是创建一个被观察者实例；<br>（3）注意以下泛型，泛型的类型决定事件传递数据的类型；<br>（4）emitter是事件发射器，主要负责发送三种事件onNext、onError、onComplete；</p>
<ul>
<li><p>创建观察者</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建观察者</span></span><br><span class="line">Observer&lt;String&gt; observer = <span class="keyword">new</span> Observer&lt;String&gt;()&#123;</span><br><span class="line">  </span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span>(<span class="params">Disposable d</span>)</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"开始采用subscribe连接！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span>(<span class="params">String <span class="keyword">value</span></span>)</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"对Next事件作出响应:"</span>+<span class="keyword">value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span>(<span class="params">Throwable e</span>)</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"对Error事件作出响应！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"事件执行完毕！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>分析以上代码：<br>（1）onSubscribe：当被观察者和观察者关联时立刻执行，其中它的形参Disposable中的dispose()可以立刻解除观察者和被观察者的订阅（关联）关系；<br>（2）onNext：当一个任务执行完毕时再执行另一个任务；<br>（3）onError：当一个任务报错是立刻中断当前任务和后续任务的执行；<br>（4）onComplete：当所有任务执行完毕的时候执行；</p>
<ul>
<li><p>让观察者和被观察者产生关联</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//订阅</span></span><br><span class="line">observable.subscribe(observer);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>当产生关联（订阅）时，将立刻执行观察者的onSubscribe回调方法，然后再执行被观察者的subscribe回调。</p>
<h4 id="5-几种创建被观察者的方式"><a href="#5-几种创建被观察者的方式" class="headerlink" title="5.几种创建被观察者的方式"></a>5.几种创建被观察者的方式</h4><h5 id="方式1：create"><a href="#方式1：create" class="headerlink" title="方式1：create"></a>方式1：create</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建一个被观察者</span></span><br><span class="line">observable = Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;String&gt; emitter)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        emitter.onNext(<span class="string">"A"</span>);</span><br><span class="line">        emitter.onNext(<span class="string">"B"</span>);</span><br><span class="line">        emitter.onNext(<span class="string">"C"</span>);</span><br><span class="line">        emitter.onComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="方式2：fromArray"><a href="#方式2：fromArray" class="headerlink" title="方式2：fromArray"></a>方式2：fromArray</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建一个被观察者</span></span><br><span class="line">Observable observable = Observable.fromArray(<span class="string">"A"</span>, <span class="string">"B"</span>);</span><br></pre></td></tr></table></figure>

<p>相当于方式1的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">emitter.onNext(<span class="string">"A"</span>);</span><br><span class="line">emitter.onNext(<span class="string">"B"</span>);</span><br></pre></td></tr></table></figure>

<h5 id="方式3：just"><a href="#方式3：just" class="headerlink" title="方式3：just"></a>方式3：just</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建一个被观察者</span></span><br><span class="line">Observable observable = Observable.just(<span class="string">"A"</span>, <span class="string">"B"</span>);</span><br></pre></td></tr></table></figure>

<p>相当于方式1的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">emitter.onNext(<span class="string">"A"</span>);</span><br><span class="line">emitter.onNext(<span class="string">"B"</span>);</span><br></pre></td></tr></table></figure>

<h5 id="方式4：fromIterable"><a href="#方式4：fromIterable" class="headerlink" title="方式4：fromIterable"></a>方式4：fromIterable</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">List</span>&lt;String&gt; <span class="keyword">list</span> = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">list</span>.add(<span class="string">"A"</span>);</span><br><span class="line"><span class="keyword">list</span>.add(<span class="string">"B"</span>);</span><br><span class="line"><span class="comment">//创建一个被观察者</span></span><br><span class="line">observable = Observable.fromIterable(<span class="keyword">list</span>);</span><br></pre></td></tr></table></figure>

<h5 id="方式5：fromCallable（线程有回调时：Callable-）"><a href="#方式5：fromCallable（线程有回调时：Callable-）" class="headerlink" title="方式5：fromCallable（线程有回调时：Callable ）"></a>方式5：fromCallable（线程有回调时：Callable ）</h5><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Callable callable = <span class="keyword">new</span> CallbaleIml();</span><br><span class="line"><span class="keyword">new</span> Thread(<span class="keyword">new</span> FutureTask&lt;<span class="built_in">String</span>&gt;(callable)).start();</span><br><span class="line"><span class="comment">//创建一个被观察者</span></span><br><span class="line">observable = Observable.fromCallable(callable);</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CallbaleIml</span> <span class="keyword">implements</span> <span class="title">Callable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"call A"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="方式6：fromFuture（线程有回调时：Future-）"><a href="#方式6：fromFuture（线程有回调时：Future-）" class="headerlink" title="方式6：fromFuture（线程有回调时：Future ）"></a>方式6：fromFuture（线程有回调时：Future ）</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FutureIml</span> <span class="keyword">implements</span> <span class="title">Future</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">cancel</span><span class="params">(<span class="keyword">boolean</span> mayInterruptIfRunning)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isCancelled</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isDone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, ExecutionException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"AA"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(<span class="keyword">long</span> timeout, @NonNull TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException, ExecutionException, TimeoutException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"BB"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当没有延迟时，返回“AA”， 当有延迟时返回“BB”</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Future <span class="built_in">future</span> = <span class="keyword">new</span> FutureIml();</span><br><span class="line"><span class="comment">//创建一个被观察者（默认）</span></span><br><span class="line">observable = Observable.fromFuture(<span class="built_in">future</span>);</span><br><span class="line"><span class="comment">//或者</span></span><br><span class="line"><span class="comment">//创建一个被观察者（有延迟）</span></span><br><span class="line">observable = Observable.fromFuture(<span class="built_in">future</span>, <span class="number">1000</span>, TimeUnit.MILLISECONDS);</span><br></pre></td></tr></table></figure>

<h5 id="方式7：继承Publisher"><a href="#方式7：继承Publisher" class="headerlink" title="方式7：继承Publisher"></a>方式7：继承Publisher</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PublisherIml</span> <span class="keyword">implements</span> <span class="title">Publisher</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(Subscriber s)</span> </span>&#123;</span><br><span class="line">        s.onNext(<span class="string">"A"</span>);</span><br><span class="line">        s.onNext(<span class="string">"B"</span>);</span><br><span class="line">        s.onNext(<span class="string">"C"</span>);</span><br><span class="line">        s.onComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Publisher publisher = <span class="keyword">new</span> PublisherIml();</span><br></pre></td></tr></table></figure>

<h5 id="方式8：fromPublisher"><a href="#方式8：fromPublisher" class="headerlink" title="方式8：fromPublisher"></a>方式8：fromPublisher</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建一个被观察者</span></span><br><span class="line">observable = Observable.fromPublisher(publisher);</span><br></pre></td></tr></table></figure>

<h5 id="方式9：defer"><a href="#方式9：defer" class="headerlink" title="方式9：defer"></a>方式9：defer</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CallbaleIml</span> <span class="keyword">implements</span> <span class="title">Callable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ObservableSource <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Observable.just(<span class="string">"A"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Callable callable = <span class="built_in">new</span> CallbaleIml();</span><br><span class="line">observable = Observable.<span class="keyword">defer</span>(callable);</span><br></pre></td></tr></table></figure>

<p>创建被观察者还有其他方式，在后续的文章中会给出。</p>
<h1 id="lt-第二篇-gt-：RxJava之Consumer和Action的使用"><a href="#lt-第二篇-gt-：RxJava之Consumer和Action的使用" class="headerlink" title="&lt;第二篇&gt;：RxJava之Consumer和Action的使用"></a>&lt;第二篇&gt;：RxJava之Consumer和Action的使用</h1><p>第一篇我们讲到创建观察者的代码如下：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建观察者</span></span><br><span class="line">Observer&lt;String&gt; observer = <span class="keyword">new</span> Observer&lt;String&gt;()&#123;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span>(<span class="params">Disposable d</span>)</span> &#123;</span><br><span class="line">      System.<span class="keyword">out</span>.println(<span class="string">"开始采用subscribe连接！"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span>(<span class="params">String <span class="keyword">value</span></span>)</span> &#123;</span><br><span class="line">      System.<span class="keyword">out</span>.println(<span class="string">"对Next事件作出响应:"</span>+<span class="keyword">value</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span>(<span class="params">Throwable e</span>)</span> &#123;</span><br><span class="line">      System.<span class="keyword">out</span>.println(<span class="string">"对Error事件作出响应！"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      System.<span class="keyword">out</span>.println(<span class="string">"事件执行完毕！"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>代码中有四个回调方法，但是我们不一定会用到所有的回调方法，那么怎么才能让代码更加简洁呢？</p>
<p>这样我们就会用到Consumer和Action了。<br>以下是subscribe中可用参数的截图。</p>
<p><img src="/" class="lazyload" data-src="http://pyn31q2x4.bkt.clouddn.com/subscribe%E9%87%8D%E8%BD%BD%E6%96%B9%E6%B3%95.png"  alt=""></p>
<p>（1）subscribe()</p>
<p>不带任何参数，也就是说观察者没有任何回调。</p>
<p>（2）subscribe(Observer&lt;? super T&gt; observer)</p>
<p>将Observer作为参数，它有四个回调方法，文章开头就说明了。</p>
<p>（3）subscribe(Consumer&lt;? super T&gt; onNext)</p>
<p>将Consumer作为参数，Consumer中有个回调方法accept，accept带有一个参数，接收被观察者发射过来的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Observable.create(new ObservableOnSubscribe&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void subscribe(ObservableEmitter&lt;String&gt; emitter) &#123;</span><br><span class="line">        emitter.onNext(&quot;hello word A&quot;);</span><br><span class="line">        emitter.onNext(&quot;hello word B&quot;);</span><br><span class="line">        emitter.onNext(&quot;hello word C&quot;);</span><br><span class="line">        emitter.onComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribe(new Consumer&lt;String&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void accept(String s) throws Exception &#123;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>当被观察者发射onNext时，accept将被执行。</p>
<p>（4）subscribe(Consumer&lt;? super T&gt; onNext, Consumer&lt;? super Throwable&gt; onError)</p>
<p>带有两个Consumer参数，分别负责onNext和onError的回调。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;String&gt; emitter)</span> </span>&#123;</span><br><span class="line">        emitter.onNext(<span class="string">"hello word A"</span>);</span><br><span class="line">        emitter.onNext(<span class="string">"hello word B"</span>);</span><br><span class="line">        emitter.onNext(<span class="string">"hello word C"</span>);</span><br><span class="line">        emitter.onError(<span class="keyword">new</span> Throwable(<span class="string">"this is nullpointException"</span>));</span><br><span class="line">        emitter.onComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="keyword">new</span> Consumer&lt;Throwable&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Throwable throwable)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(throwable.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>执行效果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hello word A</span><br><span class="line">hello word B</span><br><span class="line">hello word C</span><br><span class="line">this is nullpointException</span><br></pre></td></tr></table></figure>



<p>（5）subscribe(Consumer&lt;? super T&gt; onNext, Consumer&lt;? super Throwable&gt; onError,Action onComplete)</p>
<p>带有三个参数，分别负责onNext、onError和onComplete的回调。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;String&gt; emitter)</span> </span>&#123;</span><br><span class="line">        emitter.onNext(<span class="string">"hello word A"</span>);</span><br><span class="line">        emitter.onNext(<span class="string">"hello word B"</span>);</span><br><span class="line">        emitter.onNext(<span class="string">"hello word C"</span>);</span><br><span class="line">        <span class="comment">//emitter.onError(new Throwable("this is nullpointException"));</span></span><br><span class="line">        emitter.onComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="keyword">new</span> Consumer&lt;Throwable&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Throwable throwable)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(throwable.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="keyword">new</span> Action() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"onComplete"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>执行效果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hello word A</span><br><span class="line">hello word B</span><br><span class="line">hello word C</span><br><span class="line">onComplete</span><br></pre></td></tr></table></figure>



<p>（6）subscribe(Consumer&lt;? super T&gt; onNext, Consumer&lt;? super Throwable&gt; onError,Action onComplete, Consumer&lt;? super Disposable&gt; onSubscribe)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;String&gt; emitter)</span> </span>&#123;</span><br><span class="line">        emitter.onNext(<span class="string">"hello word A"</span>);</span><br><span class="line">        emitter.onNext(<span class="string">"hello word B"</span>);</span><br><span class="line">        emitter.onNext(<span class="string">"hello word C"</span>);</span><br><span class="line">        <span class="comment">//emitter.onError(new Throwable("this is nullpointException"));</span></span><br><span class="line">        emitter.onComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="keyword">new</span> Consumer&lt;Throwable&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Throwable throwable)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(throwable.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="keyword">new</span> Action() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"onComplete"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="keyword">new</span> Consumer&lt;Disposable&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Disposable disposable)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"观察者和被观察者已被连接，disposable可以立即中断连接！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>执行效果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">观察者和被观察者已被连接，disposable可以立即中断连接！</span><br><span class="line">hello word A</span><br><span class="line">hello word B</span><br><span class="line">hello word C</span><br><span class="line">onComplete</span><br></pre></td></tr></table></figure>





<p>想要搞清楚Consumer和Action的用法，必须了解他们是什么东西？他们是干什么的？</p>
<p>（1）他们是什么？</p>
<p>他们都是接口，源码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Consumer</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Consume the given value.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> t the value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception on error</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">accept</span><span class="params">(T t)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Action</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Runs the action and optionally throws a checked exception.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception if the implementation wishes to throw a checked exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（2）他们是干什么的？</p>
<p>他们都是为了触发回调的，Consumer自带一个参数，Action不带参数。</p>
<p>当被观察者发射onNext时，由于onNext带有参数，所有使用Consumer；<br>当被观察者发射onComplete时，由于onComplete不带参数，所以使用Action；</p>
<h1 id="lt-第三篇-gt-：RxJava之do操作符"><a href="#lt-第三篇-gt-：RxJava之do操作符" class="headerlink" title="&lt;第三篇&gt;：RxJava之do操作符"></a>&lt;第三篇&gt;：RxJava之do操作符</h1><p>do操作符用的相对比较少，就好比do…while循环和while循环，前者相对后者来说使用次数较少。</p>
<p>do操作符基本代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;String&gt; emitter)</span> </span>&#123;</span><br><span class="line">        emitter.onNext(<span class="string">"hello word A"</span>);</span><br><span class="line">        emitter.onNext(<span class="string">"hello word B"</span>);</span><br><span class="line">        emitter.onNext(<span class="string">"hello word C"</span>);</span><br><span class="line">        <span class="comment">//emitter.onError(new Throwable("this is nullpointException"));</span></span><br><span class="line">        emitter.onComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).doOnSubscribe(<span class="keyword">new</span> Consumer&lt;Disposable&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Disposable disposable)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"doOnSubscribe -- 观察者和被观察者连接时被调用"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).doOnNext(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"doOnNext -- "</span>+s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).doAfterNext(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"doAfterNext -- "</span>+s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).doOnDispose(<span class="keyword">new</span> Action() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"doOnDispose -- "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).doAfterTerminate(<span class="keyword">new</span> Action() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"doAfterTerminate -- "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).doFinally(<span class="keyword">new</span> Action() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"doFinally -- "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).doOnComplete(<span class="keyword">new</span> Action() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"doOnComplete -- "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).doOnError(<span class="keyword">new</span> Consumer&lt;Throwable&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Throwable throwable)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"doOnError -- "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).doOnLifecycle(<span class="keyword">new</span> Consumer&lt;Disposable&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Disposable disposable)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"doOnLifecycle1 -- "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="keyword">new</span> Action() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"doOnLifecycle2 -- "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).doOnEach(<span class="keyword">new</span> Consumer&lt;Notification&lt;String&gt;&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Notification&lt;String&gt; stringNotification)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"doOnEach -- "</span>+stringNotification.getValue());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribe();</span><br></pre></td></tr></table></figure>

<p>执行效果如下：</p>
<p><img src="/" class="lazyload" data-src="http://pyn31q2x4.bkt.clouddn.com/do%E6%93%8D%E4%BD%9C%E7%AC%A6%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C.png"  alt=""></p>
<p>基本说明</p>
<p>（1）doOnSubscribe：在被观察者和观察者产生关联的时候被调用，disposable可以立即取消订阅；<br>（2）doOnLifecycle：可以在订阅之后设置是否取消订阅；<br>（3）doNext和doAfterNext：可以接收到被观察者发射过来的数据；<br>（4）doOnEach：当onNext、onError、onComplete被触发是被调用；<br>（5）doOnComplete：当触发onComplete时被调用；<br>（6）doOnError：当触发onError时被调用；<br>（7）doFinally：当触发onError或onComplete时被调用；<br>（8）doOnDispose：当取消订阅时被调用；<br>（9）doAfterTerminate：订阅终止时被调用；</p>
<h1 id="lt-第四篇-gt-：RxJava之5种被观察者的创建"><a href="#lt-第四篇-gt-：RxJava之5种被观察者的创建" class="headerlink" title="&lt;第四篇&gt;：RxJava之5种被观察者的创建"></a>&lt;第四篇&gt;：RxJava之5种被观察者的创建</h1><p>5种被观察者分别是：Observable，Flowable, Single, Completable, Maybe。<br>五种被观察者可通过toObservable，toFlowable,toSingle,toCompletable,toMaybe相互转换。</p>
<h4 id="（1）Observable"><a href="#（1）Observable" class="headerlink" title="（1）Observable"></a>（1）Observable</h4><ul>
<li>Observable即被观察者，决定什么时候触发事件以及触发怎样的事件。</li>
<li>Oberver即观察者，他可以在不同的线程中执行任务，极大的简化了并发操作，因为他创建了一个处于待命状态的观察者，可以在某一时刻响应Observable的通知，而不会造成阻塞。</li>
<li>ObservableEmitter数据发射器，发射Observable的onNext，onError，onComplete，onSubscribe方法。</li>
<li>subscribe() 订阅Observable的四个方法，只有调用此方法才会开始发射数据。其有4个构造方法：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">subscribe(onNext()) </span><br><span class="line">subscribe(onNext(),onError()) </span><br><span class="line">subscribe(onNext(),onError(),onComplete())     </span><br><span class="line">subscribe(onNext(),onError(),onComplete(),onSubscribe())</span><br></pre></td></tr></table></figure>

<p>具体实现前几篇已经说明了，本篇就不介绍了。</p>
<h4 id="（2）Flowable"><a href="#（2）Flowable" class="headerlink" title="（2）Flowable"></a>（2）Flowable</h4><p>可以看成是Observable的实现，只有Flowable支持压背</p>
<ul>
<li>Observable：<br><code>一般处理不超过1000条数据，几乎不会造成内存溢出</code><br><code>不会背压</code><br><code>处理同步流</code></li>
<li>Flowable：<br><code>处理超过10KB的数据元素</code><br><code>文件读取与分析</code><br><code>读取数据库</code><br><code>处理网络I/O流</code><br><code>创建一个响应式的非阻塞接口</code></li>
</ul>
<p>压背的实现会在后续章节中讲解。</p>
<h4 id="（3）Single"><a href="#（3）Single" class="headerlink" title="（3）Single"></a>（3）Single</h4><p>只有onSuccess和onError回调，Single只会发射一次数据<br>具体实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Single.create(<span class="keyword">new</span> SingleOnSubscribe&lt;CountBean&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(SingleEmitter&lt;CountBean&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!e.isDisposed())&#123;</span><br><span class="line">            CountBean countBean = <span class="keyword">new</span> CountBean();</span><br><span class="line">            countBean.setCount(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span>(countBean.getCount() == <span class="number">1</span>)&#123;</span><br><span class="line">                e.onSuccess(countBean);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                e.onError(<span class="keyword">new</span> Throwable(<span class="string">"nullpoint exception"</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribe(<span class="keyword">new</span> Consumer&lt;CountBean&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(CountBean countBean)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"count:"</span> + countBean.getCount());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="keyword">new</span> Consumer&lt;Throwable&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Throwable throwable)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"exception:"</span> + throwable.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Single.create(<span class="keyword">new</span> SingleOnSubscribe&lt;CountBean&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(SingleEmitter&lt;CountBean&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!e.isDisposed())&#123;</span><br><span class="line">            CountBean countBean = <span class="keyword">new</span> CountBean();</span><br><span class="line">            countBean.setCount(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span>(countBean.getCount() == <span class="number">1</span>)&#123;</span><br><span class="line">                e.onSuccess(countBean);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                e.onError(<span class="keyword">new</span> Throwable(<span class="string">"nullpoint exception"</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribe(<span class="keyword">new</span> SingleObserver&lt;CountBean&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Disposable d)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"被观察者和观察者开始连接！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(CountBean countBean)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"count:"</span>+countBean.getCount());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"exception:"</span>+e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="（4）Completable"><a href="#（4）Completable" class="headerlink" title="（4）Completable"></a>（4）Completable</h4><p>只有onComplete和onError事件， 和Single不同， Completable不发射数据。</p>
<p>具体实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Completable.create(<span class="keyword">new</span> CompletableOnSubscribe() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(CompletableEmitter e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!e.isDisposed())&#123;</span><br><span class="line">            CountBean countBean = <span class="keyword">new</span> CountBean();</span><br><span class="line">            countBean.setCount(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span>(countBean.getCount() == <span class="number">1</span>)&#123;</span><br><span class="line">                e.onComplete();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                e.onError(<span class="keyword">new</span> Throwable(<span class="string">"nullpoint exception"</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribe(<span class="keyword">new</span> Action() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="keyword">new</span> Consumer&lt;Throwable&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Throwable throwable)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Completable.create(<span class="keyword">new</span> CompletableOnSubscribe() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(CompletableEmitter e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!e.isDisposed())&#123;</span><br><span class="line">            CountBean countBean = <span class="keyword">new</span> CountBean();</span><br><span class="line">            countBean.setCount(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span>(countBean.getCount() == <span class="number">1</span>)&#123;</span><br><span class="line">                e.onComplete();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                e.onError(<span class="keyword">new</span> Throwable(<span class="string">"nullpoint exception"</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribe(<span class="keyword">new</span> CompletableObserver() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Disposable d)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="（5）Maybe"><a href="#（5）Maybe" class="headerlink" title="（5）Maybe"></a>（5）Maybe</h4><p>没有onNext方法，同样需要onSuccess发射数据，且只能发射0或1个数据，多发也不再处理。</p>
<p>具体实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Maybe.create(<span class="keyword">new</span> MaybeOnSubscribe&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(MaybeEmitter&lt;String&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!e.isDisposed())&#123;</span><br><span class="line">            CountBean countBean = <span class="keyword">new</span> CountBean();</span><br><span class="line">            countBean.setCount(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(countBean.getCount() == <span class="number">1</span>)&#123;</span><br><span class="line">                e.onSuccess(<span class="string">"aaaaa"</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(countBean.getCount() == <span class="number">0</span>)&#123;</span><br><span class="line">                e.onComplete();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                e.onError(<span class="keyword">new</span> Throwable(<span class="string">"nullpoint exception"</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribe(<span class="keyword">new</span> MaybeObserver&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Disposable d)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"onSuccess:"</span>+s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"onError"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"onComplete"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h1 id="lt-第五篇-gt-：RxJava之4种Subject"><a href="#lt-第五篇-gt-：RxJava之4种Subject" class="headerlink" title="&lt;第五篇&gt;：RxJava之4种Subject"></a>&lt;第五篇&gt;：RxJava之4种Subject</h1><p>4种Subject 分别为：AsyncSubject、BehaviorSubject、ReplaySubject、PublishSubject</p>
<p>Subject将观察者和被观察者结合为一体，是观察者和被观察者的代理。</p>
<h4 id="（1）AsyncSubject"><a href="#（1）AsyncSubject" class="headerlink" title="（1）AsyncSubject"></a>（1）AsyncSubject</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">AsyncSubject asyncSubject = AsyncSubject.create();</span><br><span class="line">asyncSubject.onNext(<span class="string">"A"</span>);</span><br><span class="line">asyncSubject.onNext(<span class="string">"B"</span>);</span><br><span class="line">asyncSubject.subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"接收发射过来的数据："</span>+s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="keyword">new</span> Consumer&lt;Throwable&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Throwable throwable)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="keyword">new</span> Action() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"执行完成！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">asyncSubject.onNext(<span class="string">"C"</span>);</span><br><span class="line">asyncSubject.onComplete();</span><br></pre></td></tr></table></figure>

<p>日志如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">接收发射过来的数据：C</span><br><span class="line">执行完成！</span><br></pre></td></tr></table></figure>





<p>也就是说，AsyncSubject 无论发射多少条数据，无论在订阅前发射还是在订阅后发射，都只会收到最后一条发射的数据。</p>
<h4 id="（2）BehaviorSubject"><a href="#（2）BehaviorSubject" class="headerlink" title="（2）BehaviorSubject"></a>（2）BehaviorSubject</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">BehaviorSubject behaviorSubject = BehaviorSubject.create();</span><br><span class="line">behaviorSubject.onNext(<span class="string">"A"</span>);</span><br><span class="line">behaviorSubject.onNext(<span class="string">"B"</span>);</span><br><span class="line">behaviorSubject.subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"接收发射过来的数据："</span>+s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="keyword">new</span> Consumer&lt;Throwable&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Throwable throwable)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="keyword">new</span> Action() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"执行完成！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">behaviorSubject.onNext(<span class="string">"C"</span>);</span><br><span class="line">behaviorSubject.onComplete();</span><br></pre></td></tr></table></figure>

<p>日志如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">接收发射过来的数据：B</span><br><span class="line">接收发射过来的数据：C</span><br><span class="line">执行完成！</span><br></pre></td></tr></table></figure>





<p>也就是说，BehaviorSubjec只会接收到订阅前最后一条发射的数据以及订阅之后所有的数据。</p>
<h4 id="（3）ReplaySubject"><a href="#（3）ReplaySubject" class="headerlink" title="（3）ReplaySubject"></a>（3）ReplaySubject</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">ReplaySubject replaySubject = ReplaySubject.create();</span><br><span class="line">replaySubject.onNext(<span class="string">"A"</span>);</span><br><span class="line">replaySubject.onNext(<span class="string">"B"</span>);</span><br><span class="line">replaySubject.subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"接收发射过来的数据："</span>+s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="keyword">new</span> Consumer&lt;Throwable&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Throwable throwable)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="keyword">new</span> Action() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"执行完成！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">replaySubject.onNext(<span class="string">"C"</span>);</span><br><span class="line">replaySubject.onComplete();</span><br></pre></td></tr></table></figure>

<p>日志如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">接收发射过来的数据：A</span><br><span class="line">接收发射过来的数据：B</span><br><span class="line">接收发射过来的数据：C</span><br><span class="line">执行完成！</span><br></pre></td></tr></table></figure>



<p>也就是说，ReplaySubject会接收到全部数据。</p>
<p>这里需要补充一下：<br>ReplaySubject可以限制缓存的大小，也可以限制缓存的时间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ReplaySubject replaySubject &#x3D; ReplaySubject.createWithSize(1);</span><br><span class="line">ReplaySubject replaySubject &#x3D; ReplaySubject.createWithTime(1000, TimeUnit.MILLISECONDS, Schedulers.newThread());</span><br><span class="line">ReplaySubject replaySubject &#x3D; ReplaySubject.createWithTimeAndSize(1000, TimeUnit.MILLISECONDS, Schedulers.newThread(), 1);</span><br></pre></td></tr></table></figure>

<ul>
<li>createWithSize 限制可以接收<code>订阅前</code>发射数据的条数；</li>
<li>createWithTime 限制时间内可以接收<code>订阅前</code>发射的数据；</li>
<li>createWithTimeAndSize 限制时间内可以接收<code>订阅前</code>发射数据的条数；</li>
</ul>
<h4 id="（4）PublishSubject"><a href="#（4）PublishSubject" class="headerlink" title="（4）PublishSubject"></a>（4）PublishSubject</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">PublishSubject publishSubject = PublishSubject.create();</span><br><span class="line"></span><br><span class="line">publishSubject.onNext(<span class="string">"A"</span>);</span><br><span class="line">publishSubject.onNext(<span class="string">"B"</span>);</span><br><span class="line">publishSubject.subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"接收发射过来的数据："</span>+s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="keyword">new</span> Consumer&lt;Throwable&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Throwable throwable)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="keyword">new</span> Action() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"执行完成！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">publishSubject.onNext(<span class="string">"C"</span>);</span><br><span class="line">publishSubject.onComplete();</span><br></pre></td></tr></table></figure>

<p>日志如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">接收发射过来的数据：C</span><br><span class="line">执行完成！</span><br></pre></td></tr></table></figure>



<p>也就是说，PublishSubject只会接收到订阅之后的所有数据。</p>
<h1 id="lt-第六篇-gt-：用RxJava实现EventBus"><a href="#lt-第六篇-gt-：用RxJava实现EventBus" class="headerlink" title="&lt;第六篇&gt;：用RxJava实现EventBus"></a>&lt;第六篇&gt;：用RxJava实现EventBus</h1><h3 id="（1）没有压背处理的Rxbus"><a href="#（1）没有压背处理的Rxbus" class="headerlink" title="（1）没有压背处理的Rxbus"></a>（1）没有压背处理的Rxbus</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RxBus</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Subject&lt;Object&gt; bus;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">RxBus</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">//把非线程安全的PublishSubject包装成线程安全的SerializedSubject</span></span><br><span class="line">        bus = PublishSubject.create().toSerialized();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RxBus <span class="title">getDefault</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">SingletonHolder</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">volatile</span> RxBus INSTANCE = <span class="keyword">new</span> RxBus();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送事件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param event 事件对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">post</span>(<span class="params">Object <span class="keyword">event</span></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (bus.hasObservers()) &#123;</span><br><span class="line">            bus.onNext(<span class="keyword">event</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 监听事件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @return 特定类型的Observable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Observable&lt;Object&gt; <span class="title">observe</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 监听事件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param event 事件对象</span></span><br><span class="line"><span class="comment">     * @param &lt;T&gt;       事件类型</span></span><br><span class="line"><span class="comment">     * @return 特定类型的Observable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">Observable&lt;T&gt; <span class="title">observe</span>(<span class="params">Class&lt;T&gt; <span class="keyword">event</span></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bus.ofType(<span class="keyword">event</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注册：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">RxBus.getDefault().observe(CountBean<span class="class">.<span class="keyword">class</span>).<span class="title">subscribe</span>(<span class="title">new</span> <span class="title">Consumer</span>&lt;<span class="title">CountBean</span>&gt;() </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(CountBean countBean)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"count:"</span>+countBean.getCount());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>发送数据：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CountBean countBean = <span class="keyword">new</span> CountBean();</span><br><span class="line">countBean.setCount(<span class="number">1</span>);</span><br><span class="line">RxBus.getDefault().post(countBean);</span><br></pre></td></tr></table></figure>

<h3 id="（2）有压背处理的Rxbus"><a href="#（2）有压背处理的Rxbus" class="headerlink" title="（2）有压背处理的Rxbus"></a>（2）有压背处理的Rxbus</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RxBus</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> FlowableProcessor&lt;Object&gt; bus;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">RxBus</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">//把非线程安全的PublishSubject包装成线程安全的SerializedSubject</span></span><br><span class="line">        bus = PublishProcessor.create().toSerialized();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RxBus <span class="title">getDefault</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">SingletonHolder</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">volatile</span> RxBus INSTANCE = <span class="keyword">new</span> RxBus();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送事件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param event 事件对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">post</span>(<span class="params">Object <span class="keyword">event</span></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (bus.hasSubscribers()) &#123;</span><br><span class="line">            bus.onNext(<span class="keyword">event</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 监听事件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @return 特定类型的Observable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Flowable&lt;Object&gt; <span class="title">observe</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 监听事件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param event 事件对象</span></span><br><span class="line"><span class="comment">     * @param &lt;T&gt;       事件类型</span></span><br><span class="line"><span class="comment">     * @return 特定类型的Observable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">Flowable&lt;T&gt; <span class="title">observe</span>(<span class="params">Class&lt;T&gt; <span class="keyword">event</span></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bus.ofType(<span class="keyword">event</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="lt-第七篇-gt-：RxJava实现预加载"><a href="#lt-第七篇-gt-：RxJava实现预加载" class="headerlink" title="&lt;第七篇&gt;：RxJava实现预加载"></a>&lt;第七篇&gt;：RxJava实现预加载</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 预加载</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class RxPreLoader&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;能够缓存订阅之前的最新数据</span><br><span class="line">    private BehaviorSubject&lt;T&gt; mData;</span><br><span class="line">    private Disposable disposable;</span><br><span class="line"></span><br><span class="line">    public RxPreLoader(T defaultValue)&#123;</span><br><span class="line">        mData &#x3D; BehaviorSubject.createDefault(defaultValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 发送事件</span><br><span class="line">     * @param object</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public void publish(T object)&#123;</span><br><span class="line">        mData.onNext(object);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 订阅事件</span><br><span class="line">     * @param onNext</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public Disposable subscribe(Consumer&lt;T&gt; onNext)&#123;</span><br><span class="line">        Disposable disposable &#x3D; mData.subscribe(onNext);</span><br><span class="line">        return disposable;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 取消订阅</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public void dispose()&#123;</span><br><span class="line">        if(disposable !&#x3D; null &amp;&amp; !disposable.isDisposed())&#123;</span><br><span class="line">            disposable.dispose();</span><br><span class="line">            disposable &#x3D; null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 获取缓存数据的Subject</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public BehaviorSubject&lt;T&gt; getCacheDataSubject() &#123;</span><br><span class="line">        return mData;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 获取最近的数据</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public T getLastCacheData()&#123;</span><br><span class="line">        return mData.getValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="lt-第八篇-gt-：RxJava之创建操作符"><a href="#lt-第八篇-gt-：RxJava之创建操作符" class="headerlink" title="&lt;第八篇&gt;：RxJava之创建操作符"></a>&lt;第八篇&gt;：RxJava之创建操作符</h1><h4 id="（1）create"><a href="#（1）create" class="headerlink" title="（1）create"></a>（1）create</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Observable</span><span class="selector-class">.create</span>();</span><br><span class="line"><span class="selector-tag">Flowable</span><span class="selector-class">.create</span>();</span><br><span class="line"><span class="selector-tag">Single</span><span class="selector-class">.create</span>();</span><br><span class="line"><span class="selector-tag">Completable</span><span class="selector-class">.create</span>();</span><br><span class="line"><span class="selector-tag">Maybe</span><span class="selector-class">.create</span>();</span><br></pre></td></tr></table></figure>

<p>用来创建被观察者， 5种被观察者都可以使用create操作符创建。</p>
<h4 id="（2）just"><a href="#（2）just" class="headerlink" title="（2）just"></a>（2）just</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>);</span><br><span class="line">Flowable.just(<span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>);</span><br><span class="line">Single.just(<span class="string">"1"</span>);</span><br><span class="line">Maybe.just(<span class="string">"1"</span>);</span><br></pre></td></tr></table></figure>

<p>只有四种被观察者可以使用just，一旦使用just就必须发射一条数据。</p>
<ul>
<li><p>Observable 可以发射0个或多个数据，标准写法如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="string">"1"</span>);</span><br><span class="line">Observable.just(<span class="string">"1"</span>, <span class="string">"2"</span>);</span><br><span class="line">Observable.just(<span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>Flowable可以发射0个或多个数据，标准写法如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Flowable.just(<span class="string">"1"</span>);</span><br><span class="line">Flowable.just(<span class="string">"1"</span>, <span class="string">"2"</span>);</span><br><span class="line">Flowable.just(<span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>Single只能发射一条数据，标准写法如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Single.just(<span class="string">"1"</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>Completable不能发射数据，由于just至少要有一条数据，所以Completable没有just操作符；</p>
</li>
<li><p>Maybe只能发射0条或1条数据，由于just至少要有一条数据，所以标准写法如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Maybe.just(<span class="string">"1"</span>);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>另外，需要注意的是：</p>
<p><strong>just操作符最多可以设置10个参数。</strong></p>
<h4 id="（3）from"><a href="#（3）from" class="headerlink" title="（3）from"></a>（3）from</h4><p>from只要是将其他类种的对象和数据类型转成Observable</p>
<ul>
<li><p>fromPublisher 将Publisher转成Observable</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Observable.fromPublisher(new Publisher&lt;String&gt;() &#123;</span><br><span class="line">  </span><br><span class="line">    @Override</span><br><span class="line">    public void subscribe(Subscriber&lt;? super String&gt; s) &#123;</span><br><span class="line">        s.onNext(&quot;A&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribe(new Consumer&lt;String&gt;() &#123;</span><br><span class="line">  </span><br><span class="line">    @Override</span><br><span class="line">    public void accept(String o) throws Exception &#123;</span><br><span class="line">        System.out.println(o);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>Publisher将在后续介绍压背的时候重点提出。</p>
<ul>
<li><p>fromArray 将数组转成Observable</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Observable.fromArray(<span class="string">"A"</span>, <span class="string">"B"</span>, <span class="string">"C"</span>);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>看一下源码</p>
<p><img src="/" class="lazyload" data-src="http://pyn31q2x4.bkt.clouddn.com/fromArray%E6%BA%90%E7%A0%81.png"  alt=""></p>
<p>在这里被我圈出来的可变长度参数，也就是说参数的个数是可变的。</p>
<ul>
<li><p>fromIterable 将集合转成Observable</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">List</span>&lt;String&gt; <span class="keyword">list</span> = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">Observable.fromIterable(<span class="keyword">list</span>);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>fromIterable的参数是Iterable类型， Collection是Iterable的子接口，所以只要是最终实现Collection接口的集合都可以作为参数，以下的java集合框架图可以作为参考：</p>
<p><img src="/" class="lazyload" data-src="http://pyn31q2x4.bkt.clouddn.com/Collection%E6%8E%A5%E5%8F%A3.png"  alt=""></p>
<ul>
<li><p>fromCallable 将Callable转成Observable</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService singleThreadExecutor = Executors.newSingleThreadExecutor();</span><br><span class="line">  </span><br><span class="line">Callable callable = <span class="keyword">new</span> Callable&lt;String&gt;() &#123;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"A"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">  </span><br><span class="line">singleThreadExecutor.submit(callable);</span><br><span class="line">  </span><br><span class="line">Observable.fromCallable(callable).subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>fromFuture 将Future转成Observable</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService singleThreadExecutor = Executors.newSingleThreadExecutor();</span><br><span class="line">  </span><br><span class="line">Future future = singleThreadExecutor.submit(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="string">"A"</span>);</span><br><span class="line">  </span><br><span class="line">Observable.fromFuture(future).subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>注意：其他被观察者也可以使用from操作符</p>
<p><img src="/" class="lazyload" data-src="http://pyn31q2x4.bkt.clouddn.com/from%E6%93%8D%E4%BD%9C%E7%AC%A61.png"  alt=""></p>
<p><img src="/" class="lazyload" data-src="http://pyn31q2x4.bkt.clouddn.com/from%E6%93%8D%E4%BD%9C%E7%AC%A62.png"  alt=""></p>
<p><img src="/" class="lazyload" data-src="http://pyn31q2x4.bkt.clouddn.com/from%E6%93%8D%E4%BD%9C%E7%AC%A63.png"  alt=""></p>
<p><img src="/" class="lazyload" data-src="http://pyn31q2x4.bkt.clouddn.com/from%E6%93%8D%E4%BD%9C%E7%AC%A64.png"  alt=""></p>
<h4 id="（4）range"><a href="#（4）range" class="headerlink" title="（4）range"></a>（4）range</h4><p>发射0~9之间的整数，左闭右开[0,9)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Observable.range(<span class="number">0</span>, <span class="number">9</span>).subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(String.valueOf(integer));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>其他方式</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Observable</span><span class="selector-class">.rangeLong</span>();</span><br><span class="line"><span class="selector-tag">Flowable</span><span class="selector-class">.range</span>();</span><br><span class="line"><span class="selector-tag">Flowable</span><span class="selector-class">.rangeLong</span>();</span><br></pre></td></tr></table></figure>

<h4 id="（5）-defer"><a href="#（5）-defer" class="headerlink" title="（5） defer"></a>（5） defer</h4><p>defer只有在订阅的时候才会创建被观察者，以保证每次发射的数据是最新的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Observable.defer(<span class="keyword">new</span> Callable&lt;ObservableSource&lt;String&gt;&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ObservableSource&lt;String&gt; <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Observable.just(<span class="string">"A"</span>, <span class="string">"B"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>其他方式</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Flowable</span><span class="selector-class">.defer</span>();</span><br><span class="line"><span class="selector-tag">Single</span><span class="selector-class">.defer</span>();</span><br><span class="line"><span class="selector-tag">Completable</span><span class="selector-class">.defer</span>();</span><br><span class="line"><span class="selector-tag">Maybe</span><span class="selector-class">.defer</span>();</span><br></pre></td></tr></table></figure>

<h4 id="（6）interval"><a href="#（6）interval" class="headerlink" title="（6）interval"></a>（6）interval</h4><p>创建一个按固定时间间隔发射整数序列的Observable</p>
<p><img src="/" class="lazyload" data-src="http://pyn31q2x4.bkt.clouddn.com/interval%E6%93%8D%E4%BD%9C%E7%AC%A6.png"  alt=""></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//延迟initialDelay秒后，按period秒定时时间间隔发射整数序列，调度器为computation</span></span><br><span class="line">Observable.interval(<span class="number">1000</span>, <span class="number">1000</span>, TimeUnit.MILLISECONDS, Schedulers.computation());</span><br><span class="line"></span><br><span class="line"><span class="comment">//延迟period秒后，按period秒定时时间间隔发射整数序列，调度器为computation</span></span><br><span class="line">Observable.interval(<span class="number">1000</span>, TimeUnit.MILLISECONDS).subscribe(<span class="keyword">new</span> Consumer&lt;Long&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Long aLong)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(String.valueOf(aLong));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>有关Schedulers的讲解：</p>
<ul>
<li>Schedulers.computation() :<br>用于cpu密集型计算任务，即不会被被I/O等操作限制性能的耗时操作，例如XML，JSON文件的解析，Bitmap图片的压缩取样等，具有固定的线程池，大小为CPU核数，不可以用于IO操作，因为IO操作的等待时间会浪费cpu</li>
<li>Schedulers.from(@NonNull Excutor excutor):指定一个线程调度器，由此调度器来控制任务的执行策略。</li>
<li>Schedulers.io():用于IO密集型的操作，例如写磁盘操作，查询数据库，网络访问，具有线程缓存机制，在此调度器接收到任务之后，先检查线程缓存池中是否有空闲的线程可用，如果有，复用，如果没有则 创建新的线程，并将其加入到线程池中，如果每次都没有空闲的线程使用，可以无上限的创建线程。</li>
<li>Schedulers.newThread(): 在每执行一个任务时创建一个新的线程，不具有线程缓存机制，由于创建一个线程比起复用一个线程更加耗时耗力，虽然使用Schedulers.io()的地方都可以使用Schedulers.newThread(),但是总体上的Schedulers.newThread()的效率没有Schedulers.io()的高。</li>
<li>Schedulers.trampoline():在当前线程立即执行任务，如果当前线程有任务在执行，则会将其暂停下来，等插入进来的任务执行完成之后，再将未完成的任务接着执行。</li>
<li>Schedulers.single():拥有一个线程单例，所有的任务都在这一个线程中执行，当此线程中有任务在执行的时候其他任务将按照队列先进先出的顺序依次执行。</li>
<li>AndroidSchedulers.mainThread():在Andriod UI线程中执行任务，属于Android的专属定制。</li>
</ul>
<p>注意：在Rxjava 2.x版本中，废弃了1.x版本Schedulers.immediate(),在1.x中，Schedulers.immediate的作用是在当前线程中立即执行任务，功能等同于Rxjava中的2.x版本中的Schedulers.trampoline(),而在Schedulers.trampoline()在1.x版本的时候，作用是：当其他排队的任务执行完成之后，在当前线程排队开始执行接收到的任务，有点像2.x版本的Schedulers.single(),但是也不完全相同，因为Schedulers.single()不是在当前线程而是在一个线程单例中排队执行任务。</p>
<p>其他方式</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Flowable</span><span class="selector-class">.interval</span>();</span><br></pre></td></tr></table></figure>

<h4 id="（7）timer"><a href="#（7）timer" class="headerlink" title="（7）timer"></a>（7）timer</h4><p>实现延迟执行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Observable.timer(<span class="number">1000</span>, TimeUnit.MILLISECONDS).subscribe(<span class="keyword">new</span> Consumer&lt;Long&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Long aLong)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(String.valueOf(aLong));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Observable.timer(<span class="number">1000</span>, TimeUnit.MILLISECONDS, Schedulers.computation());</span><br></pre></td></tr></table></figure>

<p>其他方式</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Flowable</span><span class="selector-class">.timer</span>();</span><br><span class="line"><span class="selector-tag">Single</span><span class="selector-class">.timer</span>();</span><br><span class="line"><span class="selector-tag">Completable</span><span class="selector-class">.timer</span>();</span><br><span class="line"><span class="selector-tag">Maybe</span><span class="selector-class">.timer</span>();</span><br></pre></td></tr></table></figure>

<h4 id="（8）empty"><a href="#（8）empty" class="headerlink" title="（8）empty"></a>（8）empty</h4><p>使直接完成发射数据，也就是直接执行了onComplete。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Observable.empty().subscribe(<span class="keyword">new</span> Observer&lt;Object&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span>(<span class="params">Disposable d</span>)</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"11111111111111"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span>(<span class="params">Object o</span>)</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"2222222222222"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span>(<span class="params">Throwable e</span>)</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"33333333333333"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"4444444444444444"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>其他方式</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Flowable</span><span class="selector-class">.empty</span>();</span><br><span class="line"><span class="selector-tag">Maybe</span><span class="selector-class">.empty</span>();</span><br></pre></td></tr></table></figure>

<h4 id="（9）error"><a href="#（9）error" class="headerlink" title="（9）error"></a>（9）error</h4><p>使直接发生异常结束发射数据，也就是直接执行了onError。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Observable.error(<span class="keyword">new</span> Throwable(<span class="string">"nullpoint exception"</span>)).subscribe(<span class="keyword">new</span> Observer&lt;Object&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span>(<span class="params">Disposable d</span>)</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"11111111111111"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span>(<span class="params">Object o</span>)</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"2222222222222"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span>(<span class="params">Throwable e</span>)</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"4444444444444444"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>其他方式</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Flowable</span><span class="selector-class">.error</span>();</span><br><span class="line"><span class="selector-tag">Single</span><span class="selector-class">.error</span>();</span><br><span class="line"><span class="selector-tag">Completable</span><span class="selector-class">.error</span>();</span><br><span class="line"><span class="selector-tag">Maybe</span><span class="selector-class">.error</span>();</span><br></pre></td></tr></table></figure>

<h4 id="（10）never"><a href="#（10）never" class="headerlink" title="（10）never"></a>（10）never</h4><p>不发射数据，也不结束发射。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Observable.never().subscribe(<span class="keyword">new</span> Observer&lt;Object&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span>(<span class="params">Disposable d</span>)</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"11111111111111"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span>(<span class="params">Object o</span>)</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"2222222222222"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span>(<span class="params">Throwable e</span>)</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"4444444444444444"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>其他方式</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Flowable</span><span class="selector-class">.never</span>();</span><br><span class="line"><span class="selector-tag">Single</span><span class="selector-class">.never</span>();</span><br><span class="line"><span class="selector-tag">Completable</span><span class="selector-class">.never</span>();</span><br><span class="line"><span class="selector-tag">Maybe</span><span class="selector-class">.never</span>();</span><br></pre></td></tr></table></figure>



<h1 id="lt-第九篇-gt-：RxJava之Cold-Observable-和-Hot-Observable"><a href="#lt-第九篇-gt-：RxJava之Cold-Observable-和-Hot-Observable" class="headerlink" title="&lt;第九篇&gt;：RxJava之Cold Observable 和 Hot Observable"></a>&lt;第九篇&gt;：RxJava之Cold Observable 和 Hot Observable</h1><p>Observable 数据流有两种类型：hot 和 cold。</p>
<h4 id="（1）Cold-Observable"><a href="#（1）Cold-Observable" class="headerlink" title="（1）Cold Observable"></a>（1）Cold Observable</h4><p>只有当有订阅者订阅的时候， Cold Observable 才开始执行发射数据流的代码。并且每个订阅者订阅的时候都独立的执行一遍数据流代码。 Observable.interval就是一个 典型的Cold Observable。每一个订阅者都会独立的收到他们的数据流。</p>
<p>我们来验证一下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Observable observable =  Observable.interval(<span class="number">1000</span>, TimeUnit.MILLISECONDS);</span><br><span class="line">observable.subscribe(<span class="keyword">new</span> Consumer&lt;Long&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Long l)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"第一个："</span>+String.valueOf(l));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">observable.subscribe(<span class="keyword">new</span> Consumer&lt;Long&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Long l)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"第二个："</span>+String.valueOf(l));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>运行效果</p>
<p>![](<a href="http://pyn31q2x4.bkt.clouddn.com/Cold" target="_blank" rel="noopener">http://pyn31q2x4.bkt.clouddn.com/Cold</a> Observable interval.png)</p>
<p>查看运行效果可知<code>每个订阅者订阅的时候都独立的执行一遍数据流代码</code>。</p>
<p>现在我们换一种写法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Observable observable =  Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;Integer&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;Integer&gt; emitter)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        emitter.onNext(<span class="number">1</span>);</span><br><span class="line">        emitter.onNext(<span class="number">2</span>);</span><br><span class="line">        emitter.onNext(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">observable.subscribe(<span class="keyword">new</span> Consumer&lt;Long&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Long l)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"第一个："</span>+String.valueOf(l));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">observable.subscribe(<span class="keyword">new</span> Consumer&lt;Long&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Long l)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"第二个："</span>+String.valueOf(l));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这是我们最常用的写法，显然只有当只有开始在订阅的时候才会执行<code>subscribe</code>回调方法，然后发射数据<code>emitter.onNext</code>的操作是在<code>subscribe</code>回调方法里执行的，也就是说<code>只有在订阅的时候才会发射数据</code>。</p>
<p>除了<code>interval</code>、<code>create</code>属于Cold Observable之外，还有<code>just</code>、<code>range</code>、<code>timer</code>、<code>from</code>也属于Cold Observable。</p>
<h4 id="（2）Hot-Observable"><a href="#（2）Hot-Observable" class="headerlink" title="（2）Hot Observable"></a>（2）Hot Observable</h4><p>怎么区分是Cold Observable还是Hot Observable？<br><code>（1）</code> Cold Observable只有在订阅的时候才会发射数据，Hot Observable在订阅之前就可以发射数据；<br><code>（2）</code> Cold Observable的数据流都是独立，而Hot Observable的数据流是共享的；</p>
<ul>
<li>使用publish关键字（将Observable转成ConnectableObservable）</li>
</ul>
<p>Cold Observable 和 Hot Observable可以相互转换，使用<code>publish</code>关键字<br>可以将Cold Observable转成Hot Observable。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ConnectableObservable observable =  Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;Integer&gt; emitter)</span> </span>&#123;</span><br><span class="line">        CountBean countBean = <span class="keyword">new</span> CountBean();</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"开始发射数据"</span>);</span><br><span class="line">        emitter.onNext(countBean.hashCode());</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"发射数据完成"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;).observeOn(Schedulers.newThread()).publish();</span><br><span class="line"></span><br><span class="line">observable.connect();<span class="comment">//必须添加</span></span><br></pre></td></tr></table></figure>

<p>以上代码没有订阅，打印日志如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">开始发射数据</span><br><span class="line">发射数据完成:530889340</span><br></pre></td></tr></table></figure>





<p>也就是说Hot Observable数据发射的时机是执行<code>connect()</code>之后。</p>
<p>下面修改代码，添加订阅代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">ConnectableObservable observable =  Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;CountBean&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;CountBean&gt; emitter)</span> </span>&#123;</span><br><span class="line">        CountBean countBean = <span class="keyword">new</span> CountBean();</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"开始发射数据"</span>);</span><br><span class="line">        emitter.onNext(countBean);</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"发射数据完成："</span>+countBean.hashCode());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;).publish();</span><br><span class="line"></span><br><span class="line">observable.subscribe(<span class="keyword">new</span> Consumer&lt;CountBean&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(CountBean countBean)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"第一个："</span>+String.valueOf(countBean.hashCode()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">observable.subscribe(<span class="keyword">new</span> Consumer&lt;CountBean&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(CountBean countBean)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"第二个："</span>+String.valueOf(countBean.hashCode()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">observable.connect();<span class="comment">//必须添加</span></span><br></pre></td></tr></table></figure>

<p>日志如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">开始发射数据</span><br><span class="line">第一个：530889340</span><br><span class="line">第二个：530889340</span><br><span class="line">发射数据完成:530889340</span><br></pre></td></tr></table></figure>





<p>OK，我们看到CountBean的hashcode是一样的，所以可以证明<code>Hot Observable的数据流是共享的</code>。</p>
<ul>
<li>使用publish和refCount关键字（将ConnectableObservable转成Observable）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Observable observable =  Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;CountBean&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;CountBean&gt; emitter)</span> </span>&#123;</span><br><span class="line">        CountBean countBean = <span class="keyword">new</span> CountBean();</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"开始发射数据"</span>);</span><br><span class="line">        emitter.onNext(countBean);</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"发射数据完成："</span>+countBean.hashCode());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;).publish().refCount(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">observable</span><br><span class="line">        .observeOn(Schedulers.newThread())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;CountBean&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(CountBean countBean)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"第一个："</span>+String.valueOf(countBean.hashCode()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">observable</span><br><span class="line">        .observeOn(Schedulers.newThread())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;CountBean&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(CountBean countBean)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"第二个："</span>+String.valueOf(countBean.hashCode()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>比第一种方式简化了很多，refcount本质上在后台维护着一个引用计数器。</p>
<p><img src="/" class="lazyload" data-src="http://pyn31q2x4.bkt.clouddn.com/refcount%E6%96%B9%E6%B3%95%E9%87%8D%E8%BD%BD.png"  alt=""></p>
<p>图片.png</p>
<p>refCount可以设置一些参数，可以设置最大订阅数量，也可以设置某时间范围内可订阅。</p>
<p>日志如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">开始发射数据</span><br><span class="line">发射数据完成:298652533</span><br><span class="line">第一个：298652533</span><br><span class="line">第二个：298652533</span><br></pre></td></tr></table></figure>





<p>利用<code>refCount</code>修饰的ConnectableObservable符合Hot Observable共享同一条数据的特性。</p>
<ul>
<li><p>使用share关键字</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">Observable observable =  Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;CountBean&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;CountBean&gt; emitter)</span> </span>&#123;</span><br><span class="line">        CountBean countBean = <span class="keyword">new</span> CountBean();</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"开始发射数据"</span>);</span><br><span class="line">        emitter.onNext(countBean);</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"发射数据完成："</span>+countBean.hashCode());</span><br><span class="line">  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;).share();</span><br><span class="line">  </span><br><span class="line">Disposable disposable = observable</span><br><span class="line">        .observeOn(Schedulers.newThread())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;CountBean&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(CountBean countBean)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"第一个："</span>+String.valueOf(countBean.hashCode()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">  </span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">disposable.dispose();</span><br><span class="line">  </span><br><span class="line">observable</span><br><span class="line">        .observeOn(Schedulers.newThread())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;CountBean&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(CountBean countBean)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"第二个："</span>+String.valueOf(countBean.hashCode()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>日志如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">开始发射数据</span><br><span class="line">发射数据完成:11939935</span><br><span class="line">第一个：11939935</span><br><span class="line">开始发射数据</span><br><span class="line">发射数据完成:297606922</span><br><span class="line">第二个：297606922</span><br></pre></td></tr></table></figure>





<p>看一下share的源码得知，其实share就是publish().refCount()。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CheckReturnValue</span></span><br><span class="line"><span class="meta">@SchedulerSupport</span>(SchedulerSupport.NONE)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Observable&lt;T&gt; <span class="title">share</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> publish().refCount();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>refCount()如果不传递参数，则默认只能订阅一个观察者，只有在取消订阅之后才可以继续订阅。</p>
<ul>
<li><p>使用Subject关键字</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Observable observable =  Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;CountBean&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;CountBean&gt; emitter)</span> </span>&#123;</span><br><span class="line">        CountBean countBean = <span class="keyword">new</span> CountBean();</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"开始发射数据"</span>);</span><br><span class="line">        emitter.onNext(countBean);</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"发射数据完成："</span>+countBean.hashCode());</span><br><span class="line">  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">  </span><br><span class="line">PublishSubject subject = PublishSubject.create();</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">subject.subscribe(<span class="keyword">new</span> Consumer&lt;CountBean&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(CountBean countBean)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"第一个："</span>+String.valueOf(countBean.hashCode()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">  </span><br><span class="line">subject.subscribe(<span class="keyword">new</span> Consumer&lt;CountBean&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(CountBean countBean)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"第二个："</span>+String.valueOf(countBean.hashCode()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">  </span><br><span class="line">observable.subscribe(subject);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>日志如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">开始发射数据</span><br><span class="line">第一个：530889340</span><br><span class="line">第二个：530889340</span><br><span class="line">发射数据完成:530889340</span><br></pre></td></tr></table></figure>



<p>PublishSubject的父类是Subject， 查看Subject的源码可知，Subject继承了Observable，同时又实现了Observer，也就是说，Subject同时兼备了观察者和被观察者的特性，了解这个特性之后再去理解以上代码就容易多了。</p>
<h5 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h5><p>Cold Observable有个很重要的特性：<code>每个订阅者订阅的时候都独立的执行一遍数据流代码</code>。<br>Hot Observable也有一个很重要的特性：<code>每个订阅者订阅的时候都共享的执行一遍数据流代码</code>，并且它是线程安全的。</p>
<h1 id="lt-第十篇-gt-：RxJava之repeat系列"><a href="#lt-第十篇-gt-：RxJava之repeat系列" class="headerlink" title="&lt;第十篇&gt;：RxJava之repeat系列"></a>&lt;第十篇&gt;：RxJava之repeat系列</h1><p>RxJava中interval可以循环执行，但它默认发射的数据是有序数列，那么如果想要重复发射其他类型的数据呢？repeat可以满足。</p>
<h4 id="（1）repeat-设置执行的次数"><a href="#（1）repeat-设置执行的次数" class="headerlink" title="（1）repeat 设置执行的次数"></a>（1）repeat 设置执行的次数</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="string">"A"</span>, <span class="string">"B"</span>).repeat(<span class="number">3</span>).subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这里设置重复次数为3， 如果repeat不带参数默认无限循环。</p>
<h4 id="（2）repeatWhen-设置下次执行的时间"><a href="#（2）repeatWhen-设置下次执行的时间" class="headerlink" title="（2）repeatWhen 设置下次执行的时间"></a>（2）repeatWhen 设置下次执行的时间</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(&quot;A&quot;, &quot;B&quot;).repeatWhen(new Function&lt;Observable&lt;Object&gt;, ObservableSource&lt;?&gt;&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public ObservableSource&lt;?&gt; apply(Observable&lt;Object&gt; objectObservable) throws Exception &#123;</span><br><span class="line">        return Observable.timer(10000, TimeUnit.MILLISECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribe(new Consumer&lt;String&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void accept(String s) throws Exception &#123;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>代码中设置了下次执行的时间是10秒之后，这种方式只能执行两次。</p>
<h4 id="（3）repeatUntil-根据条件决定是否执行"><a href="#（3）repeatUntil-根据条件决定是否执行" class="headerlink" title="（3）repeatUntil 根据条件决定是否执行"></a>（3）repeatUntil 根据条件决定是否执行</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="string">"A"</span>, <span class="string">"B"</span>).repeatUntil(<span class="keyword">new</span> BooleanSupplier() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">getAsBoolean</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        count = count + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(count == <span class="number">10</span>)&#123;</span><br><span class="line">            count = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>getAsBoolean的返回值如果一直是false，则无限执行，当返回值是true时则立即中断执行。</p>
<h1 id="lt-第十一篇-gt-：RxJava之变换操作符"><a href="#lt-第十一篇-gt-：RxJava之变换操作符" class="headerlink" title="&lt;第十一篇&gt;：RxJava之变换操作符"></a>&lt;第十一篇&gt;：RxJava之变换操作符</h1><h4 id="（1）map"><a href="#（1）map" class="headerlink" title="（1）map"></a>（1）map</h4><p>从发射数据到接收数据之间的数据变换。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;Integer&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        e.onNext(<span class="number">1</span>);</span><br><span class="line">        e.onNext(<span class="number">2</span>);</span><br><span class="line">        e.onNext(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).map(<span class="keyword">new</span> Function&lt;Integer, String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">apply</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"我是变换过后的"</span> + integer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>以上代码的意思是，发射的数据是Integer类型的， 将Integer类型的数据经过一些处理，最后返回值是String类型。</p>
<p>如果以上的说法不能理解，那么就举个例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        toUp(<span class="string">"live"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).start();</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">private String toUp(String str)&#123;</span><br><span class="line">    String s &#x3D; str.toUpperCase();</span><br><span class="line">    return s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上的列子很简单， 那么怎么写才能让代码更加优雅呢？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(&quot;live&quot;).map(new Function&lt;String, String&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public String apply(String s) throws Exception &#123;</span><br><span class="line">        return s.toUpperCase();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribeOn(Schedulers.newThread()).subscribe(new Consumer&lt;String&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void accept(String s) throws Exception &#123;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="（2）flatMap"><a href="#（2）flatMap" class="headerlink" title="（2）flatMap"></a>（2）flatMap</h4><p>FlatMap操作符使用一个指定的函数对原始Observable发射的每一项数据执行变换操作，这个函数返回一个本身也发射数据的Observable，然后FlatMap合并这些Observables发射的数据，最后将合并后的结果当做它自己的数据序列发射。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">Observable.fromIterable(list).flatMap(<span class="keyword">new</span> Function&lt;Integer, ObservableSource&lt;String&gt;&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ObservableSource&lt;String&gt; <span class="title">apply</span><span class="params">(<span class="keyword">final</span> Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Observable observable = Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;String&gt; emitter)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">                emitter.onNext(<span class="string">"第"</span> + integer + <span class="string">"个主任务的第1个分支任务"</span>);</span><br><span class="line">                emitter.onNext(<span class="string">"第"</span> + integer + <span class="string">"个主任务的第2个分支任务"</span>);</span><br><span class="line">                emitter.onComplete();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).subscribeOn(Schedulers.newThread());</span><br><span class="line">        <span class="keyword">return</span> observable;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(s+<span class="string">"---thread:"</span>+ Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>以上代码将一个任务分成两个任务分别发射。</p>
<p>执行结果如下：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-aa152ba888ef5323.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/573/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>如果删除subscribeOn(Schedulers.newThread())代码，那么执行结果是：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-aada288eb13aa3d4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/456/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>显然， 在多线程的情况下，接收数据时，是线程不安全的，如果需要线程安全，那么需要使用ConcatMap。</p>
<p>如果以上不怎么理解，那么就举一个例子吧，请问大家有没有遇到过嵌套网络请求，当post请求成功返回数据时，这时我们需要这些数据发起新的（一个或多个）post请求。</p>
<p>需要注意的是，如果第一个post请求成功返回时，第二个和第三个post请求都需要第一个post请求返回的参数时，那么是否考虑线程安全来决定到底使用flatMap还是ConcatMap。</p>
<p>我们先用一般的代码模拟一下网络请求， 如下：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">INR</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">success</span>(<span class="params"><span class="keyword">int</span> result</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">failed</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//模拟网络请求1</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">networkRequest1</span><span class="params">(<span class="keyword">final</span> String s1, <span class="keyword">final</span> INR inr)</span></span>&#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">"1"</span>.equals(s1))&#123;</span><br><span class="line">                <span class="keyword">int</span> result = Integer.parseInt(s1);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    inr.failed();</span><br><span class="line">                &#125;</span><br><span class="line">                inr.success(result);</span><br><span class="line">            &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                inr.failed();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//模拟网络请求2</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">networkRequest2</span><span class="params">(<span class="keyword">final</span> String s2, <span class="keyword">final</span> INR inr)</span></span>&#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(s2.equals(<span class="string">"2"</span>))&#123;</span><br><span class="line">                <span class="keyword">int</span> result = Integer.parseInt(s2);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    inr.failed();</span><br><span class="line">                &#125;</span><br><span class="line">                inr.success(result);</span><br><span class="line">            &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                inr.failed();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//模拟网络请求3</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">networkRequest3</span><span class="params">(<span class="keyword">final</span> String s3, <span class="keyword">final</span> INR inr)</span></span>&#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">"3"</span>.equals(s3))&#123;</span><br><span class="line">                <span class="keyword">int</span> result = Integer.parseInt(s3);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    inr.failed();</span><br><span class="line">                &#125;</span><br><span class="line">                inr.success(result);</span><br><span class="line">            &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                inr.failed();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">networkRequest1(<span class="string">"1"</span>, <span class="keyword">new</span> INR() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">success</span><span class="params">(<span class="keyword">int</span> result)</span> </span>&#123;</span><br><span class="line">        String newresult = String.valueOf(result + <span class="number">1</span>);</span><br><span class="line">        networkRequest2(newresult, <span class="keyword">new</span> INR() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">success</span><span class="params">(<span class="keyword">int</span> result)</span> </span>&#123;</span><br><span class="line">                String newresult = String.valueOf(result + <span class="number">1</span>);</span><br><span class="line">                networkRequest3(newresult, <span class="keyword">new</span> INR() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">success</span><span class="params">(<span class="keyword">int</span> result)</span> </span>&#123;</span><br><span class="line">                        System.out.println(String.valueOf(result));</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">failed</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">failed</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">failed</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>一个完整的网络嵌套请求需要写那么多代码，可见可读性很差，代码不优雅，那么Rxjava到底怎么实现呢？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(&quot;1&quot;).flatMap(new Function&lt;String, ObservableSource&lt;String&gt;&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public ObservableSource&lt;String&gt; apply(String s) throws Exception &#123;</span><br><span class="line">        int result &#x3D; Integer.parseInt(s);</span><br><span class="line">        Thread.sleep(3000);</span><br><span class="line">        return Observable.just(result).map(new Function&lt;Integer, String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public String apply(Integer result) throws Exception &#123;</span><br><span class="line">                return String.valueOf(result + 1);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).flatMap(new Function&lt;String, ObservableSource&lt;String&gt;&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public ObservableSource&lt;String&gt; apply(String s) throws Exception &#123;</span><br><span class="line">        int result &#x3D; Integer.parseInt(s);</span><br><span class="line">        Thread.sleep(3000);</span><br><span class="line">        return Observable.just(result).map(new Function&lt;Integer, String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public String apply(Integer result) throws Exception &#123;</span><br><span class="line">                return String.valueOf(result + 1);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribeOn(Schedulers.newThread()).subscribe(new Consumer&lt;String&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void accept(String s) throws Exception &#123;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>以上代码就是Rxjava的写法了，是不是很简洁呢？</p>
<p>接下来介绍的ConcatMap就不举例了。</p>
<h4 id="（3）ConcatMap"><a href="#（3）ConcatMap" class="headerlink" title="（3）ConcatMap"></a>（3）ConcatMap</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">Observable.fromIterable(list).concatMap(<span class="keyword">new</span> Function&lt;Integer, ObservableSource&lt;String&gt;&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ObservableSource&lt;String&gt; <span class="title">apply</span><span class="params">(<span class="keyword">final</span> Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Observable observable = Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;String&gt; emitter)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">                emitter.onNext(<span class="string">"第"</span> + integer + <span class="string">"个主任务的第1个分支任务"</span>);</span><br><span class="line">                emitter.onNext(<span class="string">"第"</span> + integer + <span class="string">"个主任务的第2个分支任务"</span>);</span><br><span class="line"></span><br><span class="line">                emitter.onComplete();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).subscribeOn(Schedulers.newThread());</span><br><span class="line">        <span class="keyword">return</span> observable;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(s+<span class="string">"---thread:"</span>+ Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>执行结果是：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-0257e2c036a48680.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/521/format/webp"  alt="img"></p>
<p>图片.png</p>
<h4 id="（4）flatMapIterable"><a href="#（4）flatMapIterable" class="headerlink" title="（4）flatMapIterable"></a>（4）flatMapIterable</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Observable.create(new ObservableOnSubscribe&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void subscribe(ObservableEmitter&lt;String&gt; e) throws Exception &#123;</span><br><span class="line">        e.onNext(&quot;A&quot;);</span><br><span class="line">        e.onNext(&quot;B&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).flatMapIterable(new Function&lt;String, Iterable&lt;String&gt;&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public Iterable&lt;String&gt; apply(String s) throws Exception &#123;</span><br><span class="line">        List&lt;String&gt; list &#x3D; Arrays.asList(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;);</span><br><span class="line">        return list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribe(new Consumer&lt;String&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void accept(String s) throws Exception &#123;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="（5）switchMap"><a href="#（5）switchMap" class="headerlink" title="（5）switchMap"></a>（5）switchMap</h4><p>只发射最近发射的数据，也就是说，如果前一个任务还没完成时就开始了第二个任务，那么前一个任务将被终止。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Observable.create(new ObservableOnSubscribe&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void subscribe(ObservableEmitter&lt;String&gt; e) throws Exception &#123;</span><br><span class="line">        e.onNext(&quot;A&quot;);</span><br><span class="line">        e.onNext(&quot;B&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).switchMap(new Function&lt;String, ObservableSource&lt;String&gt;&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public ObservableSource&lt;String&gt; apply(String s) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        return Observable.just(s, &quot;---:&quot;+s).subscribeOn(Schedulers.newThread());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribe(new Consumer&lt;String&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void accept(String s) throws Exception &#123;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>日志效果如下</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-18a57ea8b3491a84.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/466/format/webp"  alt="img"></p>
<p>图片.png</p>
<h4 id="（6）scan"><a href="#（6）scan" class="headerlink" title="（6）scan"></a>（6）scan</h4><p>sacn操作符是遍历源Observable产生的结果，再按照自定义规则进行运算，依次输出每次计算后的结果给订阅者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Observable.range(<span class="number">2</span>, <span class="number">10</span>).scan(<span class="keyword">new</span> BiFunction&lt;Integer, Integer, Integer&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">apply</span><span class="params">(Integer integer, Integer integer2)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> integer + integer2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(String.valueOf(integer));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>apply回掉第一个参数是上次的结算结果，第二个参数是当此的源observable的输入值</p>
<p>日志如下：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-9822216a1080e7ac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/211/format/webp"  alt="img"></p>
<p>图片.png</p>
<h4 id="（7）groupBy"><a href="#（7）groupBy" class="headerlink" title="（7）groupBy"></a>（7）groupBy</h4><p>将1,2,3,4分组</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>).groupBy(<span class="keyword">new</span> Function&lt;Integer, Integer&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">apply</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> integer % <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribe(<span class="keyword">new</span> Consumer&lt;GroupedObservable&lt;Integer, Integer&gt;&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(<span class="keyword">final</span> GroupedObservable&lt;Integer, Integer&gt; integerIntegerGroupedObservable)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        integerIntegerGroupedObservable.subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                System.out.println(integerIntegerGroupedObservable.getKey() + <span class="string">"    "</span>+integer);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>日志如下：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-e3b398189df651bc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/214/format/webp"  alt="img"></p>
<p>图片.png</p>
<h4 id="（8）buffer"><a href="#（8）buffer" class="headerlink" title="（8）buffer"></a>（8）buffer</h4><p>字面上是缓存的意思</p>
<p>假如，现在有”one”, “two”, “three”, “four”, “five”这5条数据，将将要发射的数据存放到缓存区，每个缓存区是3条数据：<br>缓存区1：”one”, “two”, “three”<br>缓存区2：”four”, “five”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;, &quot;four&quot;, &quot;five&quot;)&#x2F;&#x2F;创建了一个有5个数字的被观察者</span><br><span class="line">        .buffer(3)</span><br><span class="line">        .subscribe(new Consumer&lt;List&lt;String&gt;&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void accept(List&lt;String&gt; strings) throws Exception &#123;</span><br><span class="line">                for (String s : strings)&#123;</span><br><span class="line">                    System.out.println(s);</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(&quot;---------------------&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>有5个字符串，设置缓存区为3（默认跳3个字符串）</p>
<p>日志效果如下：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-3b61c35e081eefbd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/348/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>假如，现在有”one”, “two”, “three”, “four”, “five”这5条数据，将将要发射的数据存放到缓存区，每个缓存区是3条数据，设置偏移量为1</p>
<p>缓存区1：”one”, “two”, “three”<br>缓存区2： “two”, “three”, “four”<br>缓存区3： “three”, “four”, “five”<br>缓存区4：”four”, “five”<br>缓存区5： “five”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;, &quot;four&quot;, &quot;five&quot;)&#x2F;&#x2F;创建了一个有5个数字的被观察者</span><br><span class="line">        .buffer(3,1)</span><br><span class="line">        .subscribe(new Consumer&lt;List&lt;String&gt;&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void accept(List&lt;String&gt; strings) throws Exception &#123;</span><br><span class="line">                for (String s : strings)&#123;</span><br><span class="line">                    System.out.println(s);</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(&quot;---------------------&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>打印日志如下：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-24ec98843966f826.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/384/format/webp"  alt="img"></p>
<p>图片.png</p>
<h4 id="（9）window"><a href="#（9）window" class="headerlink" title="（9）window"></a>（9）window</h4><p>设置一个window最多3条数据，将这个window封装成Observable，并将Observable发射出去。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="string">"one"</span>, <span class="string">"two"</span>, <span class="string">"three"</span>, <span class="string">"four"</span>, <span class="string">"five"</span>)<span class="comment">//创建了一个有5个数字的被观察者</span></span><br><span class="line">        .window(<span class="number">3</span>)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Observable&lt;String&gt;&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Observable&lt;String&gt; stringObservable)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"-----------------------"</span>);</span><br><span class="line">                stringObservable.subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        System.out.println(s);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>执行效果如下</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-bff98b3360af8828.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/371/format/webp"  alt="img"></p>
<p>图片.png</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="string">"one"</span>, <span class="string">"two"</span>, <span class="string">"three"</span>, <span class="string">"four"</span>, <span class="string">"five"</span>)<span class="comment">//创建了一个有5个数字的被观察者</span></span><br><span class="line">        .window(<span class="number">3</span>,<span class="number">1</span>)</span><br><span class="line">        .subscribeOn(Schedulers.io())</span><br><span class="line">        .unsubscribeOn(Schedulers.io())</span><br><span class="line">        .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Observable&lt;String&gt;&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Observable&lt;String&gt; stringObservable)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"-----------------------"</span>);</span><br><span class="line">                stringObservable.subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        System.out.println(s);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-274bd43716125067.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/594/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>需要说明的是：</p>
<ul>
<li>window(long count) 被分割成的每个window最大数据值</li>
<li>window(long count, long skip) count 每个window最大数据值，skip步长</li>
<li>window与buffer区别：window是把数据分割成了Observable，buffer是把数据分割成List</li>
</ul>
<h4 id="（10）cast"><a href="#（10）cast" class="headerlink" title="（10）cast"></a>（10）cast</h4><p>cast是转换操作符， 从字面上的意思是说可以实现类型的转换</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Observable.range(<span class="number">1</span>, <span class="number">5</span>).cast(Integer<span class="class">.<span class="keyword">class</span>).<span class="title">subscribe</span>(<span class="title">new</span> <span class="title">Consumer</span>&lt;<span class="title">Integer</span>&gt;() </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer ss)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(ss);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Observable.range(1, 5).cast(Number.class).subscribe(new Consumer&lt;Number&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void accept(Number ss) throws Exception &#123;</span><br><span class="line">        System.out.println(ss);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>打印效果如下：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-feca83291afdea20.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/290/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>如果改成String类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Observable.range(1, 5).cast(String.class).subscribe(new Consumer&lt;String&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void accept(String ss) throws Exception &#123;</span><br><span class="line">        System.out.println(ss);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>打印效果如下：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-ea50e38be2fbf688.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/875/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>这是一个比较有疑问的地方。</p>
<h1 id="lt-第十二篇-gt-：RxJava之过滤操作符"><a href="#lt-第十二篇-gt-：RxJava之过滤操作符" class="headerlink" title="&lt;第十二篇&gt;：RxJava之过滤操作符"></a>&lt;第十二篇&gt;：RxJava之过滤操作符</h1><p>过滤操作符分为四类<br>1.指定条件过滤事件<br>2.指定事件数量过滤事件<br>3.指定时间过滤事件<br>4.指定事件位置过滤事件</p>
<h4 id="指定条件过滤事件"><a href="#指定条件过滤事件" class="headerlink" title="指定条件过滤事件"></a>指定条件过滤事件</h4><h6 id="（1）filter"><a href="#（1）filter" class="headerlink" title="（1）filter"></a>（1）filter</h6><p>过滤指定条件。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>, <span class="string">"4"</span>, <span class="string">"5"</span>).filter(<span class="keyword">new</span> Predicate&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">test</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 根据test()的返回值 对被观察者发送的事件进行过滤 &amp; 筛选</span></span><br><span class="line">        <span class="comment">// a. 返回true，则继续发送</span></span><br><span class="line">        <span class="comment">// b. 返回false，则不发送（即过滤）</span></span><br><span class="line">        <span class="keyword">if</span>(s.equals(<span class="string">"1"</span>) || s.equals(<span class="string">"2"</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribeOn(Schedulers.newThread()).subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>结果：返回1和2。</p>
<h6 id="（2）ofType"><a href="#（2）ofType" class="headerlink" title="（2）ofType"></a>（2）ofType</h6><p>过滤指定类型。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="string">"A"</span>, <span class="string">"B"</span>, <span class="number">1</span>, <span class="number">2</span>).ofType(Integer<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">        .<span class="title">subscribeOn</span>(<span class="title">Schedulers</span>.<span class="title">newThread</span>()).<span class="title">subscribe</span>(<span class="title">new</span> <span class="title">Consumer</span>&lt;<span class="title">Integer</span>&gt;() </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(String.valueOf(integer));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>结果返回：1和2</p>
<h6 id="（3）skip和skipLast"><a href="#（3）skip和skipLast" class="headerlink" title="（3）skip和skipLast"></a>（3）skip和skipLast</h6><p>skip：从前往后跳过<br>skipLast：从后往前跳过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(&quot;A&quot;, &quot;B&quot;, &quot;1&quot;, &quot;2&quot;).skip(3)</span><br><span class="line">        .subscribeOn(Schedulers.newThread()).subscribe(new Consumer&lt;String&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void accept(String s) throws Exception &#123;</span><br><span class="line">        System.out.println(String.valueOf(s));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>返回结果：2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(&quot;A&quot;, &quot;B&quot;, &quot;1&quot;, &quot;2&quot;).skipLast(3)</span><br><span class="line">        .subscribeOn(Schedulers.newThread()).subscribe(new Consumer&lt;String&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void accept(String s) throws Exception &#123;</span><br><span class="line">        System.out.println(String.valueOf(s));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>返回结果：A</p>
<h6 id="（4）distinct和distinctUntilChanged"><a href="#（4）distinct和distinctUntilChanged" class="headerlink" title="（4）distinct和distinctUntilChanged"></a>（4）distinct和distinctUntilChanged</h6><p>distinct：过滤相同的数据<br>distinctUntilChanged：过滤连续相同的数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line">        .distinct()</span><br><span class="line">        .subscribeOn(Schedulers.newThread())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                System.out.println(String.valueOf(integer));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>返回结果：1 2 3 5</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line">        .distinctUntilChanged()</span><br><span class="line">        .subscribeOn(Schedulers.newThread())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                System.out.println(String.valueOf(integer));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>返回结果：1 2 1 2 3 5</p>
<h4 id="指定数量过滤事件"><a href="#指定数量过滤事件" class="headerlink" title="指定数量过滤事件"></a>指定数量过滤事件</h4><h6 id="（1）take和takeLast"><a href="#（1）take和takeLast" class="headerlink" title="（1）take和takeLast"></a>（1）take和takeLast</h6><p>take：观察者只能接收到前n个数据<br>takeLast：观察者只能接收到后n个数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">        .take(<span class="number">2</span>)</span><br><span class="line">        .subscribeOn(Schedulers.newThread())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                System.out.println(String.valueOf(integer));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>返回结果：1 2</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">        .takeLast(<span class="number">2</span>)</span><br><span class="line">        .subscribeOn(Schedulers.newThread())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                System.out.println(String.valueOf(integer));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>返回结果：4 5</p>
<h4 id="指定时间过滤事件"><a href="#指定时间过滤事件" class="headerlink" title="指定时间过滤事件"></a>指定时间过滤事件</h4><h6 id="（1）throttleFirst和throttleLast"><a href="#（1）throttleFirst和throttleLast" class="headerlink" title="（1）throttleFirst和throttleLast"></a>（1）throttleFirst和throttleLast</h6><p>throttleFirst：接收者只会接收到在指定时间内发送的第一条数据<br>throttleLast：接收者只会接收到在指定时间内发送的最后一条数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;Integer&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//每隔500毫秒发送一条数据</span></span><br><span class="line">        e.onNext(<span class="number">1</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">2</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">3</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">4</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">5</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">6</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">7</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">8</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">9</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">        .throttleFirst(<span class="number">1700</span>, TimeUnit.MILLISECONDS)</span><br><span class="line">        .subscribeOn(Schedulers.newThread())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                System.out.println(String.valueOf(integer));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>返回结果：1 5 9</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;Integer&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//每隔500毫秒发送一条数据</span></span><br><span class="line">        e.onNext(<span class="number">1</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">2</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">3</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">4</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">5</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">6</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">7</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">8</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">9</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">        .throttleLast(<span class="number">1700</span>, TimeUnit.MILLISECONDS)</span><br><span class="line">        .subscribeOn(Schedulers.newThread())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                System.out.println(String.valueOf(integer));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>返回结果：4 7 9</p>
<h6 id="（2）sample"><a href="#（2）sample" class="headerlink" title="（2）sample"></a>（2）sample</h6><p>与throttleLast类似，sample接收者只会接收到在指定时间内发送的最后一条数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;Integer&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//每隔500毫秒发送一条数据</span></span><br><span class="line">        e.onNext(<span class="number">1</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">2</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">3</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">4</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">5</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">6</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">7</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">8</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">9</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">        .sample(<span class="number">1700</span>, TimeUnit.MILLISECONDS)</span><br><span class="line">        .subscribeOn(Schedulers.newThread())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                System.out.println(String.valueOf(integer));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>返回结果：4 7 9</p>
<h6 id="（3）throttleWithTimeout和debounce"><a href="#（3）throttleWithTimeout和debounce" class="headerlink" title="（3）throttleWithTimeout和debounce"></a>（3）throttleWithTimeout和debounce</h6><p>throttleWithTimeout和debounce是一样的</p>
<p>假设指定时间为1秒， 那么被观察者发送第一条数据时，等待1秒之后仍然没有发送第二条数据，那么观察者将收到该数据，如果还没到1秒钟就重新发送了数据，那么第一条数据就被取消发送。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;Integer&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//每隔500毫秒发送一条数据</span></span><br><span class="line">        e.onNext(<span class="number">1</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">2</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">3</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">4</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">5</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">6</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">7</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">8</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        e.onNext(<span class="number">9</span>);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">        .throttleWithTimeout(<span class="number">600</span>, TimeUnit.MILLISECONDS)</span><br><span class="line">        .subscribeOn(Schedulers.newThread())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                System.out.println(String.valueOf(integer));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>返回结果：9</p>
<h4 id="指定事件位置过滤事件"><a href="#指定事件位置过滤事件" class="headerlink" title="指定事件位置过滤事件"></a>指定事件位置过滤事件</h4><h6 id="（1）firstElement和lastElement"><a href="#（1）firstElement和lastElement" class="headerlink" title="（1）firstElement和lastElement"></a>（1）firstElement和lastElement</h6><p>firstElement：只取第一个元素<br>lastElement：只取最后一个元素</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">        .firstElement()</span><br><span class="line">        .subscribeOn(Schedulers.newThread())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                System.out.println(String.valueOf(integer));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>返回结果：1</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">        .lastElement()</span><br><span class="line">        .subscribeOn(Schedulers.newThread())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                System.out.println(String.valueOf(integer));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>返回结果：5</p>
<h6 id="（2）elementAt"><a href="#（2）elementAt" class="headerlink" title="（2）elementAt"></a>（2）elementAt</h6><p>elementAt：只接收指定位置的元素（角标从0开始）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">        .elementAt(<span class="number">2</span>)</span><br><span class="line">        .subscribeOn(Schedulers.newThread())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                System.out.println(String.valueOf(integer));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>返回结果：3</p>
<h6 id="（3）elementAtOrError"><a href="#（3）elementAtOrError" class="headerlink" title="（3）elementAtOrError"></a>（3）elementAtOrError</h6><p>elementAtOrError：elementAt即使角标越界也不会报错，但是elementAtOrError如果角标越界的话会报错。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">        .elementAtOrError(<span class="number">5</span>)</span><br><span class="line">        .subscribeOn(Schedulers.newThread())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                System.out.println(String.valueOf(integer));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>以上代码报错如下：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-12c82d00b6c71457.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/945/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>为了防止崩溃，还是把代码补全的好，添加接收异常的回调</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">        .elementAtOrError(<span class="number">5</span>)</span><br><span class="line">        .subscribeOn(Schedulers.newThread())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                System.out.println(String.valueOf(integer));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="keyword">new</span> Consumer&lt;Throwable&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Throwable throwable)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"角标越界了"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>返回结果：角标越界了</p>
<p>2人点赞</p>
<p>Rx系列</p>
<h1 id="lt-第十三篇-gt-：RxJava之线程控制（切换-调度）"><a href="#lt-第十三篇-gt-：RxJava之线程控制（切换-调度）" class="headerlink" title="&lt;第十三篇&gt;：RxJava之线程控制（切换/调度）"></a>&lt;第十三篇&gt;：RxJava之线程控制（切换/调度）</h1><p>RxJava的线程控制主要设计到两种操作符：<code>subscribeOn</code> 和<code>observeOn</code></p>
<p>subscribeOn：如果多次调用，则只有第一次调用有效；<br>observeOn：如果多次调用，每次有可以切换线程。</p>
<h6 id="（1）默认情况下"><a href="#（1）默认情况下" class="headerlink" title="（1）默认情况下"></a>（1）默认情况下</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="string">"A"</span>)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"threadName:"</span>+Thread.currentThread().getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>打印日志：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-8b9c9d6d52900d51.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/503/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>默认情况下被观察者和观察者是运行在主线程的，如果阻塞50秒（耗时操作）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="string">"A"</span>)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Thread.sleep(<span class="number">50000</span>);</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"threadName:"</span>+Thread.currentThread().getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>这样会阻塞主线程。</p>
<p>这时，我们就需要用到线程控制的知识了。</p>
<h6 id="（2）Scheduler的种类"><a href="#（2）Scheduler的种类" class="headerlink" title="（2）Scheduler的种类"></a>（2）Scheduler的种类</h6><ul>
<li>Schedulers.io( )：<br>用于IO密集型的操作，例如读写SD卡文件，查询数据库，访问网络等，具有线程缓存机制，在此调度器接收到任务后，先检查线程缓存池中，是否有空闲的线程，如果有，则复用，如果没有则创建新的线程，并加入到线程池中，如果每次都没有空闲线程使用，可以无上限的创建新线程。</li>
<li>Schedulers.newThread( )：<br>在每执行一个任务时创建一个新的线程，不具有线程缓存机制，因为创建一个新的线程比复用一个线程更耗时耗力，虽然使用Schedulers.io( )的地方，都可以使用Schedulers.newThread( )，但是，Schedulers.newThread( )的效率没有Schedulers.io( )高。</li>
<li>Schedulers.computation()：<br>用于CPU 密集型计算任务，即不会被 I/O 等操作限制性能的耗时操作，例如xml,json文件的解析，Bitmap图片的压缩取样等，具有固定的线程池，大小为CPU的核数。不可以用于I/O操作，因为I/O操作的等待时间会浪费CPU。</li>
<li>Schedulers.trampoline()：<br>在当前线程立即执行任务，如果当前线程有任务在执行，则会将其暂停，等插入进来的任务执行完之后，再将未完成的任务接着执行。</li>
<li>Schedulers.single()：<br>拥有一个线程单例，所有的任务都在这一个线程中执行，当此线程中有任务执行时，其他任务将会按照先进先出的顺序依次执行。</li>
<li>Scheduler.from(@NonNull Executor executor)：<br>指定一个线程调度器，由此调度器来控制任务的执行策略。</li>
<li>AndroidSchedulers.mainThread()：<br>在Android UI线程中执行任务，为Android开发定制。</li>
<li>注：<br>在RxJava2中，废弃了RxJava1中的Schedulers.immediate( )<br>在RxJava1中，Schedulers.immediate( )的作用为在当前线程立即执行任务，功能等同于RxJava2中的Schedulers.trampoline( )。<br>而Schedulers.trampoline( )在RxJava1中的作用是当其它排队的任务完成后，在当前线程排队开始执行接到的任务，有点像RxJava2中的Schedulers.single()，但也不完全相同，因为Schedulers.single()不是在当前线程而是在一个线程单例中排队执行任务。</li>
</ul>
<h6 id="（3）subscribeOn的使用"><a href="#（3）subscribeOn的使用" class="headerlink" title="（3）subscribeOn的使用"></a>（3）subscribeOn的使用</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;String&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"Observable----threadName:"</span>+Thread.currentThread().getName());</span><br><span class="line">        e.onNext(<span class="string">"A"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">        .subscribeOn(Schedulers.io())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"Obsever----threadName:"</span>+Thread.currentThread().getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>代码中添加了subscribeOn(Schedulers.io())这句代码，这样就可以从默认主线程切换到IO线程。</p>
<p>我们看一下打印结果</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-410c79a6860594dd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/702/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>所以， 如果单纯用subscribeOn来控制线程，那么被观察者和观察者都会被切换到指定的线程。</p>
<p>如果添加多个， 比如</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;String&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"Observable----threadName:"</span>+Thread.currentThread().getName());</span><br><span class="line">        e.onNext(<span class="string">"A"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">        .subscribeOn(Schedulers.io())</span><br><span class="line">        .subscribeOn(Schedulers.trampoline())</span><br><span class="line">        .subscribeOn(Schedulers.newThread())</span><br><span class="line">        .subscribeOn(Schedulers.computation())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"Obsever----threadName:"</span>+Thread.currentThread().getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>那么只有第一次调用subscribeOn有效果。</p>
<h6 id="（4）observeOn的使用"><a href="#（4）observeOn的使用" class="headerlink" title="（4）observeOn的使用"></a>（4）observeOn的使用</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;String&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"Observable----threadName:"</span>+Thread.currentThread().getName());</span><br><span class="line">        e.onNext(<span class="string">"A"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">        .observeOn(Schedulers.newThread())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"Obsever----threadName:"</span>+Thread.currentThread().getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>打印效果</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-1b9ff1c356d1dfc1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/759/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>我们发现被观察者在主线程运行，观察者在子线程运行。</p>
<p>结论：结合（3）总结的结论是，subscribeOn可以控制被观察者和观察者的线程，observeOn仅可以控制观察者的线程。</p>
<h6 id="（5）subscribeOn和observeOn结合使用"><a href="#（5）subscribeOn和observeOn结合使用" class="headerlink" title="（5）subscribeOn和observeOn结合使用"></a>（5）subscribeOn和observeOn结合使用</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;String&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"Observable----threadName:"</span>+Thread.currentThread().getName());</span><br><span class="line">        e.onNext(<span class="string">"A"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">        .subscribeOn(AndroidSchedulers.mainThread())</span><br><span class="line">        .observeOn(Schedulers.computation())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"Obsever----threadName:"</span>+Thread.currentThread().getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>打印效果如下：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-91effcf32c59f34b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/675/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>这样观察者就从主线程切换到子线程了。</p>
<p>我们再来举一个稍微复杂的例子。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">Observable.create(new ObservableOnSubscribe&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">     @Override</span><br><span class="line">     public void subscribe(ObservableEmitter&lt;String&gt; e) throws Exception &#123;</span><br><span class="line">         Log.d(&quot;aaa&quot;, &quot;Observable----threadName:&quot;+Thread.currentThread().getName());</span><br><span class="line">         e.onNext(&quot;A&quot;);</span><br><span class="line"></span><br><span class="line">     &#125;</span><br><span class="line"> &#125;)</span><br><span class="line">         .subscribeOn(AndroidSchedulers.mainThread())</span><br><span class="line">         .map(new Function&lt;String, String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">             @Override</span><br><span class="line">             public String apply(String s) throws Exception &#123;</span><br><span class="line">                 Log.d(&quot;aaa&quot;, &quot;map1----threadName:&quot;+Thread.currentThread().getName());</span><br><span class="line">                 return s;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;)</span><br><span class="line">         .observeOn(Schedulers.computation())</span><br><span class="line">         .map(new Function&lt;String, String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">             @Override</span><br><span class="line">             public String apply(String s) throws Exception &#123;</span><br><span class="line">                 Log.d(&quot;aaa&quot;, &quot;map2----threadName:&quot;+Thread.currentThread().getName());</span><br><span class="line">                 return s;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;)</span><br><span class="line">         .observeOn(Schedulers.newThread())</span><br><span class="line">         .map(new Function&lt;String, String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">             @Override</span><br><span class="line">             public String apply(String s) throws Exception &#123;</span><br><span class="line">                 Log.d(&quot;aaa&quot;, &quot;map3----threadName:&quot;+Thread.currentThread().getName());</span><br><span class="line">                 return s;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;)</span><br><span class="line">         .observeOn(Schedulers.single())</span><br><span class="line">         .map(new Function&lt;String, String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">             @Override</span><br><span class="line">             public String apply(String s) throws Exception &#123;</span><br><span class="line">                 Log.d(&quot;aaa&quot;, &quot;map4----threadName:&quot;+Thread.currentThread().getName());</span><br><span class="line">                 return s;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;)</span><br><span class="line">         .observeOn(Schedulers.io())</span><br><span class="line">         .map(new Function&lt;String, String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">             @Override</span><br><span class="line">             public String apply(String s) throws Exception &#123;</span><br><span class="line">                 Log.d(&quot;aaa&quot;, &quot;map1----threadName:&quot;+Thread.currentThread().getName());</span><br><span class="line">                 return s;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;)</span><br><span class="line">         .observeOn(Schedulers.computation())</span><br><span class="line">         .map(new Function&lt;String, String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">             @Override</span><br><span class="line">             public String apply(String s) throws Exception &#123;</span><br><span class="line">                 Log.d(&quot;aaa&quot;, &quot;map2----threadName:&quot;+Thread.currentThread().getName());</span><br><span class="line">                 return s;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;)</span><br><span class="line">         .observeOn(Schedulers.newThread())</span><br><span class="line">         .map(new Function&lt;String, String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">             @Override</span><br><span class="line">             public String apply(String s) throws Exception &#123;</span><br><span class="line">                 Log.d(&quot;aaa&quot;, &quot;map3----threadName:&quot;+Thread.currentThread().getName());</span><br><span class="line">                 return s;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;)</span><br><span class="line">         .observeOn(Schedulers.single())</span><br><span class="line">         .map(new Function&lt;String, String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">             @Override</span><br><span class="line">             public String apply(String s) throws Exception &#123;</span><br><span class="line">                 Log.d(&quot;aaa&quot;, &quot;map4----threadName:&quot;+Thread.currentThread().getName());</span><br><span class="line">                 return s;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;)</span><br><span class="line">         .observeOn(Schedulers.io())</span><br><span class="line">         .subscribe(new Consumer&lt;String&gt;() &#123;</span><br><span class="line">             @Override</span><br><span class="line">             public void accept(String s) throws Exception &#123;</span><br><span class="line">                 Log.d(&quot;aaa&quot;, &quot;Obsever----threadName:&quot;+Thread.currentThread().getName());</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;);</span><br></pre></td></tr></table></figure>

<p>执行效果如下：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-c8a1685b54a0ae8b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/690/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>我们发现</p>
<ul>
<li>多次调用Schedulers.single()，都是在同一个线程执行。</li>
<li>多次调用Schedulers.computation()、Schedulers.newThread()、Schedulers.io()都会重新新建线程。</li>
</ul>
<p>Schedulers.from()和AndroidSchedulers.mainThread()就不介绍了。</p>
<h1 id="lt-第十四篇-gt-：RxJava之条件-amp-布尔操作符"><a href="#lt-第十四篇-gt-：RxJava之条件-amp-布尔操作符" class="headerlink" title="&lt;第十四篇&gt;：RxJava之条件 &amp; 布尔操作符"></a>&lt;第十四篇&gt;：RxJava之条件 &amp; 布尔操作符</h1><h6 id="（1）-all"><a href="#（1）-all" class="headerlink" title="（1） all"></a>（1） all</h6><p>判断发送的每项数据是否都满足，如果都满足则返回ture，否则返回false；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line">         .all(<span class="keyword">new</span> Predicate&lt;Integer&gt;() &#123;</span><br><span class="line">             <span class="meta">@Override</span></span><br><span class="line">             <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">test</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                 <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;)</span><br><span class="line">         .subscribe(<span class="keyword">new</span> Consumer&lt;Boolean&gt;() &#123;</span><br><span class="line">             <span class="meta">@Override</span></span><br><span class="line">             <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Boolean aBoolean)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                 Log.d(<span class="string">"aaa"</span>, String.valueOf(aBoolean));</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;);</span><br></pre></td></tr></table></figure>

<p>返回结果：true</p>
<h6 id="（2）takeWhile"><a href="#（2）takeWhile" class="headerlink" title="（2）takeWhile"></a>（2）takeWhile</h6><p>不停的发射数据，每条数据都需要判断是否满足条件，如果满足条件则继续发送，否则立即终止发射。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line">        .takeWhile(<span class="keyword">new</span> Predicate&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">test</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(integer == <span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(integer == <span class="number">2</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(integer == <span class="number">3</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(integer == <span class="number">4</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, String.valueOf(integer));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>返回结果：1</p>
<h6 id="（3）skipWhile"><a href="#（3）skipWhile" class="headerlink" title="（3）skipWhile"></a>（3）skipWhile</h6><p>数据发射之前会条件判断，知道判断结果=<code>false</code>之后才开始发射数据，之后如果发射的数据的判断条件结果=true，则照样发射数据。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line">        .skipWhile(<span class="keyword">new</span> Predicate&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">test</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(integer &gt; <span class="number">4</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(integer == <span class="number">6</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, String.valueOf(integer));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>返回结果：5 6</p>
<h6 id="（4）takeUntil"><a href="#（4）takeUntil" class="headerlink" title="（4）takeUntil"></a>（4）takeUntil</h6><p>不停的发射数据，如果发射的数据不满足条件，则继续发射数据，直到满足条件之后停止发射数据。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line">        .takeUntil(<span class="keyword">new</span> Predicate&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">test</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(integer == <span class="number">4</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, String.valueOf(integer));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>返回结果：1 2 3 4</p>
<h6 id="（5）skipUntil"><a href="#（5）skipUntil" class="headerlink" title="（5）skipUntil"></a>（5）skipUntil</h6><p>直到<code>skipUntil</code>传入的<code>Observable</code>开始发送数据时才开始发送。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Observable.interval(<span class="number">1</span>, TimeUnit.SECONDS)</span><br><span class="line">        .skipUntil(Observable.timer(<span class="number">5</span>, TimeUnit.SECONDS))</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Long&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Long mlong)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, String.valueOf(mlong));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>返回结果：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-3dd99bd4d3a635f6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/429/format/webp"  alt="img"></p>
<p>图片.png</p>
<h6 id="（6）SequenceEqual"><a href="#（6）SequenceEqual" class="headerlink" title="（6）SequenceEqual"></a>（6）SequenceEqual</h6><p>判断两个Observable的数据是否相同，如果相同返回true，否则返回false。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Observable.sequenceEqual(Observable.just(1, 2, 3), Observable.just(&quot;1&quot;, &quot;2&quot;, &quot;3&quot;))</span><br><span class="line">        .subscribe(new Consumer&lt;Boolean&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void accept(Boolean aBoolean) throws Exception &#123;</span><br><span class="line">                Log.d(&quot;aaa&quot;, String.valueOf(aBoolean));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>返回结果：false</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Observable.sequenceEqual(Observable.just(1, 2, 3), Observable.just(1, 2, 3))</span><br><span class="line">        .subscribe(new Consumer&lt;Boolean&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void accept(Boolean aBoolean) throws Exception &#123;</span><br><span class="line">                Log.d(&quot;aaa&quot;, String.valueOf(aBoolean));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>返回结果：true</p>
<h6 id="（7）contains"><a href="#（7）contains" class="headerlink" title="（7）contains"></a>（7）contains</h6><p>当Observable中包含指定的数据时，返回true，否则返回false。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.just(1, 2, 3)</span><br><span class="line">        .contains(4)</span><br><span class="line">        .subscribe(new Consumer&lt;Boolean&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void accept(Boolean aBoolean) throws Exception &#123;</span><br><span class="line">                Log.d(&quot;aaa&quot;, String.valueOf(aBoolean));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>返回结果：false</p>
<h6 id="（8）isEmpty"><a href="#（8）isEmpty" class="headerlink" title="（8）isEmpty"></a>（8）isEmpty</h6><p>判断发送的数据是否为空。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Observable.empty()</span><br><span class="line">        .isEmpty()</span><br><span class="line">        .subscribe(new Consumer&lt;Boolean&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void accept(Boolean aBoolean) throws Exception &#123;</span><br><span class="line">                Log.d(&quot;aaa&quot;, String.valueOf(aBoolean));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>结果返回：true</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(1, 2, 3, 4, 5)</span><br><span class="line">        .isEmpty()</span><br><span class="line">        .subscribe(new Consumer&lt;Boolean&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void accept(Boolean aBoolean) throws Exception &#123;</span><br><span class="line">                Log.d(&quot;aaa&quot;, String.valueOf(aBoolean));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>结果返回：false</p>
<h6 id="（9）amb"><a href="#（9）amb" class="headerlink" title="（9）amb"></a>（9）amb</h6><p>当需要发送多个 Observable时，只发送先发送数据的Observable的数据，而其余 Observable则被丢弃。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">List</span>&lt;Observable&lt;Integer&gt;&gt; <span class="keyword">list</span> = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">list</span>.add(Observable.just(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line"><span class="keyword">list</span>.add(Observable.just(<span class="number">3</span>, <span class="number">4</span>));</span><br><span class="line"><span class="keyword">list</span>.add(Observable.just(<span class="number">5</span>, <span class="number">6</span>));</span><br><span class="line"><span class="keyword">list</span>.add(Observable.just(<span class="number">7</span>, <span class="number">8</span>));</span><br><span class="line">Observable</span><br><span class="line">        .amb(<span class="keyword">list</span>)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            <span class="keyword">public</span> void accept(Integer integer) throws <span class="keyword">Exception</span> &#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, String.valueOf(integer));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">Observable.ambArray(Observable.just(<span class="number">1</span>, <span class="number">2</span>), Observable.just(<span class="number">3</span>, <span class="number">4</span>), Observable.just(<span class="number">5</span>, <span class="number">6</span>))</span><br><span class="line">.subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="keyword">public</span> void accept(Integer integer) throws <span class="keyword">Exception</span> &#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, String.valueOf(integer));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>以上两种写法都可以</p>
<p>返回结果：1 2</p>
<h6 id="（10）defaultIfEmpty"><a href="#（10）defaultIfEmpty" class="headerlink" title="（10）defaultIfEmpty"></a>（10）defaultIfEmpty</h6><p>在不发送任何有效事件（ Next事件）、仅发送了Complete 事件的前提下，发送一个默认值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;Integer&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;Integer&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        e.onComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">        .defaultIfEmpty(<span class="number">10</span>)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, String.valueOf(integer));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>结果返回：10</p>
<h1 id="lt-第十五篇-gt-：RxJava之组合-合并操作符"><a href="#lt-第十五篇-gt-：RxJava之组合-合并操作符" class="headerlink" title="&lt;第十五篇&gt;：RxJava之组合/合并操作符"></a>&lt;第十五篇&gt;：RxJava之组合/合并操作符</h1><h6 id="（1）concat和concatArray"><a href="#（1）concat和concatArray" class="headerlink" title="（1）concat和concatArray"></a>（1）concat和concatArray</h6><p>组合多个被观察者一起发送数据，合并后 按发送顺序串行执行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Observable&lt;Integer&gt;&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">list.add(Observable.just(<span class="number">1</span>,<span class="number">2</span>));</span><br><span class="line">list.add(Observable.just(<span class="number">3</span>, <span class="number">4</span>));</span><br><span class="line">list.add(Observable.just(<span class="number">5</span>, <span class="number">6</span>));</span><br><span class="line">Observable.concat(list)</span><br><span class="line">.subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, String.valueOf(integer));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Observable.concatArray(Observable.just(<span class="number">1</span>, <span class="number">2</span>), Observable.just(<span class="number">3</span>, <span class="number">4</span>), Observable.just(<span class="number">5</span>, <span class="number">6</span>))</span><br><span class="line">.subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, String.valueOf(integer));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>以上两种方式的合并，返回结果是：1 2 3 4 5 6</p>
<h6 id="（2）merge和mergeArray"><a href="#（2）merge和mergeArray" class="headerlink" title="（2）merge和mergeArray"></a>（2）merge和mergeArray</h6><p>组合多个被观察者一起发送数据，合并后 按时间线并行执行</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">List</span>&lt;Observable&lt;Integer&gt;&gt; <span class="keyword">list</span> = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">list</span>.add(Observable.just(<span class="number">1</span>, <span class="number">2</span>).delay(<span class="number">2000</span>, TimeUnit.MILLISECONDS));</span><br><span class="line"><span class="keyword">list</span>.add(Observable.just(<span class="number">3</span>, <span class="number">4</span>));</span><br><span class="line"><span class="keyword">list</span>.add(Observable.just(<span class="number">5</span>, <span class="number">6</span>));</span><br><span class="line"><span class="keyword">list</span>.add(Observable.just(<span class="number">7</span>, <span class="number">8</span>));</span><br><span class="line">Observable</span><br><span class="line">        .merge(<span class="keyword">list</span>)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            <span class="keyword">public</span> void accept(Integer integer) throws <span class="keyword">Exception</span> &#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, String.valueOf(integer));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Observable</span><br><span class="line">        .mergeArray(Observable.just(<span class="number">1</span>, <span class="number">2</span>).delay(<span class="number">2000</span>, TimeUnit.MILLISECONDS), Observable.just(<span class="number">3</span>, <span class="number">4</span>), Observable.just(<span class="number">5</span>, <span class="number">6</span>), Observable.just(<span class="number">7</span>, <span class="number">8</span>))</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            <span class="keyword">public</span> void accept(Integer integer) throws <span class="keyword">Exception</span> &#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, String.valueOf(integer));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>以上两种方法的返回结果是：3 4 5 6 7 8 1 2</p>
<h6 id="（3）concatDelayError和mergeDelayError"><a href="#（3）concatDelayError和mergeDelayError" class="headerlink" title="（3）concatDelayError和mergeDelayError"></a>（3）concatDelayError和mergeDelayError</h6><p>concatDelayError：多个Observable合并，并按顺序发射数据， 如果发生异常，则不会立即中断发射数据，异常将延迟发射。<br>mergeDelayError：多个Observable合并，并行发射数据， 如果发生异常，则不会立即中断发射数据，异常将延迟发射。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Observable&lt;Integer&gt;&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">list.add(Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;Integer&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        e.onNext(<span class="number">1</span>);</span><br><span class="line">        e.onNext(<span class="number">2</span>);</span><br><span class="line">        e.onError(<span class="keyword">new</span> NullPointerException(<span class="string">"exception"</span>));</span><br><span class="line">        e.onComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).delay(<span class="number">2000</span>, TimeUnit.MILLISECONDS));</span><br><span class="line"></span><br><span class="line">list.add(Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;Integer&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        e.onNext(<span class="number">3</span>);</span><br><span class="line">        e.onNext(<span class="number">4</span>);</span><br><span class="line">        e.onError(<span class="keyword">new</span> NullPointerException(<span class="string">"exception"</span>));</span><br><span class="line">        e.onComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">list.add(Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;Integer&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        e.onNext(<span class="number">5</span>);</span><br><span class="line">        e.onNext(<span class="number">6</span>);</span><br><span class="line">        e.onError(<span class="keyword">new</span> NullPointerException(<span class="string">"exception"</span>));</span><br><span class="line">        e.onComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">Observable</span><br><span class="line">        .concatDelayError(list)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, String.valueOf(integer));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="keyword">new</span> Consumer&lt;Throwable&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Throwable throwable)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"发生了异常"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>返回结果是：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-25f8df69961ebfd6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/540/format/webp"  alt="img"></p>
<p>图片.png</p>
<h6 id="（4）zip"><a href="#（4）zip" class="headerlink" title="（4）zip"></a>（4）zip</h6><p>合并多个被观察者的数据流， 然后发送(Emit)最终合并的数据。（数据和数据之间是一对一的关系）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Observable observable1=Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;Integer&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        e.onNext(<span class="number">1</span>);</span><br><span class="line">        SystemClock.sleep(<span class="number">1000</span>);</span><br><span class="line">        e.onNext(<span class="number">2</span>);</span><br><span class="line">        SystemClock.sleep(<span class="number">1000</span>);</span><br><span class="line">        e.onNext(<span class="number">3</span>);</span><br><span class="line">        SystemClock.sleep(<span class="number">1000</span>);</span><br><span class="line">        e.onNext(<span class="number">4</span>);</span><br><span class="line">        SystemClock.sleep(<span class="number">1000</span>);</span><br><span class="line">        e.onComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribeOn(Schedulers.io());</span><br><span class="line"></span><br><span class="line">Observable observable2=Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;String&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        e.onNext(<span class="string">"A"</span>);</span><br><span class="line">        SystemClock.sleep(<span class="number">1000</span>);</span><br><span class="line">        e.onNext(<span class="string">"B"</span>);</span><br><span class="line">        SystemClock.sleep(<span class="number">1000</span>);</span><br><span class="line">        e.onNext(<span class="string">"C"</span>);</span><br><span class="line">        SystemClock.sleep(<span class="number">1000</span>);</span><br><span class="line">        e.onComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribeOn(Schedulers.io());</span><br><span class="line"></span><br><span class="line">Observable.zip(observable1, observable2, <span class="keyword">new</span> BiFunction&lt;Integer,String,String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">apply</span><span class="params">(Integer a,String b)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a+b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>返回结果：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-04877aa2484447d0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/450/format/webp"  alt="img"></p>
<p>图片.png</p>
<h6 id="（5）combineLatest"><a href="#（5）combineLatest" class="headerlink" title="（5）combineLatest"></a>（5）combineLatest</h6><p>按照同一时间线来进行合并。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">Observable observable1=Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;Integer&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        SystemClock.sleep(<span class="number">700</span>);</span><br><span class="line">        e.onNext(<span class="number">1</span>);</span><br><span class="line">        SystemClock.sleep(<span class="number">700</span>);</span><br><span class="line">        e.onNext(<span class="number">2</span>);</span><br><span class="line">        SystemClock.sleep(<span class="number">700</span>);</span><br><span class="line">        e.onNext(<span class="number">3</span>);</span><br><span class="line">        SystemClock.sleep(<span class="number">700</span>);</span><br><span class="line">        e.onNext(<span class="number">4</span>);</span><br><span class="line">        SystemClock.sleep(<span class="number">700</span>);</span><br><span class="line">        e.onComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribeOn(Schedulers.io());</span><br><span class="line"></span><br><span class="line">Observable observable2=Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter&lt;String&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        e.onNext(<span class="string">"A"</span>);</span><br><span class="line">        SystemClock.sleep(<span class="number">600</span>);</span><br><span class="line">        e.onNext(<span class="string">"B"</span>);</span><br><span class="line">        SystemClock.sleep(<span class="number">600</span>);</span><br><span class="line">        e.onNext(<span class="string">"C"</span>);</span><br><span class="line">        SystemClock.sleep(<span class="number">600</span>);</span><br><span class="line">        e.onComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribeOn(Schedulers.io());</span><br><span class="line"></span><br><span class="line">Observable.combineLatest(observable1, observable2, <span class="keyword">new</span> BiFunction&lt;Integer,String,String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">apply</span><span class="params">(Integer a,String b)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a+b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>接下来，根据代码，我们来画一张图。</p>
<p>画两个时间线observable1和observable2，根据代码中指定的时间画时间线，最后观察两个被观察者时间线重合的地方。</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-7a5964164ac6c5c3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/639/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>实际上代码输出的结果也是：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-f16cbbfdd74c537c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/465/format/webp"  alt="img"></p>
<p>图片.png</p>
<h6 id="（6）combineLatestDelayError"><a href="#（6）combineLatestDelayError" class="headerlink" title="（6）combineLatestDelayError"></a>（6）combineLatestDelayError</h6><p>作用类似于concatDelayError（） / mergeDelayError（） ，即错误处理，上面已经介绍过类似的了。</p>
<h6 id="（7）reduce"><a href="#（7）reduce" class="headerlink" title="（7）reduce"></a>（7）reduce</h6><p>把被观察者需要发送的事件聚合成1个事件 &amp; 发送</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>)</span><br><span class="line">        .reduce(<span class="keyword">new</span> BiFunction&lt;Integer, Integer, Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Integer <span class="title">apply</span><span class="params">(Integer integer, Integer integer2)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> integer + integer2;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, String.valueOf(integer));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>日志如下：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-05bbe9b03f3d2f83.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/436/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>相当于做了一个这样的计算1+2+3+4+5 = 15，再将15发射出去。</p>
<h6 id="（8）collect"><a href="#（8）collect" class="headerlink" title="（8）collect"></a>（8）collect</h6><p>将被观察者Observable发送的数据事件收集到一个数据结构里</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Observable</span><br><span class="line">        .just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line">        .collect(<span class="keyword">new</span> Callable&lt;ArrayList&lt;Integer&gt;&gt;() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> ArrayList&lt;Integer&gt; <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> ArrayList();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="keyword">new</span> BiConsumer&lt;ArrayList&lt;Integer&gt;, Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(ArrayList&lt;Integer&gt; list, Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                list.add(integer);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).subscribe(<span class="keyword">new</span> Consumer&lt;ArrayList&lt;Integer&gt;&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(ArrayList&lt;Integer&gt; list)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> result : list)&#123;</span><br><span class="line">            Log.d(<span class="string">"aaa"</span>, String.valueOf(result));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>执行结果：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-cd7c8c03353b916a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/449/format/webp"  alt="img"></p>
<p>图片.png</p>
<h6 id="（9）startWith和startWithArray"><a href="#（9）startWith和startWithArray" class="headerlink" title="（9）startWith和startWithArray"></a>（9）startWith和startWithArray</h6><p>startWith： 在已有数据流之前追加一个或一组数据流。</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-1b9c1e68df14614d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/401/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>startWith可以传递的参数是：一个数据，一个数据列表，一个Observable。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">        .startWith(<span class="number">4</span>)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, String.valueOf(integer));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>返回结果： 4 1 2 3</p>
<p>startWithArray：在已有数据流之前追加一组数据流。</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-a6cac8fec75e913e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/301/format/webp"  alt="img"></p>
<p>图片.png</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">        .startWithArray(<span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, String.valueOf(integer));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>返回结果：4 5 1 2 3</p>
<h6 id="（10）count"><a href="#（10）count" class="headerlink" title="（10）count"></a>（10）count</h6><p>统计被观察者发送事件的数量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">        .count()</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Long&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Long aLong)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, String.valueOf(aLong));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>返回结果：4</p>
<h1 id="lt-第十六篇-gt-：RxJava之从内存或本地或网络中获取数据"><a href="#lt-第十六篇-gt-：RxJava之从内存或本地或网络中获取数据" class="headerlink" title="&lt;第十六篇&gt;：RxJava之从内存或本地或网络中获取数据"></a>&lt;第十六篇&gt;：RxJava之从内存或本地或网络中获取数据</h1><p>假设，我们有个需求，某数据需要先从内存中获取，如果内存中没有数据就从本地获取，如果本地依然没有数据，那就就从网络获取。</p>
<p>传统的代码如下：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IGetData</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">successed</span>(<span class="params">String data</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">failed</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 从网络中获取数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> getData</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getData</span><span class="params">(<span class="keyword">final</span> IGetData getData)</span></span>&#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//3秒钟之后获取成功</span></span><br><span class="line">            getData.successed(<span class="string">"success"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">(String data)</span></span>&#123;</span><br><span class="line">    <span class="comment">//处理数据并更新本地UI</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果缓存中有数据，那么直接更新UI</span></span><br><span class="line">    <span class="comment">//如果本地有数据，那么也直接更新UI</span></span><br><span class="line">    <span class="comment">//如果只能从网络上获取数据，由于网络请求是从子线程中执行的，所以这种情况不能直接更新UI</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//以上三种更新UI的方式冲突，导致业务逻辑混乱。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">String memoryCache &#x3D; null;&#x2F;&#x2F;缓存变量</span><br><span class="line">String diskCache &#x3D; null;&#x2F;&#x2F;内存数据</span><br><span class="line"></span><br><span class="line">if(memoryCache &#x3D;&#x3D; null)&#123;</span><br><span class="line">    &#x2F;&#x2F;如果内存数据为null，则从本地缓存获取</span><br><span class="line">    if(diskCache &#x3D;&#x3D; null)&#123;</span><br><span class="line">        &#x2F;&#x2F;如果本地缓存没有数据，则从网络获取</span><br><span class="line">        getData(new IGetData() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void successed(String data) &#123;</span><br><span class="line">                doSomething(data);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void failed() &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        doSomething(diskCache);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    doSomething(memoryCache);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上代码弊端很多，各种嵌套导致代码紊乱，如果使用RxJava完全不用担心这个问题。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span> memoryCache = <span class="literal">null</span>;<span class="comment">//缓存变量</span></span><br><span class="line"><span class="built_in">String</span> diskCache = <span class="literal">null</span>;<span class="comment">//内存数据</span></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Observable observable1 = Observable.create(<span class="keyword">new</span> ObservableOnSubscribe() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(memoryCache != <span class="keyword">null</span>)&#123;</span><br><span class="line">            e.onNext(memoryCache);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            e.onComplete();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Observable observable2 = Observable.create(<span class="keyword">new</span> ObservableOnSubscribe() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(diskCache != <span class="keyword">null</span>)&#123;</span><br><span class="line">            e.onNext(diskCache);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            e.onComplete();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Observable observable3 = Observable.create(<span class="keyword">new</span> ObservableOnSubscribe() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        e.onNext(<span class="string">"success"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribeOn(Schedulers.newThread());</span><br><span class="line"></span><br><span class="line">Observable</span><br><span class="line">        .concat(observable1, observable2, observable3)</span><br><span class="line">        .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">        .firstElement()</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, s);</span><br><span class="line">                doSomething(s);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>



<h1 id="lt-第十七篇-gt-：RxJava之页面数据展示（本地和网络）"><a href="#lt-第十七篇-gt-：RxJava之页面数据展示（本地和网络）" class="headerlink" title="&lt;第十七篇&gt;：RxJava之页面数据展示（本地和网络）"></a>&lt;第十七篇&gt;：RxJava之页面数据展示（本地和网络）</h1><p>一般而言，在Android开发中，如果要在一个页面上展示数据，我们必然先从本地数据库中获取数据，与此同时从网络中获取。<br>常规的写法如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">(String data)</span></span>&#123;</span><br><span class="line">    <span class="comment">//处理数据并更新本地UI</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果缓存中有数据，那么直接更新UI</span></span><br><span class="line">    <span class="comment">//如果本地有数据，那么也直接更新UI</span></span><br><span class="line">    <span class="comment">//如果只能从网络上获取数据，由于网络请求是从子线程中执行的，所以这种情况不能直接更新UI</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//以上三种更新UI的方式冲突，导致业务逻辑混乱。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 从网络中获取数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> getData</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getData</span><span class="params">(<span class="keyword">final</span> IGetData getData)</span></span>&#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//3秒钟之后获取成功</span></span><br><span class="line">            getData.successed(<span class="string">"success"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">String data = <span class="string">""</span>;</span><br><span class="line"><span class="comment">//（1）查询数据库</span></span><br><span class="line">data = <span class="string">"data"</span>;</span><br><span class="line"><span class="comment">//（2）...将数据库的数据更新到页面</span></span><br><span class="line">doSomething(data);</span><br><span class="line"><span class="comment">//（3）与此同时，查询网络</span></span><br><span class="line">getData(<span class="keyword">new</span> IGetData() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">successed</span><span class="params">(String data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">true</span>)&#123;<span class="comment">//如果时间戳已经更新</span></span><br><span class="line">            <span class="comment">//则更新UI</span></span><br><span class="line">            doSomething(data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">failed</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>由于网络请求是异步，导致更新UI方式不一样，这样同样的代码必然会写两遍，这样看起来代码看起来非常紊乱。</p>
<p>RxJava的写法是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">Observable observable1 = Observable.create(<span class="keyword">new</span> ObservableOnSubscribe() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//查询数据库</span></span><br><span class="line">        data = <span class="string">"data"</span>;</span><br><span class="line">        <span class="keyword">if</span>(!TextUtils.isEmpty(data))&#123;</span><br><span class="line">            e.onNext(data);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            e.onComplete();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Observable observable2 = Observable.create(<span class="keyword">new</span> ObservableOnSubscribe() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(ObservableEmitter e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//网络查询</span></span><br><span class="line">        Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">true</span>)&#123;<span class="comment">//如果时间戳已经更新</span></span><br><span class="line">            <span class="comment">//则更新UI</span></span><br><span class="line">            e.onNext(data);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            e.onComplete();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Observable.merge(observable1, observable2)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                doSomething(s);</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, s);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>



<h1 id="lt-第十八篇-gt-：RxJava之背压策略"><a href="#lt-第十八篇-gt-：RxJava之背压策略" class="headerlink" title="&lt;第十八篇&gt;：RxJava之背压策略"></a>&lt;第十八篇&gt;：RxJava之背压策略</h1><h6 id="（1）背压的存在背景"><a href="#（1）背压的存在背景" class="headerlink" title="（1）背压的存在背景"></a>（1）背压的存在背景</h6><p>默认情况下，上游是在主线程执行的，那么下游也必然在主线程中运行，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Observable.create(new ObservableOnSubscribe&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">      @Override</span><br><span class="line">      public void subscribe(ObservableEmitter&lt;String&gt; e) throws Exception &#123;</span><br><span class="line">          for (int i&#x3D;0;;i++)&#123;</span><br><span class="line">              e.onNext(String.valueOf(i));</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">          .subscribe(new Consumer&lt;String&gt;() &#123;</span><br><span class="line">      @Override</span><br><span class="line">      public void accept(String s) throws Exception &#123;</span><br><span class="line">          Thread.sleep(3000);</span><br><span class="line">          Log.d(&quot;aaa&quot;, String.valueOf(s));</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>当使用subscribeOn来控制上游线程时，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Observable.create(new ObservableOnSubscribe&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void subscribe(ObservableEmitter&lt;String&gt; e) throws Exception &#123;</span><br><span class="line">        for (int i&#x3D;0;;i++)&#123;</span><br><span class="line">            e.onNext(String.valueOf(i));</span><br><span class="line">            Log.d(&quot;aaa&quot;, &quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;+Thread.currentThread().getName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">        .subscribeOn(Schedulers.io())</span><br><span class="line">        .subscribe(new Consumer&lt;String&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void accept(String s) throws Exception &#123;</span><br><span class="line">        Thread.sleep(3000);</span><br><span class="line">        Log.d(&quot;aaa&quot;, String.valueOf(s)+&quot;----&quot;+Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>subscribeOn将上游的线程切换到IO线程，那么下游也自然而然在IO线程执行。</p>
<p>以上两种情况（没有控制线程或者subscribeOn控制上游线程），当上游发送一个数据之后，等到下游接收到数据之后上游才能继续发送数据，这样也就不会发生异常。</p>
<p>当我们使用observeOn时，上游和下游的执行就会独自运行了，即使如以下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Observable.create(new ObservableOnSubscribe&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void subscribe(ObservableEmitter&lt;String&gt; e) throws Exception &#123;</span><br><span class="line">        for (int i&#x3D;0;;i++)&#123;</span><br><span class="line">            e.onNext(String.valueOf(i));</span><br><span class="line">            Log.d(&quot;aaa&quot;, &quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;+Thread.currentThread().getName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">        .subscribeOn(AndroidSchedulers.mainThread())</span><br><span class="line">        .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">        .subscribe(new Consumer&lt;String&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void accept(String s) throws Exception &#123;</span><br><span class="line">        Thread.sleep(3000);</span><br><span class="line">        Log.d(&quot;aaa&quot;, String.valueOf(s)+&quot;----&quot;+Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>以上代码上游和下游都是运行在主线程，但是经过测试，只要使用了observeOn控制了下游的线程，那么第二次发送数据就不需要等到下游接收到数据之后才能发送了。也就是说，只要使用observeOn，上游和下游就会分别独自运行。</p>
<p>大部分情况，发送数据比较快，接收数据相对比较慢，也就是说：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">发送的数据个数 &gt; 接收数据的个数</span><br></pre></td></tr></table></figure>

<p>当下游来不及处理上游发送的数据时，这些发送的数据会存放在一个缓存区，当缓存区越来越大时，会发生OOM的现象，日志请看下图</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-0c1cf3a565b7589a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1128/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>我们来看一下内存情况</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-19f265b1cd31a42c.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp"  alt="img"></p>
<p>38.gif</p>
<p>由于缓存越来越大，导致内存泄漏非常严重，等缓存大到一定程度就会发生OOM。</p>
<p>为了解决这样的问题，出现了背压策略。</p>
<h6 id="（2）Flowable-1"><a href="#（2）Flowable-1" class="headerlink" title="（2）Flowable"></a>（2）Flowable</h6><p>在RxJava2中，采用Flowable来处理背压问题，Flowable的效率要比Observable低，所以最好当需要处理背压问题时再使用Flowable。</p>
<p>先贴一下代码实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">Flowable.create(<span class="keyword">new</span> FlowableOnSubscribe&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(FlowableEmitter&lt;String&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">129</span>;i++)&#123;</span><br><span class="line">            e.onNext(String.valueOf(i));</span><br><span class="line">            Log.d(<span class="string">"aaa"</span>,<span class="string">"已发送数据："</span>+i);</span><br><span class="line">        &#125;</span><br><span class="line">        e.onComplete();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;, BackpressureStrategy.ERROR)</span><br><span class="line">        .subscribeOn(Schedulers.newThread())</span><br><span class="line">        .observeOn(Schedulers.newThread())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Subscriber&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Subscription s)</span> </span>&#123;</span><br><span class="line">                <span class="comment">//设置最多可接受数据的数量</span></span><br><span class="line">                s.request(Long.MAX_VALUE);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, s);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable t)</span> </span>&#123;</span><br><span class="line">                t.printStackTrace();</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"t:"</span>+t.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"===完成==="</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>前面讲到的上游和下游分别是<code>Observable</code>和<code>Observer</code>， 以上代码上游变成了<code>Flowable</code>，下游变成了<code>Subscriber</code>，上游和下游由subscribe() 来连通。</p>
<p>代码中有两点比较重要</p>
<ul>
<li><p>request</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">s</span><span class="selector-class">.request</span>(<span class="selector-tag">Long</span><span class="selector-class">.MAX_VALUE</span>);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>这句话的意思是说，设置最大接收数据的数量，这里设置Long.MAX_VALUE就可以了。</p>
<ul>
<li>BackpressureStrategy</li>
</ul>
<p>Flowable.create的第二个参数就是策略常量。</p>
<h6 id="（3）BackpressureStrategy"><a href="#（3）BackpressureStrategy" class="headerlink" title="（3）BackpressureStrategy"></a>（3）BackpressureStrategy</h6><p>先看一下源码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Represents the options for applying backpressure to a source sequence.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> BackpressureStrategy &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * OnNext events are written without any buffering or dropping.</span></span><br><span class="line"><span class="comment">     * Downstream has to deal with any overflow.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;Useful when one applies one of the custom-parameter onBackpressureXXX operators.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    MISSING,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Signals a MissingBackpressureException in case the downstream can't keep up.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ERROR,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Buffers &lt;em&gt;all&lt;/em&gt; onNext values until the downstream consumes it.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    BUFFER,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Drops the most recent onNext value if the downstream can't keep up.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    DROP,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Keeps only the latest onNext value, overwriting any previous value if the</span></span><br><span class="line"><span class="comment">     * downstream can't keep up.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    LATEST</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在RxJava2中，给我们提供了5种背压策略</p>
<ul>
<li>BackpressureStrategy.MISSING</li>
</ul>
<p>OnNext事件是在不进行任何缓冲或删除的情况下写入的下游必须处理任何溢出</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">Flowable.create(<span class="keyword">new</span> FlowableOnSubscribe&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(FlowableEmitter&lt;String&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;;i++)&#123;</span><br><span class="line">            e.onNext(String.valueOf(i));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;, BackpressureStrategy.MISSING)</span><br><span class="line">        .subscribeOn(Schedulers.newThread())</span><br><span class="line">        .observeOn(Schedulers.newThread())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Subscriber&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Subscription s)</span> </span>&#123;</span><br><span class="line">                <span class="comment">//设置最多可接受数据的数量</span></span><br><span class="line">                s.request(Long.MAX_VALUE);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, s);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable t)</span> </span>&#123;</span><br><span class="line">                t.printStackTrace();</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"t:"</span>+t.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"===完成==="</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>日志显示，只要缓存队列满了就会抛出MissingBackpressureException异常，下游消费的数量是随机的。</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-a714fa2199ffcda4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/644/format/webp"  alt="img"></p>
<p>图片.png</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-9275faebc7ec0c21.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/873/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>BackpressureStrategy.MISSING策略本身不会产生多余缓存。</p>
<ul>
<li>BackpressureStrategy.ERROR</li>
</ul>
<p>如果下游无法跟上上游发送的速度，则会发出反向压力异常信号。</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-acd1017ea824076b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1076/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>解决这个问题，还是限制一下发送数据的速度为好。</p>
<ul>
<li>BackpressureStrategy.BUFFER</li>
</ul>
<p>缓存上游发送的数据，直到下游消费为止。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">Flowable.create(<span class="keyword">new</span> FlowableOnSubscribe&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(FlowableEmitter&lt;String&gt; e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;;i++)&#123;</span><br><span class="line">            e.onNext(String.valueOf(i));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;, BackpressureStrategy.BUFFER)</span><br><span class="line">        .subscribeOn(Schedulers.newThread())</span><br><span class="line">        .observeOn(Schedulers.newThread())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Subscriber&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Subscription s)</span> </span>&#123;</span><br><span class="line">                <span class="comment">//设置最多可接受数据的数量</span></span><br><span class="line">                s.request(Long.MAX_VALUE);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, s);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable t)</span> </span>&#123;</span><br><span class="line">                t.printStackTrace();</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"t:"</span>+t.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"===完成==="</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>这种策略依然会发生OOM，消耗的内存比<code>Observable</code>慢。</p>
<ul>
<li>BackpressureStrategy.DROP</li>
</ul>
<p>这个策略存在一个长度为128大小的缓存区，当缓存区满时下游则不再接收数据，等到缓存区清理的时候才可以再次接收数据。</p>
<ul>
<li>BackpressureStrategy.LATEST</li>
</ul>
<p>只保留最新的onnext值，如果下游无法跟上，则覆盖任何以前的值。</p>
<p>与Drop策略一样，如果缓存池满了，会丢掉将要放入缓存池中的数据，不同的是，不管缓存池的状态如何，LATEST都会将最后一条数据强行放入缓存池中，来保证观察者在接收到完成通知之前，能够接收到Flowable最新发射的一条数据。</p>
<h1 id="lt-第十九篇-gt-：RxJava之使用CompositeDisposable来管理Disposable"><a href="#lt-第十九篇-gt-：RxJava之使用CompositeDisposable来管理Disposable" class="headerlink" title="&lt;第十九篇&gt;：RxJava之使用CompositeDisposable来管理Disposable"></a>&lt;第十九篇&gt;：RxJava之使用CompositeDisposable来管理Disposable</h1><p>RxJava容易造成内存泄漏，在某些情况下没有及时取消订阅导致内存泄漏。</p>
<p>CompositeDisposable可以将Disposable统一管理。</p>
<p>下图展示了CompositeDisposable的操作方法</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-bf8e2fcf0f3fadb6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/483/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>有一篇博客讲解的不错，所以本章就不做过多讲解了。</p>
<p><a href="https://www.jianshu.com/p/2a882604bbe8" target="_blank" rel="noopener">Rxjava关于Disposable你应该知道的事</a></p>
<h4 id="关于disposable"><a href="#关于disposable" class="headerlink" title="关于disposable"></a>关于disposable</h4><p>Disposable类</p>
<ul>
<li>dispose():主动解除订阅</li>
<li>isDisposed():查询是否解除订阅 true 代表 已经解除订阅</li>
</ul>
<p>rxjava虽然好用，但是总所周知，容易遭层内存泄漏。也就说在订阅了事件后没有及时取阅，导致在activity或者fragment销毁后仍然占用着内存，无法释放。而disposable便是这个订阅事件，可以用来取消订阅。但是在什么时候取消订阅呢？我知道有两种方式:</p>
<ul>
<li>使用CompositeDisposable<br>看源码，CompositeDisposable的介绍很简单</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A disposable container that can hold onto multiple other disposables and offers O(1) add and removal complexity.</span><br></pre></td></tr></table></figure>

<p>一个disposable的容器，可以容纳多个disposable，添加和去除的复杂度为O(1)。<br>这里需要注意的是在该类的addAll方法有这么一句注释</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Atomically adds the given array of Disposables to the container or disposes them all if the container has been disposed</span><br></pre></td></tr></table></figure>

<p>也就是说，如果这个CompositeDisposable容器已经是处于dispose的状态，那么所有加进来的disposable都会被自动切断。</p>
<p>所以说可以创建一个BaseActivity，用CompositeDisposable来管理订阅事件disposable，然后在acivity销毁的时候，调用compositeDisposable.dispose()就可以切断所有订阅事件，防止内存泄漏。</p>
<h4 id="CompositeDisposable类"><a href="#CompositeDisposable类" class="headerlink" title="CompositeDisposable类"></a>CompositeDisposable类</h4><blockquote>
<p>1、可以快速解除所有添加的Disposable类.<br>2、每当我们得到一个Disposable时就调用CompositeDisposable.add()将它添加到容器中, 在退出的时候, 调用CompositeDisposable.clear() 即可快速解除.</p>
</blockquote>
<p>案例代码如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">CompositeDisposable compositeDisposable=new CompositeDisposable();</span><br><span class="line">Observable.create(new ObservableOnSubscribe<span class="tag">&lt;<span class="name">Integer</span>&gt;</span>() &#123;</span><br><span class="line">          @Override</span><br><span class="line">          public void subscribe(ObservableEmitter<span class="tag">&lt;<span class="name">Integer</span>&gt;</span> emitter) throws Exception &#123;</span><br><span class="line">              emitter.onNext(1);</span><br><span class="line">              emitter.onComplete();或者 emitter.onError(new Throwable("O__O "));</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;).subscribe(new Observer<span class="tag">&lt;<span class="name">Integer</span>&gt;</span>() &#123;</span><br><span class="line">          private Disposable mDisposable;</span><br><span class="line">          @Override</span><br><span class="line">          public void onSubscribe(Disposable d) &#123;</span><br><span class="line">              <span class="comment">&lt;!-- 订阅   --&gt;</span></span><br><span class="line">              mDisposable = d;</span><br><span class="line">              <span class="comment">&lt;!-- 添加到容器中 --&gt;</span></span><br><span class="line">              compositeDisposable.add(d);</span><br><span class="line">          &#125;</span><br><span class="line">          @Override</span><br><span class="line">          public void onNext(Integer value) &#123;</span><br><span class="line">        <span class="comment">&lt;!-- 判断mDisposable.isDisposed()如果解除了则不需要处理 --&gt;</span></span><br><span class="line">          &#125;</span><br><span class="line">          @Override</span><br><span class="line">          public void onError(Throwable e) &#123;</span><br><span class="line">          &#125;</span><br><span class="line">          @Override</span><br><span class="line">          public void onComplete() &#123;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">&lt;!-- 解除所有订阅者 --&gt;</span></span><br><span class="line">compositeDisposable.clear();</span><br></pre></td></tr></table></figure>

<ul>
<li>在oError和onComplete后调用disposable.dispose();，也就是上面我给的例子中的方法。<br>查看源码，ObservableCreate的静态类CreateEmitter就是这种方式实现的。同时也可以看到，onError和onComplete不可以同时调用的原因：每次掉用过onError或onComplete其中一个方法后，就会掉用dispose()方法，此时订阅取消，自然也就不能掉用另一个方法了</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Observer&lt;Integer&gt;() &#123;</span><br><span class="line">          <span class="keyword">private</span> Disposable mDisposable;</span><br><span class="line">          <span class="keyword">private</span> <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Disposable d)</span> </span>&#123;</span><br><span class="line">              Log.d(TAG, <span class="string">"subscribe"</span>);</span><br><span class="line">              mDisposable = d;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(Integer value)</span> </span>&#123;</span><br><span class="line">              Log.d(TAG, <span class="string">"onNext: "</span> + value);</span><br><span class="line">              i++;</span><br><span class="line">              <span class="keyword">if</span> (i == <span class="number">2</span>) &#123;</span><br><span class="line">                  Log.d(TAG, <span class="string">"dispose"</span>);</span><br><span class="line">                  mDisposable.dispose();</span><br><span class="line">                  Log.d(TAG, <span class="string">"isDisposed : "</span> + mDisposable.isDisposed());</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">              Log.d(TAG, <span class="string">"error"</span>);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">              Log.d(TAG, <span class="string">"complete"</span>);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>





<h1 id="lt-第二十篇-gt-：Transformer在RxJava中的使用"><a href="#lt-第二十篇-gt-：Transformer在RxJava中的使用" class="headerlink" title="&lt;第二十篇&gt;：Transformer在RxJava中的使用"></a>&lt;第二十篇&gt;：Transformer在RxJava中的使用</h1><h6 id="1）作用"><a href="#1）作用" class="headerlink" title="(1）作用"></a>(1）作用</h6><p>Transformer 能够将一个 Observable/Flowable/Single/Completable/Maybe 对象转换成另一个 Observable/Flowable/Single/Completable/Maybe 对象，和调用一系列的内联操作符是一模一样的。</p>
<h6 id="（2）分类"><a href="#（2）分类" class="headerlink" title="（2）分类"></a>（2）分类</h6><ul>
<li><p>ObservableTransformer</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ObservableTransformer observableTransformer &#x3D; new ObservableTransformer&lt;Integer, String&gt;() &#123;</span><br><span class="line">  </span><br><span class="line">    @Override</span><br><span class="line">    public ObservableSource&lt;String&gt; apply(Observable&lt;Integer&gt; observable) &#123;</span><br><span class="line">        return Observable.just(&quot;A&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>FlowableTransformer</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">FlowableTransformer flowableTransformer &#x3D; new FlowableTransformer&lt;Integer, String&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public Publisher&lt;String&gt; apply(Flowable&lt;Integer&gt; flowable) &#123;</span><br><span class="line">        return Flowable.just(&quot;B&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>SingleTransformer</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SingleTransformer singleTransformer &#x3D; new SingleTransformer&lt;Integer, String&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public SingleSource&lt;String&gt; apply(Single&lt;Integer&gt; single) &#123;</span><br><span class="line">        return Single.just(&quot;C&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>MaybeTransformer</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MaybeTransformer maybeTransformer &#x3D; new MaybeTransformer&lt;Integer, String&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public MaybeSource&lt;String&gt; apply(Maybe&lt;Integer&gt; maybe) &#123;</span><br><span class="line">        return Maybe.just(&quot;D&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>CompletableTransformer</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CompletableTransformer completableTransformer = <span class="keyword">new</span> CompletableTransformer() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CompletableSource <span class="title">apply</span><span class="params">(Completable completable)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Completable.create(<span class="keyword">new</span> CompletableOnSubscribe() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(CompletableEmitter completableEmitter)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                completableEmitter.onComplete();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h6 id="（3）使用"><a href="#（3）使用" class="headerlink" title="（3）使用"></a>（3）使用</h6><p>结合<code>compose</code>操作符可以使用Transformer</p>
<p>我们需要将一个Observable转成另一个Observable</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">        .compose(observableTransformer)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, s);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>





<h1 id="lt-第二十一篇-gt-：Android-第三方库RxLifecycle使用"><a href="#lt-第二十一篇-gt-：Android-第三方库RxLifecycle使用" class="headerlink" title="&lt;第二十一篇&gt;：Android 第三方库RxLifecycle使用"></a>&lt;第二十一篇&gt;：Android 第三方库RxLifecycle使用</h1><h6 id="（1）前景"><a href="#（1）前景" class="headerlink" title="（1）前景"></a>（1）前景</h6><p>在使用rxjava的时候，如果没有及时解除订阅，在退出activity的时候，异步线程还在执行。<br>对activity还存在引用，此时就会产生内存泄漏。<br>RxLifecycle就是为了解决rxjava导致的内存泄漏而产生的。</p>
<h6 id="（2）作用"><a href="#（2）作用" class="headerlink" title="（2）作用"></a>（2）作用</h6><p>它可以让Observable发布的事件和当前的组件绑定，实现生命周期同步。<br>从而实现当前组件生命周期结束时，自动取消对Observable订阅。<br>核心思想：通过监听Activity、Fragment的生命周期，来自动断开订阅防止内存泄漏。</p>
<h6 id="（3）添加依赖"><a href="#（3）添加依赖" class="headerlink" title="（3）添加依赖"></a>（3）添加依赖</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'io.reactivex.rxjava2:rxjava:2.1.3'</span></span><br><span class="line">implementation <span class="string">'io.reactivex.rxjava2:rxandroid:2.0.1'</span></span><br><span class="line"></span><br><span class="line">implementation <span class="string">'com.trello.rxlifecycle2:rxlifecycle:2.2.1'</span></span><br><span class="line">implementation <span class="string">'com.trello.rxlifecycle2:rxlifecycle-android:2.2.1'</span></span><br><span class="line">implementation <span class="string">'com.trello.rxlifecycle2:rxlifecycle-components:2.2.1'</span></span><br></pre></td></tr></table></figure>

<h6 id="（4）分类"><a href="#（4）分类" class="headerlink" title="（4）分类"></a>（4）分类</h6><ul>
<li>Activity<br><code>RxAppCompatActivity</code>、<code>RxActivity</code>、<code>RxFragmentActivity</code></li>
<li>Fragment<br><code>RxFragment</code>、<code>RxDialogFragment</code>、<code>RxPreferenceFragment</code>、<code>RxAppCompatDialogFragment</code></li>
</ul>
<h6 id="（5）Activity和Fragment的继承"><a href="#（5）Activity和Fragment的继承" class="headerlink" title="（5）Activity和Fragment的继承"></a>（5）Activity和Fragment的继承</h6><p>Activity需要继承<code>RxAppCompatActivity</code>或<code>RxActivity</code>或<code>RxFragmentActivity</code></p>
<p>比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseActivity</span> <span class="keyword">extends</span> <span class="title">RxAppCompatActivity</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Fragment和Activity一样，BaseFragment需要继承<code>RxFragment</code>或<code>RxDialogFragment</code>、<code>RxPreferenceFragment</code>、<code>RxAppCompatDialogFragment</code></p>
<h6 id="（6）让Observable发布的事件和当前的组件绑定"><a href="#（6）让Observable发布的事件和当前的组件绑定" class="headerlink" title="（6）让Observable发布的事件和当前的组件绑定"></a>（6）让Observable发布的事件和当前的组件绑定</h6><ul>
<li><p>bindUntilEvent</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Observable</span><br><span class="line">        .interval(<span class="number">1000</span>, TimeUnit.MILLISECONDS)</span><br><span class="line">        .compose(<span class="keyword">this</span>.&lt;Long&gt;bindUntilEvent(ActivityEvent.DESTROY))</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Long&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Long aLong)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, String.valueOf(aLong));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>以上代码的意思是说，当前Activity执行到onDestroy时，Observable取消订阅。</p>
<p>bindUntilEvent后面的参数决定Observable什么时候被取消。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Lifecycle events that can be emitted by Activities.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> ActivityEvent &#123;</span><br><span class="line"></span><br><span class="line">    CREATE,</span><br><span class="line">    START,</span><br><span class="line">    RESUME,</span><br><span class="line">    PAUSE,</span><br><span class="line">    STOP,</span><br><span class="line">    DESTROY</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上参数和Activity的生命周期一一对应。</p>
<ul>
<li><p>bindToLifecycle</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Observable</span><br><span class="line">        .interval(<span class="number">1000</span>, TimeUnit.MILLISECONDS)</span><br><span class="line">        .compose(<span class="keyword">this</span>.&lt;Long&gt;bindToLifecycle())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Long&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Long aLong)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, String.valueOf(aLong));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>假设当前Observable在onResume中执行的，那么当Activity执行到onPause时，Observable取消订阅。</p>
<p>bindToLifecycle没有参数，所以使用者不清楚Observable到底在什么时候取消订阅，那么我们来看也喜爱源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Function&lt;ActivityEvent, ActivityEvent&gt; ACTIVITY_LIFECYCLE =</span><br><span class="line">    <span class="keyword">new</span> Function&lt;ActivityEvent, ActivityEvent&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> ActivityEvent <span class="title">apply</span><span class="params">(ActivityEvent lastEvent)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="keyword">switch</span> (lastEvent) &#123;</span><br><span class="line">                <span class="keyword">case</span> CREATE:</span><br><span class="line">                    <span class="keyword">return</span> ActivityEvent.DESTROY;</span><br><span class="line">                <span class="keyword">case</span> START:</span><br><span class="line">                    <span class="keyword">return</span> ActivityEvent.STOP;</span><br><span class="line">                <span class="keyword">case</span> RESUME:</span><br><span class="line">                    <span class="keyword">return</span> ActivityEvent.PAUSE;</span><br><span class="line">                <span class="keyword">case</span> PAUSE:</span><br><span class="line">                    <span class="keyword">return</span> ActivityEvent.STOP;</span><br><span class="line">                <span class="keyword">case</span> STOP:</span><br><span class="line">                    <span class="keyword">return</span> ActivityEvent.DESTROY;</span><br><span class="line">                <span class="keyword">case</span> DESTROY:</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> OutsideLifecycleException(<span class="string">"Cannot bind to Activity lifecycle when outside of it."</span>);</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"Binding to "</span> + lastEvent + <span class="string">" not yet implemented"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>

<p>源码的意思很明显：</p>
<ul>
<li>如果<code>Observable</code>在<code>onCreate</code>执行，那么当执行到<code>onDestroy</code>时取消订阅；</li>
<li>如果<code>Observable</code>在<code>onStart</code>执行，那么当执行到<code>onStop</code>时取消订阅；</li>
<li>如果<code>Observable</code>在<code>onResume</code>执行，那么当执行到<code>onPause</code>时取消订阅；</li>
<li>如果<code>Observable</code>在<code>onPause</code>执行，那么当执行到<code>onStop</code>时取消订阅；</li>
<li>如果<code>Observable</code>在<code>onStop</code>执行，那么当执行到<code>onDestroy</code>时取消订阅；</li>
<li>如果<code>Observable</code>在<code>onDestroy</code>执行，则抛出异常；</li>
</ul>
<h1 id="lt-第二十二篇-gt-：RxJava之Android-第三方库AutoDispose使用"><a href="#lt-第二十二篇-gt-：RxJava之Android-第三方库AutoDispose使用" class="headerlink" title="&lt;第二十二篇&gt;：RxJava之Android 第三方库AutoDispose使用"></a>&lt;第二十二篇&gt;：RxJava之Android 第三方库AutoDispose使用</h1><h6 id="（1）前景-1"><a href="#（1）前景-1" class="headerlink" title="（1）前景"></a>（1）前景</h6><p>在使用rxjava的时候，如果没有及时解除订阅，在退出activity的时候，异步线程还在执行。<br>对activity还存在引用，此时就会产生内存泄漏。<br>AutoDispose就是为了解决rxjava导致的内存泄漏而产生的。</p>
<h6 id="（2）添加依赖"><a href="#（2）添加依赖" class="headerlink" title="（2）添加依赖"></a>（2）添加依赖</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.uber.autodispose:autodispose-android-archcomponents:1.0.0-RC2'</span></span><br></pre></td></tr></table></figure>

<h6 id="（3）使用-1"><a href="#（3）使用-1" class="headerlink" title="（3）使用"></a>（3）使用</h6><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Observable</span><br><span class="line">        .interval(<span class="number">1000</span>, TimeUnit.MILLISECONDS)</span><br><span class="line">        <span class="comment">//AutoDispose的关键语句</span></span><br><span class="line">        .<span class="keyword">as</span>(AutoDispose.&lt;Long&gt;autoDisposable(AndroidLifecycleScopeProvider.<span class="keyword">from</span>(<span class="keyword">this</span>)))</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Long&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span>(<span class="params">Long aLong</span>) throws Exception</span> &#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, String.valueOf(aLong));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>只需要添加一句话即可。</p>
<h1 id="lt-第二十三篇-gt-：RxJava内存泄漏问题解决"><a href="#lt-第二十三篇-gt-：RxJava内存泄漏问题解决" class="headerlink" title="&lt;第二十三篇&gt;：RxJava内存泄漏问题解决"></a>&lt;第二十三篇&gt;：RxJava内存泄漏问题解决</h1><h6 id="1）存在内存泄漏问题"><a href="#1）存在内存泄漏问题" class="headerlink" title="1）存在内存泄漏问题"></a>1）存在内存泄漏问题</h6><p>在使用rxjava的时候，如果没有及时解除订阅，在退出activity的时候，异步线程还在执行。对activity还存在引用，此时就会产生内存泄漏。</p>
<h6 id="（2）常规手动取消订阅（不推荐）"><a href="#（2）常规手动取消订阅（不推荐）" class="headerlink" title="（2）常规手动取消订阅（不推荐）"></a>（2）常规手动取消订阅（不推荐）</h6><p>为了防止内存泄漏的出现，我们需要在onDestroy取消订阅，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Observable.interval(<span class="number">1000</span>, TimeUnit.MILLISECONDS)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Observer&lt;Long&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Disposable d)</span> </span>&#123;</span><br><span class="line">                disposable = d;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(Long aLong)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(disposable != <span class="keyword">null</span> &amp;&amp; !disposable.isDisposed())&#123;</span><br><span class="line">        <span class="comment">//取消订阅</span></span><br><span class="line">        disposable.dispose();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">super</span>.onDestroy();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上代码的缺点很明显：</p>
<p>必须在onSubscribe中保存Disposable对象，然后在onDestroy方法里面取消订阅，如果有多个Observable时，很明显Disposable也会有多个，这样代码看起来紊乱，逻辑复杂，可读性差。</p>
<p>那么有没有什么办法对Disposable统一管理呢？</p>
<h6 id="（3）使用CompositeDisposable来管理Disposable"><a href="#（3）使用CompositeDisposable来管理Disposable" class="headerlink" title="（3）使用CompositeDisposable来管理Disposable"></a>（3）使用CompositeDisposable来管理Disposable</h6><p>这篇文章大家可以看一下</p>
<p><a href="https://www.jianshu.com/p/2a882604bbe8" target="_blank" rel="noopener">Rxjava关于Disposable你应该知道的事</a></p>
<p>CompositeDisposable是一个存放Disposable的集合，它是一个容器，可以在BaseActivity里new一个CompositeDisposable对象，在BaseActivity的子类中可以使用该对象对Disposable统一管理。</p>
<p>CompositeDisposable也属于手动取消订阅，但显然比单独管理Disposable的方法强多了。</p>
<h6 id="（4）RxLifecycle-自动取消订阅-（推荐）"><a href="#（4）RxLifecycle-自动取消订阅-（推荐）" class="headerlink" title="（4）RxLifecycle(自动取消订阅)（推荐）"></a>（4）RxLifecycle(自动取消订阅)（推荐）</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Observable</span><br><span class="line">    .interval(<span class="number">1000</span>, TimeUnit.MILLISECONDS)</span><br><span class="line">    .compose(<span class="keyword">this</span>.&lt;Long&gt;bindUntilEvent(ActivityEvent.DESTROY))</span><br><span class="line">    .subscribe(<span class="keyword">new</span> Consumer&lt;Long&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Long aLong)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, String.valueOf(aLong));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<p>RxLifecycle将Observable和Activity（Fragment）的生命周期绑定在一起，使用<code>compose</code>关键字来确定Observable将要在哪个生命周期执行时自动取消订阅。</p>
<p>具体请看这篇文章</p>
<p><a href="https://www.jianshu.com/p/88ea00755a7b" target="_blank" rel="noopener">RxJava&lt;第二十一篇&gt;：Android 第三方库RxLifecycle使用</a></p>
<p>这样优雅的解决RxJava内存泄漏问题值得推荐。</p>
<h6 id="（5）AutoDispose-自动取消订阅-（推荐）"><a href="#（5）AutoDispose-自动取消订阅-（推荐）" class="headerlink" title="（5）AutoDispose(自动取消订阅)（推荐）"></a>（5）AutoDispose(自动取消订阅)（推荐）</h6><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Observable</span><br><span class="line">        .interval(<span class="number">1000</span>, TimeUnit.MILLISECONDS)</span><br><span class="line">        <span class="comment">//AutoDispose的关键语句</span></span><br><span class="line">        .<span class="keyword">as</span>(AutoDispose.&lt;Long&gt;autoDisposable(AndroidLifecycleScopeProvider.<span class="keyword">from</span>(<span class="keyword">this</span>)))</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Long&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span>(<span class="params">Long aLong</span>) throws Exception</span> &#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, String.valueOf(aLong));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>AutoDispose要比RxLifecycle更加简单，有人说使用AutoDispose取代RxLifecycle也是有一定道理的，毕竟RxLifecycle需要继承对应的<code>RxActivity</code>、<code>RxFragment</code>，而AutoDispose却不用。</p>
<p>有关AutoDispose的描述，我也整理了一个博客。</p>
<p><a href="https://www.jianshu.com/p/ea2da1dc8b28" target="_blank" rel="noopener">RxJava&lt;第二十二篇&gt;：Android 第三方库AutoDispose使用</a></p>
<h1 id="lt-第二十四篇-gt-：RxJava之RxBinding3-0"><a href="#lt-第二十四篇-gt-：RxJava之RxBinding3-0" class="headerlink" title="&lt;第二十四篇&gt;：RxJava之RxBinding3.0"></a>&lt;第二十四篇&gt;：RxJava之RxBinding3.0</h1><h5 id="（1）github"><a href="#（1）github" class="headerlink" title="（1）github"></a>（1）github</h5><p>以下是RxBing的github地址：</p>
<p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FJakeWharton%2FRxBinding" target="_blank" rel="noopener">RxBinding</a></p>
<p>目前RxBinding已经更新到<code>3.0.0-alpha2</code>了。</p>
<h5 id="（2）依赖"><a href="#（2）依赖" class="headerlink" title="（2）依赖"></a>（2）依赖</h5><p>RxBinding2.0.0使用量比较多：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.jakewharton.rxbinding2:rxbinding:2.0.0'</span></span><br></pre></td></tr></table></figure>

<p>RxBinding2.2.0之后废弃了一些组件和接口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.jakewharton.rxbinding2:rxbinding:2.2.0'</span></span><br></pre></td></tr></table></figure>



<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-6bbf322323525f81.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/429/format/webp"  alt="img"></p>
<p>图片.png</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-d27bc10acf40f1a2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/574/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>另外RxBinding2.2.0提供了对recyclerview组件的扩展</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.jakewharton.rxbinding2:rxbinding-recyclerview-v7:2.2.0'</span></span><br></pre></td></tr></table></figure>



<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-36f9038f2af20d29.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/742/format/webp"  alt="img"></p>
<p>图片.png</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-aac8bd33e0a8e6f4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/477/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>如果用到recyclerview的话可以选择使用 <code>recyclerview-v7:2.2.0</code>这个依赖。</p>
<p>RxBinding现在已经更新到3.0.0了：</p>
<p>我们可以使用以下依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.jakewharton.rxbinding3:rxbinding:3.0.0-alpha2'</span></span><br></pre></td></tr></table></figure>

<p>同时，在2.0.0的基础上废弃了不少接口。</p>
<p>RxBinding3.0.0加入了对AndroidX的支持</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.jakewharton.rxbinding3:rxbinding-core:3.0.0-alpha2'</span></span><br><span class="line">implementation <span class="string">'com.jakewharton.rxbinding3:rxbinding-appcompat:3.0.0-alpha2'</span></span><br><span class="line">implementation <span class="string">'com.jakewharton.rxbinding3:rxbinding-drawerlayout:3.0.0-alpha2'</span></span><br><span class="line">implementation <span class="string">'com.jakewharton.rxbinding3:rxbinding-leanback:3.0.0-alpha2'</span></span><br><span class="line">implementation <span class="string">'com.jakewharton.rxbinding3:rxbinding-recyclerview:3.0.0-alpha2'</span></span><br><span class="line">implementation <span class="string">'com.jakewharton.rxbinding3:rxbinding-slidingpanelayout:3.0.0-alpha2'</span></span><br><span class="line">implementation <span class="string">'com.jakewharton.rxbinding3:rxbinding-swiperefreshlayout:3.0.0-alpha2'</span></span><br><span class="line">implementation <span class="string">'com.jakewharton.rxbinding3:rxbinding-viewpager:3.0.0-alpha2'</span></span><br></pre></td></tr></table></figure>

<p>包括Google ‘material’ library bindings:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.jakewharton.rxbinding3:rxbinding-material:3.0.0-alpha2'</span></span><br></pre></td></tr></table></figure>

<p>也需要AndroidX的支持。</p>
<p>随着Android SDK版本的迭代，api28之后将不再更新，将传统项目转成AndoridX刻不容缓，RxBinding对AndroidX的支持以后应该还会继续迭代。</p>
<p>本章将针对</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.jakewharton.rxbinding3:rxbinding:3.0.0-alpha2'</span></span><br></pre></td></tr></table></figure>

<p>这个依赖包进行分析。</p>
<p>还有一点需要说明，如果项目中已经导入了以下依赖包，可以直接删除了，因为RxBinding的依赖包自带rxjava和rxandroid。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'io.reactivex.rxjava2:rxjava:2.1.3'</span></span><br><span class="line">implementation <span class="string">'io.reactivex.rxjava2:rxandroid:2.0.1'</span></span><br></pre></td></tr></table></figure>

<h5 id="（3）相关组件"><a href="#（3）相关组件" class="headerlink" title="（3）相关组件"></a>（3）相关组件</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RxAbsListView&#96;、&#96;RxAdapter&#96;、&#96;RxAdapterView&#96;、&#96;RxAutoCompleteTextView&#96;、&#96;RxCompoundButton&#96;、&#96;RxPopupMenu&#96;、&#96;RxRadioGroup&#96;、&#96;RxRatingBar&#96;、&#96;RxSearchView&#96;、&#96;RxSeekBar&#96;、&#96;RxTextView&#96;、&#96;RxToolbar&#96;、&#96;RxMenuItem&#96;、&#96;RxView&#96;、&#96;RxViewGroup</span><br></pre></td></tr></table></figure>

<h5 id="（4）RxView"><a href="#（4）RxView" class="headerlink" title="（4）RxView"></a>（4）RxView</h5><ul>
<li><p>clicks 点击事件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">RxView.clicks(bt_1).subscribe(<span class="keyword">new</span> Consumer&lt;Object&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Object o)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"点击事件"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>相当于</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bt_1.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"点击事件"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>visibility 隐藏或者显示</li>
</ul>
<p>方法一：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">boolean <span class="keyword">value</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    RxView.visibility(bt_1).accept(<span class="keyword">value</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>相当于</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">boolean <span class="keyword">value</span> = <span class="literal">false</span>;</span><br><span class="line">bt_1.setVisibility(<span class="keyword">value</span> ? View.VISIBLE : View.GONE);</span><br></pre></td></tr></table></figure>

<p>方法二：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">boolean <span class="keyword">value</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">int</span> visibilityWhenFalse = View.VISIBLE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    RxView.visibility(bt_1, visibilityWhenFalse).accept(<span class="keyword">value</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>相当于</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">boolean <span class="keyword">value</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">int</span> visibilityWhenFalse = View.VISIBLE;</span><br><span class="line">bt_1.setVisibility(<span class="keyword">value</span> ? View.VISIBLE : visibilityWhenFalse);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>longClicks 长按事件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">RxView.longClicks(bt_1)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Unit&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Unit unit)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"1111111111111111"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>相当于</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bt_1.setOnLongClickListener(<span class="keyword">new</span> View.OnLongClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onLongClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"1111111111111111"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>attaches View被添加</li>
</ul>
<p>RxView.attaches(bt_1);</p>
<ul>
<li>attachEvents View被添加时触发</li>
</ul>
<p>RxView.attachEvents(bt_1)</p>
<ul>
<li>detaches View被移除</li>
</ul>
<p>RxView.detaches(bt_1);</p>
<ul>
<li><p>drags 拖拽的监听</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">RxView.drags(ll_demo)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;DragEvent&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span>(<span class="params">DragEvent <span class="keyword">event</span></span>) throws Exception</span> &#123;</span><br><span class="line">                <span class="comment">//获取事件</span></span><br><span class="line">                <span class="keyword">int</span> action = <span class="keyword">event</span>.getAction();</span><br><span class="line">                <span class="keyword">switch</span> (action) &#123;</span><br><span class="line">                    <span class="keyword">case</span> DragEvent.ACTION_DRAG_STARTED:</span><br><span class="line">                        Log.d(<span class="string">"aaa"</span>, <span class="string">"开始拖拽"</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> DragEvent.ACTION_DRAG_ENDED:</span><br><span class="line">                        Log.d(<span class="string">"aaa"</span>, <span class="string">"结束拖拽"</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> DragEvent.ACTION_DRAG_ENTERED:</span><br><span class="line">                        Log.d(<span class="string">"aaa"</span>, <span class="string">"拖拽的view进入监听的view时"</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> DragEvent.ACTION_DRAG_EXITED:</span><br><span class="line">                        Log.d(<span class="string">"aaa"</span>, <span class="string">"拖拽的view离开监听的view时"</span>);</span><br><span class="line">                        ll_demo.setBackgroundColor(Color.parseColor(<span class="string">"#303F9F"</span>));</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> DragEvent.ACTION_DRAG_LOCATION:</span><br><span class="line">                        <span class="keyword">float</span> x = <span class="keyword">event</span>.getX();</span><br><span class="line">                        <span class="keyword">float</span> y = <span class="keyword">event</span>.getY();</span><br><span class="line">                        ll_demo.setBackgroundColor(Color.GRAY);</span><br><span class="line">                        Log.i(<span class="string">"aaa"</span>, <span class="string">"拖拽的view在监听view中的位置:x ="</span> + x + <span class="string">",y="</span> + y);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> DragEvent.ACTION_DROP:</span><br><span class="line">                        Log.i(<span class="string">"aaa"</span>, <span class="string">"释放拖拽的view"</span>);</span><br><span class="line">  </span><br><span class="line">                        <span class="keyword">if</span>(<span class="keyword">event</span> != <span class="literal">null</span> &amp;&amp; <span class="keyword">event</span>.getLocalState() != <span class="literal">null</span>)&#123;</span><br><span class="line">                            View localState = (View) <span class="keyword">event</span>.getLocalState();</span><br><span class="line">                            FrameLayout.LayoutParams layoutParams = <span class="keyword">new</span> FrameLayout.LayoutParams(ViewGroup.LayoutParams.WRAP_CONTENT, ViewGroup.LayoutParams.WRAP_CONTENT);</span><br><span class="line">                            ((ViewGroup) localState.getParent()).removeView(localState);</span><br><span class="line">                            ll_demo.addView(localState, layoutParams);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>



</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">RxView.longClicks(bt_1)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Unit&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Unit unit)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//设置震动反馈</span></span><br><span class="line">                bt_1.performHapticFeedback(HapticFeedbackConstants.LONG_PRESS, HapticFeedbackConstants.FLAG_IGNORE_GLOBAL_SETTING);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 创建DragShadowBuilder，我把控件本身传进去</span></span><br><span class="line">                View.DragShadowBuilder builder = <span class="keyword">new</span> View.DragShadowBuilder(bt_1);</span><br><span class="line">                <span class="comment">// 剪切板数据，可以在DragEvent.ACTION_DROP方法的时候获取。</span></span><br><span class="line">                ClipData data = ClipData.newPlainText(<span class="string">"Label"</span>, <span class="string">"我是文本内容！"</span>);</span><br><span class="line">                <span class="comment">// 开始拖拽</span></span><br><span class="line">                <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) &#123;</span><br><span class="line">                    bt_1.startDragAndDrop(data, builder,bt_1, <span class="number">0</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    bt_1.startDrag(data, builder, bt_1, <span class="number">0</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-2dd2cf9f07494b66.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/302/format/webp"  alt="img"></p>
<p>40.gif</p>
<ul>
<li>draws 重绘监听</li>
</ul>
<p>监听某View重绘</p>
<p>随便自定义一个view吧</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomView</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomView</span><span class="params">(Context context, @Nullable AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomView</span><span class="params">(Context context, @Nullable AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span>[] colors = &#123;Color.RED, Color.BLACK, Color.CYAN, Color.BLUE&#125;;</span><br><span class="line">    <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDraw(canvas);</span><br><span class="line">        canvas.drawColor(colors[index]);</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, String.valueOf(index));</span><br><span class="line"></span><br><span class="line">        index = (++index &gt;= colors.length) ? <span class="number">0</span> : index;</span><br><span class="line">        postInvalidateDelayed(<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果如下</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-8b708675232b3a87.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/302/format/webp"  alt="img"></p>
<p>41.gif</p>
<p>现在开始监听</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">RxView.draws(view_demo)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Unit&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Unit unit)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"22222"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>相当于</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">view_demo.getViewTreeObserver().addOnDrawListener(<span class="keyword">new</span> ViewTreeObserver.OnDrawListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"22222"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>globalLayouts 监听布局改变</li>
</ul>
<p>在弹出软键盘，使布局变化的场景常用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">RxView.globalLayouts(rootview)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Unit&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Unit unit)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"1111111111111111111"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>相当于</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rootview.getViewTreeObserver().addOnGlobalLayoutListener(<span class="keyword">new</span> ViewTreeObserver.OnGlobalLayoutListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onGlobalLayout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"1111111111111111111"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>focusChanges 监听焦点变化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">RxView.focusChanges(et_demo)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Boolean&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Boolean aBoolean)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"11111111111111"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>相当于</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">et_demo.setOnFocusChangeListener(<span class="keyword">new</span> View.OnFocusChangeListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFocusChange</span><span class="params">(View v, <span class="keyword">boolean</span> hasFocus)</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"11111111111111"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>hovers 悬停事件</li>
</ul>
<p>一些平板支持鼠标，当鼠标悬停在某view上时，会有其他效果</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-a86299c6507a1535.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/580/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>比如给按钮添加背景，设置state_hovered属性， 当鼠标悬停在view上时会改变颜色。</p>
<p>我们也可以对悬停事件进行监听</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">RxView.hovers(bt_1)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;MotionEvent&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(MotionEvent motionEvent)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"11111111111111"</span>);</span><br><span class="line">                <span class="keyword">int</span> what = motionEvent.getAction();</span><br><span class="line">                <span class="keyword">switch</span>(what)&#123;</span><br><span class="line">                    <span class="keyword">case</span> MotionEvent.ACTION_HOVER_ENTER: <span class="comment">//鼠标进入view</span></span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> MotionEvent.ACTION_HOVER_MOVE: <span class="comment">//鼠标在view上</span></span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> MotionEvent.ACTION_HOVER_EXIT: <span class="comment">//鼠标离开view</span></span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>相当于</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">bt_1.setOnHoverListener(<span class="keyword">new</span> View.OnHoverListener() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> boolean <span class="title">onHover</span>(<span class="params">View v, MotionEvent <span class="keyword">event</span></span>)</span> &#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"11111111111111"</span>);</span><br><span class="line">        <span class="keyword">int</span> what = <span class="keyword">event</span>.getAction();</span><br><span class="line">        <span class="keyword">switch</span>(what)&#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_HOVER_ENTER: <span class="comment">//鼠标进入view</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_HOVER_MOVE: <span class="comment">//鼠标在view上</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_HOVER_EXIT: <span class="comment">//鼠标离开view</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>keys 按键被按下</li>
</ul>
<p>主要用作于监听物理按键的返回键，当然，软键盘的删除和回车(搜索)也是可以监听到的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">RxView.keys(et_demo)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;KeyEvent&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(KeyEvent keyEvent)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"11111111111111"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>相当于</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">et_demo.setOnKeyListener(<span class="keyword">new</span> View.OnKeyListener() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> boolean <span class="title">onKey</span>(<span class="params">View v, <span class="keyword">int</span> keyCode, KeyEvent <span class="keyword">event</span></span>)</span> &#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"11111111111111:"</span>+<span class="keyword">event</span>.getAction());</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>layoutChanges和layoutChangeEvents 组件布局参数发生改变</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">RxView.layoutChanges(rootview)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Unit&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Unit unit)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"1111111111111111111"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>



</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">RxView.layoutChangeEvents(rootview)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;ViewLayoutChangeEvent&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(ViewLayoutChangeEvent viewLayoutChangeEvent)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"1111111111111111111"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>相当于</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rootview.addOnLayoutChangeListener(<span class="keyword">new</span> View.OnLayoutChangeListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLayoutChange</span><span class="params">(View v, <span class="keyword">int</span> left, <span class="keyword">int</span> top, <span class="keyword">int</span> right, <span class="keyword">int</span> bottom, <span class="keyword">int</span> oldLeft, <span class="keyword">int</span> oldTop, <span class="keyword">int</span> oldRight, <span class="keyword">int</span> oldBottom)</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"1111111111111111111"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>preDraws 将要绘制时</li>
</ul>
<p>熟悉自定义view或者viewgroup的猿一定知道三个方法：<code>onMeasure</code>、<code>onLayout</code>、<code>onDraw</code>，它们的执行顺序是<code>onMeasure</code>–&gt;<code>onLayout</code>–&gt;<code>onDraw</code>， <code>preDraws</code>监听的时机就在<code>onLayout</code>和<code>onDraw</code>之间。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">RxView.preDraws(view_demo, <span class="keyword">new</span> Function0&lt;Boolean&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">invoke</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Observer&lt;Unit&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Disposable d)</span> </span>&#123;</span><br><span class="line">                disposable = d;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(Unit unit)</span> </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"onPreDraw"</span>);</span><br><span class="line">                <span class="comment">//接收一次之后立即移除监听，否则会阻塞UI线程</span></span><br><span class="line">                disposable.dispose();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>相当于</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">view_demo.getViewTreeObserver().addOnPreDrawListener(<span class="keyword">new</span> ViewTreeObserver.OnPreDrawListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onPreDraw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"onPreDraw"</span>);</span><br><span class="line">        <span class="comment">//监听一次之后立即移除监听，否则会阻塞UI线程</span></span><br><span class="line">        view_demo.getViewTreeObserver().removeOnPreDrawListener(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>scrollChangeEvents 滚动事件API23</li>
</ul>
<p>这个监听在API 23之后生效</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">RxView.scrollChangeEvents(view_demo)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;ViewScrollChangeEvent&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(ViewScrollChangeEvent viewScrollChangeEvent)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>相当于</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) &#123;</span><br><span class="line">    view_demo.setOnScrollChangeListener(<span class="keyword">new</span> View.OnScrollChangeListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onScrollChange</span><span class="params">(View v, <span class="keyword">int</span> scrollX, <span class="keyword">int</span> scrollY, <span class="keyword">int</span> oldScrollX, <span class="keyword">int</span> oldScrollY)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>systemUiVisibilityChanges 状态栏和导航栏可见和隐藏</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">RxView.systemUiVisibilityChanges(rootview)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>相当于</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rootview.setOnSystemUiVisibilityChangeListener(<span class="keyword">new</span> View.OnSystemUiVisibilityChangeListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSystemUiVisibilityChange</span><span class="params">(<span class="keyword">int</span> visibility)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>touches 触摸事件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">RxView.touches(et_demo)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;MotionEvent&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(MotionEvent motionEvent)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>相当于</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">et_demo.setOnTouchListener(<span class="keyword">new</span> View.OnTouchListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="（5）RxTextView"><a href="#（5）RxTextView" class="headerlink" title="（5）RxTextView"></a>（5）RxTextView</h5><ul>
<li>beforeTextChangeEvents、textChanges、textChangeEvents、afterTextChangeEvents</li>
</ul>
<p>对文本变化监听。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">RxTextView.beforeTextChangeEvents(et_demo)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;TextViewBeforeTextChangeEvent&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(TextViewBeforeTextChangeEvent textViewBeforeTextChangeEvent)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"111111111111111"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">RxTextView.textChangeEvents(et_demo)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;TextViewTextChangeEvent&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(TextViewTextChangeEvent textViewTextChangeEvent)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"2222222222222222222"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">RxTextView.afterTextChangeEvents(et_demo)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;TextViewAfterTextChangeEvent&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(TextViewAfterTextChangeEvent textViewAfterTextChangeEvent)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"3333333333333333333333"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>相当于</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">et_demo.addTextChangedListener(<span class="keyword">new</span> TextWatcher() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeTextChanged</span><span class="params">(CharSequence s, <span class="keyword">int</span> start, <span class="keyword">int</span> count, <span class="keyword">int</span> after)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTextChanged</span><span class="params">(CharSequence s, <span class="keyword">int</span> start, <span class="keyword">int</span> before, <span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterTextChanged</span><span class="params">(Editable s)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>editorActions和editorActionEvents</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">RxTextView.editorActions(et_demo)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, String.valueOf(integer));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>



</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">RxTextView.editorActionEvents(et_demo)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;TextViewEditorActionEvent&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(TextViewEditorActionEvent textViewEditorActionEvent)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"1111111111111111111111"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>相当于</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">et_demo.setOnEditorActionListener(<span class="keyword">new</span> TextView.OnEditorActionListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onEditorAction</span><span class="params">(TextView v, <span class="keyword">int</span> actionId, KeyEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>需要注意的是：在布局文件中需要添加inputType和imeOptions属性。</p>
<h5 id="（6）RxViewGroup"><a href="#（6）RxViewGroup" class="headerlink" title="（6）RxViewGroup"></a>（6）RxViewGroup</h5><ul>
<li>changeEvents</li>
</ul>
<p>当viewgroup添加或者删除子view时触发</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">rootview</span><span class="selector-class">.addView</span>(<span class="selector-tag">view</span>);</span><br><span class="line"><span class="selector-tag">rootview</span><span class="selector-class">.removeView</span>(<span class="selector-tag">view</span>);</span><br></pre></td></tr></table></figure>



<p>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">RxViewGroup.changeEvents(rootview)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;ViewGroupHierarchyChangeEvent&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(ViewGroupHierarchyChangeEvent viewGroupHierarchyChangeEvent)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"11111111111111111111"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>相当于</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">rootview.setOnHierarchyChangeListener(<span class="keyword">new</span> ViewGroup.OnHierarchyChangeListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onChildViewAdded</span><span class="params">(View parent, View child)</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"11111111111111111111"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onChildViewRemoved</span><span class="params">(View parent, View child)</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"22222222222222222222"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="（7）RxToolbar"><a href="#（7）RxToolbar" class="headerlink" title="（7）RxToolbar"></a>（7）RxToolbar</h5><ul>
<li><p>navigationClicks</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">RxToolbar.navigationClicks(toolbar_normal).subscribe(<span class="keyword">new</span> Consumer&lt;Unit&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Unit unit)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>相当于</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">toolbar_normal.setNavigationOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>itemClicks</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">RxToolbar.itemClicks(toolbar_normal).subscribe(<span class="keyword">new</span> Consumer&lt;MenuItem&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(MenuItem menuItem)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>相当于</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">toolbar_normal.setOnMenuItemClickListener(<span class="keyword">new</span> Toolbar.OnMenuItemClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onMenuItemClick</span><span class="params">(MenuItem menuItem)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (menuItem.getItemId())&#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.action_item_one:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.action_item_two:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.action_notification:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.action_search:</span><br><span class="line">                SearchView searchView = (SearchView) menuItem.getActionView();</span><br><span class="line">                searchView.setQueryHint(<span class="string">"搜索"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="（8）RxMenuItem"><a href="#（8）RxMenuItem" class="headerlink" title="（8）RxMenuItem"></a>（8）RxMenuItem</h5><ul>
<li><p>clicks</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">RxMenuItem.clicks(menuItem)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Unit&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Unit unit)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>对应着Toolbar某Item的点击事件</p>
<ul>
<li><p>actionViewEvents</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">RxMenuItem.actionViewEvents(menuItem)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;MenuItemActionViewEvent&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(MenuItemActionViewEvent menuItemActionViewEvent)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>对应着Toolbar某Item的点击事件</p>
<h5 id="（9）RxRadioGroup"><a href="#（9）RxRadioGroup" class="headerlink" title="（9）RxRadioGroup"></a>（9）RxRadioGroup</h5><ul>
<li>checkedChanges</li>
</ul>
<p>监听选中变化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">RxRadioGroup.checkedChanges(radio_g).subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>相当于</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">radio_g.setOnCheckedChangeListener(<span class="keyword">new</span> RadioGroup.OnCheckedChangeListener() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCheckedChanged</span>(<span class="params">RadioGroup <span class="keyword">group</span>, <span class="keyword">int</span> checkedId</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>checked</li>
</ul>
<p>选择单选按钮</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    RxRadioGroup.<span class="keyword">checked</span>(radio_g).accept(radioButton2.getId());</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>相当于</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">radio_g</span><span class="selector-class">.check</span>(<span class="selector-tag">radioButton2</span><span class="selector-class">.getId</span>());</span><br></pre></td></tr></table></figure>

<h5 id="（10）RxCompoundButton"><a href="#（10）RxCompoundButton" class="headerlink" title="（10）RxCompoundButton"></a>（10）RxCompoundButton</h5><p>单选按钮</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">RxCompoundButton.checkedChanges(radioButton1)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Boolean&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Boolean isChecked)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>相当于</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">radioButton1.setOnCheckedChangeListener(<span class="keyword">new</span> CompoundButton.OnCheckedChangeListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCheckedChanged</span><span class="params">(CompoundButton buttonView, <span class="keyword">boolean</span> isChecked)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="（11）RxAutoCompleteTextView"><a href="#（11）RxAutoCompleteTextView" class="headerlink" title="（11）RxAutoCompleteTextView"></a>（11）RxAutoCompleteTextView</h5><p>Item点击事件监听</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">RxAutoCompleteTextView.itemClickEvents(auto_tv)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;AdapterViewItemClickEvent&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(AdapterViewItemClickEvent adapterViewItemClickEvent)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<h5 id="（12）RxPopupMenu"><a href="#（12）RxPopupMenu" class="headerlink" title="（12）RxPopupMenu"></a>（12）RxPopupMenu</h5><ul>
<li><p>itemClicks</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">RxPopupMenu.itemClicks(popupMenu)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;MenuItem&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(MenuItem menuItem)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  </span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>相当于</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">popupMenu.setOnMenuItemClickListener(<span class="keyword">new</span> PopupMenu.OnMenuItemClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onMenuItemClick</span><span class="params">(MenuItem item)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 控件每一个item的点击事件</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>dismisses</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">RxPopupMenu.dismisses(popupMenu).subscribe(<span class="keyword">new</span> Consumer&lt;Unit&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Unit unit)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>相当于</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">popupMenu.setOnDismissListener(<span class="keyword">new</span> PopupMenu.OnDismissListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDismiss</span><span class="params">(PopupMenu menu)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 控件消失时的事件</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="（13）RxAdapter、RxAbsListView、RxAdapterView"><a href="#（13）RxAdapter、RxAbsListView、RxAdapterView" class="headerlink" title="（13）RxAdapter、RxAbsListView、RxAdapterView"></a>（13）RxAdapter、RxAbsListView、RxAdapterView</h5><p>适配器和listview相关，这个相信大家已经很熟悉了，这里不做过多介绍。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//适配器Adapter数据改变</span></span><br><span class="line">RxAdapter.dataChanges();</span><br><span class="line"><span class="comment">//绝对视图滚动事件</span></span><br><span class="line">RxAbsListView.scrollEvents();</span><br><span class="line"></span><br><span class="line">RxAdapterView.selectionEvents();</span><br><span class="line"></span><br><span class="line">RxAdapterView.itemSelections();</span><br><span class="line"></span><br><span class="line">RxAdapterView.itemClicks();</span><br><span class="line"></span><br><span class="line">RxAdapterView.itemLongClicks();</span><br><span class="line"></span><br><span class="line">RxAdapterView.itemLongClickEvents();</span><br></pre></td></tr></table></figure>

<h5 id="（14）RxSeekBar"><a href="#（14）RxSeekBar" class="headerlink" title="（14）RxSeekBar"></a>（14）RxSeekBar</h5><p>进度条相关监听</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">RxSeekBar.userChanges(seekBar).subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">RxSeekBar.systemChanges(seekBar).subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">RxSeekBar.changeEvents(seekBar).subscribe(<span class="keyword">new</span> Consumer&lt;SeekBarChangeEvent&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(SeekBarChangeEvent seekBarChangeEvent)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">RxSeekBar.changes(seekBar).subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="（15）RxRatingBar"><a href="#（15）RxRatingBar" class="headerlink" title="（15）RxRatingBar"></a>（15）RxRatingBar</h5><p>RatingBar用作评分的进度条</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-41461d750f819392.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/441/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>比如上图， 用手指拖动可以进行评分。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//星级滚动条进度改变事件</span></span><br><span class="line">RxRatingBar.ratingChanges();</span><br><span class="line"><span class="comment">//星级滚动条进度改变事件</span></span><br><span class="line">RxRatingBar.ratingChangeEvents();</span><br></pre></td></tr></table></figure>

<p>它的用法比较简单，这里就不写完整代码了。</p>
<h5 id="（16）RxSearchView"><a href="#（16）RxSearchView" class="headerlink" title="（16）RxSearchView"></a>（16）RxSearchView</h5><p>SearchView的一般监听写法是</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">search_view.setOnQueryTextListener(<span class="keyword">new</span> SearchView.OnQueryTextListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onQueryTextSubmit</span><span class="params">(String query)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//提交后的处理</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onQueryTextChange</span><span class="params">(String newText)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//输入文本监听，newText是文本变化后的文本</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>queryTextChanges</li>
</ul>
<p>输入文本监听，文本变化后的文本</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">RxSearchView.queryTextChanges(search_view)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;CharSequence&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(CharSequence charSequence)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="comment">//输入文本监听，文本变化后的文本</span></span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, charSequence.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>queryTextChangeEvents</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">RxSearchView.queryTextChangeEvents(search_view).subscribe(<span class="keyword">new</span> Consumer&lt;SearchViewQueryTextEvent&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(SearchViewQueryTextEvent searchViewQueryTextEvent)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(searchViewQueryTextEvent.isSubmitted())&#123;</span><br><span class="line">            <span class="comment">//提交后的处理</span></span><br><span class="line">  </span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//输入文本监听</span></span><br><span class="line">  </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>query</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">//设置SearchView的初始值</span></span><br><span class="line">    RxSearchView.query(search_view, <span class="keyword">true</span>).accept(<span class="string">"asd"</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (<span class="keyword">Exception</span> e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h1 id="lt-第二十五篇-gt-：RxJava之功能防抖（防暴力点击）"><a href="#lt-第二十五篇-gt-：RxJava之功能防抖（防暴力点击）" class="headerlink" title="&lt;第二十五篇&gt;：RxJava之功能防抖（防暴力点击）"></a>&lt;第二十五篇&gt;：RxJava之功能防抖（防暴力点击）</h1><p>网上有大量的防抖动措施，基本类似。</p>
<p>下面我来通过RxJava实现防抖动（防暴力点击）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RxBinding&#96;和&#96;throttleFirst&#96;相结合可以实现&#96;功能防抖</span><br></pre></td></tr></table></figure>

<p>过滤操作符<code>throttleFirst</code>：接收者只会接收到在指定时间内发送的第一条数据</p>
<p>代码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">RxView.clicks(bt_1)</span><br><span class="line">        .throttleFirst(<span class="number">2</span>, TimeUnit.SECONDS)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Unit&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Unit unit)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="comment">//点击事件回调</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>两秒内，不管点击多少次，Oberver只会接收第一条数据。</p>
<h1 id="lt-第二十六篇-gt-：RxJava之联合判断"><a href="#lt-第二十六篇-gt-：RxJava之联合判断" class="headerlink" title="&lt;第二十六篇&gt;：RxJava之联合判断"></a>&lt;第二十六篇&gt;：RxJava之联合判断</h1><p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-fab3ff394ef0d0ca.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/314/format/webp"  alt="img"></p>
<p>如图所示，图片上有三个编辑框，当三个编辑框的内容满足条件时，登录按钮可被点击，否则不可被点击。</p>
<p>要求：</p>
<ul>
<li>手机号必须等于11位；</li>
<li>密码必须大于等于6位；</li>
<li>授权码不能为空；</li>
</ul>
<p>同时满足以上条件即可让登录按钮使能。</p>
<p>如果使用RxJava来实现，代码可以更加优雅。</p>
<p>这里采用<code>RxBinding</code>和<code>combineLatest</code>相结合的方式实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> EditText telphone = findViewById(R.id.telphone);</span><br><span class="line"><span class="keyword">final</span> EditText password = findViewById(R.id.password);</span><br><span class="line"><span class="keyword">final</span> EditText shouquan = findViewById(R.id.shouquan);</span><br><span class="line"><span class="keyword">final</span> Button bt_login = findViewById(R.id.bt_login);</span><br><span class="line"></span><br><span class="line"><span class="comment">//手机号文本监听被观察者</span></span><br><span class="line">Observable&lt;CharSequence&gt; observable1 = RxTextView.textChanges(telphone);</span><br><span class="line"><span class="comment">//密码文本监听被观察者</span></span><br><span class="line">Observable&lt;CharSequence&gt; observable2 = RxTextView.textChanges(password);</span><br><span class="line"><span class="comment">//授权文本监听被观察者</span></span><br><span class="line">Observable&lt;CharSequence&gt; observable3 = RxTextView.textChanges(shouquan);</span><br><span class="line"></span><br><span class="line">Observable.combineLatest(observable1, observable2, observable3, <span class="keyword">new</span> Function3&lt;CharSequence, CharSequence, CharSequence, Boolean&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">apply</span><span class="params">(CharSequence charSequence, CharSequence charSequence2, CharSequence charSequence3)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> phone_boolean = (!TextUtils.isEmpty(telphone.getText()) &amp;&amp; telphone.getText().length() == <span class="number">11</span>) ? <span class="keyword">true</span> : <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">boolean</span> password_boolean = (!TextUtils.isEmpty(password.getText()) &amp;&amp; password.getText().length() &gt;= <span class="number">6</span>) ? <span class="keyword">true</span> : <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">boolean</span> shouquan_boolean = !TextUtils.isEmpty(shouquan.getText()) ? <span class="keyword">true</span> : <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">return</span> phone_boolean &amp;&amp; password_boolean &amp;&amp; shouquan_boolean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).subscribe(<span class="keyword">new</span> Consumer&lt;Boolean&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Boolean aBoolean)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(aBoolean)&#123;</span><br><span class="line">            bt_login.setEnabled(<span class="keyword">true</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            bt_login.setEnabled(<span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-2f3d97a0f74de8b2.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/322/format/webp"  alt="img"></p>
<h1 id="lt-第二十七篇-gt-：RxJava之搜索优化"><a href="#lt-第二十七篇-gt-：RxJava之搜索优化" class="headerlink" title="&lt;第二十七篇&gt;：RxJava之搜索优化"></a>&lt;第二十七篇&gt;：RxJava之搜索优化</h1><p><code>throttleWithTimeout</code>和<code>debounce</code>是一个意思：</p>
<p>假设指定时间为1秒， 那么被观察者发送第一条数据时，等待1秒之后仍然没有发送第二条数据，那么观察者将收到该数据，如果还没到1秒钟就重新发送了数据，那么第一条数据就被取消发送。</p>
<p><code>RxBinding</code>和<code>throttleWithTimeout</code>相结合或者<code>RxBinding</code>和<code>debounce</code>相结合都可以对搜索进行优化。</p>
<p>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> EditText telphone = findViewById(R.id.telphone);</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> TextView search_result = findViewById(R.id.search_result);</span><br><span class="line"></span><br><span class="line">RxTextView.textChanges(telphone)</span><br><span class="line">        <span class="comment">//.throttleWithTimeout(2, TimeUnit.SECONDS)</span></span><br><span class="line">        .debounce(<span class="number">2</span>, TimeUnit.SECONDS)</span><br><span class="line">        .subscribeOn(Schedulers.io())</span><br><span class="line">        .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;CharSequence&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(CharSequence charSequence)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                search_result.setText(<span class="string">"搜索结果："</span>+charSequence);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>



<h1 id="lt-第二十八篇-gt-：RxJava实现倒计时"><a href="#lt-第二十八篇-gt-：RxJava实现倒计时" class="headerlink" title="&lt;第二十八篇&gt;：RxJava实现倒计时"></a>&lt;第二十八篇&gt;：RxJava实现倒计时</h1><p>通常情况下，我们可以使用<code>CountDownTimer</code>来优雅的实现时间倒计时，代码如下</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">string</span> name=<span class="string">"remainder_second"</span>&gt;%<span class="number">2</span>ds&lt;/<span class="built_in">string</span>&gt;</span><br><span class="line">&lt;<span class="built_in">string</span> name=<span class="string">"get_code"</span>&gt;获取验证码&lt;/<span class="built_in">string</span>&gt;</span><br></pre></td></tr></table></figure>



<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//当获取验证码成功的时候倒计时开始</span></span><br><span class="line"> CountDownTimer timer = <span class="keyword">new</span> CountDownTimer(<span class="number">60000</span>, <span class="number">1000</span>) &#123;</span><br><span class="line">     @Override</span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTick</span>(<span class="params"><span class="keyword">long</span> millisUntilFinished</span>)</span> &#123;</span><br><span class="line">         bt_1.setEnabled(<span class="literal">false</span>);</span><br><span class="line">         bt_1.setText(getString(R.<span class="keyword">string</span>.remainder_second, millisUntilFinished / <span class="number">1000</span>));</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     @Override</span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFinish</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">         bt_1.setEnabled(<span class="literal">true</span>);</span><br><span class="line">         bt_1.setText(getString(R.<span class="keyword">string</span>.get_code));</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;;</span><br><span class="line"> timer.start();</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-81bf6ecb85ccf42d.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/322/format/webp"  alt="img"></p>
<p>那么RxJava也可以实现时间倒计时，下面将结合<code>RxBinding</code>来实现时间倒计时功能。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> maxCount = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">RxView.clicks(bt_1)</span><br><span class="line">        .flatMap(<span class="keyword">new</span> Function&lt;Unit, ObservableSource&lt;Integer&gt;&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> ObservableSource&lt;Integer&gt; <span class="title">apply</span><span class="params">(Unit unit)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                bt_1.setEnabled(<span class="keyword">false</span>);</span><br><span class="line">                bt_1.setText(getString(R.string.remainder_second, maxCount));</span><br><span class="line">                <span class="keyword">return</span> Observable.interval(<span class="number">1000</span>, TimeUnit.MILLISECONDS)</span><br><span class="line">                        .take(maxCount)</span><br><span class="line">                        .map(<span class="keyword">new</span> Function&lt;Long, Integer&gt;() &#123;</span><br><span class="line">                            <span class="meta">@Override</span></span><br><span class="line">                            <span class="function"><span class="keyword">public</span> Integer <span class="title">apply</span><span class="params">(Long aLong)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                                <span class="keyword">return</span> maxCount - (aLong.intValue() + <span class="number">1</span>);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"int:"</span>+integer);</span><br><span class="line">        <span class="keyword">if</span>(integer.intValue() == <span class="number">0</span>)&#123;</span><br><span class="line">            bt_1.setEnabled(<span class="keyword">false</span>);</span><br><span class="line">            bt_1.setText(getString(R.string.get_code));</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            bt_1.setEnabled(<span class="keyword">false</span>);</span><br><span class="line">            bt_1.setText(getString(R.string.remainder_second, integer));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>







<h1 id="lt-第二十九篇-gt-：RxPermission"><a href="#lt-第二十九篇-gt-：RxPermission" class="headerlink" title="&lt;第二十九篇&gt;：RxPermission"></a>&lt;第二十九篇&gt;：RxPermission</h1><p>我在<a href="https://www.jianshu.com/p/3018060a9ab2" target="_blank" rel="noopener">RxPermission 用法</a>已经介绍过RxPermission的基本用法了。</p>
<p>以下代码就是RxPermission优雅的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">String[] permissions = &#123;Manifest.permission.CAMERA, Manifest.permission.ACCESS_FINE_LOCATION&#125;;</span><br><span class="line">RxPermissions rxPermissions = <span class="keyword">new</span> RxPermissions(<span class="keyword">this</span>);</span><br><span class="line">rxPermissions.requestEach(permissions)</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Permission&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Permission permission)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (permission.granted) &#123;</span><br><span class="line">                    <span class="comment">// 用户已经同意该权限</span></span><br><span class="line">                    <span class="comment">//result.agree(permission);</span></span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (permission.shouldShowRequestPermissionRationale) &#123;</span><br><span class="line">                    <span class="comment">// 用户拒绝了该权限，没有选中『不再询问』（Never ask again）,那么下次再次启动时，还会提示请求权限的对话框</span></span><br><span class="line">                    <span class="comment">//result.refuse(permission);</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 用户拒绝了该权限，并且选中『不再询问』，提醒用户手动打开权限</span></span><br><span class="line">                    <span class="comment">//result.noMoreQuestions(permission);</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>效果如下</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-78b5dc9eb3499a84.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/303/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>下面结合<code>Rxbinding</code></p>
<p>首先添加依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.jakewharton.rxbinding3:rxbinding:3.0.0-alpha2'</span></span><br><span class="line">implementation <span class="string">'com.tbruyelle.rxpermissions2:rxpermissions:0.9.5@aar'</span></span><br></pre></td></tr></table></figure>

<h5 id="（1）如果只申请一个权限的情况下"><a href="#（1）如果只申请一个权限的情况下" class="headerlink" title="（1）如果只申请一个权限的情况下"></a>（1）如果只申请一个权限的情况下</h5><p>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">RxPermissions rxPermissions = <span class="keyword">new</span> RxPermissions(<span class="keyword">this</span>);</span><br><span class="line">RxView.clicks(bt_1)</span><br><span class="line">        .compose(rxPermissions.ensure(Manifest.permission.CAMERA))</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Boolean&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Boolean granted)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(granted)&#123;</span><br><span class="line">                    <span class="comment">//允许</span></span><br><span class="line"></span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="comment">//拒绝</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<h5 id="（2）如果一次性申请多个权限的情况下"><a href="#（2）如果一次性申请多个权限的情况下" class="headerlink" title="（2）如果一次性申请多个权限的情况下"></a>（2）如果一次性申请多个权限的情况下</h5><p>代码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">RxPermissions rxPermissions = <span class="keyword">new</span> RxPermissions(<span class="keyword">this</span>);</span><br><span class="line">RxView.clicks(bt_1)</span><br><span class="line">        .compose(rxPermissions.ensure(Manifest.permission.CAMERA, Manifest.permission.ACCESS_FINE_LOCATION))</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Boolean&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Boolean granted)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(granted)&#123;</span><br><span class="line">                    <span class="comment">//允许</span></span><br><span class="line"></span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="comment">//拒绝</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p>这里观察者接收一个boolean值，只有当所有权限都申请成功时才会返回true，否则但会false。</p>
<h1 id="lt-第三十篇-gt-：Android开发必须了解的Okhttp"><a href="#lt-第三十篇-gt-：Android开发必须了解的Okhttp" class="headerlink" title="&lt;第三十篇&gt;：Android开发必须了解的Okhttp"></a>&lt;第三十篇&gt;：Android开发必须了解的Okhttp</h1><blockquote>
<p>Okhttp是目前主流网络框架之一，往往结合retrofit一起使用。因为现在项目主流框架是RxJava+Okhttp+Retrofit，所以我将Okhttp的讲解放在了Rx系列专题。</p>
</blockquote>
<h5 id="（1）添加依赖库"><a href="#（1）添加依赖库" class="headerlink" title="（1）添加依赖库"></a>（1）添加依赖库</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.squareup.okhttp3:okhttp:3.12.2'</span></span><br></pre></td></tr></table></figure>

<h5 id="（2）解决引入依赖库之后的异常"><a href="#（2）解决引入依赖库之后的异常" class="headerlink" title="（2）解决引入依赖库之后的异常"></a>（2）解决引入依赖库之后的异常</h5><p>引入依赖库之后需要对Java8的编译支持，否则会报错，在<code>build.gradle</code>中添加：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">compileOptions &#123;</span><br><span class="line">    sourceCompatibility JavaVersion.VERSION_1_8</span><br><span class="line">    targetCompatibility JavaVersion.VERSION_1_8</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-7604907823d5d7a5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/654/format/webp"  alt="img"></p>
<p>图片.png</p>
<h5 id="（3）添加网络权限"><a href="#（3）添加网络权限" class="headerlink" title="（3）添加网络权限"></a>（3）添加网络权限</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.INTERNET"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="（4）Get请求"><a href="#（4）Get请求" class="headerlink" title="（4）Get请求"></a>（4）Get请求</h5><ul>
<li>同步调用</li>
</ul>
<p>使用call.execute()实现同步调用，但是从Android3.0之后出现一个新的策略，凡是网络请求必须在异步线程执行，不能在UI线程执行，否则抛出异常，所以以下代码的网络请求部分必须在子线程执行</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//（1）创建client对象</span></span><br><span class="line">OkHttpClient client = <span class="keyword">new</span> OkHttpClient.Builder().build();</span><br><span class="line"><span class="comment">//（2）创建Request对象</span></span><br><span class="line">Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">        .<span class="keyword">get</span>()</span><br><span class="line">        .url(<span class="string">"https:www.baidu.com"</span>)</span><br><span class="line">        .build();</span><br><span class="line"><span class="comment">//（3）将Request封装成Call</span></span><br><span class="line">Call call = client.newCall(request);</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//（4）开始Get请求</span></span><br><span class="line">            Response response = call.execute();</span><br><span class="line">            <span class="keyword">if</span>(response.isSuccessful())&#123;</span><br><span class="line"></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            Log.d(<span class="string">"aaa"</span>, response.body().toString());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).start();</span><br></pre></td></tr></table></figure>

<p>在平时，我们应当尽量避免在UI线程执行网络请求，因为网络请求必然会阻塞UI线程。<br>其实call.execute()是可以在UI线程执行的，我们可以通过代码取消Android3.0对<code>网络请求不能在UI线程执行</code>的限制</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">StrictMode.ThreadPolicy policy=<span class="keyword">new</span> StrictMode.ThreadPolicy.Builder().permitAll().build();</span><br><span class="line">StrictMode.setThreadPolicy(policy);</span><br></pre></td></tr></table></figure>

<p>在<code>onCreate</code>方法中添加这两句代码就可以让call.execute()在主线程执行。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//（1）创建client对象</span></span><br><span class="line">OkHttpClient client = <span class="keyword">new</span> OkHttpClient.Builder().build();</span><br><span class="line"><span class="comment">//（2）创建Request对象</span></span><br><span class="line">Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">        .<span class="keyword">get</span>()</span><br><span class="line">        .url(<span class="string">"https:www.baidu.com"</span>)</span><br><span class="line">        .build();</span><br><span class="line"><span class="comment">//（3）将Request封装成Call</span></span><br><span class="line">Call call = client.newCall(request);</span><br><span class="line"></span><br><span class="line"><span class="comment">//（4）开始Get请求</span></span><br><span class="line">Response response = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    response = call.execute();</span><br><span class="line">    <span class="keyword">if</span>(response.isSuccessful())&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">Log.d(<span class="string">"aaa"</span>, response.body().toString());</span><br></pre></td></tr></table></figure>

<ul>
<li><p>异步调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//（1）创建client对象</span></span><br><span class="line">OkHttpClient client = <span class="keyword">new</span> OkHttpClient.Builder().build();</span><br><span class="line"><span class="comment">//（2）创建Request对象</span></span><br><span class="line">Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">        .get()</span><br><span class="line">        .url(<span class="string">"https:www.baidu.com"</span>)</span><br><span class="line">        .build();</span><br><span class="line"><span class="comment">//（3）将Request封装成Call</span></span><br><span class="line">Call call = client.newCall(request);</span><br><span class="line"></span><br><span class="line"><span class="comment">//（4）异步调用,并设置回调函数</span></span><br><span class="line">call.enqueue(<span class="keyword">new</span> Callback() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, IOException e)</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call call, <span class="keyword">final</span> Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> String res = response.body().string();</span><br><span class="line">  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>异步调用<code>onFailure</code>和<code>onResponse</code>是在非UI线程上执行的。</p>
<h5 id="（5）Post请求"><a href="#（5）Post请求" class="headerlink" title="（5）Post请求"></a>（5）Post请求</h5><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建client对象</span></span><br><span class="line">OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line"><span class="comment">//创建FormBody对象，并传参</span></span><br><span class="line">FormBody formBody = <span class="keyword">new</span> FormBody.Builder()</span><br><span class="line">        .<span class="keyword">add</span>(<span class="string">"username"</span>, <span class="string">"admin"</span>)</span><br><span class="line">        .<span class="keyword">add</span>(<span class="string">"password"</span>, <span class="string">"admin"</span>)</span><br><span class="line">        .build();</span><br><span class="line"><span class="comment">//创建request对象</span></span><br><span class="line">Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">        .url(<span class="string">"http://www.jianshu.com/"</span>)</span><br><span class="line">        .post(formBody)</span><br><span class="line">        .build();</span><br><span class="line"><span class="comment">//将Request封装成Call</span></span><br><span class="line">Call call = client.newCall(request);</span><br><span class="line"><span class="comment">//开始网络请求</span></span><br><span class="line">call.enqueue(<span class="keyword">new</span> Callback() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span>(<span class="params">Call call, IOException e</span>)</span> &#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"11111111111111"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span>(<span class="params">Call call, Response response</span>) throws IOException</span> &#123;</span><br><span class="line">        String res = response.body().<span class="keyword">string</span>();</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"22222:"</span>+res);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>同步调用和Get请求一致。</p>
<h5 id="（6）OkHttpClient"><a href="#（6）OkHttpClient" class="headerlink" title="（6）OkHttpClient"></a>（6）OkHttpClient</h5><p>OkHttpClient可配置的属性有</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">OkHttpClient client=<span class="keyword">new</span> OkHttpClient.Builder()</span><br><span class="line">        .connectTimeout(<span class="number">60</span>, TimeUnit.SECONDS)       <span class="comment">//设置连接超时</span></span><br><span class="line">        .readTimeout(<span class="number">60</span>, TimeUnit.SECONDS)          <span class="comment">//设置读超时</span></span><br><span class="line">        .writeTimeout(<span class="number">60</span>,TimeUnit.SECONDS)          <span class="comment">//设置写超时</span></span><br><span class="line">        .retryOnConnectionFailure(<span class="literal">true</span>)             <span class="comment">//是否自动重连</span></span><br><span class="line">        .build();                                   <span class="comment">//构建OkHttpClient对象</span></span><br></pre></td></tr></table></figure>

<p>内存的释放</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">client.dispatcher().executorService().shutdown();   <span class="comment">//清除并关闭线程池</span></span><br><span class="line">client.connectionPool().evictAll();                 <span class="comment">//清除并关闭连接池</span></span><br><span class="line">client.cache().<span class="built_in">close</span>();                             <span class="comment">//清除cache</span></span><br></pre></td></tr></table></figure>

<p><code>newBuilder</code>的使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">OkHttpClient eagerClient &#x3D; client.newBuilder() </span><br><span class="line">       .readTimeout(500, TimeUnit.MILLISECONDS)</span><br><span class="line">       .build();</span><br></pre></td></tr></table></figure>

<p>这样创建的实例与原实例共享线程池、连接池和其他设置项，只需进行少量配置就可以实现特殊需求。</p>
<h5 id="（7）Request"><a href="#（7）Request" class="headerlink" title="（7）Request"></a>（7）Request</h5><p>Request是网络请求的对象，其本身的构造函数是private的，只能通过Request.Builder来构建（建造者设计模式）。下面代码展示了常用的设置项。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">        .url(<span class="string">"https://api.github.com/repos/square/okhttp/issues"</span>)                          <span class="comment">//设置访问url</span></span><br><span class="line">        .<span class="keyword">get</span>()                                                                             <span class="comment">//类似的有post、delete、patch、head、put等方法，对应不同的网络请求方法</span></span><br><span class="line">        .header(<span class="string">"User-Agent"</span>, <span class="string">"OkHttp Headers.java"</span>)                                       <span class="comment">//设置header</span></span><br><span class="line">        .addHeader(<span class="string">"Accept"</span>, <span class="string">"application/json; q=0.5"</span>)                                    <span class="comment">//添加header</span></span><br><span class="line">        .removeHeader(<span class="string">"User-Agent"</span>)                                                        <span class="comment">//移除header</span></span><br><span class="line">        .headers(<span class="keyword">new</span> Headers.Builder().<span class="keyword">add</span>(<span class="string">"User-Agent"</span>, <span class="string">"OkHttp Headers.java"</span>).build())   <span class="comment">//移除原有所有header，并设置新header</span></span><br><span class="line">        .addHeader(<span class="string">"Accept"</span>, <span class="string">"application/vnd.github.v3+json"</span>)</span><br><span class="line">        .build();</span><br></pre></td></tr></table></figure>

<h5 id="（8）RequestBody和FormBody、-MultipartBody"><a href="#（8）RequestBody和FormBody、-MultipartBody" class="headerlink" title="（8）RequestBody和FormBody、 MultipartBody"></a>（8）<code>RequestBody</code>和<code>FormBody</code>、 <code>MultipartBody</code></h5><ul>
<li>RequestBody</li>
</ul>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-ef7edd94362ea59d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/686/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>从上图可知，创建RequestBody请求体支持文件、byte数组以及字符串。</p>
<p>就以字符串为例</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">JSONObject jsonObject = <span class="keyword">new</span> JSONObject();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    jsonObject.put(<span class="string">"username"</span>, <span class="string">"admin"</span>);</span><br><span class="line">    jsonObject.put(<span class="string">"password"</span>, <span class="string">"admin"</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (JSONException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">RequestBody requestBody = RequestBody.create(MediaType.parse(<span class="string">"application/json; charset=utf-8"</span>), jsonObject.toString());</span><br></pre></td></tr></table></figure>

<p>另外，requestBody可以获取以下属性</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-6a92977ad7a225ad.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/346/format/webp"  alt="img"></p>
<p>图片.png</p>
<p><code>contentLength：</code> 消息体长度<br><code>isDuplex：</code> 是否支持双工<br><code>isOneShot：</code> 是否支持单工<br><code>contentType：</code> 获取MediaType</p>
<p>这里还需要重点介绍一下<code>MediaType</code>，可分为：：</p>
<p><code>json：</code> application/json<br><code>xml：</code> application/xml<br><code>png：</code> image/png<br><code>jpg：</code> image/jpeg<br><code>gif：</code> imge/gif<br><code>form：</code> application/x-www-form-urlencoded</p>
<p>使用时最好带上编码：<code>MediaType.parse(&quot;application/json; charset=utf-8&quot;)</code></p>
<ul>
<li>FormBody</li>
</ul>
<p>FromBody用于提交表单键值对，其作用类似于HTML中的<form>标记。</p>
<p>FormBody是RequestBody的子类，从源码可以看出它默认MediaType是<code>application/x-www-form-urlencoded</code></p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-db348fae3d766237.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/624/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>FormBody支持设置键值对</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">RequestBody formBody = <span class="keyword">new</span> FormBody.Builder()</span><br><span class="line">        .<span class="keyword">add</span>(<span class="string">"username"</span>, <span class="string">"admin"</span>)</span><br><span class="line">        .<span class="keyword">add</span>(<span class="string">"password"</span>, <span class="string">"admin"</span>)</span><br><span class="line">        .addEncoded(URLEncoder.encode(<span class="string">"A"</span>), URLEncoder.encode(<span class="string">"B"</span>))</span><br><span class="line">        .build();</span><br></pre></td></tr></table></figure>

<p>FormBody 的两个方法<code>add</code>和<code>addEncoded</code>可以添加键值对。</p>
<p>FormBody对象可以获取到的值如图所示：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-51d1233a86422fbf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/428/format/webp"  alt="img"></p>
<p>图片.png</p>
<p><code>encodedName：</code> 指定角标，获取已编码的key；<br><code>encodedValue：</code> 指定角标，获取已编码的value；<br><code>name：</code> 指定角标获取key；<br><code>value：</code> 指定角标获取value；<br><code>contentLength：</code> 获取请求体的长度；<br><code>contentType：</code> 获取MediaType类型；<br><code>size：</code> 获取键值对的数量</p>
<ul>
<li>MultipartBody</li>
</ul>
<p>使用MultipartBody.Builder可以构建与HTML文件上传格式兼容的复杂请求体。多块请求体中每块请求都是一个独立的请求体，都可以定义自己的请求头。这些请求头应该用于描述对应的请求体，例如Content-Disposition，Content-Length，和Content-Type会自动被添加到请求头中。</p>
<p>它有五种MediaType，分别是：</p>
<p><code>MultipartBody.MIXED：</code> “multipart/mixed”<br><code>MultipartBody.ALTERNATIVE：</code> “multipart/alternative”<br><code>MultipartBody.DIGEST：</code> “multipart/digest”<br><code>MultipartBody.PARALLEL：</code> “multipart/parallel”<br><code>MultipartBody.FORM：</code> “multipart/form-data”</p>
<p><code>MultipartBody.FORM</code> 比较常用，其他四种查询了很多资料也没有完全理清楚。</p>
<p>multipartBody可调用的方法有：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-0b74523f41ce3db1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/497/format/webp"  alt="img"></p>
<p>图片.png</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setType：&#96; 设置MediaType</span><br><span class="line">&#96;addFormDataPart：</span><br></pre></td></tr></table></figure>



<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-3acd9b75c4c8336f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/508/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>两个参数：键值对</p>
<p>三个参数：键值对+文件消息体（一般用于文件上传）</p>
<p><code>addPart：</code> 每个Part（块）都会封装一个请求体</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-8d44c8e960193760.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/507/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>代码如下：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">RequestBody multipartBody = <span class="keyword">new</span> MultipartBody.Builder()</span><br><span class="line">        .setType(MultipartBody.FORM)</span><br><span class="line">        .addPart(</span><br><span class="line">                Headers.of(<span class="string">"Content-Disposition"</span>, <span class="string">"form-data; name=\"title\""</span>),</span><br><span class="line">                RequestBody.create(<span class="literal">null</span>, <span class="string">"Logo"</span>))</span><br><span class="line">        .addPart(</span><br><span class="line">                Headers.of(<span class="string">"Content-Disposition"</span>, <span class="string">"form-data; name=\"image\""</span>),</span><br><span class="line">                RequestBody.create(MediaType.parse(<span class="string">"image/png"</span>), <span class="keyword">new</span> File(<span class="string">"website/static/logo.png"</span>)))</span><br><span class="line">        .addFormDataPart(<span class="string">"discription"</span>,<span class="string">"beautiful"</span>)</span><br><span class="line">        .build();</span><br></pre></td></tr></table></figure>

<h5 id="（9）Call"><a href="#（9）Call" class="headerlink" title="（9）Call"></a>（9）Call</h5><p>Call对象表示一个已经准备好可以执行的请求，用这个对象可以查询请求的执行状态，或者取消当前请求。它具有以下方法：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Call call=client.newCall(request);              <span class="comment">//获取Call对象</span></span><br><span class="line">Response response=call.execute();               <span class="comment">//同步执行网络请求，不要在主线程执行</span></span><br><span class="line">call.enqueue(<span class="keyword">new</span> Callback());                   <span class="comment">//异步执行网络请求</span></span><br><span class="line">call.cancel();                                  <span class="comment">//取消请求</span></span><br><span class="line">call.isCanceled();                              <span class="comment">//查询是否取消</span></span><br><span class="line">call.isExecuted();                              <span class="comment">//查询是否被执行过</span></span><br></pre></td></tr></table></figure>

<p>要注意的是，每个Call对象只能执行一次请求。如果想重复执行相同的请求，可以：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Call reCall=client.newCall(call.request());     <span class="comment">//获取另一个相同配置的Call对象</span></span><br></pre></td></tr></table></figure>

<h5 id="（10）Response"><a href="#（10）Response" class="headerlink" title="（10）Response"></a>（10）Response</h5><p>Response是网络请求的结果下面是一些常用方法：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Response response=call.execute();               <span class="comment">//获取Response对象</span></span><br><span class="line">response.code();                                <span class="comment">//请求的状态码</span></span><br><span class="line">response.isSuccessful();                        <span class="comment">//如果状态码为[200..300)，则表明请求成功</span></span><br><span class="line">Headers headers=response.headers();              <span class="comment">//获取响应头</span></span><br><span class="line">List&lt;<span class="built_in">String</span>&gt; names=response.headers(<span class="string">"name"</span>);     <span class="comment">//获取响应头中的某个字段</span></span><br><span class="line">ResponseBody body=response.body();             <span class="comment">//获取响应体</span></span><br></pre></td></tr></table></figure>

<p>其中ResponseBody代表响应体，用于操作网络请求返回的内容。常用方法如下：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">body.contentLength();                           <span class="comment">//body的长度</span></span><br><span class="line">String content=body.<span class="keyword">string</span>();                   <span class="comment">//以字符串形式解码body</span></span><br><span class="line"><span class="keyword">byte</span>[] byteContent=body.bytes();                <span class="comment">//以字节数组形式解码body</span></span><br><span class="line">InputStreamReader reader=body.charStream();     <span class="comment">//将body以字符流的形式解码</span></span><br><span class="line">InputStream inputStream=body.byteStream();      <span class="comment">//将body以字节流的形式解码</span></span><br></pre></td></tr></table></figure>

<p>需要注意的是：</p>
<ul>
<li><p>ResponseBody必须关闭，不然可能造成资源泄漏，你可以通过以下方法关闭ResponseBody,对同一个ResponseBody只要关闭一次就可以了。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Response</span><span class="selector-class">.close</span>();</span><br><span class="line"><span class="selector-tag">Response</span><span class="selector-class">.body</span>()<span class="selector-class">.close</span>();</span><br><span class="line"><span class="selector-tag">Response</span><span class="selector-class">.body</span>()<span class="selector-class">.source</span>()<span class="selector-class">.close</span>();</span><br><span class="line"><span class="selector-tag">Response</span><span class="selector-class">.body</span>()<span class="selector-class">.charStream</span>()<span class="selector-class">.close</span>();</span><br><span class="line"><span class="selector-tag">Response</span><span class="selector-class">.body</span>()<span class="selector-class">.byteString</span>()<span class="selector-class">.close</span>();</span><br><span class="line"><span class="selector-tag">Response</span><span class="selector-class">.body</span>()<span class="selector-class">.bytes</span>();</span><br><span class="line"><span class="selector-tag">Response</span><span class="selector-class">.body</span>()<span class="selector-class">.string</span>();</span><br></pre></td></tr></table></figure>
</li>
<li><p>ResponseBody只能被消费一次，也就是string(),bytes(),byteStream()或 charStream()方法只能调用其中一个。</p>
</li>
<li><p>如果ResponseBody中的数据很大，则不应该使用bytes() 或 string()方法，它们会将结果一次性读入内存，而应该使用byteStream()或 charStream()，以流的方式读取数据。</p>
</li>
</ul>
<h1 id="lt-第三十一篇-gt-：Android开发必须了解的Retrofit"><a href="#lt-第三十一篇-gt-：Android开发必须了解的Retrofit" class="headerlink" title="&lt;第三十一篇&gt;：Android开发必须了解的Retrofit"></a>&lt;第三十一篇&gt;：Android开发必须了解的Retrofit</h1><blockquote>
<p>Retrofit是目前主流网络框架之一，往往结合OKHttp一起使用。Retrofit提供网络请求接口，OKhttp专门负责请求网络，因为现在项目主流框架是RxJava+Okhttp+Retrofit，所以我将Retrofit的讲解放在了Rx系列专题。</p>
</blockquote>
<h5 id="（1）依赖"><a href="#（1）依赖" class="headerlink" title="（1）依赖"></a>（1）依赖</h5><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//OKHttp依赖</span></span><br><span class="line">implementation <span class="string">'com.squareup.okhttp3:okhttp:3.12.2'</span></span><br><span class="line"><span class="comment">//Retrofit依赖</span></span><br><span class="line">implementation <span class="string">'com.squareup.retrofit2:retrofit:2.5.0'</span></span><br><span class="line"><span class="comment">//GSON依赖</span></span><br><span class="line">implementation <span class="string">'com.google.code.gson:gson:2.8.5'</span></span><br><span class="line"><span class="comment">//GSON转换器依赖</span></span><br><span class="line">implementation <span class="string">'com.squareup.retrofit2:converter-gson:2.5.0'</span></span><br></pre></td></tr></table></figure>

<p>依赖这边这个坑，retrofit的版本要和converter的版本保持一致，否则Json和对象之间的转换可能会报错。</p>
<h5 id="（2）一般用法"><a href="#（2）一般用法" class="headerlink" title="（2）一般用法"></a>（2）一般用法</h5><ul>
<li>声明接口</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public interface SearchFileAPIService &#123;</span><br><span class="line"></span><br><span class="line">    @FormUrlEncoded</span><br><span class="line">    @POST(&quot;file&#x2F;search?from&#x3D;upload&quot;)</span><br><span class="line">    Call&lt;ResponseBody&gt; fileSearch(@Field(&quot;filetype&quot;) String filetype, @Field(&quot;filename&quot;) String filename);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>请求实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder().baseUrl(<span class="string">"http://xxxxxx:82/oa/"</span>).build();</span><br><span class="line">SearchFileAPIService searchFileAPIService = retrofit.create(SearchFileAPIService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">Call&lt;ResponseBody&gt; call = searchFileAPIService.fileSearch(<span class="string">"-1"</span>, <span class="string">"1"</span>);</span><br><span class="line">call.enqueue(<span class="keyword">new</span> Callback&lt;ResponseBody&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;ResponseBody&gt; call, Response&lt;ResponseBody&gt; response)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(response != <span class="keyword">null</span> &amp;&amp; response.isSuccessful())&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, response.body().string());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, Throwable t)</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, t.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>我们先来看一下retrofit的基本代码，以上代码正是retrofit的post请求。<br>之所以在文章一开头就贴出基本代码是因为需要说明以下几点：</p>
<p><code>（1）</code> 本文重点介绍Retrofit，与RxJava结合使用将在下节介绍；<br><code>（2）</code> retrofit用于接口的封装，结合OKHttp可以优雅的实现网络请求框架；<br><code>（3）</code> retrofit第一步总是声明接口，以上代码声明了SearchFileAPIService接口，我们可以在SearchFileAPIService声明多个方法，以上代码只封装了fileSearch方法，retrofit提供了多种注解，<code>@FormUrlEncoded</code>、<code>@POST</code>、<code>@Field</code>都是retrofit的注解，当然还有其它注解，文章后面会讲解；<br><code>（4）</code> baseUrl有两种,一种不带路径，比如：<code>http://xxxxxx:82</code>，另一种带路径，比如： <code>http://xxxxxx:82/oa/</code>，这里需要重点注意：不带路径的baseUrl结尾可以不带有’/‘，但是带路径的baseUrl接口必须以’/‘结尾，否则会报错，如图：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-10d905cca35917e6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/628/format/webp"  alt="img"></p>
<p>图片.png</p>
<p><code>（5）</code> Call后面必须添加泛型，否则会报错，泛型类型不允许是<code>String</code>、<code>Integer</code>或者其他基本数据类型，这里用将<code>ResponseBody</code>作为泛型类型即可，<code>ResponseBody</code>是OKHttp中的类，所以Retrofit有时候需要结合OKHttp使用。</p>
<p>其实需要注意的不止是以上5点，还有很多需要注意的地方，如果过早的指出那就更加不能理解了。</p>
<p>以上声明的5点只是打一个预防针，文章后面会重新说明。</p>
<h5 id="（3）Retrofit的请求方式注解"><a href="#（3）Retrofit的请求方式注解" class="headerlink" title="（3）Retrofit的请求方式注解"></a>（3）Retrofit的请求方式注解</h5><ul>
<li>GET请求注解：<code>@GET</code></li>
</ul>
<p>GET请求是请求方式的其中一种，下面我来封装一个最简单的GET请求接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SearchFileAPIService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GET</span>(<span class="string">"/"</span>)</span><br><span class="line">    <span class="function">Call&lt;ResponseBody&gt; <span class="title">getBaidu</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder().baseUrl(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line">        .build();</span><br><span class="line">SearchFileAPIService searchFileAPIService = retrofit.create(SearchFileAPIService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">Call&lt;ResponseBody&gt; call = searchFileAPIService.getBaidu();</span><br><span class="line">call.enqueue(<span class="keyword">new</span> Callback&lt;ResponseBody&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;ResponseBody&gt; call, Response&lt;ResponseBody&gt; response)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(response != <span class="keyword">null</span> &amp;&amp; response.isSuccessful())&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"onResponse:"</span>+response.body().string());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call&lt;ResponseBody&gt; call, Throwable t)</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"onFailure："</span>+t.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>请求结果如下：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-398aacd452d3b207.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/685/format/webp"  alt="img"></p>
<p>图片.png</p>
<ul>
<li>POST请求注解：<code>@POST</code></li>
</ul>
<p>POST请求是请求方式的一种，POST请求上面已经给出例子了。</p>
<ul>
<li>HTTP请求：<code>@HTTP</code></li>
</ul>
<p><code>@HTTP</code>可以使用任何请求，现在就以GET请求为例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SearchFileAPIService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@HTTP</span>(method = <span class="string">"GET"</span>, path = <span class="string">"user_user"</span>, hasBody = <span class="keyword">false</span>)</span><br><span class="line">    <span class="function">Call&lt;ResponseBody&gt; <span class="title">getBaidu3</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder().baseUrl(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line">        .build();</span><br><span class="line">SearchFileAPIService searchFileAPIService = retrofit.create(SearchFileAPIService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">Call&lt;ResponseBody&gt; call = searchFileAPIService.getBaidu3();</span><br><span class="line">call.enqueue(<span class="keyword">new</span> Callback&lt;ResponseBody&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;ResponseBody&gt; call, Response&lt;ResponseBody&gt; response)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(response != <span class="keyword">null</span> &amp;&amp; response.isSuccessful())&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"onResponse:"</span>+response.body().string());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call&lt;ResponseBody&gt; call, Throwable t)</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"onFailure："</span>+t.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>以上代码请求网络需要跳过证书（怎么跳过证书文章后面会讲到）</p>
<p>请求头报文和上面一样：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-d0b7dd2b54f04425.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/428/format/webp"  alt="img"></p>
<p>图片.png</p>
<ul>
<li>DELETE请求注解：<code>@DELETE</code></li>
</ul>
<p>DELETE请求相对GET和POST请求而言用的比较少</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SearchFileAPIService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@HTTP</span>(method = <span class="string">"DELETE"</span>, path = <span class="string">"delete"</span>, hasBody = <span class="keyword">true</span>)</span><br><span class="line">    <span class="function">Call&lt;ResponseBody&gt; <span class="title">deleteSomething</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public interface SearchFileAPIService &#123;</span><br><span class="line"></span><br><span class="line">    @DELETE(&quot;&#x2F;&#123;delete&#125;&quot;)</span><br><span class="line">    Call&lt;ResponseBody&gt; deleteSomething(@Path(&quot;delete&quot;) String delete);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder().baseUrl(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line">        .build();</span><br><span class="line">SearchFileAPIService searchFileAPIService = retrofit.create(SearchFileAPIService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">Call&lt;ResponseBody&gt; call = searchFileAPIService.deleteSomething(<span class="string">"delete_delete"</span>);</span><br><span class="line">call.enqueue(<span class="keyword">new</span> Callback&lt;ResponseBody&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;ResponseBody&gt; call, Response&lt;ResponseBody&gt; response)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(response != <span class="keyword">null</span> &amp;&amp; response.isSuccessful())&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"onResponse:"</span>+response.body().string());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            Log.d(<span class="string">"aaa"</span>, <span class="string">"onResponse:"</span>+response.message());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call&lt;ResponseBody&gt; call, Throwable t)</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"onFailure："</span>+t.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>以上代码请求网络需要跳过证书（怎么跳过证书文章后面会讲到）</p>
<p>目前当前接口调试是不通的，大家也不要纠结为什么没用了，到目前为止我也没用过这个请求，以后用到的话可以补充。不过查询资料之后得到一句解释：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE请求顾名思义，就是执行相应的删除操作，配合数据库进行相应的删除动作。</span><br></pre></td></tr></table></figure>

<ul>
<li>PUT请求：<code>@PUT</code></li>
</ul>
<p>用于更新资源</p>
<ul>
<li>PATCH请求：<code>@PATCH</code></li>
</ul>
<p>该请求是对put请求的补充，用于更新局部资源</p>
<ul>
<li>OPTIONS请求：<code>@OPTIONS</code></li>
</ul>
<p>（以后补充）</p>
<ul>
<li>head请求：<code>@HEAD</code></li>
</ul>
<p>（以后补充）</p>
<h5 id="（4）Retrofit的请求参数注解"><a href="#（4）Retrofit的请求参数注解" class="headerlink" title="（4）Retrofit的请求参数注解"></a>（4）Retrofit的请求参数注解</h5><ul>
<li>url 替换：<code>@Path</code><br>我们就基于以上请求百度页面的例子添加<code>@Path</code>，代码如下：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public interface SearchFileAPIService &#123;</span><br><span class="line">    @GET(&quot;&#x2F;&#123;user&#125;&quot;)</span><br><span class="line">    Call&lt;ResponseBody&gt; getBaidu2(@Path(&quot;user&quot;) String user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder().baseUrl(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line">        .build();</span><br><span class="line">SearchFileAPIService searchFileAPIService = retrofit.create(SearchFileAPIService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">Call&lt;ResponseBody&gt; call = searchFileAPIService.getBaidu2(<span class="string">"user_user"</span>);</span><br><span class="line">call.enqueue(<span class="keyword">new</span> Callback&lt;ResponseBody&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;ResponseBody&gt; call, Response&lt;ResponseBody&gt; response)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(response != <span class="keyword">null</span> &amp;&amp; response.isSuccessful())&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"onResponse:"</span>+response.body().string());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call&lt;ResponseBody&gt; call, Throwable t)</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"onFailure："</span>+t.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>以上代码请求网络需要跳过证书（怎么跳过证书文章后面会讲到）</p>
<p>请求头如下：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-d0b7dd2b54f04425.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/428/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>通过以上代码演示，<code>@Path</code>的作用已经显而易见了，<code>@GET(&quot;/{user}&quot;)</code>中的user是一个参数，参数变量用<code>{}</code>修饰。</p>
<ul>
<li>表单字段：<code>@Filed</code>和<code>@FiledMap</code></li>
</ul>
<p><code>@Filed</code>和<code>@FiledMap</code>主要用于POST请求表单数据的声明，我们来看一下接口的定义</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public interface SearchFileAPIService &#123;</span><br><span class="line"></span><br><span class="line">    @FormUrlEncoded</span><br><span class="line">    @POST(&quot;file&#x2F;search?from&#x3D;upload&quot;)</span><br><span class="line">    Call&lt;ResponseBody&gt; fileSearch(@Field(&quot;filetype&quot;) String filetype, @Field(&quot;filename&quot;) String filename);</span><br><span class="line">    @FormUrlEncoded</span><br><span class="line">    @POST(&quot;file&#x2F;search?from&#x3D;upload&quot;)</span><br><span class="line">    Call&lt;ResponseBody&gt; fileSearch2(@FieldMap Map&lt;String, String&gt; map)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面贴一下完整的使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder()</span><br><span class="line">        .baseUrl(<span class="string">"http://xxxxxxxx:82/oa/"</span>).build();</span><br><span class="line">SearchFileAPIService searchFileAPIService = retrofit.create(SearchFileAPIService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">Call&lt;ResponseBody&gt; call = searchFileAPIService.fileSearch(<span class="string">"-1"</span>, <span class="string">"1"</span>);</span><br><span class="line">call.enqueue(<span class="keyword">new</span> Callback&lt;ResponseBody&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;ResponseBody&gt; call, Response&lt;ResponseBody&gt; response)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(response != <span class="keyword">null</span> &amp;&amp; response.isSuccessful())&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, response.body().string());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, Throwable t)</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, t.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder()</span><br><span class="line">        .baseUrl(<span class="string">"http:/xxxxxxxxx:82/oa/"</span>).build();</span><br><span class="line">SearchFileAPIService searchFileAPIService = retrofit.create(SearchFileAPIService.class);</span><br><span class="line">Map&lt;String, String&gt; <span class="built_in">map</span> = <span class="keyword">new</span> HashMap();</span><br><span class="line"><span class="built_in">map</span>.put(<span class="string">"filetype"</span>, <span class="string">"-1"</span>);</span><br><span class="line"><span class="built_in">map</span>.put(<span class="string">"filename"</span>, <span class="string">"1"</span>);</span><br><span class="line">Call&lt;ResponseBody&gt; call = searchFileAPIService.fileSearch2(<span class="built_in">map</span>);</span><br><span class="line">call.enqueue(<span class="keyword">new</span> Callback&lt;ResponseBody&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> onResponse(Call&lt;ResponseBody&gt; call, Response&lt;ResponseBody&gt; response) &#123;</span><br><span class="line">        <span class="keyword">if</span>(response != null &amp;&amp; response.isSuccessful())&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, response.body().<span class="built_in">string</span>());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> onFailure(Call call, Throwable t) &#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, t.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>POST请求非表单数据：<code>@Body</code></li>
</ul>
<p>在post请求时，我们可以传递键值对，也可以传递键值对的map集合，使用<code>@Body</code>我们可以传递一个对象，利用json转换器将对象转成json，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SearchFileAPIService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@POST</span>(<span class="string">"file/search?from=upload"</span>)</span><br><span class="line">    <span class="function">Call&lt;ResponseBody&gt; <span class="title">fileSearch3</span><span class="params">(@Body FileBean fileBean)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder()</span><br><span class="line">        .addConverterFactory(GsonConverterFactory.create(<span class="keyword">new</span> Gson()))</span><br><span class="line">        .baseUrl(<span class="string">"http://xxxxxxxxxx:82/oa/"</span>).build();</span><br><span class="line">SearchFileAPIService searchFileAPIService = retrofit.create(SearchFileAPIService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">FileBean fileBean = <span class="keyword">new</span> FileBean();</span><br><span class="line">fileBean.setFiletype(<span class="string">"-1"</span>);</span><br><span class="line">fileBean.setFilename(<span class="string">"1"</span>);</span><br><span class="line">Call&lt;ResponseBody&gt; call = searchFileAPIService.fileSearch3(fileBean);</span><br><span class="line">call.enqueue(<span class="keyword">new</span> Callback&lt;ResponseBody&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;ResponseBody&gt; call, Response&lt;ResponseBody&gt; response)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(response != <span class="keyword">null</span> &amp;&amp; response.isSuccessful())&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, response.body().string());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, Throwable t)</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, t.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这里使用了<code>addConverterFactory</code>，这是添加转换器，文章后面会讲到。</p>
<ul>
<li>指定请求路径：<code>@Url</code></li>
</ul>
<p>一般情况下，请求路径是在<code>@POST</code>的参数中声明的，一旦使用<code>@Url</code>来指定请求路径，<code>@POST</code>就不能传递传输。代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public interface SearchFileAPIService &#123;</span><br><span class="line"></span><br><span class="line">        @POST()</span><br><span class="line">        Call&lt;ResponseBody&gt; fileSearch4(@Url String url, @Body FileBean fileBean);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder()</span><br><span class="line">        .addConverterFactory(GsonConverterFactory.create(<span class="keyword">new</span> Gson()))</span><br><span class="line">        .baseUrl(<span class="string">"http://xin-ikea.cn:82/oa/"</span>).build();</span><br><span class="line">SearchFileAPIService searchFileAPIService = retrofit.create(SearchFileAPIService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">FileBean fileBean = <span class="keyword">new</span> FileBean();</span><br><span class="line">fileBean.setFiletype(<span class="string">"-1"</span>);</span><br><span class="line">fileBean.setFilename(<span class="string">"1"</span>);</span><br><span class="line">Call&lt;ResponseBody&gt; call = searchFileAPIService.fileSearch4(<span class="string">"file/search?from=upload"</span>, fileBean);</span><br><span class="line">call.enqueue(<span class="keyword">new</span> Callback&lt;ResponseBody&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;ResponseBody&gt; call, Response&lt;ResponseBody&gt; response)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(response != <span class="keyword">null</span> &amp;&amp; response.isSuccessful())&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, response.body().string());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, Throwable t)</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, t.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>Get中指定参数： <code>@Query</code>和 <code>@QueryMap</code></li>
</ul>
<p>我定义了一个接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@FormUrlEncoded</span><br><span class="line">@POST(&quot;file&#x2F;search?from&#x3D;upload&quot;)</span><br><span class="line">Call&lt;ResponseBody&gt; fileSearch5(@Query(&quot;filetype&quot;) String filetype, @Query(&quot;filename&quot;) String filename, @Field(&quot;filetype&quot;) String filetype1, @Field(&quot;filename&quot;) String filename1);</span><br></pre></td></tr></table></figure>

<p>抓到的报文如下：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-8528062aab0a169c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/640/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>我们发现在原本URL的基础上拼接了filetype和filename两个参数，所以 <code>@Query</code>和 <code>@QueryMap</code>其实主要用于GET请求。接口如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@GET(&quot;&#x2F;&quot;)</span><br><span class="line">Call&lt;ResponseBody&gt; getJianshu1(@Query(&quot;name&quot;) String name, @Query(&quot;age&quot;) int age);</span><br><span class="line"></span><br><span class="line">@GET(&quot;&#x2F;&quot;)</span><br><span class="line">Call&lt;ResponseBody&gt; getJianshu2(@QueryMap Map&lt;String, String&gt; map);</span><br></pre></td></tr></table></figure>

<ul>
<li><code>@Part</code>和<code>@PartMap</code></li>
</ul>
<p><code>@Part</code>：用于表单字段,Part和PartMap与Multipart注解结合使用,适合文件上传的情况</p>
<p><code>@PartMap</code>：用于表单字段,默认接受的类型是Map&lt;String,REquestBody&gt;，可用于实现多文件上传</p>
<p>这两种注解将在文章下面和Multipart注解一起讲解。</p>
<h5 id="（5）Retrofit响应格式注解"><a href="#（5）Retrofit响应格式注解" class="headerlink" title="（5）Retrofit响应格式注解"></a>（5）Retrofit响应格式注解</h5><ul>
<li>Form表单数据：<code>@FormUrlEncoded</code></li>
</ul>
<p><code>@FormUrlEncoded</code>和<code>@Field</code>或<code>@FieldMap</code>一起配合使用，用于POST请求传递表单数据。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public interface SearchFileAPIService &#123;</span><br><span class="line"></span><br><span class="line">        @FormUrlEncoded</span><br><span class="line">        @POST(&quot;file&#x2F;search?from&#x3D;upload&quot;)</span><br><span class="line">        Call&lt;ResponseBody&gt; fileSearch(@Field(&quot;filetype&quot;) String filetype, @Field(&quot;filename&quot;) String filename);</span><br><span class="line">        @FormUrlEncoded</span><br><span class="line">        @POST(&quot;file&#x2F;search?from&#x3D;upload&quot;)</span><br><span class="line">        Call&lt;ResponseBody&gt; fileSearch2(@FieldMap Map&lt;String, String&gt; map);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>发送multipart数据：<code>@Multipart</code></li>
</ul>
<p>一般和<code>@Part</code>或<code>@PartMap</code>一起配合使用，支持单文件上传，多文件上传，也支持表单和文件一起上传。</p>
<p>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SearchFileAPIService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Multipart</span></span><br><span class="line">        <span class="meta">@POST</span>(<span class="string">"FileUpload/FileUploadServlet"</span>)</span><br><span class="line">        <span class="function">Call&lt;ResponseBody&gt; <span class="title">uploadFlie2</span><span class="params">(@Part MultipartBody.Part file)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder()</span><br><span class="line">        .baseUrl(<span class="string">"http://192.168.0.105:8080"</span>).build();</span><br><span class="line">SearchFileAPIService searchFileAPIService = retrofit.create(SearchFileAPIService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">File file = <span class="keyword">new</span> File(Environment.getExternalStorageDirectory() + File.separator + <span class="string">"iam.jpg"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 RequestBody</span></span><br><span class="line"><span class="comment">//application/otcet-stream</span></span><br><span class="line">RequestBody requestFile = RequestBody.create(MediaType.parse(<span class="string">"application/otcet-stream"</span>), file);</span><br><span class="line"></span><br><span class="line"><span class="comment">//新建Part</span></span><br><span class="line">MultipartBody.Part body = MultipartBody.Part.createFormData(<span class="string">"photo1"</span>, file.getName(), requestFile);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加描述</span></span><br><span class="line">String descriptionString = <span class="string">"hello, 这是文件描述"</span>;</span><br><span class="line">RequestBody description = RequestBody.create(MediaType.parse(<span class="string">"multipart/form-data"</span>), descriptionString);</span><br><span class="line">Call&lt;ResponseBody&gt; call = searchFileAPIService.uploadFlie2(body);</span><br><span class="line">call.enqueue(<span class="keyword">new</span> Callback&lt;ResponseBody&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;ResponseBody&gt; call, Response&lt;ResponseBody&gt; response)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(response != <span class="keyword">null</span> &amp;&amp; response.isSuccessful())&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, response.body().string());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, Throwable t)</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, t.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>我们查看一下报文：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-bf9161a31c25877c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/745/format/webp"  alt="img"></p>
<p>图片.png</p>
<ul>
<li>响应用字节流的形式返回：<code>@Streaming</code></li>
</ul>
<p>该注解可以用于下载文件。<br>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SearchFileAPIService</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Streaming</span></span><br><span class="line">        <span class="meta">@GET</span>(<span class="string">"/1.apk"</span>)</span><br><span class="line">        <span class="function">Call&lt;ResponseBody&gt; <span class="title">downloadFile</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder().baseUrl(<span class="string">"http://192.168.0.105:8080"</span>).build();</span><br><span class="line">SearchFileAPIService searchFileAPIService = retrofit.create(SearchFileAPIService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">Call&lt;ResponseBody&gt; call = searchFileAPIService.downloadFile();</span><br><span class="line">call.enqueue(<span class="keyword">new</span> Callback&lt;ResponseBody&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;ResponseBody&gt; call, Response&lt;ResponseBody&gt; response)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(response != <span class="keyword">null</span> &amp;&amp; response.isSuccessful())&#123;</span><br><span class="line">            <span class="keyword">boolean</span> writtenToDisk = writeResponseBodyToDisk(response.body());</span><br><span class="line">            Log.d(<span class="string">"aaa"</span>, <span class="string">"下载成功："</span>+writtenToDisk);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call&lt;ResponseBody&gt; call, Throwable t)</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"下载失败"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//写入到磁盘根目录</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">writeResponseBodyToDisk</span><span class="params">(ResponseBody body)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        File futureStudioIconFile = <span class="keyword">new</span> File(Environment.getExternalStorageDirectory() + File.separator + <span class="string">"myapk.apk"</span>);</span><br><span class="line">        InputStream inputStream = <span class="keyword">null</span>;</span><br><span class="line">        OutputStream outputStream = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] fileReader = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">4096</span>];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">long</span> fileSize = body.contentLength();</span><br><span class="line">            <span class="keyword">long</span> fileSizeDownloaded = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            inputStream = body.byteStream();</span><br><span class="line">            outputStream = <span class="keyword">new</span> FileOutputStream(futureStudioIconFile);</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="keyword">int</span> read = inputStream.read(fileReader);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (read == -<span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                outputStream.write(fileReader, <span class="number">0</span>, read);</span><br><span class="line"></span><br><span class="line">                fileSizeDownloaded += read;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">long</span> finalFileSizeDownloaded = fileSizeDownloaded;</span><br><span class="line">                runOnUiThread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        bt_1.setText(<span class="string">"file download: "</span> + finalFileSizeDownloaded + <span class="string">" of "</span> + fileSize);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            outputStream.flush();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (inputStream != <span class="keyword">null</span>) &#123;</span><br><span class="line">                inputStream.close();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (outputStream != <span class="keyword">null</span>) &#123;</span><br><span class="line">                outputStream.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>报文如下：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-a67c7a3a7d210093.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/781/format/webp"  alt="img"></p>
<p>图片.png</p>
<h5 id="（6）Retrofit的请求头注解"><a href="#（6）Retrofit的请求头注解" class="headerlink" title="（6）Retrofit的请求头注解"></a>（6）Retrofit的请求头注解</h5><ul>
<li><code>@Headers</code></li>
</ul>
<p>用于添加固定请求头，可以同时添加多个。通过该注解添加的请求头不会相互覆盖，而是共同存在。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Headers</span>(&#123;<span class="string">"User-Agent:okhttp/3.14.1"</span>,<span class="string">"User-Agent:okhttp/3.14.2"</span>,<span class="string">"Content-Type: text/html"</span>&#125;)</span><br><span class="line"><span class="meta">@GET</span>(<span class="string">"/"</span>)</span><br><span class="line"><span class="function">Call&lt;ResponseBody&gt; <span class="title">getJianshu2</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>请求报文如下：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-22afb43e804232fb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/405/format/webp"  alt="img"></p>
<p>图片.png</p>
<ul>
<li><code>@Header</code></li>
</ul>
<p>作为方法的参数传入，用于添加不固定值的Header，该注解会更新已有的请求头</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@GET(&quot;&#x2F;&quot;)</span><br><span class="line">Call&lt;ResponseBody&gt; getJianshu2(@Header(&quot;Content-Type&quot;) String contentType);</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder().baseUrl(<span class="string">"http://www.jianshu.com"</span>).build();</span><br><span class="line">SearchFileAPIService searchFileAPIService = retrofit.create(SearchFileAPIService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">Call&lt;ResponseBody&gt; call = searchFileAPIService.getJianshu2(<span class="string">"text/html"</span>);</span><br><span class="line">call.enqueue(<span class="keyword">new</span> Callback&lt;ResponseBody&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;ResponseBody&gt; call, Response&lt;ResponseBody&gt; response)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(response != <span class="keyword">null</span> &amp;&amp; response.isSuccessful())&#123;</span><br><span class="line">            Log.d(<span class="string">"aaa"</span>, <span class="string">"11111111111111111"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call&lt;ResponseBody&gt; call, Throwable t)</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"2222222222222222"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>报文如下：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-ff80670f35bbc504.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/452/format/webp"  alt="img"></p>
<p>图片.png</p>
<h5 id="（7）怎么跳出SSL证书校验？"><a href="#（7）怎么跳出SSL证书校验？" class="headerlink" title="（7）怎么跳出SSL证书校验？"></a>（7）怎么跳出SSL证书校验？</h5><p>有时候，我们想要请求https开头的链接，有些服务器会做限制，不让别人访问自己的服务器，这个时候我们需要跳出证书校验了，Retrofit的client方法可以重新封装OkHttpClient，使hostnameVerifier返回true即可跳过证书校验。</p>
<p>就以访问“<a href="https://www.jianshu.com/" target="_blank" rel="noopener">https://www.jianshu.com</a>”为例，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SslClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SslClient</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleHolder</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> SslClient instance = <span class="keyword">new</span> SslClient();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SslClient <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SingleHolder.instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> OkHttpClient <span class="title">getOkHttpClient</span><span class="params">()</span></span>&#123;</span><br><span class="line">        OkHttpClient.Builder builder = <span class="keyword">new</span> OkHttpClient.Builder();</span><br><span class="line">        X509TrustManager x509TrustManager = <span class="keyword">new</span> X509TrustManager() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkClientTrusted</span><span class="params">(X509Certificate[] chain, String authType)</span> <span class="keyword">throws</span> CertificateException </span>&#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkServerTrusted</span><span class="params">(X509Certificate[] chain, String authType)</span> <span class="keyword">throws</span> CertificateException </span>&#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> X509Certificate[] getAcceptedIssuers() &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> X509Certificate[<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        TrustManager[] trustManager = <span class="keyword">new</span> TrustManager[]&#123;</span><br><span class="line">                x509TrustManager</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            SSLContext sslContext = SSLContext.getInstance(<span class="string">"SSL"</span>);</span><br><span class="line">            sslContext.init(<span class="keyword">null</span>, trustManager, <span class="keyword">new</span> SecureRandom());</span><br><span class="line">            SSLSocketFactory sslSocketFactory = sslContext.getSocketFactory();</span><br><span class="line">            builder.sslSocketFactory(sslSocketFactory,x509TrustManager);</span><br><span class="line">            builder.hostnameVerifier(<span class="keyword">new</span> HostnameVerifier() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">verify</span><span class="params">(String hostname, SSLSession session)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> hostname.contains(<span class="string">"www.jianshu.com"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (KeyManagementException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> builder.build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SearchFileAPIService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@GET</span>(<span class="string">"/"</span>)</span><br><span class="line">        <span class="function">Call&lt;ResponseBody&gt; <span class="title">getJianshu</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder().baseUrl(<span class="string">"https://www.jianshu.com"</span>)</span><br><span class="line">        .client(SslClient.getInstance().getOkHttpClient())</span><br><span class="line">        .build();</span><br><span class="line">SearchFileAPIService searchFileAPIService = retrofit.create(SearchFileAPIService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">Call&lt;ResponseBody&gt; call = searchFileAPIService.getJianshu();</span><br><span class="line">call.enqueue(<span class="keyword">new</span> Callback&lt;ResponseBody&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;ResponseBody&gt; call, Response&lt;ResponseBody&gt; response)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(response != <span class="keyword">null</span> &amp;&amp; response.isSuccessful())&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, <span class="string">"onResponse:"</span>+response.body().string());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            Log.d(<span class="string">"aaa"</span>, <span class="string">"onResponse:"</span>+response.message());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call&lt;ResponseBody&gt; call, Throwable t)</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"onFailure："</span>+t.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="（8）转换器"><a href="#（8）转换器" class="headerlink" title="（8）转换器"></a>（8）转换器</h5><p>我们先来搜索一下有多少转换器依赖吧</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-3776f019c7d0ad14.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/630/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>这里就以gson转换器为例，其它转换器不做讲解。</p>
<p>一般情况下，我们的post请求代码是这样写的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder().baseUrl(<span class="string">"http://123.124.175.239:7001"</span>).build();</span><br><span class="line">SearchFileAPIService searchFileAPIService = retrofit.create(SearchFileAPIService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">Call&lt;ResponseBody&gt; call = searchFileAPIService.getCarList(<span class="string">"868256021322879"</span>, <span class="string">"862679"</span>, <span class="string">"c907d5df8b26550eaf2841ed9bcf51bb44b9ae1b"</span>, <span class="string">"d3974829a20747579c90e2004a5ed1c5"</span>);</span><br><span class="line">call.enqueue(<span class="keyword">new</span> Callback&lt;ResponseBody&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;ResponseBody&gt; call, Response&lt;ResponseBody&gt; response)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(response != <span class="keyword">null</span> &amp;&amp; response.isSuccessful())&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, response.body().string());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call&lt;ResponseBody&gt; call, Throwable t)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>当我们获取返回结果时，发现返回结果时一个<code>json或者json数组</code>，这个时候我们可以利用转换器将json直接转成对象，改造之后的代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public interface SearchFileAPIService &#123;</span><br><span class="line"></span><br><span class="line">        @FormUrlEncoded</span><br><span class="line">        @POST(&quot;&#x2F;xxx&#x2F;interface&#x2F;carList&quot;)</span><br><span class="line">        Call&lt;ArrayList&lt;Car&gt;&gt; getCarList(@Field(&quot;IMEI&quot;) String IMEI, @Field(&quot;appid&quot;) String appid, @Field(&quot;appkey&quot;) String appkey, @Field(&quot;userId&quot;) String userId);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder().baseUrl(<span class="string">"http://123.124.175.239:7001"</span>)</span><br><span class="line">        .addConverterFactory(GsonConverterFactory.create(<span class="keyword">new</span> Gson()))</span><br><span class="line">        .build();</span><br><span class="line">SearchFileAPIService searchFileAPIService = retrofit.create(SearchFileAPIService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">Call&lt;ArrayList&lt;Car&gt;&gt; call = searchFileAPIService.getCarList(<span class="string">"868256021322879"</span>, <span class="string">"862679"</span>, <span class="string">"c907d5df8b26550eaf2841ed9bcf51bb44b9ae1b"</span>, <span class="string">"d3974829a20747579c90e2004a5ed1c5"</span>);</span><br><span class="line">call.enqueue(<span class="keyword">new</span> Callback&lt;ArrayList&lt;Car&gt;&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;ArrayList&lt;Car&gt;&gt; call, Response&lt;ArrayList&lt;Car&gt;&gt; response)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(response != <span class="keyword">null</span> &amp;&amp; response.isSuccessful())&#123;</span><br><span class="line">            ArrayList&lt;Car&gt; carlist = response.body();</span><br><span class="line">            <span class="keyword">for</span>(Car car : carlist)&#123;</span><br><span class="line">                Log.d(<span class="string">"aaa"</span>, car.getCarNumber());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call&lt;ArrayList&lt;Car&gt;&gt; call, Throwable t)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>获取的结果是一个数组：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-2f5352c31888f2d0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/523/format/webp"  alt="img"></p>
<p>图片.png</p>
<h5 id="（9）日志拦截器"><a href="#（9）日志拦截器" class="headerlink" title="（9）日志拦截器"></a>（9）日志拦截器</h5><p>当我们网络请求时，要想看到报文，有时候必须依赖于抓包工具，本人常用的抓包工具是<code>Fiddler</code>，除了抓包工具之外，OkHttp提供了日志拦截器，可以打印报文日志。</p>
<p>通过下图代码，可以添加拦截求</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-fb164f86bfecdc51.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/647/format/webp"  alt="img"></p>
<p>图片.png</p>
<p>创建日志拦截器有两种方式：</p>
<ul>
<li>自定义的方式</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 创建日志拦截器</span><br><span class="line"> *</span><br><span class="line"> * @return</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class LogInterceptor implements Interceptor &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public okhttp3.Response intercept(Chain chain) throws IOException &#123;</span><br><span class="line">        Request request &#x3D; chain.request();</span><br><span class="line">        Log.d(&quot;bbb&quot;, &quot;请求数据：&quot;);</span><br><span class="line">        Log.d(&quot;bbb&quot;, &quot;请求URL：&quot;+String.valueOf(request.url()));</span><br><span class="line">        Log.d(&quot;bbb&quot;, &quot;请求头：&quot;+String.valueOf(request.headers()));</span><br><span class="line">        Log.d(&quot;bbb&quot;, &quot;请求体：&quot;+request.toString());</span><br><span class="line"></span><br><span class="line">        okhttp3.Response response &#x3D; chain.proceed(request);</span><br><span class="line"></span><br><span class="line">        Log.d(&quot;bbb&quot;, &quot;响应数据：&quot;);</span><br><span class="line">        Log.d(&quot;bbb&quot;, &quot;返回码：&quot;+String.valueOf(response.code()));</span><br><span class="line">        Log.d(&quot;bbb&quot;, &quot;响应头：&quot;+String.valueOf(response.headers()));</span><br><span class="line">        Log.d(&quot;bbb&quot;, &quot;响应体：&quot;+String.valueOf(response.body().string()));</span><br><span class="line"></span><br><span class="line">        return response;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打印日志如下：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-d9bfa3e9bed45754.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1008/format/webp"  alt="img"></p>
<p>图片.png</p>
<ul>
<li>使用日志拦截器依赖</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.squareup.okhttp3:logging-interceptor:3.5.0'</span></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建日志拦截器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HttpLoggingInterceptor <span class="title">getHttpLoggingInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    HttpLoggingInterceptor loggingInterceptor = <span class="keyword">new</span> HttpLoggingInterceptor(</span><br><span class="line">            <span class="keyword">new</span> HttpLoggingInterceptor.Logger() &#123;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">                    Log.e(<span class="string">"bbb"</span>, <span class="string">"log = "</span> + message);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;);</span><br><span class="line">    loggingInterceptor.setLevel(HttpLoggingInterceptor.Level.BODY);</span><br><span class="line">    <span class="keyword">return</span> loggingInterceptor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>捕获到的日志如下：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-b229d5eeef610fde.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/986/format/webp"  alt="img"></p>
<p>图片.png</p>
<h5 id="（10）自定义CookieJar"><a href="#（10）自定义CookieJar" class="headerlink" title="（10）自定义CookieJar"></a>（10）自定义CookieJar</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">OkHttpClient client = <span class="keyword">new</span> OkHttpClient.Builder()</span><br><span class="line">        .addInterceptor(getHttpLoggingInterceptor())</span><br><span class="line">        .cookieJar(<span class="keyword">new</span> CookieJar() &#123;</span><br><span class="line">            <span class="keyword">final</span> HashMap&lt;HttpUrl, List&lt;Cookie&gt;&gt; cookieStore = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveFromResponse</span><span class="params">(HttpUrl url, List&lt;Cookie&gt; cookies)</span> </span>&#123;</span><br><span class="line">                cookieStore.put(url, cookies);<span class="comment">//保存cookie</span></span><br><span class="line">                <span class="comment">//也可以使用SP保存</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> List&lt;Cookie&gt; <span class="title">loadForRequest</span><span class="params">(HttpUrl url)</span> </span>&#123;</span><br><span class="line">                List&lt;Cookie&gt; cookies = cookieStore.get(url);<span class="comment">//取出cookie</span></span><br><span class="line">                <span class="keyword">return</span> cookies != <span class="keyword">null</span> ? cookies : <span class="keyword">new</span> ArrayList&lt;Cookie&gt;();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .build();</span><br><span class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder().baseUrl(<span class="string">"http://123.124.175.239:7001"</span>)</span><br><span class="line">        .addConverterFactory(GsonConverterFactory.create(<span class="keyword">new</span> Gson()))</span><br><span class="line">        .client(client)</span><br><span class="line">        .build();</span><br></pre></td></tr></table></figure>

<h5 id="（11）取消请求"><a href="#（11）取消请求" class="headerlink" title="（11）取消请求"></a>（11）取消请求</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call.cancel();</span><br></pre></td></tr></table></figure>



<h1 id="lt-第三十二篇-gt-：RxJava-Retrofit-OkHttp-MVP"><a href="#lt-第三十二篇-gt-：RxJava-Retrofit-OkHttp-MVP" class="headerlink" title="&lt;第三十二篇&gt;：RxJava+Retrofit+OkHttp+MVP"></a>&lt;第三十二篇&gt;：RxJava+Retrofit+OkHttp+MVP</h1><p>本章主要针对<code>RxJava</code>、<code>Retrofit</code>和<code>OkHttp</code>结合使用，现在说明一下三者的职责所在。</p>
<p><code>OkHttp</code>：负责网络请求；<br><code>Retrofit</code>：主要负责网络请求接口的封装，结合<code>OkHttp</code>可以处理网络请求的结果；<br><code>RxJava</code>：负责网络请求的异步；</p>
<h5 id="（1）权限"><a href="#（1）权限" class="headerlink" title="（1）权限"></a>（1）权限</h5><p>网络请求别忘了添加网络权限</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.INTERNET"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="（2）依赖-1"><a href="#（2）依赖-1" class="headerlink" title="（2）依赖"></a>（2）依赖</h5><ul>
<li>RxJava依赖</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'io.reactivex.rxjava2:rxjava:2.1.3'</span></span><br><span class="line">implementation <span class="string">'io.reactivex.rxjava2:rxandroid:2.0.1'</span></span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.jakewharton.rxbinding3:rxbinding:3.0.0-alpha2'</span></span><br></pre></td></tr></table></figure>

<p>如果使用rxbinding，就添加rxbinding相关依赖，rxbinding依赖本身支持rxjava和rxandroid，所以如果添加rxbinding依赖就可以去除rxjava和rxandroid依赖了。</p>
<ul>
<li>okhttp3依赖</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.squareup.okhttp3:okhttp:3.12.2'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//日志拦截器依赖</span></span><br><span class="line">implementation <span class="string">'com.squareup.okhttp3:logging-interceptor:3.5.0'</span></span><br></pre></td></tr></table></figure>

<ul>
<li>retrofit依赖</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.squareup.retrofit2:retrofit:2.5.0'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//gson转换器依赖</span></span><br><span class="line">implementation <span class="string">'com.squareup.retrofit2:converter-gson:2.5.0'</span></span><br></pre></td></tr></table></figure>

<ul>
<li>RxJava和Retrofit混用的适配器</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.squareup.retrofit2:adapter-rxjava2:2.5.0'</span></span><br></pre></td></tr></table></figure>

<ul>
<li>autodispose依赖</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.uber.autodispose:autodispose-android-archcomponents:1.0.0-RC2'</span></span><br></pre></td></tr></table></figure>

<ul>
<li>其它辅助依赖</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//gson依赖</span></span><br><span class="line">implementation <span class="string">'com.google.code.gson:gson:2.8.5'</span></span><br></pre></td></tr></table></figure>

<h5 id="（3）RxJava介绍"><a href="#（3）RxJava介绍" class="headerlink" title="（3）RxJava介绍"></a>（3）RxJava介绍</h5><p>点击某按钮，请求网络接口，要求防抖动（防止不一小心点击两次，导致没必要的网络请求），RxJava可以实现按钮防抖动。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">RxView.clicks(findViewById(R.id.bt))</span><br><span class="line">        .throttleFirst(<span class="number">2</span>, TimeUnit.SECONDS)</span><br><span class="line">        <span class="comment">//AutoDispose的关键语句</span></span><br><span class="line">        .<span class="keyword">as</span>(AutoDispose.&lt;Unit&gt;autoDisposable(AndroidLifecycleScopeProvider.<span class="keyword">from</span>(<span class="keyword">this</span>)))</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Consumer&lt;Unit&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span>(<span class="params">Unit unit</span>) throws Exception</span> &#123;</span><br><span class="line">                <span class="comment">//获取新闻</span></span><br><span class="line">                mainPresenter.getWeather();</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p><code>throttleFirst</code>表示2秒内，只处理第一次点击的响应；<br><code>AutoDispose</code>是为了防止内存泄漏；</p>
<p>RxJava还可以和Retrofit共同完成网络请求。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取天气预报</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getWeather</span><span class="params">(ResultCallBack callBack)</span></span>&#123;</span><br><span class="line">    RetrofitUtils.getInstance().getDataFromAPI(retrofitAPI.getWeather(), callBack);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通用方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> observable</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">getDataFromAPI</span><span class="params">(Observable&lt;T&gt; observable, <span class="keyword">final</span> ResultCallBack callBack)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//绑定Activity的生命周期</span></span><br><span class="line">    callBack.autoDispose(observable);</span><br><span class="line"></span><br><span class="line">    observable</span><br><span class="line">            .subscribeOn(Schedulers.io())</span><br><span class="line">            .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">            .subscribe(<span class="keyword">new</span> Observer&lt;T&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Disposable d)</span> </span>&#123;</span><br><span class="line">                    <span class="comment">//开始请求</span></span><br><span class="line"></span><br><span class="line">                    callBack.startRequest();</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(T t)</span> </span>&#123;</span><br><span class="line">                    <span class="comment">//成功</span></span><br><span class="line">                    callBack.success(t);</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    <span class="comment">//失败</span></span><br><span class="line">                    Log.d(<span class="string">"aaa"</span>, <span class="string">"onFailure:"</span>+e.getCause() + <span class="string">"\n"</span> + e.getMessage());</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (e <span class="keyword">instanceof</span> SocketTimeoutException) &#123;</span><br><span class="line">                        callBack.failed(<span class="string">"网络中断，请检查您的网络状态！"</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> ConnectException) &#123;</span><br><span class="line">                        callBack.failed(<span class="string">"网络中断，请检查您的网络状态！"</span>);</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        callBack.failed(<span class="string">"未知异常！"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="comment">//结束请求</span></span><br><span class="line"></span><br><span class="line">                    callBack.requestComplete();</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="（4）Retrofit介绍"><a href="#（4）Retrofit介绍" class="headerlink" title="（4）Retrofit介绍"></a>（4）Retrofit介绍</h5><p>单独使用Retrofit，网络请求的返回值类型是<code>Call</code>，与RxJava结合使用后返回值变成了<code>observable</code>,这样做的好处是：</p>
<ul>
<li>可以方便的控制线程</li>
<li>可以知道网络请求什么时候开始以及什么时候结束</li>
</ul>
<p>另外，OkHttp可以设置网络超时以及其他配置。</p>
<p>Retrofit在之前的文章中已经介绍过了，因此这里直接跳过，等下直接贴代码。</p>
<h5 id="（5）MVP介绍"><a href="#（5）MVP介绍" class="headerlink" title="（5）MVP介绍"></a>（5）MVP介绍</h5><p>MVP模式请先看一下这篇博客</p>
<p><a href="https://www.jianshu.com/p/d723d17973c9" target="_blank" rel="noopener">Andorid之MVP模式</a></p>
<p>这篇博客是最简单的MVP模式了，在实际项目中往往更加复杂，但是，复杂并不可怕，可怕的是你不知道怎么使用MVP。</p>
<p>MVP模式一般流向是：View–&gt;Presenter–&gt;Model，这里最好不要逆向，或者禁止逆向。</p>
<p>这个流向大致的意思是View直接访问Presenter，Presenter直接访问Model，那么问题来了：</p>
<ul>
<li>Presenter怎么访问View？</li>
</ul>
<p>Activity（Fragment）就是MVP的View，该Activity（Fragment）会实现一个IView接口，Presenter与IView具有依赖性，Presenter通过IView可以间接执行Activity（Fragment）的IView回调。</p>
<ul>
<li>Model怎么访问Presenter？</li>
</ul>
<p>通过CallBack访问，等下贴下代码就知道了。</p>
<ul>
<li>Model怎么访问View？</li>
</ul>
<p>先通过CallBack访问Presenter，再让Presenter通过IView访问Activity（Fragment）。</p>
<h5 id="（6）完整封装"><a href="#（6）完整封装" class="headerlink" title="（6）完整封装"></a>（6）完整封装</h5><p>这里直接贴代码了。</p>
<p>WeatherBean.java（这是新闻类的Bean，网络请求之后数据装载类）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WeatherBean</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * status : 201</span></span><br><span class="line"><span class="comment">     * message : APP被用户自己禁用，请在控制台解禁</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> status;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getStatus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStatus</span><span class="params">(<span class="keyword">int</span> status)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.status = status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMessage</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ResultCallBack.java（这是网络请求结果返回的callback）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ResultCallBack</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//开始请求</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">startRequest</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//请求成功</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">success</span><span class="params">(T t)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//请求失败</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">failed</span><span class="params">(String error)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//请求完成</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">requestComplete</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//自动绑定生命周期</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">autoDispose</span><span class="params">(Observable observable)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>RetrofitAPI.java（Retrofit接口类，这里会防止所有的网络请求接口）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RetrofitAPI</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GET</span>(<span class="string">"weather?location=jiaxing&amp;output=json&amp;ak=5slgyqGDENN7Sy7pw29IUvrZ"</span>)</span><br><span class="line">    <span class="function">Observable&lt;WeatherBean&gt; <span class="title">getWeather</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>RetrofitUtils.java（Retrofit网络请求工具类，这是通用的）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RetrofitUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RetrofitAPI retrofitAPI;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String BASE_URL = <span class="string">"http://api.map.baidu.com/telematics/v3/"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">RetrofitUtils</span><span class="params">()</span></span>&#123;</span><br><span class="line">        OkHttpClient client = <span class="keyword">new</span> OkHttpClient.Builder()</span><br><span class="line">                .connectTimeout(<span class="number">10</span>, TimeUnit.SECONDS)<span class="comment">//设置连接超时时长</span></span><br><span class="line">                .readTimeout(<span class="number">20</span>, TimeUnit.SECONDS)<span class="comment">//设置读超时时长</span></span><br><span class="line">                .writeTimeout(<span class="number">20</span>, TimeUnit.SECONDS)<span class="comment">//设置写超时时长</span></span><br><span class="line">                .addInterceptor(getHttpLoggingInterceptor())<span class="comment">//添加日志拦截器</span></span><br><span class="line">                .build();</span><br><span class="line">        Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder().baseUrl(BASE_URL)</span><br><span class="line">                .addConverterFactory(GsonConverterFactory.create(<span class="keyword">new</span> Gson()))</span><br><span class="line">                .addCallAdapterFactory(RxJava2CallAdapterFactory.create())</span><br><span class="line">                .client(client)</span><br><span class="line">                .build();</span><br><span class="line">        retrofitAPI = retrofit.create(RetrofitAPI<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleHolder</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> RetrofitUtils instance = <span class="keyword">new</span> RetrofitUtils();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RetrofitUtils <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> RetrofitUtils.SingleHolder.instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建日志拦截器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> HttpLoggingInterceptor <span class="title">getHttpLoggingInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        HttpLoggingInterceptor loggingInterceptor = <span class="keyword">new</span> HttpLoggingInterceptor(</span><br><span class="line">                <span class="keyword">new</span> HttpLoggingInterceptor.Logger() &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">                        Log.e(<span class="string">"RetrofitUtils"</span>, <span class="string">"log = "</span> + message);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;);</span><br><span class="line">        loggingInterceptor.setLevel(HttpLoggingInterceptor.Level.BODY);</span><br><span class="line">        <span class="keyword">return</span> loggingInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RetrofitAPI <span class="title">getRetrofitAPI</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> retrofitAPI;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通用方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> observable</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">getDataFromAPI</span><span class="params">(Observable&lt;T&gt; observable, <span class="keyword">final</span> ResultCallBack callBack)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//绑定Activity的生命周期</span></span><br><span class="line">        callBack.autoDispose(observable);</span><br><span class="line"></span><br><span class="line">        observable</span><br><span class="line">                .subscribeOn(Schedulers.io())</span><br><span class="line">                .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">                .subscribe(<span class="keyword">new</span> Observer&lt;T&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Disposable d)</span> </span>&#123;</span><br><span class="line">                        <span class="comment">//开始请求</span></span><br><span class="line"></span><br><span class="line">                        callBack.startRequest();</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(T t)</span> </span>&#123;</span><br><span class="line">                        <span class="comment">//成功</span></span><br><span class="line">                        callBack.success(t);</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                        <span class="comment">//失败</span></span><br><span class="line">                        Log.d(<span class="string">"aaa"</span>, <span class="string">"onFailure:"</span>+e.getCause() + <span class="string">"\n"</span> + e.getMessage());</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (e <span class="keyword">instanceof</span> SocketTimeoutException) &#123;</span><br><span class="line">                            callBack.failed(<span class="string">"网络中断，请检查您的网络状态！"</span>);</span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> ConnectException) &#123;</span><br><span class="line">                            callBack.failed(<span class="string">"网络中断，请检查您的网络状态！"</span>);</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                            callBack.failed(<span class="string">"未知异常！"</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        <span class="comment">//结束请求</span></span><br><span class="line"></span><br><span class="line">                        callBack.requestComplete();</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CarModel.java（MVP模式的Model，用于处理非UI操作，一般用于处理网络请求）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CarModel</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RetrofitAPI retrofitAPI;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CarModel</span><span class="params">()</span></span>&#123;</span><br><span class="line">        retrofitAPI = RetrofitUtils.getInstance().getRetrofitAPI();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取天气预报</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getWeather</span><span class="params">(ResultCallBack callBack)</span></span>&#123;</span><br><span class="line">        RetrofitUtils.getInstance().getDataFromAPI(retrofitAPI.getWeather(), callBack);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BasePresenter.java（MVP模式的Presenter的基类，主要负责处理一些通用的逻辑）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Presenter基类</span></span><br><span class="line"><span class="comment"> * @param &lt;V&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasePresenter</span>&lt;V extends IBaseView&gt; &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 绑定的view</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> V mvpView;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 绑定view</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attachView</span><span class="params">(V mvpView)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mvpView = mvpView;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 销毁view</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">detachView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mvpView = null;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否与View建立连接</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> boolean <span class="title">isViewAttached</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mvpView != null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取连接的view</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">getView</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mvpView;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MainPresenter.java（MVP模式的Presenter）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainPresenter</span> <span class="keyword">extends</span> <span class="title">BasePresenter</span>&lt;<span class="title">IMainView</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CarModel carModel;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MainPresenter</span><span class="params">()</span></span>&#123;</span><br><span class="line">        carModel = <span class="keyword">new</span> CarModel();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取天气预报</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getWeather</span><span class="params">()</span></span>&#123;</span><br><span class="line">        carModel.getWeather(<span class="keyword">new</span> ResultCallBack&lt;WeatherBean&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startRequest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                getView().loadingDialogShow(<span class="string">"请稍等..."</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">success</span><span class="params">(WeatherBean weatherBean)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(weatherBean != <span class="keyword">null</span>)&#123;</span><br><span class="line">                    getView().setResult(weatherBean.getMessage());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">failed</span><span class="params">(String error)</span> </span>&#123;</span><br><span class="line">                getView().setResult(error);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">requestComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                getView().loadingDialogDismiss();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">autoDispose</span><span class="params">(Observable observable)</span> </span>&#123;</span><br><span class="line">                <span class="comment">//AutoDispose的关键语句</span></span><br><span class="line">                getView().autoDispose(observable);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>IBaseView.java（MVP模式的View的基类，可以在Activity的基类中实现）</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 所有UI通用的View操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IBaseView</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 显示等待对话框</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">loadingDialogShow</span>(<span class="params">String msg</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 关闭等待对话框</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">loadingDialogDismiss</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 显示提示</span></span><br><span class="line"><span class="comment">     * @param msg</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">showToast</span>(<span class="params">String msg</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取上下文</span></span><br><span class="line"><span class="comment">     * @return 上下文</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Context <span class="title">getContext</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Observable绑定生命周期</span></span><br><span class="line"><span class="comment">     * @param observable</span></span><br><span class="line"><span class="comment">     * @return</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">autoDispose</span>(<span class="params">Observable observable</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>IMainView.java（MVP模式的View）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IMainView</span> <span class="keyword">extends</span> <span class="title">IBaseView</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setResult</span><span class="params">(String result)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BaseActivity.java（所有Activity的基类，包含网络进度条、AutoDispose、Toast、网络请求等待对话框）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> <span class="keyword">implements</span> <span class="title">IBaseView</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AlertDialog loadingDialog;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> Toolbar toolbar;</span><br><span class="line">    <span class="keyword">private</span> ViewFlipper mContentView;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="comment">//初始化布局</span></span><br><span class="line">        setContentView(R.layout.layout_base);</span><br><span class="line">        mContentView = (ViewFlipper) findViewById(R.id.layout_container);</span><br><span class="line">        toolbar = (Toolbar) findViewById(R.id.base_tool_bar);</span><br><span class="line"></span><br><span class="line">        LinearLayout.LayoutParams lp = <span class="keyword">new</span> LinearLayout.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT, <span class="number">1</span>);</span><br><span class="line">        mContentView.addView(getRootView(), lp);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//初始化基类数据</span></span><br><span class="line">        initBaseData();</span><br><span class="line">        <span class="comment">//初始化控件</span></span><br><span class="line">        initView();</span><br><span class="line">        <span class="comment">//初始化数据</span></span><br><span class="line">        initData();</span><br><span class="line">        <span class="comment">//初始化监听</span></span><br><span class="line">        initListener();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**初始化基类数据*/</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initBaseData</span><span class="params">()</span></span>&#123;&#125;&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**初始化布局*/</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> View <span class="title">getRootView</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">/**初始化控件*/</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">/**初始化数据*/</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">initData</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">/**初始化点击事件*/</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">initListener</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启动Activity</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">startActivity</span><span class="params">(Class&lt;? extends Activity&gt; clazz)</span></span>&#123;</span><br><span class="line">        Intent in = <span class="keyword">new</span> Intent(<span class="keyword">this</span>,clazz);</span><br><span class="line">        startActivity(in);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadingDialogShow</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        TextView tipTextView = <span class="keyword">null</span>;</span><br><span class="line">        LayoutInflater inflater = LayoutInflater.from(<span class="keyword">this</span>);</span><br><span class="line">        View view = inflater.inflate(R.layout.loading_dialog, <span class="keyword">null</span>);<span class="comment">// 得到加载view</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (loadingDialog == <span class="keyword">null</span>) &#123;</span><br><span class="line">            ImageView imageView = view.findViewById(R.id.img);</span><br><span class="line">            tipTextView = view.findViewById(R.id.tipTextView);<span class="comment">// 提示文字</span></span><br><span class="line">            <span class="comment">// 加载动画</span></span><br><span class="line">            Animation hyperspaceJumpAnimation = AnimationUtils.loadAnimation(<span class="keyword">this</span>, R.anim.loading_animation);</span><br><span class="line">            <span class="comment">// 使用ImageView显示动画</span></span><br><span class="line">            imageView.startAnimation(hyperspaceJumpAnimation);</span><br><span class="line">            tipTextView.setText(msg);<span class="comment">// 设置加载信息</span></span><br><span class="line"></span><br><span class="line">            AlertDialog.Builder builder = <span class="keyword">new</span> AlertDialog.Builder(<span class="keyword">this</span>, R.style.loading_dialog);</span><br><span class="line">            loadingDialog =builder.create();</span><br><span class="line">            builder.setCancelable(<span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!loadingDialog.isShowing()) &#123;</span><br><span class="line">            loadingDialog.show();</span><br><span class="line">            loadingDialog.getWindow().setContentView(view);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadingDialogDismiss</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (loadingDialog != <span class="keyword">null</span> &amp;&amp; loadingDialog.isShowing()) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                loadingDialog.dismiss();</span><br><span class="line">                loadingDialog = <span class="keyword">null</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showToast</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>, msg, Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Context <span class="title">getContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">autoDispose</span><span class="params">(Observable observable)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//AutoDispose的关键语句</span></span><br><span class="line">        observable.as(AutoDispose.autoDisposable(AndroidLifecycleScopeProvider.from(<span class="keyword">this</span>)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//关闭进度条</span></span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        loadingDialogDismiss();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MainActivity.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">BaseActivity</span> <span class="keyword">implements</span> <span class="title">IMainView</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MainPresenter mainPresenter;</span><br><span class="line">    <span class="keyword">private</span> TextView result_text;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> View <span class="title">getRootView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> LayoutInflater.from(<span class="keyword">this</span>).inflate(R.layout.activity_main, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        result_text = findViewById(R.id.result_text);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mainPresenter = <span class="keyword">new</span> MainPresenter();</span><br><span class="line">        mainPresenter.attachView(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initListener</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        RxView.clicks(findViewById(R.id.bt))</span><br><span class="line">                .throttleFirst(<span class="number">2</span>, TimeUnit.SECONDS)</span><br><span class="line">                <span class="comment">//AutoDispose的关键语句</span></span><br><span class="line">                .as(AutoDispose.&lt;Unit&gt;autoDisposable(AndroidLifecycleScopeProvider.from(<span class="keyword">this</span>)))</span><br><span class="line">                .subscribe(<span class="keyword">new</span> Consumer&lt;Unit&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Unit unit)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        <span class="comment">//获取新闻</span></span><br><span class="line">                        mainPresenter.getWeather();</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setResult</span><span class="params">(String result)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//显示结果</span></span><br><span class="line">        result_text.setText(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        <span class="keyword">if</span>(mainPresenter.isViewAttached())&#123;</span><br><span class="line">            mainPresenter.detachView();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>loading_animation.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:shareInterpolator</span>=<span class="string">"false"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">rotate</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"900"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fromDegrees</span>=<span class="string">"0"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:interpolator</span>=<span class="string">"@android:anim/linear_interpolator"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:pivotX</span>=<span class="string">"50%"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:pivotY</span>=<span class="string">"50%"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:repeatCount</span>=<span class="string">"-1"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:repeatMode</span>=<span class="string">"restart"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:startOffset</span>=<span class="string">"-1"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:toDegrees</span>=<span class="string">"+360"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>loading_dialog.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">"@android:color/transparent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:padding</span>=<span class="string">"10dp"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/img"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"40dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"40dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:scaleType</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:src</span>=<span class="string">"@mipmap/aliwx_img_loading"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/tipTextView"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textStyle</span>=<span class="string">"bold"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginLeft</span>=<span class="string">"5dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textColor</span>=<span class="string">"#FF34A350"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"数据加载中……"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textSize</span>=<span class="string">"16sp"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>layout_base.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/base_tool_bar"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">android.support.v7.widget.Toolbar</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ViewFlipper</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/layout_container"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>activity_main.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/rootview"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_centerInParent</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/bt"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textSize</span>=<span class="string">"18sp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"点击开始网络请求"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/result_text"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textSize</span>=<span class="string">"18sp"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>图片：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/12648131-1cb7ef84d366fc54.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/29/format/webp"  alt="img"></p>
<p>aliwx_img_loading.png</p>
<p>style：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 自定义loading dialog --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"loading_dialog"</span> <span class="attr">parent</span>=<span class="string">"android:style/Theme.Dialog"</span>&gt;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowFrame"</span>&gt;</span>@null<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowNoTitle"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowIsFloating"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:backgroundDimEnabled"</span>&gt;</span>false<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowBackground"</span>&gt;</span>@color/bg_dialog_white<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowContentOverlay"</span>&gt;</span>@null<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>[本章完…]</p>
<h1 id="lt-第三十四篇-gt-：Android开发需要了解的Dagger2"><a href="#lt-第三十四篇-gt-：Android开发需要了解的Dagger2" class="headerlink" title="&lt;第三十四篇&gt;：Android开发需要了解的Dagger2"></a>&lt;第三十四篇&gt;：Android开发需要了解的Dagger2</h1><blockquote>
<p>在Android中Dagger2主要目的是解耦，一般结合MVP达到完全解耦的效果。</p>
</blockquote>
<h5 id="（1）什么是Dagger2？"><a href="#（1）什么是Dagger2？" class="headerlink" title="（1）什么是Dagger2？"></a>（1）什么是Dagger2？</h5><p>Dagger是为Android和Java平台提供的一个完全静态的，在编译时进行依赖注入的框架，原来是由Square公司维护，现在由Google维护。</p>
<h5 id="（2）存在的意义"><a href="#（2）存在的意义" class="headerlink" title="（2）存在的意义"></a>（2）存在的意义</h5><p>我们在activity中有可能会用到很多很多的类，这些类要在activity中进行实例化，这样就导致我们的activity非常依赖这么多的类，这样的程序耦合非常严重，不便于维护和扩展，有什么办法可以不去依赖这些类呢，这时候就需要有一个容器，将这些类放到这个容器里并实例化，我们activity在用到的时候去容器里面取就可以了，我们从依赖类到依赖这个容器，实现了解耦，这就是我所理解的依赖注入，即所谓控制反转。</p>
<h5 id="（3）注解之-Inject"><a href="#（3）注解之-Inject" class="headerlink" title="（3）注解之@Inject"></a>（3）注解之@Inject</h5><p>主要有两个作用，一个是使用在构造函数上，通过标记构造函数让Dagger2来使用（Dagger2通过Inject标记可以在需要这个类实 例的时候来找到这个构造函数并把相关实例new出来）从而提供依赖，另一个作用就是标记在需要依赖的变量让Dagger2为其提供依赖。</p>
<h5 id="（4）注解之-Module"><a href="#（4）注解之-Module" class="headerlink" title="（4）注解之@Module"></a>（4）注解之@Module</h5><p>用Module标注的类是专门用来提供依赖的。有的人可能有些疑惑，看了上面的@Inject，需要在构造函数上标记才能提供依赖，那么如果我们需要提供的类构造函数无法修改怎么办，比如一些jar包里的类，我们无法修改源码。这时候就需要使用Module了。Module可以给不能修改源码的类提供依赖，当然，能用Inject标注的通过Module也可以提供依赖</p>
<h5 id="（5）注解之-Provides"><a href="#（5）注解之-Provides" class="headerlink" title="（5）注解之@Provides"></a>（5）注解之@Provides</h5><p>用Provide来标注一个方法，该方法可以在需要提供依赖时被调用，从而把预先提供好的对象当做依赖给标注了@Inject的变量赋值。provide主要用于标注Module里的方法</p>
<h5 id="（6）注解之-Component"><a href="#（6）注解之-Component" class="headerlink" title="（6）注解之@Component"></a>（6）注解之@Component</h5><p>Component一般用来标注接口，被标注了Component的接口在编译时会产生相应的类的实例来作为提供依赖方和需要依赖方之间的桥梁，把相关依赖注入到其中。</p>
<h5 id="（7）添加依赖"><a href="#（7）添加依赖" class="headerlink" title="（7）添加依赖"></a>（7）添加依赖</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.google.dagger:dagger:2.22.1'</span></span><br><span class="line">annotationProcessor <span class="string">'com.google.dagger:dagger-compiler:2.22.1'</span></span><br></pre></td></tr></table></figure>

<h5 id="（8）-Inject和-Component使用"><a href="#（8）-Inject和-Component使用" class="headerlink" title="（8）@Inject和@Component使用"></a>（8）@Inject和@Component使用</h5><p>我们先看一下未注入Dagger的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">BaseActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> DaggerTest daggerTest;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressLint</span>(<span class="string">"CheckResult"</span>)</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        daggerTest = <span class="keyword">new</span> DaggerTest();</span><br><span class="line"></span><br><span class="line">        findViewById(R.id.bt_1).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                daggerTest.print();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaggerTest</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 打印测试数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"做一个小测试"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在MainActivity中创建一个DaggerTest对象，这样的话MainActivity和DaggerTest就产生了依赖关系，这就产生了耦合。下面将使用Dagger来解耦：</p>
<p><code>第一步</code> 在MainActivity中使用@Inject注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">BaseActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    DaggerTest daggerTest;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressLint</span>(<span class="string">"CheckResult"</span>)</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        findViewById(R.id.bt_1).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                daggerTest.print();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第二步</code> 在DaggerTest的构造方法中使用@Inject注解（构造方法不可以是private）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaggerTest</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    @Inject</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DaggerTest</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 打印测试数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"做一个小测试"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第三步</code> 新建一个TestComponent接口，并用@Component修饰</p>
<p>Component是连接注入类和目标类的桥梁。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TestComponent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(MainActivity mainActivity)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Component会查找目标类中用Inject注解标注的属性，查找到相应的属性后会接着查找该属性对应的用Inject标注的构造函数</p>
<p><code>第四步</code> 将目标类注入到Component中</p>
<p>我们在MainActivity中的onCreate方法中添加以下代码</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">DaggerTestComponent</span><span class="selector-class">.create</span>()<span class="selector-class">.inject</span>(<span class="selector-tag">this</span>);</span><br></pre></td></tr></table></figure>

<p>这种方式的局限性：</p>
<ul>
<li>DaggerTest构造方法不可以带有参数；</li>
<li>DaggerTest不可以存在多个构造方法；</li>
</ul>
<h5 id="（9）解决第（8）项构造方法中不能带参数的问题"><a href="#（9）解决第（8）项构造方法中不能带参数的问题" class="headerlink" title="（9）解决第（8）项构造方法中不能带参数的问题"></a>（9）解决第<code>（8）</code>项构造方法中不能带参数的问题</h5><p>要想构造方法中可以带有参数，需要@Module和@Provides的支持。</p>
<p><code>第一步</code> 在MainActivity中使用@Inject注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">BaseActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    DaggerTest daggerTest;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressLint</span>(<span class="string">"CheckResult"</span>)</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        findViewById(R.id.bt_1).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                daggerTest.print();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第二步</code> 在DaggerTest的构造方法中使用@Inject注解</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaggerTest</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    @Inject</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DaggerTest</span><span class="params">(String s)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 打印测试数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Log.d(<span class="string">"aaa"</span>, <span class="string">"做一个小测试"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第三步</code> 新建Model</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestModel</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DaggerTest <span class="title">provideDaggerTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DaggerTest(<span class="string">"a"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Model类使用<code>@Module</code>修饰，<code>@Provides</code>修饰任意方法并提供对象的实例。</p>
<p><code>第四步</code> 新建一个TestComponent接口，用@Component修饰，并指定某Model</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(modules = TestModel<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">interface</span> <span class="title">TestComponent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(MainActivity mainActivity)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第五步</code> 将目标类注入到Component中</p>
<p>我们在MainActivity中的onCreate方法中添加以下代码</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">DaggerTestComponent</span><span class="selector-class">.builder</span>()</span><br><span class="line">        <span class="selector-class">.testModel</span>(<span class="selector-tag">new</span> <span class="selector-tag">TestModel</span>())</span><br><span class="line">        <span class="selector-class">.build</span>()</span><br><span class="line">        <span class="selector-class">.inject</span>(<span class="selector-tag">this</span>);</span><br></pre></td></tr></table></figure>

<p>当然TestModel的构造方法可以带有参数</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">DaggerTestComponent</span><span class="selector-class">.builder</span>()</span><br><span class="line">        <span class="selector-class">.testModel</span>(<span class="selector-tag">new</span> <span class="selector-tag">TestModel</span>("我传递了一个数据"))</span><br><span class="line">        <span class="selector-class">.build</span>()</span><br><span class="line">        <span class="selector-class">.inject</span>(<span class="selector-tag">this</span>);</span><br></pre></td></tr></table></figure>

<p>这种方式的局限性：</p>
<ul>
<li>DaggerTest不可以存在多个构造方法；</li>
</ul>
<h5 id="（10）注入类拥有多个构造方法的情况"><a href="#（10）注入类拥有多个构造方法的情况" class="headerlink" title="（10）注入类拥有多个构造方法的情况"></a>（10）注入类拥有多个构造方法的情况</h5><p>使用<code>@Named</code>可以使构造方法分类，我就不分步骤了，直接贴一下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">BaseActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Named</span>(<span class="string">"type1"</span>)</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    DaggerTest daggerTest1;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Named</span>(<span class="string">"type2"</span>)</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    DaggerTest daggerTest2;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Named</span>(<span class="string">"type3"</span>)</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    DaggerTest daggerTest3;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressLint</span>(<span class="string">"CheckResult"</span>)</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        DaggerTestComponent.builder()</span><br><span class="line">                .testModel(<span class="keyword">new</span> TestModel(<span class="string">"我传递了一个数据"</span>))</span><br><span class="line">                .build()</span><br><span class="line">                .inject(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        findViewById(R.id.bt_1).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                daggerTest1.print();</span><br><span class="line">                daggerTest2.print();</span><br><span class="line">                daggerTest3.print();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaggerTest</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String printStr = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DaggerTest</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DaggerTest</span><span class="params">(String s)</span></span>&#123;</span><br><span class="line">        printStr = s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DaggerTest</span><span class="params">(String s, String ss)</span></span>&#123;</span><br><span class="line">        printStr = s + ss;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 打印测试数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!TextUtils.isEmpty(printStr))&#123;</span><br><span class="line">            Log.d(<span class="string">"aaa"</span>, printStr);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            Log.d(<span class="string">"aaa"</span>, <span class="string">"做一个小测试"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestModel</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String test;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TestModel</span><span class="params">(String s)</span></span>&#123;</span><br><span class="line">        test = s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Named</span>(<span class="string">"type1"</span>)</span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DaggerTest <span class="title">provideDaggerTest1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DaggerTest();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Named</span>(<span class="string">"type2"</span>)</span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DaggerTest <span class="title">provideDaggerTest2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DaggerTest(test);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Named</span>(<span class="string">"type3"</span>)</span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DaggerTest <span class="title">provideDaggerTest3</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DaggerTest(test, <span class="string">"1"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(modules = TestModel<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">interface</span> <span class="title">TestComponent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(MainActivity mainActivity)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="（11）自定义注解替代-Named"><a href="#（11）自定义注解替代-Named" class="headerlink" title="（11）自定义注解替代@Named"></a>（11）自定义注解替代<code>@Named</code></h5><p><code>@Qualifier</code>注解可以解决注入类拥有多个构造方法时依赖冲突的问题，下面我们自定义一个注解<code>@CustomName</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Qualifier</span><br><span class="line">@Documented</span><br><span class="line">@Target(&#123; ElementType.FIELD, ElementType.METHOD &#125;)</span><br><span class="line">@Retention(RUNTIME)</span><br><span class="line">public @interface CustomName &#123;</span><br><span class="line"></span><br><span class="line">    String value() default &quot;&quot;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们只要将<code>（10）</code>中的<code>@Named</code>换成<code>@CustomName</code>即可。</p>
<h5 id="（12）单例模式"><a href="#（12）单例模式" class="headerlink" title="（12）单例模式"></a>（12）单例模式</h5><p>使用<code>@Singleton</code>注解实现单例。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">第一步&#96; 在Component中添加&#96;@Singleton</span><br><span class="line">@Singleton</span><br><span class="line">@Component(modules &#x3D; TestModel.class)</span><br><span class="line">public interface TestComponent &#123;</span><br><span class="line"></span><br><span class="line">    void inject(MainActivity mainActivity);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">第二步&#96; 在Model中的被&#96;@Provides&#96;修饰的方法上添加&#96;@Singleton</span><br><span class="line">@Singleton</span><br><span class="line">@Provides</span><br><span class="line">public DaggerTest provideDaggerTest1()&#123;</span><br><span class="line">    return new DaggerTest();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上两部可以实现局部单例。</p>
<p>当我们从各种Activity中都使用了以下代码</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">DaggerTestComponent</span><span class="selector-class">.builder</span>()</span><br><span class="line">        <span class="selector-class">.testModel</span>(<span class="selector-tag">new</span> <span class="selector-tag">TestModel</span>("我传递了一个数据"))</span><br><span class="line">        <span class="selector-class">.build</span>()</span><br><span class="line">        <span class="selector-class">.inject</span>(<span class="selector-tag">this</span>);</span><br></pre></td></tr></table></figure>

<p>那么DaggerTest只在各个Activity中是单例的，不同Activity中的DaggerTest的hashcode不同。现在我们将<code>局部单例</code>改造成<code>全局单例</code>：</p>
<ul>
<li>自定义Application</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> TestComponent testComponent;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        testComponent = DaggerTestComponent.builder()</span><br><span class="line">                .testModel(<span class="keyword">new</span> TestModel(<span class="string">"我传递了一个数据"</span>))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TestComponent <span class="title">getTestComponent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> testComponent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TestComponent <span class="title">getTestComponent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> testComponent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>在Activity引用Activity中的Component对象</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">MyApp</span><span class="selector-class">.getTest</span>()<span class="selector-class">.inject</span>(<span class="selector-tag">this</span>);</span><br></pre></td></tr></table></figure>

<h5 id="（13）自定义Scope"><a href="#（13）自定义Scope" class="headerlink" title="（13）自定义Scope"></a>（13）自定义Scope</h5></li>
</ul>
<p>自定义Scope比较简单，现在我们想定义一个<code>@MyScope</code>注解，代码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Scope</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention</span>(RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyScope &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>而<code>@Singleton</code>则是<code>@Scope</code>的默认实现，所以也可以写成</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Scope</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention</span>(RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Singleton&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="（14）延迟注入（Lazy）"><a href="#（14）延迟注入（Lazy）" class="headerlink" title="（14）延迟注入（Lazy）"></a>（14）延迟注入（Lazy）</h5><p>有时我们想注入的依赖在使用时再完成初始化，加快加载速度，就可以使用注入Lazy<T>。只有在调用 <code>Lazy&lt;T&gt;</code> 的 <code>get()</code> 方法时才会初始化依赖实例注入依赖。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@Inject</span></span><br><span class="line">Lazy&lt;DaggerTest&gt; daggerTest1;</span><br></pre></td></tr></table></figure>



<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">daggerTest1</span><span class="selector-class">.get</span>()<span class="selector-class">.print</span>(<span class="selector-tag">String</span><span class="selector-class">.valueOf</span>(<span class="selector-tag">daggerTest1</span><span class="selector-class">.hashCode</span>()));</span><br></pre></td></tr></table></figure>

<h5 id="（15）多个依赖的情况"><a href="#（15）多个依赖的情况" class="headerlink" title="（15）多个依赖的情况"></a>（15）多个依赖的情况</h5><p>假设有A，B两个类，在A中新建一个B对象，那么A和B就产生了依赖，我们称之为：<code>A依赖于B</code>。</p>
<p>结合上面讲解到的知识，我们很容易就会想到如何使用Dagger来解耦：</p>
<p><code>第一步</code> 在A中使用<code>@Inject</code>修饰B的成员变量</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@Inject</span></span><br><span class="line">A a;</span><br></pre></td></tr></table></figure>

<p><code>第二步</code> 使用<code>@Module</code>和<code>@Provides</code>新建一个Model</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BModel</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DaggerTest <span class="title">provideDaggerB</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> B();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第三步</code> 使用<code>@Component</code>定义接口，这个接口作为A和B形成依赖关系的桥梁</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(modules = BModel<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">interface</span> <span class="title">ABComponent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(A a)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第四步</code> 在A中使用以下代码，即可完成A和B的依赖关系。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ABComponent abComponent = DaggerABComponent.builder()</span><br><span class="line">         .testModel(<span class="keyword">new</span> BModel())</span><br><span class="line">         .build()</span><br><span class="line">         .inject(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure>

<p>以上四个步骤比较简单，但是这时又来了一个C类，在C类中新建一个B对象，那么C和B就产生了依赖，我们称之为<code>C依赖于B</code>。</p>
<p>我们可以在<code>@Component</code>新增接口可以实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(modules = BModel<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">interface</span> <span class="title">ABComponent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(A a)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(C c)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="（16）一个桥梁可以引用多个modules"><a href="#（16）一个桥梁可以引用多个modules" class="headerlink" title="（16）一个桥梁可以引用多个modules"></a>（16）一个桥梁可以引用多个modules</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(modules = &#123;TestModel<span class="class">.<span class="keyword">class</span>, <span class="title">Test2Model</span>.<span class="title">class</span>&#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">interface</span> <span class="title">TestComponent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(MainActivity mainActivity)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="（17）Component的依赖关系"><a href="#（17）Component的依赖关系" class="headerlink" title="（17）Component的依赖关系"></a>（17）Component的依赖关系</h5><p>Component就是桥梁，如果某桥梁想要使用另一个桥梁的方法时，可通过依赖实现。</p>
<p><code>第一步</code> 使用<code>@Inject</code>声明成员变量</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@Inject</span></span><br><span class="line">DaggerTest2 daggerTest2;</span><br></pre></td></tr></table></figure>

<p><code>第二步</code> 新建Modules</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test2Model</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DaggerTest2 <span class="title">provideDaggerTest1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DaggerTest2();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第三步</code> 桥梁</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(modules = &#123;TestModel<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">interface</span> <span class="title">TestComponent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(MainActivity mainActivity)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">DaggerTest <span class="title">getDaggerTest</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(modules = Test2Model<span class="class">.<span class="keyword">class</span>, <span class="title">dependencies</span> </span>= TestComponent<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">interface</span> <span class="title">Test2Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">(DemoActivity mainActivity)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第四步</code> 产生依赖，并调用依赖桥梁的方法</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DaggerTest daggerTest = DaggerTestComponent.create().getDaggerTest();</span><br><span class="line">daggerTest.print(<span class="string">"aaaa"</span>);</span><br><span class="line"></span><br><span class="line">DaggerTest2Component.builder()</span><br><span class="line">        .testComponent(DaggerTestComponent.create())</span><br><span class="line">        .test2Model(<span class="keyword">new</span> Test2Model())</span><br><span class="line">        .build()</span><br><span class="line">        .test(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure>

<h5 id="（18）可参考的其它博客"><a href="#（18）可参考的其它博客" class="headerlink" title="（18）可参考的其它博客"></a>（18）可参考的其它博客</h5><p><a href="https://www.jianshu.com/p/26d9f99ea3bb" target="_blank" rel="noopener">Dagger 2 完全解析（一），Dagger 2 的基本使用与原理</a><br><a href="https://www.jianshu.com/p/9703a931c7e7" target="_blank" rel="noopener">Dagger 2 完全解析（二），进阶使用 Lazy、Qualifier、Scope 等</a><br><a href="https://www.jianshu.com/p/2ac2f39cb25f" target="_blank" rel="noopener">Dagger 2 完全解析（三），Component 的组织关系与 SubComponent</a><br><a href="https://www.jianshu.com/p/fe0fd2c9df61" target="_blank" rel="noopener">Dagger 2 完全解析（四），Android 中使用 Dagger 2</a><br><a href="https://www.jianshu.com/p/fbacd083a365" target="_blank" rel="noopener">Dagger 2 完全解析（五），Kotlin 中使用 Dagger 2</a><br><a href="https://www.jianshu.com/p/8060a260488d" target="_blank" rel="noopener">Dagger 2 完全解析（六），dagger.android 扩展库的使用</a></p>
</div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/RxJava/">RxJava</a></div><div class="post_share"><div class="social-share" data-image="https://coding.imooc.com/static/module/class/content/img/308/section1-2.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/04/17/Android%E8%B6%85%E8%AF%A6%E7%BB%86%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%9B%BE/"><img class="prev_cover lazyload" data-src="/img/assets/a3ea13ec36c191ed6925.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Android超详细的生命周期图</div></div></a></div><div class="next-post pull_right"><a href="/2020/04/16/Android%20Studio3.x%E4%B8%8A%E4%BD%BF%E7%94%A8Lombok/"><img class="next_cover lazyload" data-src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1587041127112&amp;di=7668cf504c2ca89b87b95ca8a8cd4e5f&amp;imgtype=0&amp;src=http%3A%2F%2F5b0988e595225.cdn.sohucs.com%2Fimages%2F20171116%2F234a497834c444a9a502efd31d514538.jpeg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Android Studio3.x上使用Lombok</div></div></a></div></nav></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By Kai</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script></body></html>