<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>MyBatis使用详解 | K的小屋</title><meta name="description" content="MyBatis使用介绍"><meta name="keywords" content="Java,MyBatis,数据库框架"><meta name="author" content="Kai"><meta name="copyright" content="Kai"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="MyBatis使用详解"><meta name="twitter:description" content="MyBatis使用介绍"><meta name="twitter:image" content="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=2196685962,796489853&amp;fm=26&amp;gp=0.jpg"><meta property="og:type" content="article"><meta property="og:title" content="MyBatis使用详解"><meta property="og:url" content="https://www.google.com/2020/04/16/MyBatis%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/"><meta property="og:site_name" content="K的小屋"><meta property="og:description" content="MyBatis使用介绍"><meta property="og:image" content="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=2196685962,796489853&amp;fm=26&amp;gp=0.jpg"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://www.google.com/2020/04/16/MyBatis%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/"><link rel="prev" title="Android Studio3.x上使用Lombok" href="https://www.google.com/2020/04/16/Android%20Studio3.x%E4%B8%8A%E4%BD%BF%E7%94%A8Lombok/"><link rel="next" title="Hello World" href="https://www.google.com/2020/04/16/hello-world/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: true
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">24</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">27</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">11</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#内容概述"><span class="toc-number">1.</span> <span class="toc-text">内容概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是框架？"><span class="toc-number">2.</span> <span class="toc-text">什么是框架？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三层架构"><span class="toc-number">3.</span> <span class="toc-text">三层架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是-MyBatis-？"><span class="toc-number">4.</span> <span class="toc-text">什么是 MyBatis ？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JDBC问题分析"><span class="toc-number">5.</span> <span class="toc-text">JDBC问题分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MyBatis框架概述"><span class="toc-number">6.</span> <span class="toc-text">MyBatis框架概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MyBatis快速入门"><span class="toc-number">7.</span> <span class="toc-text">MyBatis快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#环境参数"><span class="toc-number">7.1.</span> <span class="toc-text">环境参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mybatis的环境搭建步骤"><span class="toc-number">7.2.</span> <span class="toc-text">Mybatis的环境搭建步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#XML版本"><span class="toc-number">7.2.1.</span> <span class="toc-text">XML版本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#注解版本"><span class="toc-number">7.2.2.</span> <span class="toc-text">注解版本</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MyBatis的CRUD操作-xml版本"><span class="toc-number">8.</span> <span class="toc-text">MyBatis的CRUD操作(xml版本)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-创建不用骨架的java-maven项目，导入坐标"><span class="toc-number">8.1.</span> <span class="toc-text">1. 创建不用骨架的java maven项目，导入坐标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-准备数据，sql语句"><span class="toc-number">8.2.</span> <span class="toc-text">2. 准备数据，sql语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-创建user实体类，实现Serializable，属性名和数据库表名保持一致"><span class="toc-number">8.3.</span> <span class="toc-text">3. 创建user实体类，实现Serializable，属性名和数据库表名保持一致</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-创建一个IUserDao接口，或者叫IUserMapper，用户的持久层接口"><span class="toc-number">8.4.</span> <span class="toc-text">4. 创建一个IUserDao接口，或者叫IUserMapper，用户的持久层接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-在resources目录下创建一个Mybatis的主配置文件SqlMapConifg-xml，指定映射配置文件的位置"><span class="toc-number">8.5.</span> <span class="toc-text">5. 在resources目录下创建一个Mybatis的主配置文件SqlMapConifg.xml，指定映射配置文件的位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-创建映射配置文件IUserMapper-xml，目录和接口IUserDao-IUserMapper-保持一致"><span class="toc-number">8.6.</span> <span class="toc-text">6. 创建映射配置文件IUserMapper.xml，目录和接口IUserDao(IUserMapper)保持一致</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-编写测试类"><span class="toc-number">8.7.</span> <span class="toc-text">7. 编写测试类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-输出日志"><span class="toc-number">8.8.</span> <span class="toc-text">8. 输出日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#注意事项"><span class="toc-number">8.9.</span> <span class="toc-text">注意事项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#小结"><span class="toc-number">8.10.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MyBatis的CRUD操作-注解版本"><span class="toc-number">9.</span> <span class="toc-text">MyBatis的CRUD操作(注解版本)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-idea创建一个不用骨架的java-maven项目，导入坐标"><span class="toc-number">9.1.</span> <span class="toc-text">1. idea创建一个不用骨架的java maven项目，导入坐标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-准备数据，sql语句-1"><span class="toc-number">9.2.</span> <span class="toc-text">2. 准备数据，sql语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-创建student实体类，实现Serializable，属性名和数据库表名保持一致"><span class="toc-number">9.3.</span> <span class="toc-text">3. 创建student实体类，实现Serializable，属性名和数据库表名保持一致</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-创建一个IStudentDao接口，或者叫IUserMapper，用户的持久层接口，使用注解实现增删改查功能-Select"><span class="toc-number">9.4.</span> <span class="toc-text">4. 创建一个IStudentDao接口，或者叫IUserMapper，用户的持久层接口，使用注解实现增删改查功能@Select</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-在resources目录下创建一个Mybatis的主配置文件SqlMapConifg-xml，指定映射配置文件的位置，使用classs属性"><span class="toc-number">9.5.</span> <span class="toc-text">5. 在resources目录下创建一个Mybatis的主配置文件SqlMapConifg.xml，指定映射配置文件的位置，使用classs属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-创建映射配置文件IUserMapper-xml，目录和接口IUserDao-IUserMapper-保持一致-1"><span class="toc-number">9.6.</span> <span class="toc-text">6. 创建映射配置文件IUserMapper.xml，目录和接口IUserDao(IUserMapper)保持一致</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-编写测试类-1"><span class="toc-number">9.7.</span> <span class="toc-text">7. 编写测试类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-输出日志-1"><span class="toc-number">9.8.</span> <span class="toc-text">8. 输出日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#小结-1"><span class="toc-number">9.9.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MyBatis的CRUD操作-自己写实现类的方式"><span class="toc-number">10.</span> <span class="toc-text">MyBatis的CRUD操作(自己写实现类的方式)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-创建IUserDao的实现类UserDaoImpl"><span class="toc-number">10.1.</span> <span class="toc-text">1. 创建IUserDao的实现类UserDaoImpl</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-测试方法"><span class="toc-number">10.2.</span> <span class="toc-text">2. 测试方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-输出日志"><span class="toc-number">10.3.</span> <span class="toc-text">3. 输出日志</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#完整版MyBatis的CRUD操作-基于xml版本"><span class="toc-number">11.</span> <span class="toc-text">完整版MyBatis的CRUD操作(基于xml版本)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#基础功能"><span class="toc-number">11.1.</span> <span class="toc-text">基础功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#入参深入-使用实体类的包装对象作为查询条件OGNL"><span class="toc-number">11.2.</span> <span class="toc-text">入参深入-使用实体类的包装对象作为查询条件OGNL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#返回值深入-实体类属性和数据库列名不对应"><span class="toc-number">11.3.</span> <span class="toc-text">返回值深入-实体类属性和数据库列名不对应</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#常用标签的介绍"><span class="toc-number">12.</span> <span class="toc-text">常用标签的介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#properties"><span class="toc-number">12.1.</span> <span class="toc-text">properties</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#typeAliases"><span class="toc-number">12.2.</span> <span class="toc-text">typeAliases</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#package"><span class="toc-number">12.3.</span> <span class="toc-text">package</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MyBatis连接池及事务控制"><span class="toc-number">13.</span> <span class="toc-text">MyBatis连接池及事务控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#连接池"><span class="toc-number">13.1.</span> <span class="toc-text">连接池</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#连接池作用"><span class="toc-number">13.1.1.</span> <span class="toc-text">连接池作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mybatis连接池分类"><span class="toc-number">13.1.2.</span> <span class="toc-text">Mybatis连接池分类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#事务控制"><span class="toc-number">13.2.</span> <span class="toc-text">事务控制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#动态SQL"><span class="toc-number">14.</span> <span class="toc-text">动态SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL片段"><span class="toc-number">14.1.</span> <span class="toc-text">SQL片段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#if标签"><span class="toc-number">14.2.</span> <span class="toc-text">if标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#where标签"><span class="toc-number">14.3.</span> <span class="toc-text">where标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#foreach标签"><span class="toc-number">14.4.</span> <span class="toc-text">foreach标签</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#p6sy"><span class="toc-number">15.</span> <span class="toc-text">p6sy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#多表查询（一对一）"><span class="toc-number">16.</span> <span class="toc-text">多表查询（一对一）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#多表查询（一对多）"><span class="toc-number">17.</span> <span class="toc-text">多表查询（一对多）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Step1-建表"><span class="toc-number">17.1.</span> <span class="toc-text">Step1. 建表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step2-建实体类对应关系"><span class="toc-number">17.2.</span> <span class="toc-text">Step2. 建实体类对应关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step3-编写查询Mapper"><span class="toc-number">17.3.</span> <span class="toc-text">Step3.编写查询Mapper</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step4-测试"><span class="toc-number">17.4.</span> <span class="toc-text">Step4. 测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#多表查询（多对多）"><span class="toc-number">18.</span> <span class="toc-text">多表查询（多对多）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Step1-建表-1"><span class="toc-number">18.1.</span> <span class="toc-text">Step1. 建表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step2-建立两个实体类"><span class="toc-number">18.2.</span> <span class="toc-text">Step2.建立两个实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step3-建立Mapper配置文件"><span class="toc-number">18.3.</span> <span class="toc-text">Step3. 建立Mapper配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step4-测试-1"><span class="toc-number">18.4.</span> <span class="toc-text">Step4. 测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#延迟加载"><span class="toc-number">19.</span> <span class="toc-text">延迟加载</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#延迟加载和立即加载的概念"><span class="toc-number">19.1.</span> <span class="toc-text">延迟加载和立即加载的概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#一对一实现延迟加载"><span class="toc-number">19.2.</span> <span class="toc-text">一对一实现延迟加载</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#立即加载"><span class="toc-number">19.2.1.</span> <span class="toc-text">立即加载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#延迟加载-1"><span class="toc-number">19.2.2.</span> <span class="toc-text">延迟加载</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#一对多实现延迟加载"><span class="toc-number">19.3.</span> <span class="toc-text">一对多实现延迟加载</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#一级缓存"><span class="toc-number">20.</span> <span class="toc-text">一级缓存</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二级缓存"><span class="toc-number">21.</span> <span class="toc-text">二级缓存</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mybatis注解开发"><span class="toc-number">22.</span> <span class="toc-text">Mybatis注解开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PageHelper插件"><span class="toc-number">23.</span> <span class="toc-text">PageHelper插件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#逆向工程MyBatis-Generotor"><span class="toc-number">24.</span> <span class="toc-text">逆向工程MyBatis-Generotor</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">25.</span> <span class="toc-text">总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#待完善内容"><span class="toc-number">25.1.</span> <span class="toc-text">待完善内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#问题记录"><span class="toc-number">25.2.</span> <span class="toc-text">问题记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#欢迎反馈"><span class="toc-number">25.3.</span> <span class="toc-text">欢迎反馈</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考文章"><span class="toc-number">26.</span> <span class="toc-text">参考文章</span></a></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=2196685962,796489853&amp;fm=26&amp;gp=0.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">K的小屋</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">MyBatis使用详解</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-04-16 04:07:00"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-04-16</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-04-16 16:37:58"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-04-16</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/SSM/">SSM</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">22.6k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 107 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><h2 id="内容概述"><a href="#内容概述" class="headerlink" title="内容概述"></a>内容概述</h2><p>准备写一个系列文章，MyBatis作为JavaEE框架开发的入门技术，所以作为开篇吧。</p>
<p>后续会推出MyBatisPlus、Spring、SpringMVC、Oracle、Maven、ElasticSearch、SpringBoot、SpringCloud、RabbitMQ、Nginx…等等，涉及到常用的JavaEE开发技术。</p>
<p>系列文章是用来记录自己在实际开发中常用的技术和内容，也可以做回顾，有遗漏的地方可以留言，待我记录后及时补充。</p>
<p>才疏学浅，写的文章难免有出错的地方，还望指正，大家相互进步。:smile:</p>
<p>​                                                                        ——现役码农 2019-12-17</p>
<h2 id="什么是框架？"><a href="#什么是框架？" class="headerlink" title="什么是框架？"></a>什么是框架？</h2><p>它是我们软件开发中的一套解决方案，不同的框架解决的是不同的问题。</p>
<p>使用框架的好处：框架封装了很多的细节，使开发者可以使用极简的方式实现功能，大大提高开发效率。</p>
<p>MyBatis是解决持久层问题，SpringMVC是解决表现层问题。</p>
<p>框架（Framework）是整个或部分系统的可重用设计，表现为一组抽象构件及构件实例间交互的方法;另一种定义认为，框架是可被应用开发者定制的应用骨架。前者是从应用方面而后者是从目的方面给出的定义。</p>
<p>简而言之，框架其实就是某种应用的半成品，就是一组组件，供你选用完成你自己的系统。简单说就是使用别人搭好的舞台，你来做表演。而且，框架一般是成熟的，不断升级的软件。</p>
<p>框架一般处在低层应用平台（如 J2EE ）和高层业务逻辑之间的中间层。</p>
<p>软件开发的分层重要性：<br>​    框架的重要性在于它实现了部分功能，并且能够很好的将低层应用平台和高层业务逻辑进行了缓和。为了实现软件工程中的“高内聚、低耦合”。把问题划分开来各个解决，易于控制，易于延展，易于分配资源。我们常见的MVC 软件设计思想就是很好的分层思想。</p>
<h2 id="三层架构"><a href="#三层架构" class="headerlink" title="三层架构"></a>三层架构</h2><p><img src="/" class="lazyload" data-src="/img/assets/%E4%B8%89%E5%B1%82%E6%9E%B6%E6%9E%84.png"  alt=""></p>
<p>表现层：是用于展示数据的（SpringMVC）</p>
<p>业务层：是处理业务需求</p>
<p>持久层：是和数据库交互的（MyBatis）</p>
<p>常见的 JavaEE 开发框架：</p>
<p>1 、解决数据的持久化问题的框架——MyBatis<br>MyBatis:作为持久层的框架，还有一个封装程度更高的框架就是Hibernate，但这个框架因为各种原因目前在国内的流行程度下降太多，现在公司开发也越来越少使用。目前使用 Spring Data 来实现数据持久化也是一种趋势。<br>2、解决 WEB层问题的MVC框架——SpringMVC<br>3 、解决技术整合问题——Spring，Spring是一个轻量级控制反转(IOC)和面向切面(AOP)的容器框架</p>
<h2 id="什么是-MyBatis-？"><a href="#什么是-MyBatis-？" class="headerlink" title="什么是 MyBatis ？"></a>什么是 MyBatis ？</h2><blockquote>
<p>MyBatis 是支持定制化SQL、存储过程以及高级映射的优秀的持久层框架。MyBatis 避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集。</p>
<p>MyBatis 可以对配置和原生Map使用简单的 XML 或注解，将接口和 Java 的 POJOs(Plain Old Java Objects,普通的 Java对象)映射成数据库中的记录。</p>
</blockquote>
<p>mybatis是一个优秀的基于 java 的持久层框架，它内部封装了 jdbc，使开发者只需要关注 sql 语句本身，而不需要花费精力去处理加载驱动、创建连接、创建 statement 等繁杂的过程。</p>
<p>mybatis通过 xml 或注解的方式将要执行的各种statement配置起来，并通过java对象和statement 中sql 的动态参数进行映射生成最终执行的 sql 语句，最后由 mybatis 框架执行 sql 并将结果映射为 java 对象并返回。</p>
<p>采用 ORM 思想解决了实体和数据库映射的问题，对 jdbc进行了封装，屏蔽了 jdbc api 底层访问细节，使我们不用与 jdbc api 打交道，就可以完成对数据库的持久化操作。</p>
<p>为了我们能够更好掌握框架运行的内部过程，并且有更好的体验，下面我们将从自定义 Mybatis 框架开始来学习框架。此时我们将会体验框架从无到有的过程体验，也能够很好的综合前面阶段所学的基础。</p>
<h2 id="JDBC问题分析"><a href="#JDBC问题分析" class="headerlink" title="JDBC问题分析"></a>JDBC问题分析</h2><p>用 jdbc 的原始方法（未经封装）实现了查询数据库表记录的操作：</p>
<ul>
<li><p>准备数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for t_user</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS &#96;t_user&#96;;</span><br><span class="line">CREATE TABLE &#96;t_user&#96; (</span><br><span class="line">  &#96;id&#96; int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  &#96;username&#96; varchar(32) NOT NULL,</span><br><span class="line">  &#96;password&#96; varchar(32) NOT NULL,</span><br><span class="line">  &#96;birthday&#96; date DEFAULT NULL,</span><br><span class="line">  &#96;sex&#96; bit(1) DEFAULT NULL,</span><br><span class="line">  &#96;address&#96; varchar(255) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (&#96;id&#96;),</span><br><span class="line">  UNIQUE KEY &#96;username&#96; (&#96;username&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB AUTO_INCREMENT&#x3D;4 DEFAULT CHARSET&#x3D;utf8;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Records of t_user</span><br><span class="line">-- ----------------------------</span><br><span class="line">INSERT INTO &#96;t_user&#96; VALUES (&#39;1&#39;, &#39;AA&#39;, &#39;123456&#39;, &#39;2019-12-13&#39;, &#39;&#39;, &#39;北京&#39;);</span><br><span class="line">INSERT INTO &#96;t_user&#96; VALUES (&#39;2&#39;, &#39;BB&#39;, &#39;123456&#39;, &#39;2019-12-10&#39;, &#39;\0&#39;, &#39;上海&#39;);</span><br><span class="line">INSERT INTO &#96;t_user&#96; VALUES (&#39;3&#39;, &#39;CC&#39;, &#39;123456&#39;, &#39;2019-12-04&#39;, &#39;&#39;, &#39;广州&#39;);</span><br></pre></td></tr></table></figure>

<p><img src="/" class="lazyload" data-src="/img/assets/1576223885147.png"  alt="1576223885147"></p>
</li>
</ul>
<p><img src="/" class="lazyload" data-src="/img/assets/1576223914122.png"  alt="1576223914122"></p>
<p>Java代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用 jdbc 的原始方法（未经封装）实现了查询数据库表记录的操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        PreparedStatement ps = <span class="keyword">null</span>;</span><br><span class="line">        ResultSet resultSet = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1. 注册驱动</span></span><br><span class="line">            Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">            <span class="comment">//2. 获取连接对象</span></span><br><span class="line">            conn = DriverManager.getConnection(<span class="string">"jdbc:mysql://localhost:3306/mybatis?useUnicode=true&amp;useJDBCCompliantTimezoneShift=true&amp;useLegacyDatetimeCode=false&amp;serverTimezone=UTC"</span>, <span class="string">"root"</span>, <span class="string">"123456"</span>);</span><br><span class="line">            <span class="comment">//3. 准备SQL语句</span></span><br><span class="line">            String sql = <span class="string">"select * from t_user"</span>;</span><br><span class="line">            <span class="comment">//4. 获取预处理statement</span></span><br><span class="line">            ps = conn.prepareStatement(sql);</span><br><span class="line">            <span class="comment">//5.执行SQL语句</span></span><br><span class="line">            resultSet = ps.executeQuery();</span><br><span class="line">            <span class="comment">//6.处理结果集</span></span><br><span class="line">            <span class="keyword">while</span> (resultSet.next()) &#123;</span><br><span class="line">                <span class="keyword">int</span> id = resultSet.getInt(<span class="string">"id"</span>);</span><br><span class="line">                String username = resultSet.getString(<span class="string">"username"</span>);</span><br><span class="line">                String password = resultSet.getString(<span class="string">"password"</span>);</span><br><span class="line">                Date birthday = resultSet.getDate(<span class="string">"birthday"</span>);</span><br><span class="line">                <span class="keyword">boolean</span> sex = resultSet.getBoolean(<span class="string">"sex"</span>);</span><br><span class="line">                String address = resultSet.getString(<span class="string">"address"</span>);</span><br><span class="line">                <span class="comment">//System.out.println(id + "--" + username + "--" + password + "--" + birthday + "--" + sex + "--" + address);</span></span><br><span class="line">                User user = <span class="keyword">new</span> User(id, username, password, birthday, sex, address);</span><br><span class="line">                System.out.println(user);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException | SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//7. 释放资源</span></span><br><span class="line">            <span class="keyword">if</span> (resultSet != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    resultSet.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    resultSet = <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (ps != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    ps.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    ps = <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (conn != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    conn.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    conn = <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>User实体类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">public class User implements Serializable &#123;</span><br><span class="line">    private static final long serialVersionUID &#x3D; -2661131928069328685L;</span><br><span class="line">    private int id;</span><br><span class="line">    private String username;</span><br><span class="line">    private String password;</span><br><span class="line">    private Date birthday;</span><br><span class="line">    private boolean sex;</span><br><span class="line">    private String address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>输出日志：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User(id&#x3D;1, username&#x3D;AA, password&#x3D;123456, birthday&#x3D;2019-12-13, sex&#x3D;true, address&#x3D;北京)</span><br><span class="line">User(id&#x3D;2, username&#x3D;BB, password&#x3D;123456, birthday&#x3D;2019-12-10, sex&#x3D;false, address&#x3D;上海)</span><br><span class="line">User(id&#x3D;3, username&#x3D;CC, password&#x3D;123456, birthday&#x3D;2019-12-04, sex&#x3D;true, address&#x3D;广州)</span><br></pre></td></tr></table></figure>



<p>补充：</p>
<ul>
<li><p>Lombok使用，<a href="https://blog.csdn.net/ThinkWon/article/details/101392808" target="_blank" rel="noopener">https://blog.csdn.net/ThinkWon/article/details/101392808</a></p>
</li>
<li><p>自动生成 serialVersionUID 的设置，<a href="https://www.cnblogs.com/godtrue/p/7674487.html" target="_blank" rel="noopener">https://www.cnblogs.com/godtrue/p/7674487.html</a></p>
</li>
<li><p>为了使MySQL JDBC驱动程序的5.1.33版本与UTC时区配合使用，必须在连接字符串中明确指定serverTimezone</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;mybatis?useUnicode&#x3D;true&amp;useJDBCCompliantTimezoneShift&#x3D;true&amp;useLegacyDatetimeCode&#x3D;false&amp;serverTimezone&#x3D;UTC</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<ol>
<li>数据库链接创建、释放频繁造成系统资源浪费从而影响系统性能，如果使用数据库连接池可以解决此问题；</li>
<li>Sql语句在代码中硬编码，造成代码不易维护，实际应用Sql变化可能较大，Sql变动需要修改java代码；</li>
<li>使用PreparedStatement向占位符传参存在硬编码，因为Sql语句的where条件不一定，可能多也可能少，修改Sql还要修改代码，系统不易维护；</li>
<li>对结果集解析存在硬编码（查询列名），Sql变化导致解析代码变化，系统不易维护，如果能将数据库记录封装成pojo对象解析比较方便。</li>
</ol>
<h2 id="MyBatis框架概述"><a href="#MyBatis框架概述" class="headerlink" title="MyBatis框架概述"></a>MyBatis框架概述</h2><ol>
<li>MyBatis是一个优秀的基于java的持久层框架，它内部封装了jdbc，使开发者只需要关注sql语句本身，而不需要花费经历去处理加载驱动、创建连接、创建statement等繁杂过程；</li>
<li>MyBatis通过xml或注解的形式将要执行的各种statement配置起来，并通过java对象和statement中的sql的动态参数进行映射生成最终执行的sql语句，最后由MyBatis框架执行sql并将结果映射为java对象并返回；</li>
<li>采用ORM思想解决了实体和数据库映射的问题，对jdbc进行了封装，屏蔽了jdbc api底层访问细节，使我们不用与jdbc api打交道，就可以完成对数据库的持久化操作。Mybatis的原名 ibatis，属于半orm框架，而Hibernate属于orm框架。</li>
</ol>
<p>它使用了ORM思想实现了结果集的封装，Object Relational Mappging 对象关系映射，简单的说，就是把数据库表和实体类及实体类的属性对应起来，让我们可以操作实体类就实现操作数据库表。</p>
<h2 id="MyBatis快速入门"><a href="#MyBatis快速入门" class="headerlink" title="MyBatis快速入门"></a>MyBatis快速入门</h2><h3 id="环境参数"><a href="#环境参数" class="headerlink" title="环境参数"></a>环境参数</h3><ul>
<li><p>文档创建时间：2019-12-12 </p>
</li>
<li><p>开发平台：Windows</p>
</li>
<li><p>JDK版本：JDK1.8.0_131</p>
</li>
<li><p>开发工具：IntelliJ IDEA 2019.3</p>
<blockquote>
<p>IntelliJ IDEA 2019.3 (Ultimate Edition)<br>Build #IU-193.5233.84, built on November 25, 2019</p>
</blockquote>
</li>
</ul>
<h3 id="Mybatis的环境搭建步骤"><a href="#Mybatis的环境搭建步骤" class="headerlink" title="Mybatis的环境搭建步骤"></a>Mybatis的环境搭建步骤</h3><h4 id="XML版本"><a href="#XML版本" class="headerlink" title="XML版本"></a>XML版本</h4><ol>
<li>idea创建一个不用骨架的java maven项目，导入坐标</li>
<li>准备数据，sql语句</li>
<li>创建user实体类，实现Serializable，属性名和数据库表名保持一致</li>
<li>创建一个IUserDao接口，或者叫IUserMapper，用户的持久层接口，增删改查功能</li>
<li>在resources目录下创建一个Mybatis的主配置文件SqlMapConifg.xml，指定映射配置文件的位置</li>
<li>创建映射配置文件IUserMapper.xml，目录和接口IUserDao(IUserMapper)保持一致</li>
<li>编写测试类<ol>
<li>读取配置文件</li>
<li>创建SqlSessionFactory工厂</li>
<li>创建SqlSession</li>
<li>创建Dao接口的代理对象</li>
<li>执行dao中的方法</li>
<li>释放资源</li>
</ol>
</li>
</ol>
<h4 id="注解版本"><a href="#注解版本" class="headerlink" title="注解版本"></a>注解版本</h4><ol>
<li>idea创建一个不用骨架的java maven项目，导入坐标</li>
<li>准备数据，sql语句</li>
<li>创建student实体类，实现Serializable，属性名和数据库表名保持一致</li>
<li>创建一个IStudentDao接口，或者叫IUserMapper，用户的持久层接口，使用注解实现增删改查功能<strong>@Select</strong></li>
<li>在resources目录下创建一个Mybatis的主配置文件SqlMapConifg.xml，指定映射配置文件的位置，<strong>使用classs属性</strong></li>
<li><del>创建映射配置文件IUserMapper.xml，目录和接口IUserDao(IUserMapper)保持一致</del></li>
<li>编写测试类<ol>
<li>读取配置文件</li>
<li>创建SqlSessionFactory工厂</li>
<li>创建SqlSession</li>
<li>创建Dao接口的代理对象</li>
<li>执行dao中的方法</li>
<li>释放资源</li>
</ol>
</li>
</ol>
<h2 id="MyBatis的CRUD操作-xml版本"><a href="#MyBatis的CRUD操作-xml版本" class="headerlink" title="MyBatis的CRUD操作(xml版本)"></a>MyBatis的CRUD操作(xml版本)</h2><p>先放上完整的项目目录结构图：</p>
<p><img src="/" class="lazyload" data-src="/img/assets/1576306964599.png"  alt="1576306964599"></p>
<h3 id="1-创建不用骨架的java-maven项目，导入坐标"><a href="#1-创建不用骨架的java-maven项目，导入坐标" class="headerlink" title="1. 创建不用骨架的java maven项目，导入坐标"></a>1. 创建不用骨架的java maven项目，导入坐标</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;junit&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;junit&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;4.11&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;mysql&#x2F;mysql-connector-java --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;8.0.18&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.mybatis&#x2F;mybatis --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.mybatis&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mybatis&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;3.5.3&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;log4j&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;log4j&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.2.17&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.projectlombok&#x2F;lombok --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.18.10&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;scope&gt;provided&lt;&#x2F;scope&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>



<h3 id="2-准备数据，sql语句"><a href="#2-准备数据，sql语句" class="headerlink" title="2. 准备数据，sql语句"></a>2. 准备数据，sql语句</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for t_user</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS &#96;t_user&#96;;</span><br><span class="line">CREATE TABLE &#96;t_user&#96; (</span><br><span class="line">  &#96;id&#96; int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  &#96;username&#96; varchar(32) NOT NULL,</span><br><span class="line">  &#96;password&#96; varchar(32) NOT NULL,</span><br><span class="line">  &#96;birthday&#96; date DEFAULT NULL,</span><br><span class="line">  &#96;sex&#96; bit(1) DEFAULT NULL,</span><br><span class="line">  &#96;address&#96; varchar(255) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (&#96;id&#96;),</span><br><span class="line">  UNIQUE KEY &#96;username&#96; (&#96;username&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB AUTO_INCREMENT&#x3D;4 DEFAULT CHARSET&#x3D;utf8;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Records of t_user</span><br><span class="line">-- ----------------------------</span><br><span class="line">INSERT INTO &#96;t_user&#96; VALUES (&#39;1&#39;, &#39;AA&#39;, &#39;123456&#39;, &#39;2019-12-13&#39;, &#39;&#39;, &#39;北京&#39;);</span><br><span class="line">INSERT INTO &#96;t_user&#96; VALUES (&#39;2&#39;, &#39;BB&#39;, &#39;123456&#39;, &#39;2019-12-10&#39;, &#39;\0&#39;, &#39;上海&#39;);</span><br><span class="line">INSERT INTO &#96;t_user&#96; VALUES (&#39;3&#39;, &#39;CC&#39;, &#39;123456&#39;, &#39;2019-12-04&#39;, &#39;&#39;, &#39;广州&#39;);</span><br></pre></td></tr></table></figure>



<h3 id="3-创建user实体类，实现Serializable，属性名和数据库表名保持一致"><a href="#3-创建user实体类，实现Serializable，属性名和数据库表名保持一致" class="headerlink" title="3. 创建user实体类，实现Serializable，属性名和数据库表名保持一致"></a>3. 创建user实体类，实现Serializable，属性名和数据库表名保持一致</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">2661131928069328685L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> sex;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-创建一个IUserDao接口，或者叫IUserMapper，用户的持久层接口"><a href="#4-创建一个IUserDao接口，或者叫IUserMapper，用户的持久层接口" class="headerlink" title="4. 创建一个IUserDao接口，或者叫IUserMapper，用户的持久层接口"></a>4. 创建一个IUserDao接口，或者叫IUserMapper，用户的持久层接口</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public interface IUserDao &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 查询所有</span><br><span class="line">     *</span><br><span class="line">     * @return 返回用户集合</span><br><span class="line">     *&#x2F;</span><br><span class="line">    List&lt;User&gt; findAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="5-在resources目录下创建一个Mybatis的主配置文件SqlMapConifg-xml，指定映射配置文件的位置"><a href="#5-在resources目录下创建一个Mybatis的主配置文件SqlMapConifg-xml，指定映射配置文件的位置" class="headerlink" title="5. 在resources目录下创建一个Mybatis的主配置文件SqlMapConifg.xml，指定映射配置文件的位置"></a>5. 在resources目录下创建一个Mybatis的主配置文件SqlMapConifg.xml，指定映射配置文件的位置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--mybatis主配置文件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置环境--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置mysql的环境--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置事务的类型--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置数据源（连接池）--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--配置连接数据库的4个基本信息--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/mybatis?serverTimezone=UTC"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"123456"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--指定映射配置文件的位置，映射配置文件指的是每一个dao独立的配置文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"com/ivyzh/dao/IUserMapper.xml"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="6-创建映射配置文件IUserMapper-xml，目录和接口IUserDao-IUserMapper-保持一致"><a href="#6-创建映射配置文件IUserMapper-xml，目录和接口IUserDao-IUserMapper-保持一致" class="headerlink" title="6. 创建映射配置文件IUserMapper.xml，目录和接口IUserDao(IUserMapper)保持一致"></a>6. 创建映射配置文件IUserMapper.xml，目录和接口IUserDao(IUserMapper)保持一致</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;&#x2F;DTD Mapper 3.0&#x2F;&#x2F;EN&quot;</span><br><span class="line">        &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace&#x3D;&quot;com.ivyzh.dao.IUserDao&quot;&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findAll&quot; resultType&#x3D;&quot;com.ivyzh.domain.User&quot;&gt;</span><br><span class="line">        select * from t_user</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br></pre></td></tr></table></figure>



<h3 id="7-编写测试类"><a href="#7-编写测试类" class="headerlink" title="7. 编写测试类"></a>7. 编写测试类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * MyBatis快速入门</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisQuickStart</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. 读取配置文件</span></span><br><span class="line">        InputStream is = Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line">        <span class="comment">//2. 创建SqlSessionFactory工厂</span></span><br><span class="line">        SqlSessionFactoryBuilder builder = <span class="keyword">new</span> SqlSessionFactoryBuilder();</span><br><span class="line">        SqlSessionFactory factory = builder.build(is);</span><br><span class="line">        <span class="comment">//3. 使用工厂生产SqlSession对象</span></span><br><span class="line">        SqlSession sqlSession = factory.openSession();</span><br><span class="line">        <span class="comment">//4. 使用SqlSession创建Dao接口的代理对象</span></span><br><span class="line">        IUserDao userMapper = sqlSession.getMapper(IUserDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">//5. 使用代理对象执行方法</span></span><br><span class="line">        List&lt;User&gt; users = userMapper.findAll();</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//6. 释放资源</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line">        is.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-输出日志"><a href="#8-输出日志" class="headerlink" title="8. 输出日志"></a>8. 输出日志</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User(id&#x3D;1, username&#x3D;AA, password&#x3D;123456, birthday&#x3D;Fri Dec 13 08:00:00 CST 2019, sex&#x3D;true, address&#x3D;北京)</span><br><span class="line">User(id&#x3D;2, username&#x3D;BB, password&#x3D;123456, birthday&#x3D;Tue Dec 10 08:00:00 CST 2019, sex&#x3D;false, address&#x3D;上海)</span><br><span class="line">User(id&#x3D;3, username&#x3D;CC, password&#x3D;123456, birthday&#x3D;Wed Dec 04 08:00:00 CST 2019, sex&#x3D;true, address&#x3D;广州)</span><br></pre></td></tr></table></figure>



<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ul>
<li>解决org.apache.ibatis.binding.BindingException: Type interface xxx is not known to the MapperRegistry<ul>
<li>解决方案：检查定义的接口和实体类映射的接口名是否一致</li>
<li>参考：<a href="https://blog.csdn.net/zeal9s/article/details/83685274" target="_blank" rel="noopener">https://blog.csdn.net/zeal9s/article/details/83685274</a></li>
</ul>
</li>
</ul>
<p><img src="/" class="lazyload" data-src="/img/assets/1576307126198.png"  alt="1576307126198"></p>
<ul>
<li>log4j:WARN No appenders could be found for logger 解决办法<ul>
<li>MyBatis要配合log4j使用</li>
<li>参考：<a href="https://blog.csdn.net/chw0629/article/details/80567936" target="_blank" rel="noopener">https://blog.csdn.net/chw0629/article/details/80567936</a></li>
<li>Log4j入门教程参考：<a href="https://blog.csdn.net/qq_35787138/article/details/81009056" target="_blank" rel="noopener">https://blog.csdn.net/qq_35787138/article/details/81009056</a></li>
</ul>
</li>
</ul>
<p>环境搭建的注意事项：</p>
<p>第一个：创建IUserDao.xml （IUserMapper.xml）和 IUserDao.java时名称是为了和我们之前的知识保持一致。</p>
<p>​    在Mybatis中它把持久层的操作接口名称和映射文件也叫做：Mapper</p>
<p>​    所以：IUserDao 和 IUserMapper是一样的</p>
<p>第二个：在idea中创建目录的时候，它和包是不一样的</p>
<p>​    包在创建时：com.ivyzh.dao它是三级结构</p>
<p>​    目录在创建时：com.ivyzh.dao是一级目录</p>
<p>第三个：mybatis的映射配置文件位置必须和dao接口的包结构相同</p>
<p>第四个：映射配置文件的mapper标签<strong>namespace属性的取值必须是dao接口的全限定类名</strong></p>
<p>第五个：映射配置文件的操作配置（select），<strong>id属性的取值必须是dao接口的方法名</strong></p>
<p>当我们遵从了第三，四，五点之后，我们在开发中就无须再写dao的实现类。</p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>通过快速入门示例，我们发现使用 mybatis 是非常容易的一件事情，因为只需要编写 <strong>Dao 接口</strong>并且按照mybatis 要求编写<strong>两个配置文件（SqlMapCofig.xml和IUserMapper.xml）</strong>，就可以实现功能。远比我们之前的 jdbc 方便多了。（我们使用注解之后，将变得更为简单，只需要编写一个 mybatis 配置文件(SqlMapCofig.xml)就够了。）</p>
<p>但是，这里面包含了许多细节，比如为什么会有工厂对象（SqlSessionFactory）,为什么有了工厂之后还要有构建者对象（SqlSessionFactoryBuilder），为什么 IUserDao.xml 在创建时有位置和文件名的要求等等。</p>
<p>这些问题我们在自定义 mybatis 框架的章节，通过层层剥离的方式，给大家讲解。</p>
<p>请注意：我们讲解自定义 Mybatis 框架，不是让大家回去自己去写个 mybatis，而是让我们能更好的了解mybatis 内部是怎么执行的，在以后的开发中能更好的使用 mybatis 框架，同时对它的设计理念（设计模式）有一个认识。</p>
<h2 id="MyBatis的CRUD操作-注解版本"><a href="#MyBatis的CRUD操作-注解版本" class="headerlink" title="MyBatis的CRUD操作(注解版本)"></a>MyBatis的CRUD操作(注解版本)</h2><p>注：为了演示使用注解版，我们换操作另外一张表t_student，里面的数据和结构和t_user是一模一样的。</p>
<p>先放目录结构和用到的类：</p>
<p><img src="/" class="lazyload" data-src="/img/assets/1576308650936.png"  alt="1576308650936"></p>
<h3 id="1-idea创建一个不用骨架的java-maven项目，导入坐标"><a href="#1-idea创建一个不用骨架的java-maven项目，导入坐标" class="headerlink" title="1. idea创建一个不用骨架的java maven项目，导入坐标"></a>1. idea创建一个不用骨架的java maven项目，导入坐标</h3><h3 id="2-准备数据，sql语句-1"><a href="#2-准备数据，sql语句-1" class="headerlink" title="2. 准备数据，sql语句"></a>2. 准备数据，sql语句</h3><h3 id="3-创建student实体类，实现Serializable，属性名和数据库表名保持一致"><a href="#3-创建student实体类，实现Serializable，属性名和数据库表名保持一致" class="headerlink" title="3. 创建student实体类，实现Serializable，属性名和数据库表名保持一致"></a>3. 创建student实体类，实现Serializable，属性名和数据库表名保持一致</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">4227290463847762031L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> sex;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-创建一个IStudentDao接口，或者叫IUserMapper，用户的持久层接口，使用注解实现增删改查功能-Select"><a href="#4-创建一个IStudentDao接口，或者叫IUserMapper，用户的持久层接口，使用注解实现增删改查功能-Select" class="headerlink" title="4. 创建一个IStudentDao接口，或者叫IUserMapper，用户的持久层接口，使用注解实现增删改查功能@Select"></a>4. 创建一个IStudentDao接口，或者叫IUserMapper，用户的持久层接口，使用注解实现增删改查功能<strong>@Select</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public interface IStudentDao &#123;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 查询所有</span><br><span class="line">     *</span><br><span class="line">     * @return 返回学生集合</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Select(&quot;select * from t_student&quot;)</span><br><span class="line">    List&lt;Student&gt; findAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="5-在resources目录下创建一个Mybatis的主配置文件SqlMapConifg-xml，指定映射配置文件的位置，使用classs属性"><a href="#5-在resources目录下创建一个Mybatis的主配置文件SqlMapConifg-xml，指定映射配置文件的位置，使用classs属性" class="headerlink" title="5. 在resources目录下创建一个Mybatis的主配置文件SqlMapConifg.xml，指定映射配置文件的位置，使用classs属性"></a>5. 在resources目录下创建一个Mybatis的主配置文件SqlMapConifg.xml，指定映射配置文件的位置，<strong>使用classs属性</strong></h3><p>如果使用的注解来配置的话，此处应该使用class属性指定被注解的dao全限定类名：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">        PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;&#x2F;DTD Config 3.0&#x2F;&#x2F;EN&quot;</span><br><span class="line">        &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-config.dtd&quot;&gt;</span><br><span class="line">&lt;!--mybatis主配置文件--&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;!--配置环境--&gt;</span><br><span class="line">    &lt;environments default&#x3D;&quot;development&quot;&gt;</span><br><span class="line">        &lt;!--配置mysql的环境--&gt;</span><br><span class="line">        &lt;environment id&#x3D;&quot;development&quot;&gt;</span><br><span class="line">            &lt;!--配置事务的类型--&gt;</span><br><span class="line">            &lt;transactionManager type&#x3D;&quot;JDBC&quot;&#x2F;&gt;</span><br><span class="line">            &lt;!--配置数据源（连接池）--&gt;</span><br><span class="line">            &lt;dataSource type&#x3D;&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;!--配置连接数据库的4个基本信息--&gt;</span><br><span class="line">                &lt;property name&#x3D;&quot;driver&quot; value&#x3D;&quot;com.mysql.jdbc.Driver&quot;&#x2F;&gt;</span><br><span class="line">                &lt;property name&#x3D;&quot;url&quot; value&#x3D;&quot;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;mybatis?serverTimezone&#x3D;UTC&quot;&#x2F;&gt;</span><br><span class="line">                &lt;property name&#x3D;&quot;username&quot; value&#x3D;&quot;root&quot;&#x2F;&gt;</span><br><span class="line">                &lt;property name&#x3D;&quot;password&quot; value&#x3D;&quot;123456&quot;&#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;dataSource&gt;</span><br><span class="line">        &lt;&#x2F;environment&gt;</span><br><span class="line">    &lt;&#x2F;environments&gt;</span><br><span class="line">    &lt;!--指定映射配置文件的位置，映射配置文件指的是每一个dao独立的配置文件--&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;mapper resource&#x3D;&quot;com&#x2F;ivyzh&#x2F;dao&#x2F;IUserMapper.xml&quot;&#x2F;&gt;</span><br><span class="line">        &lt;!--如果使用的注解来配置的话，此处应该使用class属性指定被注解的dao全限定类名--&gt;</span><br><span class="line">        &lt;mapper class&#x3D;&quot;com.ivyzh.dao.IStudentDao&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;mappers&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br></pre></td></tr></table></figure>



<h3 id="6-创建映射配置文件IUserMapper-xml，目录和接口IUserDao-IUserMapper-保持一致-1"><a href="#6-创建映射配置文件IUserMapper-xml，目录和接口IUserDao-IUserMapper-保持一致-1" class="headerlink" title="6. 创建映射配置文件IUserMapper.xml，目录和接口IUserDao(IUserMapper)保持一致"></a><del>6. 创建映射配置文件IUserMapper.xml，目录和接口IUserDao(IUserMapper)保持一致</del></h3><p>使用注解方式，没有这个步骤。</p>
<h3 id="7-编写测试类-1"><a href="#7-编写测试类-1" class="headerlink" title="7. 编写测试类"></a>7. 编写测试类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * MyBatis快速入门-注解形式</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class StudentTest &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;1. 读取配置文件</span><br><span class="line">        InputStream is &#x3D; Resources.getResourceAsStream(&quot;SqlMapConfig.xml&quot;);</span><br><span class="line">        &#x2F;&#x2F;2. 创建SqlSessionFactory工厂</span><br><span class="line">        SqlSessionFactoryBuilder builder &#x3D; new SqlSessionFactoryBuilder();</span><br><span class="line">        SqlSessionFactory factory &#x3D; builder.build(is);</span><br><span class="line">        &#x2F;&#x2F;3. 使用工厂生产SqlSession对象</span><br><span class="line">        SqlSession sqlSession &#x3D; factory.openSession();</span><br><span class="line">        &#x2F;&#x2F;4. 使用SqlSession创建Dao接口的代理对象</span><br><span class="line">        IStudentDao studentMapper &#x3D; sqlSession.getMapper(IStudentDao.class);</span><br><span class="line">        &#x2F;&#x2F;5. 使用代理对象执行方法</span><br><span class="line">        List&lt;Student&gt; students &#x3D; studentMapper.findAll();</span><br><span class="line">        for (Student student : students) &#123;</span><br><span class="line">            System.out.println(student);</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F;6. 释放资源</span><br><span class="line">        sqlSession.close();</span><br><span class="line">        is.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="8-输出日志-1"><a href="#8-输出日志-1" class="headerlink" title="8. 输出日志"></a>8. 输出日志</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Student(id&#x3D;1, username&#x3D;AA, password&#x3D;123456, birthday&#x3D;Fri Dec 13 08:00:00 CST 2019, sex&#x3D;true, address&#x3D;北京)</span><br><span class="line">Student(id&#x3D;2, username&#x3D;BB, password&#x3D;123456, birthday&#x3D;Tue Dec 10 08:00:00 CST 2019, sex&#x3D;false, address&#x3D;上海)</span><br><span class="line">Student(id&#x3D;3, username&#x3D;CC, password&#x3D;123456, birthday&#x3D;Wed Dec 04 08:00:00 CST 2019, sex&#x3D;true, address&#x3D;广州)</span><br></pre></td></tr></table></figure>



<h3 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h3><ul>
<li>比xml形式省事好多：不用写select标签，配置id，也不用写封装结果resultType</li>
<li>把IUserDao.xml移除，在dao接口的方法上使用@Select注解，并且指定SQL语句</li>
<li>同时需要在SqlMapConfig.xml中的mapper配置时，使用class属性指定dao接口的全限定类名</li>
</ul>
<h2 id="MyBatis的CRUD操作-自己写实现类的方式"><a href="#MyBatis的CRUD操作-自己写实现类的方式" class="headerlink" title="MyBatis的CRUD操作(自己写实现类的方式)"></a>MyBatis的CRUD操作(自己写实现类的方式)</h2><p>常用MyBatis的CRUD方式XML和注解都已经介绍过了，还有一种是dao实现类方式实现CRUD，这种方式不常用，只是证明有这种方式，下面简单演示一下，就以User案例。</p>
<h3 id="1-创建IUserDao的实现类UserDaoImpl"><a href="#1-创建IUserDao的实现类UserDaoImpl" class="headerlink" title="1. 创建IUserDao的实现类UserDaoImpl"></a>1. 创建IUserDao的实现类UserDaoImpl</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public class UserDaoImpl implements IUserDao &#123;</span><br><span class="line"></span><br><span class="line">    private SqlSessionFactory factory;</span><br><span class="line"></span><br><span class="line">    public UserDaoImpl(SqlSessionFactory factory) &#123;</span><br><span class="line">        this.factory &#x3D; factory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public List&lt;User&gt; findAll() &#123;</span><br><span class="line">        &#x2F;&#x2F;使用工厂创建SqlSession对象</span><br><span class="line">        SqlSession sqlSession &#x3D; factory.openSession();</span><br><span class="line">        &#x2F;&#x2F;使用sqlSession执行查询所有方法</span><br><span class="line">        List&lt;User&gt; users &#x3D; sqlSession.selectList(&quot;com.ivyzh.dao.IUserDao.findAll&quot;);</span><br><span class="line">        sqlSession.close();</span><br><span class="line">        &#x2F;&#x2F;返回结果集</span><br><span class="line">        return users;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-测试方法"><a href="#2-测试方法" class="headerlink" title="2. 测试方法"></a>2. 测试方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * MyBatis快速入门-Dao实现类形式</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class UserImplTest &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;1. 读取配置文件</span><br><span class="line">        InputStream is &#x3D; Resources.getResourceAsStream(&quot;SqlMapConfig.xml&quot;);</span><br><span class="line">        &#x2F;&#x2F;2. 创建SqlSessionFactory工厂</span><br><span class="line">        SqlSessionFactoryBuilder builder &#x3D; new SqlSessionFactoryBuilder();</span><br><span class="line">        SqlSessionFactory factory &#x3D; builder.build(is);</span><br><span class="line">        &#x2F;&#x2F;3. 创建IUserDao实现类对象</span><br><span class="line">        IUserDao userDao &#x3D; new UserDaoImpl(factory);</span><br><span class="line">        &#x2F;&#x2F;4. 调用查询方法</span><br><span class="line">        List&lt;User&gt; users &#x3D; userDao.findAll();</span><br><span class="line">        for (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F;5. 释放资源</span><br><span class="line">        is.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-输出日志"><a href="#3-输出日志" class="headerlink" title="3. 输出日志"></a>3. 输出日志</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User(id&#x3D;1, username&#x3D;AA, password&#x3D;123456, birthday&#x3D;Fri Dec 13 08:00:00 CST 2019, sex&#x3D;true, address&#x3D;北京)</span><br><span class="line">User(id&#x3D;2, username&#x3D;BB, password&#x3D;123456, birthday&#x3D;Tue Dec 10 08:00:00 CST 2019, sex&#x3D;false, address&#x3D;上海)</span><br><span class="line">User(id&#x3D;3, username&#x3D;CC, password&#x3D;123456, birthday&#x3D;Wed Dec 04 08:00:00 CST 2019, sex&#x3D;true, address&#x3D;广州)</span><br></pre></td></tr></table></figure>





<h2 id="完整版MyBatis的CRUD操作-基于xml版本"><a href="#完整版MyBatis的CRUD操作-基于xml版本" class="headerlink" title="完整版MyBatis的CRUD操作(基于xml版本)"></a>完整版MyBatis的CRUD操作(基于xml版本)</h2><p>上面的3种实现方式（XML、注解、dao实现）只是实现了findAll方法，接下来我们要真正实现增删改查功能了，是基于XML形式的，使用的表是Teacher了，数据格式和之前是User、Student是一模一样的，用户名改成TAA、TBB、TCC吧。</p>
<p>实现步骤就不具体列举了，直接贴代码</p>
<h3 id="基础功能"><a href="#基础功能" class="headerlink" title="基础功能"></a>基础功能</h3><ul>
<li>基本的增删改查包含如下功能<ul>
<li>查询所有</li>
<li>新增</li>
<li>删除</li>
<li>查询单条记录</li>
<li>获取总记录数</li>
<li>模糊查询，两种方式</li>
<li>扩展：新增用户id的返回</li>
</ul>
</li>
</ul>
<p>Teacher实体类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">public class Teacher implements Serializable &#123;</span><br><span class="line">    private static final long serialVersionUID &#x3D; -4399789553021464706L;</span><br><span class="line">    private int id;</span><br><span class="line">    private String username;</span><br><span class="line">    private String password;</span><br><span class="line">    private Date birthday;</span><br><span class="line">    private boolean sex;</span><br><span class="line">    private String address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>ITeacherDao实现类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">public interface ITeacherDao &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 查询所有</span><br><span class="line">     *</span><br><span class="line">     * @return 返回老师集合</span><br><span class="line">     *&#x2F;</span><br><span class="line">    List&lt;Teacher&gt; findAll();</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 保存操作</span><br><span class="line">     *</span><br><span class="line">     * @param teacher 老师数据</span><br><span class="line">     *&#x2F;</span><br><span class="line">    void saveTeacher(Teacher teacher);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 保存操作：问题拓展，新增用户id的返回</span><br><span class="line">     *</span><br><span class="line">     * @param teacher 老师数据</span><br><span class="line">     *&#x2F;</span><br><span class="line">    void saveTeacher2(Teacher teacher);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 更新操作</span><br><span class="line">     *</span><br><span class="line">     * @param teacher 老师数据</span><br><span class="line">     *&#x2F;</span><br><span class="line">    void updateTeacher(Teacher teacher);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 删除操作</span><br><span class="line">     *</span><br><span class="line">     * @param id 编号id</span><br><span class="line">     *&#x2F;</span><br><span class="line">    void deleteTeacher(Integer id);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 查询一个，根据id查询</span><br><span class="line">     *</span><br><span class="line">     * @param id 用户id</span><br><span class="line">     * @return 用户数据</span><br><span class="line">     *&#x2F;</span><br><span class="line">    Teacher findById(Integer id);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 模糊查询，根据用户名查询</span><br><span class="line">     *</span><br><span class="line">     * @param username 用户名</span><br><span class="line">     * @return 用户数据列表</span><br><span class="line">     *&#x2F;</span><br><span class="line">    List&lt;Teacher&gt; findByName(String username);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 模糊查询，根据用户名查询，方式2</span><br><span class="line">     *</span><br><span class="line">     * @param username 用户名</span><br><span class="line">     * @return 用户数据列表</span><br><span class="line">     *&#x2F;</span><br><span class="line">    List&lt;Teacher&gt; findByName2(String username);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 获取总记录数</span><br><span class="line">     *</span><br><span class="line">     * @return 总记录数</span><br><span class="line">     *&#x2F;</span><br><span class="line">    Integer findTotal();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ITeacherMapper.xml文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;&#x2F;DTD Mapper 3.0&#x2F;&#x2F;EN&quot;</span><br><span class="line">        &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace&#x3D;&quot;com.ivyzh.dao.ITeacherDao&quot;&gt;</span><br><span class="line">    &lt;!--查询所有--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findAll&quot; resultType&#x3D;&quot;com.ivyzh.domain.Teacher&quot;&gt;</span><br><span class="line">         select * from t_teacher</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--保存操作--&gt;</span><br><span class="line">    &lt;insert id&#x3D;&quot;saveTeacher&quot; parameterType&#x3D;&quot;com.ivyzh.domain.Teacher&quot;&gt;</span><br><span class="line">        insert into t_teacher(username,password,birthday,sex,address) values (#&#123;username&#125;,#&#123;password&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;)</span><br><span class="line">    &lt;&#x2F;insert&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--保存操作，问题拓展，新增用户id的返回--&gt;</span><br><span class="line">    &lt;insert id&#x3D;&quot;saveTeacher2&quot; parameterType&#x3D;&quot;com.ivyzh.domain.Teacher&quot;&gt;</span><br><span class="line">        &#x2F;*keyProperty:属性名，keyColumn数据库中字段名*&#x2F;</span><br><span class="line">        &lt;selectKey keyProperty&#x3D;&quot;id&quot; keyColumn&#x3D;&quot;id&quot; resultType&#x3D;&quot;java.lang.Integer&quot; order&#x3D;&quot;AFTER&quot;&gt;</span><br><span class="line">            select last_insert_id();</span><br><span class="line">        &lt;&#x2F;selectKey&gt;</span><br><span class="line">        insert into t_teacher(username,password,birthday,sex,address) values</span><br><span class="line">        (#&#123;username&#125;,#&#123;password&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;)</span><br><span class="line">    &lt;&#x2F;insert&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--更新操作--&gt;</span><br><span class="line">    &lt;update id&#x3D;&quot;updateTeacher&quot; parameterType&#x3D;&quot;com.ivyzh.domain.Teacher&quot;&gt;</span><br><span class="line">        update t_teacher set username&#x3D;#&#123;username&#125;,password&#x3D;#&#123;password&#125;,birthday&#x3D;#&#123;birthday&#125;,sex&#x3D;#&#123;sex&#125;,address&#x3D;#&#123;address&#125; where id &#x3D; #&#123;id&#125;</span><br><span class="line">    &lt;&#x2F;update&gt;</span><br><span class="line">    &lt;!--删除操作，只有一个参数的时候mapper可以随便写，这是一个占位符--&gt;</span><br><span class="line">    &lt;delete id&#x3D;&quot;deleteTeacher&quot; parameterType&#x3D;&quot;java.lang.Integer&quot;&gt;</span><br><span class="line">        delete from t_teacher where id&#x3D;#&#123;uid&#125;</span><br><span class="line">    &lt;&#x2F;delete&gt;</span><br><span class="line">    &lt;!--查询一个，根据id查询--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findById&quot; parameterType&#x3D;&quot;java.lang.Integer&quot; resultType&#x3D;&quot;com.ivyzh.domain.Teacher&quot;&gt;</span><br><span class="line">         select * from t_teacher where id&#x3D;#&#123;id&#125;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--模糊查询方式1--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findByName&quot; parameterType&#x3D;&quot;java.lang.String&quot; resultType&#x3D;&quot;com.ivyzh.domain.Teacher&quot;&gt;</span><br><span class="line">         select * from t_teacher where username like #&#123;username&#125;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">    &lt;!--模糊查询方式2,了解这种写法就好,实际开发中，不要用value--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findByName2&quot; parameterType&#x3D;&quot;java.lang.String&quot; resultType&#x3D;&quot;com.ivyzh.domain.Teacher&quot;&gt;</span><br><span class="line">         select * from t_teacher where username like &#39;%$&#123;value&#125;%&#39;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--mybatis也支持聚合函数，支持返回一行一列，获取总记录数--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findTotal&quot; resultType&#x3D;&quot;java.lang.Integer&quot;&gt;</span><br><span class="line">         select count(id) from t_teacher</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br></pre></td></tr></table></figure>



<p>SqlMapConfig.xml文件：配置映射文件的位置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">        PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;&#x2F;DTD Config 3.0&#x2F;&#x2F;EN&quot;</span><br><span class="line">        &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-config.dtd&quot;&gt;</span><br><span class="line">&lt;!--mybatis主配置文件--&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;!--配置环境--&gt;</span><br><span class="line">    &lt;environments default&#x3D;&quot;development&quot;&gt;</span><br><span class="line">        &lt;!--配置mysql的环境--&gt;</span><br><span class="line">        &lt;environment id&#x3D;&quot;development&quot;&gt;</span><br><span class="line">            &lt;!--配置事务的类型--&gt;</span><br><span class="line">            &lt;transactionManager type&#x3D;&quot;JDBC&quot;&#x2F;&gt;</span><br><span class="line">            &lt;!--配置数据源（连接池）--&gt;</span><br><span class="line">            &lt;dataSource type&#x3D;&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;!--配置连接数据库的4个基本信息--&gt;</span><br><span class="line">                &lt;property name&#x3D;&quot;driver&quot; value&#x3D;&quot;com.mysql.jdbc.Driver&quot;&#x2F;&gt;</span><br><span class="line">                &lt;property name&#x3D;&quot;url&quot; value&#x3D;&quot;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;mybatis?serverTimezone&#x3D;UTC&quot;&#x2F;&gt;</span><br><span class="line">                &lt;property name&#x3D;&quot;username&quot; value&#x3D;&quot;root&quot;&#x2F;&gt;</span><br><span class="line">                &lt;property name&#x3D;&quot;password&quot; value&#x3D;&quot;123456&quot;&#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;dataSource&gt;</span><br><span class="line">        &lt;&#x2F;environment&gt;</span><br><span class="line">    &lt;&#x2F;environments&gt;</span><br><span class="line">    &lt;!--指定映射配置文件的位置，映射配置文件指的是每一个dao独立的配置文件--&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;mapper resource&#x3D;&quot;com&#x2F;ivyzh&#x2F;dao&#x2F;IUserMapper.xml&quot;&#x2F;&gt;</span><br><span class="line">        &lt;mapper resource&#x3D;&quot;com&#x2F;ivyzh&#x2F;dao&#x2F;ITeacherMapper.xml&quot;&#x2F;&gt;</span><br><span class="line">        &lt;!--如果使用的注解来配置的话，此处应该使用class属性指定被注解的dao全限定类名--&gt;</span><br><span class="line">        &lt;mapper class&#x3D;&quot;com.ivyzh.dao.IStudentDao&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;mappers&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br></pre></td></tr></table></figure>



<p>以上需要注意的地方有：<strong>findByName2</strong>、<strong>saveTeacher2</strong> 两个方法，分别演示了模糊查询和新增用户id的返回问题。</p>
<h3 id="入参深入-使用实体类的包装对象作为查询条件OGNL"><a href="#入参深入-使用实体类的包装对象作为查询条件OGNL" class="headerlink" title="入参深入-使用实体类的包装对象作为查询条件OGNL"></a>入参深入-使用实体类的包装对象作为查询条件OGNL</h3><p>parameterType类型：3种</p>
<ul>
<li><p>基础类型，如查询一个，parameterType=”java.lang.Integer”</p>
<ul>
<li>java.lang.Integer，可以写成Integer或者int都行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--查询一个，根据id查询--&gt;</span><br><span class="line">&lt;select id&#x3D;&quot;findById&quot; parameterType&#x3D;&quot;java.lang.Integer&quot; resultType&#x3D;&quot;com.ivyzh.domain.Teacher&quot;&gt;</span><br><span class="line">         select * from t_teacher where id&#x3D;#&#123;id&#125;</span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>传递pojo对象：如更新操作，传递的就是Teacher对象</p>
<ul>
<li>MyBatis使用ognl表达式解析对象字段的值，#{}或者${}括号中的值为pojo属性名称</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--更新操作--&gt;</span><br><span class="line">&lt;update id&#x3D;&quot;updateTeacher&quot; parameterType&#x3D;&quot;com.ivyzh.domain.Teacher&quot;&gt;</span><br><span class="line">        update t_teacher set username&#x3D;#&#123;username&#125;,password&#x3D;#&#123;password&#125;,birthday&#x3D;#&#123;birthday&#125;,sex&#x3D;#&#123;sex&#125;,address&#x3D;#&#123;address&#125; where id &#x3D; #&#123;id&#125;</span><br><span class="line">&lt;&#x2F;update&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>传递pojo对象：如根据用户名查询用户信息，查询条件放到QueryVo的teacher属性中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--根据queryVo的条件查询用户--&gt;</span><br><span class="line">&lt;select id&#x3D;&quot;findByVo&quot; parameterType&#x3D;&quot;com.ivyzh.domain.QueryVo&quot; resultType&#x3D;&quot;com.ivyzh.domain.Teacher&quot;&gt;</span><br><span class="line">         select * from t_teacher where username like #&#123;teacher.username&#125;</span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>





</li>
</ul>
<p>OGNL表达式：（Apache）</p>
<p>​    Object Graphic Navigation Language</p>
<p>​    对象    图    导航       语言</p>
<p>它是通过对象的取值方法来获取数据。在写法上把get给省略了。</p>
<p>​    比如：我们获取用户的名称</p>
<p>​        类中的写法：user.getUsername();</p>
<p>​        OGNL表达式写法：user.username</p>
<p>​    mybatis中为什么能直接写username,而不用user.呢：</p>
<p>​        因为在parameterType中已经提供了属性所属的类，所以此时不需要写对象名</p>
<p><strong>演示：根据用户名查询用户信息，查询条件放到QueryVo的teacher属性中</strong></p>
<p>QueryVo类，放在了<code>package com.ivyzh.domain</code>包下面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">public class QueryVo &#123;</span><br><span class="line">    private Teacher teacher;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>ITeacherMapp.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;mapper&gt;</span><br><span class="line"></span><br><span class="line">	....</span><br><span class="line"></span><br><span class="line">	&lt;!--根据queryVo的条件查询用户--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findByVo&quot; parameterType&#x3D;&quot;com.ivyzh.domain.QueryVo&quot; resultType&#x3D;&quot;com.ivyzh.domain.Teacher&quot;&gt;</span><br><span class="line">         select * from t_teacher where username like #&#123;teacher.username&#125;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br></pre></td></tr></table></figure>



<p>TeacherTest.java测试类方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testFindByVo() &#123;</span><br><span class="line">    ITeacherDao mapper &#x3D; sqlSession.getMapper(ITeacherDao.class);</span><br><span class="line">    QueryVo vo &#x3D; new QueryVo();</span><br><span class="line">    Teacher teacher &#x3D; new Teacher();</span><br><span class="line">    teacher.setUsername(&quot;%zs%&quot;);</span><br><span class="line">    vo.setTeacher(teacher);</span><br><span class="line">    List&lt;Teacher&gt; teachers &#x3D; mapper.findByVo(vo);</span><br><span class="line">    for (Teacher t : teachers) &#123;</span><br><span class="line">        System.out.println(t);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>输出日志：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Teacher(id&#x3D;10, username&#x3D;zs1, password&#x3D;123456, birthday&#x3D;Sat Dec 14 08:00:00 CST 2019, sex&#x3D;false, address&#x3D;杭州)</span><br><span class="line">Teacher(id&#x3D;12, username&#x3D;zs2, password&#x3D;123456, birthday&#x3D;Sat Dec 14 08:00:00 CST 2019, sex&#x3D;false, address&#x3D;杭州)</span><br><span class="line">Teacher(id&#x3D;13, username&#x3D;zs3, password&#x3D;123456, birthday&#x3D;Sat Dec 14 08:00:00 CST 2019, sex&#x3D;false, address&#x3D;杭州)</span><br></pre></td></tr></table></figure>



<h3 id="返回值深入-实体类属性和数据库列名不对应"><a href="#返回值深入-实体类属性和数据库列名不对应" class="headerlink" title="返回值深入-实体类属性和数据库列名不对应"></a>返回值深入-<strong>实体类属性和数据库列名不对应</strong></h3><p>场景解释：就是数据库字段和自定义的实体类的属性名不是一一对应，那会是怎样呢？</p>
<p>为了演示这样一个问题，我们copy一份t_teacher数据，然后创建t_worker数据库来演示，里面的内容结构和之前的都一样，如下：</p>
<p><img src="/" class="lazyload" data-src="/img/assets/1576476240182.png"  alt="1576476240182"></p>
<p>接下来就是copy之前的Worker实体类、IWorkerDao接口、Mapper、测试类、SqlMapperConfig</p>
<p><strong>Worker实体类：</strong></p>
<p>Teacher的实体类是这样的，是和数据库字段一样的，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">public class Teacher implements Serializable &#123;</span><br><span class="line">    private static final long serialVersionUID &#x3D; -4399789553021464706L;</span><br><span class="line">    private int id;</span><br><span class="line">    private String username;</span><br><span class="line">    private String password;</span><br><span class="line">    private Date birthday;</span><br><span class="line">    private boolean sex;</span><br><span class="line">    private String address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们做一下简单的修改，每个字段前面加一个user：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">public class Worker implements Serializable &#123;</span><br><span class="line">    private static final long serialVersionUID &#x3D; -4399789553021464706L;</span><br><span class="line">    private int userId;</span><br><span class="line">    private String userName;</span><br><span class="line">    private String userPassword;</span><br><span class="line">    private Date userBirthday;</span><br><span class="line">    private boolean userSex;</span><br><span class="line">    private String userAddress;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>IWorkerDao接口：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">public interface IWorkerDao &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 查询所有</span><br><span class="line">     *</span><br><span class="line">     * @return 返回老师集合</span><br><span class="line">     *&#x2F;</span><br><span class="line">    List&lt;Worker&gt; findAll();</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 保存操作</span><br><span class="line">     *</span><br><span class="line">     * @param worker 老师数据</span><br><span class="line">     *&#x2F;</span><br><span class="line">    void saveWorker(Worker worker);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 保存操作：问题拓展，新增用户id的返回</span><br><span class="line">     *</span><br><span class="line">     * @param worker 老师数据</span><br><span class="line">     *&#x2F;</span><br><span class="line">    void saveWorker2(Worker worker);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 更新操作</span><br><span class="line">     *</span><br><span class="line">     * @param worker 老师数据</span><br><span class="line">     *&#x2F;</span><br><span class="line">    void updateWorker(Worker worker);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 删除操作</span><br><span class="line">     *</span><br><span class="line">     * @param id 编号id</span><br><span class="line">     *&#x2F;</span><br><span class="line">    void deleteWorker(Integer id);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 查询一个，根据id查询</span><br><span class="line">     *</span><br><span class="line">     * @param id 用户id</span><br><span class="line">     * @return 用户数据</span><br><span class="line">     *&#x2F;</span><br><span class="line">    Worker findById(Integer id);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 模糊查询，根据用户名查询</span><br><span class="line">     *</span><br><span class="line">     * @param username 用户名</span><br><span class="line">     * @return 用户数据列表</span><br><span class="line">     *&#x2F;</span><br><span class="line">    List&lt;Worker&gt; findByName(String username);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 模糊查询，根据用户名查询，方式2</span><br><span class="line">     *</span><br><span class="line">     * @param username 用户名</span><br><span class="line">     * @return 用户数据列表</span><br><span class="line">     *&#x2F;</span><br><span class="line">    List&lt;Worker&gt; findByName2(String username);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 获取总记录数</span><br><span class="line">     *</span><br><span class="line">     * @return 总记录数</span><br><span class="line">     *&#x2F;</span><br><span class="line">    Integer findTotal();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>IWorkerMapper.xml：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;&#x2F;DTD Mapper 3.0&#x2F;&#x2F;EN&quot;</span><br><span class="line">        &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace&#x3D;&quot;com.ivyzh.dao.IWorkerDao&quot;&gt;</span><br><span class="line">    &lt;!--查询所有--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findAll&quot; resultType&#x3D;&quot;com.ivyzh.domain.Worker&quot;&gt;</span><br><span class="line">         select * from t_worker</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--保存操作--&gt;</span><br><span class="line">    &lt;insert id&#x3D;&quot;saveWorker&quot; parameterType&#x3D;&quot;com.ivyzh.domain.Worker&quot;&gt;</span><br><span class="line">        insert into t_worker(username,password,birthday,sex,address) values (#&#123;userName&#125;,#&#123;userPassword&#125;,#&#123;userBirthday&#125;,#&#123;userSex&#125;,#&#123;userAddress&#125;)</span><br><span class="line">    &lt;&#x2F;insert&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--保存操作，问题拓展，新增用户id的返回--&gt;</span><br><span class="line">    &lt;insert id&#x3D;&quot;saveWorker2&quot; parameterType&#x3D;&quot;com.ivyzh.domain.Worker&quot;&gt;</span><br><span class="line">        &#x2F;*keyProperty:属性名，keyColumn数据库中字段名*&#x2F;</span><br><span class="line">        &lt;selectKey keyProperty&#x3D;&quot;userId&quot; keyColumn&#x3D;&quot;id&quot; resultType&#x3D;&quot;java.lang.Integer&quot; order&#x3D;&quot;AFTER&quot;&gt;</span><br><span class="line">            select last_insert_id();</span><br><span class="line">        &lt;&#x2F;selectKey&gt;</span><br><span class="line">        insert into t_worker(username,password,birthday,sex,address) values</span><br><span class="line">        (#&#123;userName&#125;,#&#123;userPassword&#125;,#&#123;userBirthday&#125;,#&#123;userSex&#125;,#&#123;userAddress&#125;)</span><br><span class="line">    &lt;&#x2F;insert&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--更新操作--&gt;</span><br><span class="line">    &lt;update id&#x3D;&quot;updateWorker&quot; parameterType&#x3D;&quot;com.ivyzh.domain.Worker&quot;&gt;</span><br><span class="line">        update t_worker set username&#x3D;#&#123;userName&#125;,password&#x3D;#&#123;userPassword&#125;,birthday&#x3D;#&#123;userBirthday&#125;,sex&#x3D;#&#123;userSex&#125;,address&#x3D;#&#123;userAddress&#125; where id &#x3D; #&#123;userId&#125;</span><br><span class="line">    &lt;&#x2F;update&gt;</span><br><span class="line">    &lt;!--删除操作，只有一个参数的时候mapper可以随便写，这是一个占位符--&gt;</span><br><span class="line">    &lt;delete id&#x3D;&quot;deleteWorker&quot; parameterType&#x3D;&quot;java.lang.Integer&quot;&gt;</span><br><span class="line">        delete from t_worker where id&#x3D;#&#123;uid&#125;</span><br><span class="line">    &lt;&#x2F;delete&gt;</span><br><span class="line">    &lt;!--查询一个，根据id查询--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findById&quot; parameterType&#x3D;&quot;java.lang.Integer&quot; resultType&#x3D;&quot;com.ivyzh.domain.Worker&quot;&gt;</span><br><span class="line">         select * from t_worker where id&#x3D;#&#123;id&#125;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--模糊查询方式1--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findByName&quot; parameterType&#x3D;&quot;java.lang.String&quot; resultType&#x3D;&quot;com.ivyzh.domain.Worker&quot;&gt;</span><br><span class="line">         select * from t_worker where username like #&#123;userName&#125;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">    &lt;!--模糊查询方式2,了解这种写法就好,实际开发中，不要用value--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findByName2&quot; parameterType&#x3D;&quot;java.lang.String&quot; resultType&#x3D;&quot;com.ivyzh.domain.Worker&quot;&gt;</span><br><span class="line">         select * from t_worker where username like &#39;%$&#123;value&#125;%&#39;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--mybatis也支持聚合函数，支持返回一行一列，获取总记录数--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findTotal&quot; resultType&#x3D;&quot;java.lang.Integer&quot;&gt;</span><br><span class="line">         select count(id) from t_worker</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br></pre></td></tr></table></figure>

<p>注意这里的findAll、findById、findByName、findByName2这几个方法如果不修改是有问题的。</p>
<p>这里先简单说下情况就是调用findAll之后的方法，日志如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Worker(userId&#x3D;0, userName&#x3D;TAA, userPassword&#x3D;null, userBirthday&#x3D;null, userSex&#x3D;false, userAddress&#x3D;null)</span><br><span class="line">Worker(userId&#x3D;0, userName&#x3D;TBB, userPassword&#x3D;null, userBirthday&#x3D;null, userSex&#x3D;false, userAddress&#x3D;null)</span><br><span class="line">Worker(userId&#x3D;0, userName&#x3D;TCC, userPassword&#x3D;null, userBirthday&#x3D;null, userSex&#x3D;false, userAddress&#x3D;null)</span><br></pre></td></tr></table></figure>

<p>可以发现只有userName字段查出来了，为什么呢？因为mysql在windows环境下不区分大小写！</p>
<p><strong>SqlMapConfig.xml：</strong></p>
<p>加入IWorkerMapper映射配置文件的位置，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;mappers&gt;</span><br><span class="line">	&lt;mapper resource&#x3D;&quot;com&#x2F;ivyzh&#x2F;dao&#x2F;IUserMapper.xml&quot;&#x2F;&gt;</span><br><span class="line">	&lt;mapper resource&#x3D;&quot;com&#x2F;ivyzh&#x2F;dao&#x2F;ITeacherMapper.xml&quot;&#x2F;&gt;</span><br><span class="line">	&lt;mapper resource&#x3D;&quot;com&#x2F;ivyzh&#x2F;dao&#x2F;IWorkerMapper.xml&quot;&#x2F;&gt;</span><br><span class="line">    &lt;!--如果使用的注解来配置的话，此处应该使用class属性指定被注解的dao全限定类名--&gt;</span><br><span class="line">	&lt;mapper class&#x3D;&quot;com.ivyzh.dao.IStudentDao&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;mappers&gt;</span><br></pre></td></tr></table></figure>



<p><strong>WorkerTest测试类：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * MyBatis快速入门-Worker基于XML形式的增删改查测试</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class WorkerTest &#123;</span><br><span class="line"></span><br><span class="line">    InputStream is;</span><br><span class="line">    SqlSession sqlSession;</span><br><span class="line"></span><br><span class="line">    @Before</span><br><span class="line">    public void init() throws IOException &#123;</span><br><span class="line">        &#x2F;&#x2F;1. 读取配置文件</span><br><span class="line">        is &#x3D; Resources.getResourceAsStream(&quot;SqlMapConfig.xml&quot;);</span><br><span class="line">        &#x2F;&#x2F;2. 创建SqlSessionFactory工厂</span><br><span class="line">        SqlSessionFactoryBuilder builder &#x3D; new SqlSessionFactoryBuilder();</span><br><span class="line">        SqlSessionFactory factory &#x3D; builder.build(is);</span><br><span class="line">        &#x2F;&#x2F;3. 使用工厂生产SqlSession对象</span><br><span class="line">        sqlSession &#x3D; factory.openSession();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 查询所有用户数据</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void testFindAll() &#123;</span><br><span class="line">        IWorkerDao mapper &#x3D; sqlSession.getMapper(IWorkerDao.class);</span><br><span class="line">        List&lt;Worker&gt; workers &#x3D; mapper.findAll();</span><br><span class="line">        for (Worker worker : workers) &#123;</span><br><span class="line">            System.out.println(worker);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 保存操作</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void testSave() &#123;</span><br><span class="line">        IWorkerDao mapper &#x3D; sqlSession.getMapper(IWorkerDao.class);</span><br><span class="line">        Worker t &#x3D; new Worker(0, &quot;zs14&quot;, &quot;123456&quot;, new Date(), false, &quot;杭州&quot;);</span><br><span class="line">        mapper.saveWorker(t);</span><br><span class="line">        List&lt;Worker&gt; workers &#x3D; mapper.findAll();</span><br><span class="line">        for (Worker worker : workers) &#123;</span><br><span class="line">            System.out.println(worker);</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F;提交事务，或者放到destory里面</span><br><span class="line">        &#x2F;&#x2F;sqlSession.commit();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 保存操作</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void testSave2() &#123;</span><br><span class="line">        IWorkerDao mapper &#x3D; sqlSession.getMapper(IWorkerDao.class);</span><br><span class="line">        Worker t &#x3D; new Worker(0, &quot;zs15&quot;, &quot;123456&quot;, new Date(), false, &quot;杭州&quot;);</span><br><span class="line">        System.out.println(&quot;保存操作之前：&quot; + t);</span><br><span class="line">        mapper.saveWorker2(t);</span><br><span class="line">        System.out.println(&quot;保存操作之后：&quot; + t);</span><br><span class="line">        List&lt;Worker&gt; workers &#x3D; mapper.findAll();</span><br><span class="line">        for (Worker worker : workers) &#123;</span><br><span class="line">            System.out.println(worker);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testUpdate() &#123;</span><br><span class="line">        IWorkerDao mapper &#x3D; sqlSession.getMapper(IWorkerDao.class);</span><br><span class="line">        Worker t &#x3D; new Worker(13, &quot;zs13&quot;, &quot;&quot;, new Date(), true, &quot;南京&quot;);</span><br><span class="line">        mapper.updateWorker(t);</span><br><span class="line">        List&lt;Worker&gt; workers &#x3D; mapper.findAll();</span><br><span class="line">        for (Worker worker : workers) &#123;</span><br><span class="line">            System.out.println(worker);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testDelete() &#123;</span><br><span class="line">        IWorkerDao mapper &#x3D; sqlSession.getMapper(IWorkerDao.class);</span><br><span class="line">        mapper.deleteWorker(6);</span><br><span class="line">        List&lt;Worker&gt; workers &#x3D; mapper.findAll();</span><br><span class="line">        for (Worker worker : workers) &#123;</span><br><span class="line">            System.out.println(worker);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testFindById() &#123;</span><br><span class="line">        IWorkerDao mapper &#x3D; sqlSession.getMapper(IWorkerDao.class);</span><br><span class="line">        Worker worker &#x3D; mapper.findById(1);</span><br><span class="line">        System.out.println(worker);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testFindByName() &#123;</span><br><span class="line">        IWorkerDao mapper &#x3D; sqlSession.getMapper(IWorkerDao.class);</span><br><span class="line">        List&lt;Worker&gt; workers &#x3D; mapper.findByName(&quot;%T%&quot;);</span><br><span class="line">        for (Worker worker : workers) &#123;</span><br><span class="line">            System.out.println(worker);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testFindByName2() &#123;</span><br><span class="line">        IWorkerDao mapper &#x3D; sqlSession.getMapper(IWorkerDao.class);</span><br><span class="line">        List&lt;Worker&gt; workers &#x3D; mapper.findByName2(&quot;T&quot;);</span><br><span class="line">        for (Worker worker : workers) &#123;</span><br><span class="line">            System.out.println(worker);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testFindTotal() &#123;</span><br><span class="line">        IWorkerDao mapper &#x3D; sqlSession.getMapper(IWorkerDao.class);</span><br><span class="line">        Integer total &#x3D; mapper.findTotal();</span><br><span class="line">        System.out.println(&quot;total -&gt; &quot; + total);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @After</span><br><span class="line">    public void destory() throws IOException &#123;</span><br><span class="line">        &#x2F;&#x2F;提交事务，或者放到destory里面</span><br><span class="line">        sqlSession.commit();</span><br><span class="line">        &#x2F;&#x2F;6. 释放资源</span><br><span class="line">        sqlSession.close();</span><br><span class="line">        is.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>问题解决</strong></p>
<p>可以发现在查询的时候，并没有将查询字段封装到Domain实体类里面，那么该怎么解决呢？这里有两个方案</p>
<ol>
<li>起别名</li>
<li>使用resultMap</li>
</ol>
<ul>
<li><p>起别名</p>
<p>这种方式是执行最快的，比如这里我只修改findAll方法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--查询所有--&gt;</span><br><span class="line">&lt;select id&#x3D;&quot;findAll&quot; resultType&#x3D;&quot;com.ivyzh.domain.Worker&quot;&gt;</span><br><span class="line">    select id as userId,username as userName,password as userPassword,birthday as userBirthday,sex as userSex,address as userAddress from t_worker</span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Worker(userId&#x3D;1, userName&#x3D;TAA, userPassword&#x3D;123456, userBirthday&#x3D;Fri Dec 13 08:00:00 CST 2019, userSex&#x3D;true, userAddress&#x3D;北京)</span><br><span class="line">Worker(userId&#x3D;2, userName&#x3D;TBB, userPassword&#x3D;123456, userBirthday&#x3D;Tue Dec 10 08:00:00 CST 2019, userSex&#x3D;false, userAddress&#x3D;上海)</span><br><span class="line">Worker(userId&#x3D;3, userName&#x3D;TCC, userPassword&#x3D;123456, userBirthday&#x3D;Wed Dec 04 08:00:00 CST 2019, userSex&#x3D;true, userAddress&#x3D;广州)</span><br></pre></td></tr></table></figure>

<p>可以发现数据已经填充好了。</p>
</li>
<li><p>使用resultMap</p>
<p>即配置查询结果的列名和实体类的属性名对应关系</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;mapper namespace&#x3D;&quot;com.ivyzh.dao.IWorkerDao&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--配置查询结果的列名和实体类的属性名的对应关系--&gt;</span><br><span class="line">    &lt;resultMap id&#x3D;&quot;workerMap&quot; type&#x3D;&quot;com.ivyzh.domain.Worker&quot;&gt;</span><br><span class="line">        &lt;!--主键字段的对应，property:对应实体类，column：对应数据库列名--&gt;</span><br><span class="line">        &lt;id property&#x3D;&quot;userId&quot; column&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">        &lt;!--非主键字段的对应--&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;userName&quot; column&#x3D;&quot;username&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;userPassword&quot; column&#x3D;&quot;password&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;userSex&quot; column&#x3D;&quot;sex&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;userAddress&quot; column&#x3D;&quot;address&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;resultMap&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;!--查询一个，根据id查询--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findById&quot; parameterType&#x3D;&quot;java.lang.Integer&quot; resultMap&#x3D;&quot;workerMap&quot;&gt;</span><br><span class="line">         select * from t_worker where id&#x3D;#&#123;id&#125;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!--模糊查询方式1--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findByName&quot; parameterType&#x3D;&quot;java.lang.String&quot; resultMap&#x3D;&quot;workerMap&quot;&gt;</span><br><span class="line">         select * from t_worker where username like #&#123;userName&#125;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!--模糊查询方式2,了解这种写法就好,实际开发中，不要用value--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findByName2&quot; parameterType&#x3D;&quot;java.lang.String&quot; resultMap&#x3D;&quot;workerMap&quot;&gt;</span><br><span class="line">         select * from t_worker where username like &#39;%$&#123;value&#125;%&#39;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">    ...</span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br></pre></td></tr></table></figure>

<p>这样调用findByName方法，就会打印如下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Worker(userId&#x3D;1, userName&#x3D;TAA, userPassword&#x3D;123456, userBirthday&#x3D;null, userSex&#x3D;true, userAddress&#x3D;北京)</span><br><span class="line">Worker(userId&#x3D;2, userName&#x3D;TBB, userPassword&#x3D;123456, userBirthday&#x3D;null, userSex&#x3D;false, userAddress&#x3D;上海)</span><br><span class="line">Worker(userId&#x3D;3, userName&#x3D;TCC, userPassword&#x3D;123456, userBirthday&#x3D;null, userSex&#x3D;true, userAddress&#x3D;广州)</span><br></pre></td></tr></table></figure>





</li>
</ul>
<p>两种方式对比：</p>
<p>第一种执行效率高，是在sql层面上修改的，起别名。但是sql语句该找了改造量大！对于开发效率比较低。</p>
<p>第二种方式因为多引入了xml文件，需要多一步xml解析。所以效率不如上面的高，但是封装好的resultMap多处可以复用！开发效率高！</p>
<p>再回顾一下，至此项目的目录：</p>
<p><img src="/" class="lazyload" data-src="/img/assets/1576484889995.png"  alt="1576484889995"></p>
<p>依次用到了User、Student、Teacher、Worker实体类，为了演示不同的场景，才新建这么多测试类的，到时候回头来看，比较清晰。自己研究琢磨的时候，可以用一个实体类就行 :smile:</p>
<h2 id="常用标签的介绍"><a href="#常用标签的介绍" class="headerlink" title="常用标签的介绍"></a>常用标签的介绍</h2><h3 id="properties"><a href="#properties" class="headerlink" title="properties"></a>properties</h3><p>properties标签作用：用于抽取数据库连接配置信息。</p>
<p>我们现在将数据库连接池写在了<code>SqlMapConfig.xml</code>文件里面，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">        PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;&#x2F;DTD Config 3.0&#x2F;&#x2F;EN&quot;</span><br><span class="line">        &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-config.dtd&quot;&gt;</span><br><span class="line">&lt;!--mybatis主配置文件--&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;!--配置环境--&gt;</span><br><span class="line">    &lt;environments default&#x3D;&quot;development&quot;&gt;</span><br><span class="line">        &lt;!--配置mysql的环境--&gt;</span><br><span class="line">        &lt;environment id&#x3D;&quot;development&quot;&gt;</span><br><span class="line">            &lt;!--配置事务的类型--&gt;</span><br><span class="line">            &lt;transactionManager type&#x3D;&quot;JDBC&quot;&#x2F;&gt;</span><br><span class="line">            &lt;!--配置数据源（连接池）--&gt;</span><br><span class="line">            &lt;dataSource type&#x3D;&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;!--配置连接数据库的4个基本信息--&gt;</span><br><span class="line">                &lt;property name&#x3D;&quot;driver&quot; value&#x3D;&quot;com.mysql.jdbc.Driver&quot;&#x2F;&gt;</span><br><span class="line">                &lt;property name&#x3D;&quot;url&quot; value&#x3D;&quot;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;mybatis?serverTimezone&#x3D;UTC&quot;&#x2F;&gt;</span><br><span class="line">                &lt;property name&#x3D;&quot;username&quot; value&#x3D;&quot;root&quot;&#x2F;&gt;</span><br><span class="line">                &lt;property name&#x3D;&quot;password&quot; value&#x3D;&quot;123456&quot;&#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;dataSource&gt;</span><br><span class="line">        &lt;&#x2F;environment&gt;</span><br><span class="line">    &lt;&#x2F;environments&gt;</span><br><span class="line">    &lt;!--指定映射配置文件的位置，映射配置文件指的是每一个dao独立的配置文件--&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;mapper resource&#x3D;&quot;com&#x2F;ivyzh&#x2F;dao&#x2F;IUserMapper.xml&quot;&#x2F;&gt;</span><br><span class="line">        &lt;mapper resource&#x3D;&quot;com&#x2F;ivyzh&#x2F;dao&#x2F;ITeacherMapper.xml&quot;&#x2F;&gt;</span><br><span class="line">        &lt;mapper resource&#x3D;&quot;com&#x2F;ivyzh&#x2F;dao&#x2F;IWorkerMapper.xml&quot;&#x2F;&gt;</span><br><span class="line">        &lt;!--如果使用的注解来配置的话，此处应该使用class属性指定被注解的dao全限定类名--&gt;</span><br><span class="line">        &lt;mapper class&#x3D;&quot;com.ivyzh.dao.IStudentDao&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;mappers&gt;</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br></pre></td></tr></table></figure>

<p>properties的功能就是将dataSource标签下面的数据库连接信息抽出来，为此我们可以有这样几种操作：</p>
<p>第一种：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;!--配置properties--&gt;</span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;driver&quot; value&#x3D;&quot;com.mysql.jdbc.Driver&quot;&#x2F;&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;url&quot; value&#x3D;&quot;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;mybatis?serverTimezone&#x3D;UTC&quot;&#x2F;&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;username&quot; value&#x3D;&quot;root&quot;&#x2F;&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;password&quot; value&#x3D;&quot;123456&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--配置环境--&gt;</span><br><span class="line">    &lt;environments default&#x3D;&quot;development&quot;&gt;</span><br><span class="line">        &lt;!--配置mysql的环境--&gt;</span><br><span class="line">        &lt;environment id&#x3D;&quot;development&quot;&gt;</span><br><span class="line">            &lt;!--配置事务的类型--&gt;</span><br><span class="line">            &lt;transactionManager type&#x3D;&quot;JDBC&quot;&#x2F;&gt;</span><br><span class="line">            &lt;!--配置数据源（连接池）--&gt;</span><br><span class="line">            &lt;dataSource type&#x3D;&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;!--配置连接数据库的4个基本信息，使用properties标签--&gt;</span><br><span class="line">                &lt;property name&#x3D;&quot;driver&quot; value&#x3D;&quot;$&#123;driver&#125;&quot;&#x2F;&gt;</span><br><span class="line">                &lt;property name&#x3D;&quot;url&quot; value&#x3D;&quot;$&#123;url&#125;&quot;&#x2F;&gt;</span><br><span class="line">                &lt;property name&#x3D;&quot;username&quot; value&#x3D;&quot;$&#123;username&#125;&quot;&#x2F;&gt;</span><br><span class="line">                &lt;property name&#x3D;&quot;password&quot; value&#x3D;&quot;$&#123;password&#125;&quot;&#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;dataSource&gt;</span><br><span class="line">        &lt;&#x2F;environment&gt;</span><br><span class="line">    &lt;&#x2F;environments&gt;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line"> </span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br></pre></td></tr></table></figure>

<p>第二种：</p>
<p>使用properties的resource属性，指定配置文件位置。即可以在<code>properties</code>标签内部配置连接数据的信息，也可以通过属性引用外部配置文件信息。</p>
<p>resource属性：用于指定配置文件的位置，是按照类路径的写法来写，必须存在于类路径下。</p>
<p>jdbcConfig.properties的存放路径和内容：</p>
<p><img src="/" class="lazyload" data-src="/img/assets/1576486278460.png"  alt="1576486278460"></p>
<p>引用的时候，可以这样配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;!--配置properties--&gt;</span><br><span class="line">    &lt;properties resource&#x3D;&quot;jdbcConfig.properties&quot;&#x2F;&gt;</span><br><span class="line">    ...</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br></pre></td></tr></table></figure>

<p>第三种：</p>
<p>使用properties的url属性。</p>
<p>比如我把jdbcConfig.properties连接信息copy到D盘根目录，则引用的时候应该这样做：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;!--配置properties--&gt;</span><br><span class="line">    &lt;properties url&#x3D;&quot;file:&#x2F;&#x2F;&#x2F;D:&#x2F;jdbcConfig.properties&quot;&#x2F;&gt;</span><br><span class="line">    ...</span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br></pre></td></tr></table></figure>



<h3 id="typeAliases"><a href="#typeAliases" class="headerlink" title="typeAliases"></a>typeAliases</h3><p>回顾IWorkerMapper.xml这个文件中有几个写的是类全限定名，如图：</p>
<p><img src="/" class="lazyload" data-src="/img/assets/1576486867518.png"  alt="1576486867518"></p>
<p>在resultMap标签type属性、select标签的resultType、parameterType属性都写了全限定名<code>com.ivyzh.domain.Worker</code></p>
<p>这时候typeAliases出来就是来优化这种写法的。</p>
<p>使用typeAliases配置别名，它只能配置domain中类的别名。</p>
<p>typeAlias的type属性指的是实体类全限定名，alias属性指起的别名，不区分大小写。</p>
<p>同样这个需要在SqlMapConfig.xml文件里面去配置：</p>
<p><img src="/" class="lazyload" data-src="/img/assets/1576487248449.png"  alt="1576487248449"></p>
<p>使用的时候可以直接写别名了，且不区分大小写：</p>
<p><img src="/" class="lazyload" data-src="/img/assets/1576487346207.png"  alt="1576487346207"></p>
<p>typeAliases配置过的时候也是很麻烦的，比如又N个实体类需要配置，那么就需要在<code>typeAliases</code>标签下面写N个<code>typeAlias</code>，所以它提供了packge标签。</p>
<h3 id="package"><a href="#package" class="headerlink" title="package"></a>package</h3><p>配置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--使用typeAliases配置别名，它只能配置domain中类的别名--&gt;</span><br><span class="line">&lt;typeAliases&gt;</span><br><span class="line">    &lt;package name&#x3D;&quot;com.ivyzh.domain&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;typeAliases&gt;</span><br></pre></td></tr></table></figure>

<p>这样表示在<code>com.ivyzh.domain</code>包下面的实体类都不用再一个个配置了，他们的默认别名就是类名。</p>
<p>同理：mappers标签下面也有package标签，是指定接口所在的包，当指定了之后就不需要写mapper、resources、class了。</p>
<p>比如我们用到的User、Student、Teacher、Worker实体类所对应的Mapper.xml或者Dao的实现类文件都要配置在mappers标签下面。</p>
<p><img src="/" class="lazyload" data-src="/img/assets/1576487638163.png"  alt="1576487638163"></p>
<p>用了package标签之后，就简洁很多了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;mappers&gt;</span><br><span class="line">    &lt;!--pack标签是用于指定dao接口所在的包，当指定了之后就不需要再写mapper及resource或者class了--&gt;</span><br><span class="line">    &lt;!--目前这个功能运行报错，不知道为什么？暂时记录一下--&gt;</span><br><span class="line">    &lt;!--&lt;package name&#x3D;&quot;com.ivyzh.dao&quot;&#x2F;&gt;--&gt;</span><br><span class="line">&lt;&#x2F;mappers&gt;</span><br></pre></td></tr></table></figure>

<p>调用查询所有的报错信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.apache.ibatis.binding.BindingException: Invalid bound statement (not found): com.ivyzh.dao.IWorkerDao.findAll</span><br></pre></td></tr></table></figure>



<p>最后解决了，参考文章<a href="https://blog.csdn.net/weixin_43951534/article/details/90416363" target="_blank" rel="noopener">https://blog.csdn.net/weixin_43951534/article/details/90416363</a></p>
<blockquote>
<p> MyBatis注册映射文件，package 加载方式(class加载方式的简写方式)，适用于类路径下,接口文件与映射文件在同一路径下,且<strong>接口名与映射文件名相同</strong>,并且映射文件命名为接口全类名的情况</p>
</blockquote>
<p>即IWorkerMapper.xml要改成IWorkerDao.xml才行！太坑了！</p>
<p>修改完之后的目录结构：</p>
<p><img src="/" class="lazyload" data-src="/img/assets/1576490885398.png"  alt="1576490885398"></p>
<p>关于package、mappers几篇参考文章：</p>
<p><a href="https://www.jianshu.com/p/4e50fa289271" target="_blank" rel="noopener">https://www.jianshu.com/p/4e50fa289271</a></p>
<p><a href="https://blog.csdn.net/u014268482/article/details/80597036" target="_blank" rel="noopener">https://blog.csdn.net/u014268482/article/details/80597036</a></p>
<p><a href="https://blog.csdn.net/qq_31457665/article/details/81080304" target="_blank" rel="noopener">https://blog.csdn.net/qq_31457665/article/details/81080304</a></p>
<p><a href="https://blog.csdn.net/weixin_43951534/article/details/90416363" target="_blank" rel="noopener">https://blog.csdn.net/weixin_43951534/article/details/90416363</a></p>
<h2 id="MyBatis连接池及事务控制"><a href="#MyBatis连接池及事务控制" class="headerlink" title="MyBatis连接池及事务控制"></a>MyBatis连接池及事务控制</h2><p>这一节内容：原理部分了解，应用部分会用即可。</p>
<h3 id="连接池"><a href="#连接池" class="headerlink" title="连接池"></a>连接池</h3><h4 id="连接池作用"><a href="#连接池作用" class="headerlink" title="连接池作用"></a>连接池作用</h4><blockquote>
<p>它可以减少我们获取连接所消耗的时间</p>
</blockquote>
<h4 id="Mybatis连接池分类"><a href="#Mybatis连接池分类" class="headerlink" title="Mybatis连接池分类"></a>Mybatis连接池分类</h4><p>mybatis连接池提供了3种方式的配置：<br>配置的位置：主配置文件SqlMapConfig.xml中的dataSource标签，type属性就是表示采用何种连接池方式，type属性的取值3种。</p>
<ul>
<li>POOLED     </li>
<li>UNPOOLED </li>
<li>JNDI（了解）</li>
</ul>
<p>POOLED：采用传统的javax.sql.DataSource规范中的连接池，mybatis中有针对规范的实现</p>
<p>UNPOOLED： 采用传统的获取连接的方式，虽然也实现Javax.sql.DataSource接口，但是并没有使用池的思想。</p>
<p>JNDI（拓展了解）： 采用服务器提供的JNDI技术实现，来获取DataSource对象，不同的服务器所能拿到DataSource是不一样。</p>
<p>注意：如果不是web或者maven的war工程，是不能使用的。tomcat服务器，采用连接池就是dbcp连接池。</p>
<h3 id="事务控制"><a href="#事务控制" class="headerlink" title="事务控制"></a>事务控制</h3><blockquote>
<p>mybatis中的事务，它是通过sqlsession对象的commit方法和rollback方法实现事务的提交和回滚。</p>
</blockquote>
<p>如何设置代码让其自动提交？</p>
<p>sqlSession  = sqlSessionFactory.openSession(boolean autoCommit);//设置true就可以了。</p>
<p>这一块，没有具体研究过，先暂存吧，后面找到合适例子再补充。</p>
<h2 id="动态SQL"><a href="#动态SQL" class="headerlink" title="动态SQL"></a>动态SQL</h2><p>这一节内容：会用即可。</p>
<blockquote>
<p>Mybatis 的映射文件中，前面我们的 SQL 都是比较简单的，有些时候业务逻辑复杂时，我们的 SQL 是动态变化的，此时在前面的学习中我们的 SQL 就不能满足要求了。</p>
</blockquote>
<ul>
<li>if标签</li>
<li>where标签</li>
<li>foreach标签</li>
<li>SQL片段</li>
</ul>
<p>再新建一个厨师表<code>t_chef</code>数据和<code>t_worker</code>一模一样。</p>
<p><strong>Chef实体类：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">public class Chef implements Serializable &#123;</span><br><span class="line">    private static final long serialVersionUID &#x3D; -6815279398228636657L;</span><br><span class="line">    private int id;</span><br><span class="line">    private String username;</span><br><span class="line">    private String password;</span><br><span class="line">    private Date birthday;</span><br><span class="line">    private Boolean sex;</span><br><span class="line">    private String address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意这里sex是Boolen类型。</p>
<p><strong>IChefDao.java：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">public interface IChefDao &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 查询所有</span><br><span class="line">     *</span><br><span class="line">     * @return 返回老师集合</span><br><span class="line">     *&#x2F;</span><br><span class="line">    List&lt;Chef&gt; findAll();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据条件查询，查询内容可能是姓名、性别、地址...</span><br><span class="line">     * 演示if标签</span><br><span class="line">     *</span><br><span class="line">     * @param chef 用户数据</span><br><span class="line">     * @return 用户数据列表</span><br><span class="line">     *&#x2F;</span><br><span class="line">    List&lt;Chef&gt; findByCondition(Chef chef);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据条件查询，查询内容可能是姓名、性别、地址...</span><br><span class="line">     * 演示where标签</span><br><span class="line">     *</span><br><span class="line">     * @param chef 用户数据</span><br><span class="line">     * @return 用户数据列表</span><br><span class="line">     *&#x2F;</span><br><span class="line">    List&lt;Chef&gt; findByCondition2(Chef chef);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据ChefQueryVo中提供的id集合，查询用户信息</span><br><span class="line">     *</span><br><span class="line">     * @param vo 查询条件</span><br><span class="line">     * @return 用户数据列表</span><br><span class="line">     *&#x2F;</span><br><span class="line">    List&lt;Chef&gt; findByIds(ChefQueryVo vo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ChefQueryVo.java：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">public class ChefQueryVo &#123;</span><br><span class="line">    private List&lt;Integer&gt; ids;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>注：由于在SQLMapConfig文件使用package标签，则在定义Mapper映射文件的时候要和接口名称定义成相同的，IChefDao.xml</p>
<p><strong>测试类ChefTest：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * MyBatis快速入门-ChefTest基于XML形式的增删改查测试</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class ChefTest &#123;</span><br><span class="line"></span><br><span class="line">    InputStream is;</span><br><span class="line">    SqlSession sqlSession;</span><br><span class="line"></span><br><span class="line">    @Before</span><br><span class="line">    public void init() throws IOException &#123;</span><br><span class="line">        &#x2F;&#x2F;1. 读取配置文件</span><br><span class="line">        is &#x3D; Resources.getResourceAsStream(&quot;SqlMapConfig.xml&quot;);</span><br><span class="line">        &#x2F;&#x2F;2. 创建SqlSessionFactory工厂</span><br><span class="line">        SqlSessionFactoryBuilder builder &#x3D; new SqlSessionFactoryBuilder();</span><br><span class="line">        SqlSessionFactory factory &#x3D; builder.build(is);</span><br><span class="line">        &#x2F;&#x2F;3. 使用工厂生产SqlSession对象</span><br><span class="line">        sqlSession &#x3D; factory.openSession();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 查询所有用户数据</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void testFindAll() &#123;</span><br><span class="line">        IChefDao mapper &#x3D; sqlSession.getMapper(IChefDao.class);</span><br><span class="line">        List&lt;Chef&gt; chefs &#x3D; mapper.findAll();</span><br><span class="line">        print(chefs);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void print(List&lt;Chef&gt; chefs) &#123;</span><br><span class="line">        for (Chef chef : chefs) &#123;</span><br><span class="line">            System.out.println(chef);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testFindByCondition() &#123;</span><br><span class="line">        IChefDao mapper &#x3D; sqlSession.getMapper(IChefDao.class);</span><br><span class="line">        Chef chef &#x3D; new Chef();</span><br><span class="line">        chef.setUsername(&quot;TAA&quot;);</span><br><span class="line">        List&lt;Chef&gt; chefs &#x3D; mapper.findByCondition(chef);</span><br><span class="line">        print(chefs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testFindByCondition2() &#123;</span><br><span class="line">        IChefDao mapper &#x3D; sqlSession.getMapper(IChefDao.class);</span><br><span class="line">        Chef chef &#x3D; new Chef();</span><br><span class="line">        chef.setAddress(&quot;杭州&quot;);</span><br><span class="line">        List&lt;Chef&gt; chefs &#x3D; mapper.findByCondition2(chef);</span><br><span class="line">        print(chefs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testFindByQueryVo() &#123;</span><br><span class="line">        IChefDao mapper &#x3D; sqlSession.getMapper(IChefDao.class);</span><br><span class="line">        ChefQueryVo vo &#x3D; new ChefQueryVo();</span><br><span class="line">        ArrayList&lt;Integer&gt; ids &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line">        ids.add(1);</span><br><span class="line">        ids.add(3);</span><br><span class="line">        ids.add(5);</span><br><span class="line">        ids.add(8);</span><br><span class="line">        vo.setIds(ids);</span><br><span class="line">        List&lt;Chef&gt; chefs &#x3D; mapper.findByIds(vo);</span><br><span class="line">        print(chefs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @After</span><br><span class="line">    public void destory() throws IOException &#123;</span><br><span class="line">        &#x2F;&#x2F;提交事务，或者放到destory里面</span><br><span class="line">        sqlSession.commit();</span><br><span class="line">        &#x2F;&#x2F;6. 释放资源</span><br><span class="line">        sqlSession.close();</span><br><span class="line">        is.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="SQL片段"><a href="#SQL片段" class="headerlink" title="SQL片段"></a>SQL片段</h3><p>sql片段意思是抽取重复语句，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;mapper namespace&#x3D;&quot;com.ivyzh.dao.IChefDao&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--抽取sql代码块--&gt;</span><br><span class="line">    &lt;sql id&#x3D;&quot;selectAll&quot;&gt;</span><br><span class="line">        select * from t_chef</span><br><span class="line">    &lt;&#x2F;sql&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--查询所有--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findAll&quot; resultType&#x3D;&quot;chef&quot;&gt;</span><br><span class="line">        &lt;include refid&#x3D;&quot;selectAll&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&lt;mapper&#x2F;&gt;</span><br></pre></td></tr></table></figure>



<h3 id="if标签"><a href="#if标签" class="headerlink" title="if标签"></a>if标签</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;mapper namespace&#x3D;&quot;com.ivyzh.dao.IChefDao&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--抽取sql代码块--&gt;</span><br><span class="line">    &lt;sql id&#x3D;&quot;selectAll&quot;&gt;</span><br><span class="line">        select * from t_chef</span><br><span class="line">    &lt;&#x2F;sql&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--查询所有--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findAll&quot; resultType&#x3D;&quot;chef&quot;&gt;</span><br><span class="line">        &lt;include refid&#x3D;&quot;selectAll&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--根据条件查询，查询内容可能是姓名、性别、地址...--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findByCondition&quot; parameterType&#x3D;&quot;chef&quot; resultType&#x3D;&quot;chef&quot;&gt;</span><br><span class="line">        select * from t_chef where 1 &#x3D; 1</span><br><span class="line">        &lt;if test&#x3D;&quot;username !&#x3D; null&quot;&gt;</span><br><span class="line">            and username &#x3D; #&#123;username&#125;</span><br><span class="line">        &lt;&#x2F;if&gt;</span><br><span class="line">        &lt;if test&#x3D;&quot;sex !&#x3D; null&quot;&gt;</span><br><span class="line">            and sex &#x3D; #&#123;sex&#125;</span><br><span class="line">        &lt;&#x2F;if&gt;</span><br><span class="line">        &lt;if test&#x3D;&quot;address !&#x3D; null&quot;&gt;</span><br><span class="line">            and address &#x3D; #&#123;address&#125;</span><br><span class="line">        &lt;&#x2F;if&gt;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">&lt;mapper&#x2F;&gt;</span><br></pre></td></tr></table></figure>



<h3 id="where标签"><a href="#where标签" class="headerlink" title="where标签"></a>where标签</h3><p>if标签需要手写<code>where 1 = 1</code>，使用where标签我们可以这样做：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    &lt;!--根据条件查询，查询内容可能是姓名、性别、地址...演示where标签--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findByCondition2&quot; parameterType&#x3D;&quot;chef&quot; resultType&#x3D;&quot;chef&quot;&gt;</span><br><span class="line">        select * from t_chef</span><br><span class="line">        &lt;where&gt;</span><br><span class="line">            &lt;if test&#x3D;&quot;username !&#x3D; null&quot;&gt;</span><br><span class="line">                and username &#x3D; #&#123;username&#125;</span><br><span class="line">            &lt;&#x2F;if&gt;</span><br><span class="line">            &lt;if test&#x3D;&quot;sex !&#x3D; null&quot;&gt;</span><br><span class="line">                and sex &#x3D; #&#123;sex&#125;</span><br><span class="line">            &lt;&#x2F;if&gt;</span><br><span class="line">            &lt;if test&#x3D;&quot;address !&#x3D; null&quot;&gt;</span><br><span class="line">                and address &#x3D; #&#123;address&#125;</span><br><span class="line">            &lt;&#x2F;if&gt;</span><br><span class="line">        &lt;&#x2F;where&gt;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>



<h3 id="foreach标签"><a href="#foreach标签" class="headerlink" title="foreach标签"></a>foreach标签</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    &lt;!--根据ChefQueryVo中提供的id集合，查询用户信息--&gt;</span><br><span class="line">    &lt;!--注意size()可以写成size--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findByIds&quot; parameterType&#x3D;&quot;queryvo&quot; resultType&#x3D;&quot;chef&quot;&gt;</span><br><span class="line">        &lt;include refid&#x3D;&quot;selectAll&quot;&#x2F;&gt;</span><br><span class="line">        &lt;where&gt;</span><br><span class="line">            &lt;if test&#x3D;&quot;ids !&#x3D; null and ids.size() &gt;0&quot;&gt;</span><br><span class="line">                &lt;foreach collection&#x3D;&quot;ids&quot; open&#x3D;&quot;and id in (&quot; close&#x3D;&quot;)&quot; item&#x3D;&quot;uid&quot; separator&#x3D;&quot;,&quot;&gt;</span><br><span class="line">                    #&#123;uid&#125;</span><br><span class="line">                &lt;&#x2F;foreach&gt;</span><br><span class="line">            &lt;&#x2F;if&gt;</span><br><span class="line">        &lt;&#x2F;where&gt;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>





<h2 id="p6sy"><a href="#p6sy" class="headerlink" title="p6sy"></a>p6sy</h2><blockquote>
<p>p6spy是一个开源项目，通常使用它来跟踪数据库操作，查看程序运行过程中执行的sql语句。</p>
</blockquote>
<p>参考文章：<a href="https://blog.csdn.net/gnd15732625435/article/details/81626095" target="_blank" rel="noopener">https://blog.csdn.net/gnd15732625435/article/details/81626095</a></p>
<h2 id="多表查询（一对一）"><a href="#多表查询（一对一）" class="headerlink" title="多表查询（一对一）"></a>多表查询（一对一）</h2><p>其实上面这种方式在实际开发中并不常用，应用场景举例，一个用户可以有多个银行账户，一个银行账户唯一对应一个用户。</p>
<p>根据账户id查询用户信息，就是一个一对一的案例。实现起来不难，可以单表查询就行，这里我们直接演示另一种情况，一对多。后面还会提到一对一查询，详见<strong>延迟加载-一对一实现立即加载章节</strong>。</p>
<h2 id="多表查询（一对多）"><a href="#多表查询（一对多）" class="headerlink" title="多表查询（一对多）"></a>多表查询（一对多）</h2><p>一对多情况：一个用户可以有多张银行卡，场景是根据用户id查询他的用户信息和银行卡信息。</p>
<h3 id="Step1-建表"><a href="#Step1-建表" class="headerlink" title="Step1. 建表"></a>Step1. 建表</h3><p>创建客户表<code>t_account</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE IF EXISTS t_account;</span><br><span class="line"></span><br><span class="line">CREATE TABLE t_account (</span><br><span class="line">  id INT(10) PRIMARY KEY NOT NULL AUTO_INCREMENT,</span><br><span class="line">  money INT(10),</span><br><span class="line">  uid INT(10) NOT NULL</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>创建客户表<code>t_customer</code>：</p>
<p>表结构和数据和之前的Worker一样。</p>
<p><code>t_customer</code>的数据内容：</p>
<p><img src="/" class="lazyload" data-src="/img/assets/1576556227431.png"  alt="1576556227431"></p>
<p><code>t_account</code>和<code>t_customer</code>建立外键约束：</p>
<p><img src="/" class="lazyload" data-src="/img/assets/1576556195144.png"  alt="1576556195144"></p>
<p><code>t_account</code>表数据：</p>
<p><img src="/" class="lazyload" data-src="/img/assets/1576556333975.png"  alt="1576556333975"></p>
<p>先验证一下sql查询：</p>
<ul>
<li><p>查询用户和其对应的账户信息</p>
<blockquote>
<p>SELECT * FROM t_customer,t_account WHERE t_customer.id = t_account.<code>uid</code></p>
</blockquote>
</li>
</ul>
<p><img src="/" class="lazyload" data-src="/img/assets/1576556529130.png"  alt="1576556529130"></p>
<ul>
<li><p>查询用户id为2的用户和其对应的账户信息</p>
<blockquote>
<p>SELECT * FROM t_customer c,t_account a WHERE c.id = a.<code>uid</code> AND c.id =1</p>
</blockquote>
</li>
</ul>
<p><img src="/" class="lazyload" data-src="/img/assets/1576556570894.png"  alt="1576556570894"></p>
<h3 id="Step2-建实体类对应关系"><a href="#Step2-建实体类对应关系" class="headerlink" title="Step2. 建实体类对应关系"></a>Step2. 建实体类对应关系</h3><p>账户表Account：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">public class Account implements Serializable &#123;</span><br><span class="line">    private static final long serialVersionUID &#x3D; -5255167209921667740L;</span><br><span class="line">    private Integer id;</span><br><span class="line">    private Integer money;</span><br><span class="line">    private Integer uid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>顾客表Customer：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">public class Customer implements Serializable &#123;</span><br><span class="line">    private static final long serialVersionUID &#x3D; 3456456284746844493L;</span><br><span class="line">    private Integer id;</span><br><span class="line">    private String username;</span><br><span class="line">    private String password;</span><br><span class="line">    private Date birthday;</span><br><span class="line">    private Boolean sex;</span><br><span class="line">    private String address;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 一对多关系映射：主表实体类中应该包含从表实体的集合引用</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private List&lt;Account&gt; accounts;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>顾客操作接口ICustomerDao：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public interface ICustomerDao &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 查询所有</span><br><span class="line">     *</span><br><span class="line">     * @return 返回数据集合</span><br><span class="line">     *&#x2F;</span><br><span class="line">    List&lt;Customer&gt; findAll();</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 查询所有并包含账户信息</span><br><span class="line">     *</span><br><span class="line">     * @return 返回数据集合</span><br><span class="line">     *&#x2F;</span><br><span class="line">    List&lt;Customer&gt; findAllWithAccount();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Step3-编写查询Mapper"><a href="#Step3-编写查询Mapper" class="headerlink" title="Step3.编写查询Mapper"></a>Step3.编写查询Mapper</h3><p>ICustomerDao.xml：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;&#x2F;DTD Mapper 3.0&#x2F;&#x2F;EN&quot;</span><br><span class="line">        &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace&#x3D;&quot;com.ivyzh.dao.ICustomerDao&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--配置Customer的resultMap--&gt;</span><br><span class="line">    &lt;resultMap id&#x3D;&quot;caMap&quot; type&#x3D;&quot;customer&quot;&gt;</span><br><span class="line">        &lt;id property&#x3D;&quot;id&quot; column&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;username&quot; column&#x3D;&quot;username&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;password&quot; column&#x3D;&quot;password&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;sex&quot; column&#x3D;&quot;sex&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;birthday&quot; column&#x3D;&quot;birthday&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;address&quot; column&#x3D;&quot;address&quot;&#x2F;&gt;</span><br><span class="line">        &lt;!--配置customer对象中accounts集合的映射--&gt;</span><br><span class="line">        &lt;collection property&#x3D;&quot;accounts&quot; ofType&#x3D;&quot;account&quot;&gt;</span><br><span class="line">            &lt;id property&#x3D;&quot;id&quot; column&#x3D;&quot;aid&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result property&#x3D;&quot;money&quot; column&#x3D;&quot;money&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result property&#x3D;&quot;uid&quot; column&#x3D;&quot;uid&quot;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;collection&gt;</span><br><span class="line">    &lt;&#x2F;resultMap&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--抽取sql代码块--&gt;</span><br><span class="line">    &lt;sql id&#x3D;&quot;selectAll&quot;&gt;</span><br><span class="line">        select * from t_customer</span><br><span class="line">    &lt;&#x2F;sql&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--查询所有--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findAll&quot; resultType&#x3D;&quot;customer&quot;&gt;</span><br><span class="line">        &lt;include refid&#x3D;&quot;selectAll&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--查询所有并包含账户信息--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findAllWithAccount&quot; resultMap&#x3D;&quot;caMap&quot;&gt;</span><br><span class="line">       select c.*,a.id as aid ,a.money money,a.uid uid from t_customer c left outer join t_account a on c.id &#x3D; a.uid</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Step4-测试"><a href="#Step4-测试" class="headerlink" title="Step4. 测试"></a>Step4. 测试</h3><p>测试类CustomerTest：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * MyBatis快速入门-CustomerTest基于XML形式的增删改查测试</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class CustomerTest &#123;</span><br><span class="line"></span><br><span class="line">    InputStream is;</span><br><span class="line">    SqlSession sqlSession;</span><br><span class="line"></span><br><span class="line">    @Before</span><br><span class="line">    public void init() throws IOException &#123;</span><br><span class="line">        &#x2F;&#x2F;1. 读取配置文件</span><br><span class="line">        is &#x3D; Resources.getResourceAsStream(&quot;SqlMapConfig.xml&quot;);</span><br><span class="line">        &#x2F;&#x2F;2. 创建SqlSessionFactory工厂</span><br><span class="line">        SqlSessionFactoryBuilder builder &#x3D; new SqlSessionFactoryBuilder();</span><br><span class="line">        SqlSessionFactory factory &#x3D; builder.build(is);</span><br><span class="line">        &#x2F;&#x2F;3. 使用工厂生产SqlSession对象</span><br><span class="line">        sqlSession &#x3D; factory.openSession();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 查询所有用户数据</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void testFindAll() &#123;</span><br><span class="line">        ICustomerDao mapper &#x3D; sqlSession.getMapper(ICustomerDao.class);</span><br><span class="line">        List&lt;Customer&gt; customers &#x3D; mapper.findAll();</span><br><span class="line">        print(customers);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testFindAllWithAccount() &#123;</span><br><span class="line">        ICustomerDao mapper &#x3D; sqlSession.getMapper(ICustomerDao.class);</span><br><span class="line">        List&lt;Customer&gt; customers &#x3D; mapper.findAllWithAccount();</span><br><span class="line">        print(customers);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void print(List&lt;Customer&gt; objs) &#123;</span><br><span class="line">        for (Customer obj : objs) &#123;</span><br><span class="line">            System.out.println(obj);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @After</span><br><span class="line">    public void destory() throws IOException &#123;</span><br><span class="line">        &#x2F;&#x2F;提交事务，或者放到destory里面</span><br><span class="line">        sqlSession.commit();</span><br><span class="line">        &#x2F;&#x2F;6. 释放资源</span><br><span class="line">        sqlSession.close();</span><br><span class="line">        is.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出结果：</p>
<ul>
<li><p>testFindAll方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Customer(id&#x3D;1, username&#x3D;TAA, password&#x3D;123456, birthday&#x3D;Fri Dec 13 08:00:00 CST 2019, sex&#x3D;true, address&#x3D;北京, accounts&#x3D;null)</span><br><span class="line">Customer(id&#x3D;2, username&#x3D;TBB, password&#x3D;123456, birthday&#x3D;Tue Dec 10 08:00:00 CST 2019, sex&#x3D;false, address&#x3D;上海, accounts&#x3D;null)</span><br><span class="line">Customer(id&#x3D;3, username&#x3D;TCC, password&#x3D;123456, birthday&#x3D;Wed Dec 04 08:00:00 CST 2019, sex&#x3D;true, address&#x3D;广州, accounts&#x3D;null)</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>testFindAllWithAccount方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Customer(id&#x3D;1, username&#x3D;TAA, password&#x3D;123456, birthday&#x3D;Fri Dec 13 08:00:00 CST 2019, sex&#x3D;true, address&#x3D;北京, accounts&#x3D;[Account(id&#x3D;1, money&#x3D;1000, uid&#x3D;1), Account(id&#x3D;2, money&#x3D;2000, uid&#x3D;1), Account(id&#x3D;3, money&#x3D;3000, uid&#x3D;1)])</span><br><span class="line">Customer(id&#x3D;2, username&#x3D;TBB, password&#x3D;123456, birthday&#x3D;Tue Dec 10 08:00:00 CST 2019, sex&#x3D;false, address&#x3D;上海, accounts&#x3D;[Account(id&#x3D;4, money&#x3D;4000, uid&#x3D;2), Account(id&#x3D;5, money&#x3D;5000, uid&#x3D;2)])</span><br><span class="line">Customer(id&#x3D;3, username&#x3D;TCC, password&#x3D;123456, birthday&#x3D;Wed Dec 04 08:00:00 CST 2019, sex&#x3D;true, address&#x3D;广州, accounts&#x3D;[Account(id&#x3D;6, money&#x3D;6000, uid&#x3D;3)])</span><br></pre></td></tr></table></figure>



</li>
</ul>
<p>注意事项：collection标签里面的书写格式。</p>
<h2 id="多表查询（多对多）"><a href="#多表查询（多对多）" class="headerlink" title="多表查询（多对多）"></a>多表查询（多对多）</h2><p>示例：用户和角色</p>
<p>​    一个用户可以有多个角色</p>
<p>​    一个角色可以赋予多个用户</p>
<p>步骤：</p>
<p>​    1、建立两张表：用户表，角色表</p>
<p>​        让用户表和角色表具有多对多的关系。需要使用中间表，中间表中包含各自的主键，在中间表中是外键。</p>
<p>​    2、建立两个实体类：用户实体类和角色实体类</p>
<p>​        让用户和角色的实体类能体现出来多对多的关系</p>
<p>​        各自包含对方一个集合引用</p>
<p>​    3、建立两个配置文件</p>
<p>​        用户的配置文件</p>
<p>​        角色的配置文件</p>
<p>​    4、实现配置：</p>
<p>​        当我们查询用户时，可以同时得到用户所包含的角色信息</p>
<p>​        当我们查询角色时，可以同时得到角色的所赋予的用户信息</p>
<p><strong>演示案例</strong>：当我们查询用户时，可以同时得到用户所包含的角色信息</p>
<h3 id="Step1-建表-1"><a href="#Step1-建表-1" class="headerlink" title="Step1. 建表"></a>Step1. 建表</h3><p><code>t_role</code>角色表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE IF EXISTS t_role;</span><br><span class="line"></span><br><span class="line">CREATE TABLE t_role (</span><br><span class="line">  id INT(10) PRIMARY KEY NOT NULL AUTO_INCREMENT,</span><br><span class="line">  role_name VARCHAR(10),</span><br><span class="line">  role_desc VARCHAR(10)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><code>t_employee</code>员工表：</p>
<blockquote>
<p>结构和数据与<code>t_customer</code>表一致。</p>
</blockquote>
<p><code>t_employee_role</code>角色权限对应表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE IF EXISTS t_employee_role;</span><br><span class="line"></span><br><span class="line">CREATE TABLE t_employee_role (</span><br><span class="line">  id INT(10) PRIMARY KEY NOT NULL AUTO_INCREMENT,</span><br><span class="line">  cid INT(10) NOT NULL,</span><br><span class="line">  rid INT(10) NOT NULL</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>加入外键：</p>
<p><img src="/" class="lazyload" data-src="/img/assets/1576569204137.png"  alt="1576569204137"></p>
<p>加一下数据：</p>
<p>t_employee：</p>
<p><img src="/" class="lazyload" data-src="/img/assets/1576569240217.png"  alt="1576569240217"></p>
<p>t_role：</p>
<p><img src="/" class="lazyload" data-src="/img/assets/1576569254137.png"  alt="1576569254137"></p>
<p>t_employee_role：</p>
<p><img src="/" class="lazyload" data-src="/img/assets/1576569275727.png"  alt="1576569275727"></p>
<p>简单写一个sql查询一下：</p>
<blockquote>
<p>SELECT e.*,r.id AS rid,r.role_name,r.role_desc  FROM t_role r LEFT OUTER JOIN t_employee_role er ON r.id = er.rid<br>LEFT OUTER JOIN t_employee e ON e.id = er.cid;  </p>
</blockquote>
<p><img src="/" class="lazyload" data-src="/img/assets/1576570107456.png"  alt="1576570107456"></p>
<h3 id="Step2-建立两个实体类"><a href="#Step2-建立两个实体类" class="headerlink" title="Step2.建立两个实体类"></a>Step2.建立两个实体类</h3><p>Employee:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">public class Employee implements Serializable &#123;</span><br><span class="line">    private static final long serialVersionUID &#x3D; -2661131928069328685L;</span><br><span class="line">    private Integer id;</span><br><span class="line">    private String username;</span><br><span class="line">    private String password;</span><br><span class="line">    private Date birthday;</span><br><span class="line">    private boolean sex;</span><br><span class="line">    private String address;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 一对多关系映射：主表实体类中应该包含从表实体的集合引用</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private List&lt;Role&gt; roles;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Role:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">public class Role implements Serializable &#123;</span><br><span class="line">    private static final long serialVersionUID &#x3D; -2661131928069328685L;</span><br><span class="line">    private Integer roleId;</span><br><span class="line">    private String roleName;</span><br><span class="line">    private String roleDesc;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意这里我们故意将字段名和数据库存储字段写的不一样。</p>
<p>IEmployeeDao:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public interface IEmployeeDao &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 查询所有</span><br><span class="line">     *</span><br><span class="line">     * @return 返回数据集合</span><br><span class="line">     *&#x2F;</span><br><span class="line">    List&lt;Employee&gt; findAll();</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 查询所有并包含角色信息</span><br><span class="line">     *</span><br><span class="line">     * @return 返回数据集合</span><br><span class="line">     *&#x2F;</span><br><span class="line">    List&lt;Employee&gt; findAllWithRole();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Step3-建立Mapper配置文件"><a href="#Step3-建立Mapper配置文件" class="headerlink" title="Step3. 建立Mapper配置文件"></a>Step3. 建立Mapper配置文件</h3><p>IEmployeeDao.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;&#x2F;DTD Mapper 3.0&#x2F;&#x2F;EN&quot;</span><br><span class="line">        &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace&#x3D;&quot;com.ivyzh.dao.IEmployeeDao&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--配置Customer的resultMap--&gt;</span><br><span class="line">    &lt;resultMap id&#x3D;&quot;erMap&quot; type&#x3D;&quot;employee&quot;&gt;</span><br><span class="line">        &lt;id property&#x3D;&quot;id&quot; column&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;username&quot; column&#x3D;&quot;username&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;password&quot; column&#x3D;&quot;password&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;sex&quot; column&#x3D;&quot;sex&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;birthday&quot; column&#x3D;&quot;birthday&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;address&quot; column&#x3D;&quot;address&quot;&#x2F;&gt;</span><br><span class="line">        &lt;!--配置customer对象中accounts集合的映射--&gt;</span><br><span class="line">        &lt;collection property&#x3D;&quot;roles&quot; ofType&#x3D;&quot;role&quot;&gt;</span><br><span class="line">            &lt;id property&#x3D;&quot;roleId&quot; column&#x3D;&quot;rid&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result property&#x3D;&quot;roleName&quot; column&#x3D;&quot;role_name&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result property&#x3D;&quot;roleDesc&quot; column&#x3D;&quot;role_desc&quot;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;collection&gt;</span><br><span class="line">    &lt;&#x2F;resultMap&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--抽取sql代码块--&gt;</span><br><span class="line">    &lt;sql id&#x3D;&quot;selectAll&quot;&gt;</span><br><span class="line">        select * from t_employee</span><br><span class="line">    &lt;&#x2F;sql&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--查询所有--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findAll&quot; resultType&#x3D;&quot;employee&quot;&gt;</span><br><span class="line">        &lt;include refid&#x3D;&quot;selectAll&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--查询所有并包含账户信息--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findAllWithRole&quot; resultMap&#x3D;&quot;erMap&quot;&gt;</span><br><span class="line">        SELECT e.*,r.id AS rid,r.&#96;role_name&#96;,r.&#96;role_desc&#96; FROM t_employee e</span><br><span class="line">        LEFT OUTER JOIN t_employee_role er ON e.id &#x3D; er.&#96;cid&#96;</span><br><span class="line">        LEFT OUTER JOIN t_role r ON r.&#96;id&#96; &#x3D; er.&#96;rid&#96;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br></pre></td></tr></table></figure>



<h3 id="Step4-测试-1"><a href="#Step4-测试-1" class="headerlink" title="Step4. 测试"></a>Step4. 测试</h3><p>EmployeeTest：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * EmployeeTest演示多对多——一个雇员对应多个身份</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class EmployeeTest &#123;</span><br><span class="line"></span><br><span class="line">    InputStream is;</span><br><span class="line">    SqlSession sqlSession;</span><br><span class="line"></span><br><span class="line">    @Before</span><br><span class="line">    public void init() throws IOException &#123;</span><br><span class="line">        &#x2F;&#x2F;1. 读取配置文件</span><br><span class="line">        is &#x3D; Resources.getResourceAsStream(&quot;SqlMapConfig.xml&quot;);</span><br><span class="line">        &#x2F;&#x2F;2. 创建SqlSessionFactory工厂</span><br><span class="line">        SqlSessionFactoryBuilder builder &#x3D; new SqlSessionFactoryBuilder();</span><br><span class="line">        SqlSessionFactory factory &#x3D; builder.build(is);</span><br><span class="line">        &#x2F;&#x2F;3. 使用工厂生产SqlSession对象</span><br><span class="line">        sqlSession &#x3D; factory.openSession();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 查询所有用户数据</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void testFindAll() &#123;</span><br><span class="line">        IEmployeeDao mapper &#x3D; sqlSession.getMapper(IEmployeeDao.class);</span><br><span class="line">        List&lt;Employee&gt; employees &#x3D; mapper.findAll();</span><br><span class="line">        print(employees);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testFindAllWithRole() &#123;</span><br><span class="line">        IEmployeeDao mapper &#x3D; sqlSession.getMapper(IEmployeeDao.class);</span><br><span class="line">        List&lt;Employee&gt; employees &#x3D; mapper.findAllWithRole();</span><br><span class="line">        print(employees);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void print(List&lt;Employee&gt; objs) &#123;</span><br><span class="line">        for (Employee obj : objs) &#123;</span><br><span class="line">            System.out.println(obj);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @After</span><br><span class="line">    public void destory() throws IOException &#123;</span><br><span class="line">        &#x2F;&#x2F;提交事务，或者放到destory里面</span><br><span class="line">        sqlSession.commit();</span><br><span class="line">        &#x2F;&#x2F;6. 释放资源</span><br><span class="line">        sqlSession.close();</span><br><span class="line">        is.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>日志输出：</strong></p>
<ul>
<li><p>testFindAll</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Employee(id&#x3D;1, username&#x3D;TAA, password&#x3D;123456, birthday&#x3D;Fri Dec 13 08:00:00 CST 2019, sex&#x3D;true, address&#x3D;北京, roles&#x3D;null)</span><br><span class="line">Employee(id&#x3D;2, username&#x3D;TBB, password&#x3D;123456, birthday&#x3D;Tue Dec 10 08:00:00 CST 2019, sex&#x3D;false, address&#x3D;上海, roles&#x3D;null)</span><br><span class="line">Employee(id&#x3D;3, username&#x3D;TCC, password&#x3D;123456, birthday&#x3D;Wed Dec 04 08:00:00 CST 2019, sex&#x3D;true, address&#x3D;广州, roles&#x3D;null)</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>testFindAllWithRole</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Employee(id&#x3D;1, username&#x3D;TAA, password&#x3D;123456, birthday&#x3D;Fri Dec 13 08:00:00 CST 2019, sex&#x3D;true, address&#x3D;北京, roles&#x3D;[Role(roleId&#x3D;2, roleName&#x3D;校长, roleDesc&#x3D;管理整个学校), Role(roleId&#x3D;1, roleName&#x3D;院长, roleDesc&#x3D;管理整个学院)])</span><br><span class="line">Employee(id&#x3D;2, username&#x3D;TBB, password&#x3D;123456, birthday&#x3D;Tue Dec 10 08:00:00 CST 2019, sex&#x3D;false, address&#x3D;上海, roles&#x3D;[Role(roleId&#x3D;1, roleName&#x3D;院长, roleDesc&#x3D;管理整个学院)])</span><br><span class="line">Employee(id&#x3D;3, username&#x3D;TCC, password&#x3D;123456, birthday&#x3D;Wed Dec 04 08:00:00 CST 2019, sex&#x3D;true, address&#x3D;广州, roles&#x3D;[Role(roleId&#x3D;3, roleName&#x3D;班长, roleDesc&#x3D;管理班级)])</span><br></pre></td></tr></table></figure>



</li>
</ul>
<p>以上就是查询用户下面所有的角色，那么如何查询角色获取角色下所属用户信息呢？</p>
<p>Role实体类加入employees引用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">public class Role implements Serializable &#123;</span><br><span class="line">    private static final long serialVersionUID &#x3D; -2661131928069328685L;</span><br><span class="line">    private Integer roleId;</span><br><span class="line">    private String roleName;</span><br><span class="line">    private String roleDesc;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 一对多关系映射：主表实体类中应该包含从表实体的集合引用</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private List&lt;Employee&gt; employees;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>IRoleDao：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public interface IRoleDao &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 查询所有</span><br><span class="line">     *</span><br><span class="line">     * @return 返回数据集合</span><br><span class="line">     *&#x2F;</span><br><span class="line">    List&lt;Role&gt; findAll();</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 查询所有角色并包含用户信息</span><br><span class="line">     *</span><br><span class="line">     * @return 返回数据集合</span><br><span class="line">     *&#x2F;</span><br><span class="line">    List&lt;Role&gt; findAllWithEmployee();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>IRoleDao.xml：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;&#x2F;DTD Mapper 3.0&#x2F;&#x2F;EN&quot;</span><br><span class="line">        &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace&#x3D;&quot;com.ivyzh.dao.IRoleDao&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--配置Role的resultMap--&gt;</span><br><span class="line">    &lt;resultMap id&#x3D;&quot;reMap&quot; type&#x3D;&quot;role&quot;&gt;</span><br><span class="line">        &lt;id property&#x3D;&quot;roleId&quot; column&#x3D;&quot;rid&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;roleName&quot; column&#x3D;&quot;role_name&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;roleDesc&quot; column&#x3D;&quot;role_desc&quot;&#x2F;&gt;</span><br><span class="line">        &lt;!--配置role对象中employees集合的映射--&gt;</span><br><span class="line">        &lt;collection property&#x3D;&quot;employees&quot; ofType&#x3D;&quot;employee&quot;&gt;</span><br><span class="line">            &lt;id property&#x3D;&quot;id&quot; column&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result property&#x3D;&quot;username&quot; column&#x3D;&quot;username&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result property&#x3D;&quot;password&quot; column&#x3D;&quot;password&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result property&#x3D;&quot;sex&quot; column&#x3D;&quot;sex&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result property&#x3D;&quot;birthday&quot; column&#x3D;&quot;birthday&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result property&#x3D;&quot;address&quot; column&#x3D;&quot;address&quot;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;collection&gt;</span><br><span class="line">    &lt;&#x2F;resultMap&gt;</span><br><span class="line">    &lt;!--查询所有--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findAll&quot; resultMap&#x3D;&quot;reMap&quot;&gt;</span><br><span class="line">        select r.id AS rid,r.&#96;role_name&#96;,r.&#96;role_desc&#96; from t_role r</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--查询所有角色并包含用户信息--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findAllWithEmployee&quot; resultMap&#x3D;&quot;reMap&quot;&gt;</span><br><span class="line">        SELECT r.id AS rid,r.&#96;role_name&#96;,r.&#96;role_desc&#96;,e.*  FROM t_role r</span><br><span class="line">        LEFT OUTER JOIN t_employee_role er ON r.id &#x3D; er.&#96;rid&#96;</span><br><span class="line">        LEFT OUTER JOIN t_employee e ON e.id &#x3D; er.&#96;cid&#96;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br></pre></td></tr></table></figure>



<p>测试类RoleTest：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * RoleTest演示多对多——角色对应的用户信息</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class RoleTest &#123;</span><br><span class="line"></span><br><span class="line">    InputStream is;</span><br><span class="line">    SqlSession sqlSession;</span><br><span class="line"></span><br><span class="line">    @Before</span><br><span class="line">    public void init() throws IOException &#123;</span><br><span class="line">        &#x2F;&#x2F;1. 读取配置文件</span><br><span class="line">        is &#x3D; Resources.getResourceAsStream(&quot;SqlMapConfig.xml&quot;);</span><br><span class="line">        &#x2F;&#x2F;2. 创建SqlSessionFactory工厂</span><br><span class="line">        SqlSessionFactoryBuilder builder &#x3D; new SqlSessionFactoryBuilder();</span><br><span class="line">        SqlSessionFactory factory &#x3D; builder.build(is);</span><br><span class="line">        &#x2F;&#x2F;3. 使用工厂生产SqlSession对象</span><br><span class="line">        sqlSession &#x3D; factory.openSession();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 查询所有用户数据</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void testFindAll() &#123;</span><br><span class="line">        IRoleDao mapper &#x3D; sqlSession.getMapper(IRoleDao.class);</span><br><span class="line">        List&lt;Role&gt; roles &#x3D; mapper.findAll();</span><br><span class="line">        print(roles);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void findAllWithEmployee() &#123;</span><br><span class="line">        IRoleDao mapper &#x3D; sqlSession.getMapper(IRoleDao.class);</span><br><span class="line">        List&lt;Role&gt; roles &#x3D; mapper.findAllWithEmployee();</span><br><span class="line">        print(roles);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void print(List&lt;Role&gt; objs) &#123;</span><br><span class="line">        for (Role obj : objs) &#123;</span><br><span class="line">            System.out.println(obj);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @After</span><br><span class="line">    public void destory() throws IOException &#123;</span><br><span class="line">        &#x2F;&#x2F;提交事务，或者放到destory里面</span><br><span class="line">        sqlSession.commit();</span><br><span class="line">        &#x2F;&#x2F;6. 释放资源</span><br><span class="line">        sqlSession.close();</span><br><span class="line">        is.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>输出：</p>
<ul>
<li><p>testFindAll</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Role(roleId&#x3D;1, roleName&#x3D;院长, roleDesc&#x3D;管理整个学院, employees&#x3D;[])</span><br><span class="line">Role(roleId&#x3D;2, roleName&#x3D;校长, roleDesc&#x3D;管理整个学校, employees&#x3D;[])</span><br><span class="line">Role(roleId&#x3D;3, roleName&#x3D;班长, roleDesc&#x3D;管理班级, employees&#x3D;[])</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>testFindAllWithRole</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Role(roleId&#x3D;2, roleName&#x3D;校长, roleDesc&#x3D;管理整个学校, employees&#x3D;[Employee(id&#x3D;1, username&#x3D;TAA, password&#x3D;123456, birthday&#x3D;Fri Dec 13 08:00:00 CST 2019, sex&#x3D;true, address&#x3D;北京, roles&#x3D;null)])</span><br><span class="line">Role(roleId&#x3D;1, roleName&#x3D;院长, roleDesc&#x3D;管理整个学院, employees&#x3D;[Employee(id&#x3D;1, username&#x3D;TAA, password&#x3D;123456, birthday&#x3D;Fri Dec 13 08:00:00 CST 2019, sex&#x3D;true, address&#x3D;北京, roles&#x3D;null), Employee(id&#x3D;2, username&#x3D;TBB, password&#x3D;123456, birthday&#x3D;Tue Dec 10 08:00:00 CST 2019, sex&#x3D;false, address&#x3D;上海, roles&#x3D;null)])</span><br><span class="line">Role(roleId&#x3D;3, roleName&#x3D;班长, roleDesc&#x3D;管理班级, employees&#x3D;[Employee(id&#x3D;3, username&#x3D;TCC, password&#x3D;123456, birthday&#x3D;Wed Dec 04 08:00:00 CST 2019, sex&#x3D;true, address&#x3D;广州, roles&#x3D;null)])</span><br></pre></td></tr></table></figure>




</li>
</ul>
<p>至此，项目的目录结构如图：</p>
<p><img src="/" class="lazyload" data-src="/img/assets/1576573295619.png"  alt="1576573295619"></p>
<p><img src="/" class="lazyload" data-src="/img/assets/1576573311736.png"  alt="1576573311736"></p>
<h2 id="延迟加载"><a href="#延迟加载" class="headerlink" title="延迟加载"></a>延迟加载</h2><h3 id="延迟加载和立即加载的概念"><a href="#延迟加载和立即加载的概念" class="headerlink" title="延迟加载和立即加载的概念"></a>延迟加载和立即加载的概念</h3><p>问题：在一对多中，当我们有一个用户，它有100个账户。<br>      在查询用户的时候，要不要把关联的账户查出来？<br>      在查询账户的时候，要不要把关联的用户查出来？</p>
<p>在查询用户时，用户下的账户信息应该是，什么时候使用，什么时候查询的。<br>在查询账户时，账户的所属用户信息应该是随着账户查询时一起查询出来。</p>
<p>什么是延迟加载<br>    在真正使用数据时才发起查询，不用的时候不查询。按需加载（懒加载）<br>什么是立即加载<br>    不管用不用，只要一调用方法，马上发起查询。</p>
<p>在对应的四种表关系中：一对多，多对一，一对一，多对多<br>    一对多，多对多：通常情况下我们都是采用延迟加载。<br>    多对一，一对一：通常情况下我们都是采用立即加载。</p>
<h3 id="一对一实现延迟加载"><a href="#一对一实现延迟加载" class="headerlink" title="一对一实现延迟加载"></a>一对一实现延迟加载</h3><p>这个案例可以用Customer和Account这个表来演示，即一个账户对应一个用户。</p>
<p>之前在讲多表查询（一对一）章节的时候略过了，但这里需要用到这个案例，看来还是躲不过去的。</p>
<p>那么我们先用Customer和Account来演示立即加载的情况吧。</p>
<p>注：只演示AccountDao.findById查询账户信息且带出用户信息的情况。</p>
<h4 id="立即加载"><a href="#立即加载" class="headerlink" title="立即加载"></a>立即加载</h4><p>修改Account实体类，加入Customer：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">public class Account implements Serializable &#123;</span><br><span class="line">    private static final long serialVersionUID &#x3D; 1113742752197915016L;</span><br><span class="line">    private Integer id;</span><br><span class="line">    private Integer money;</span><br><span class="line">    private Integer uid;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 演示一对一查询</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private Customer customer;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Account&#123;&quot; + &quot;id&#x3D;&quot; + id + &quot;, money&#x3D;&quot; + money + &quot;, uid&#x3D;&quot; + uid + &quot;&#125;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>IAccountDao:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public interface IAccountDao &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据id查询账户信息</span><br><span class="line">     *</span><br><span class="line">     * @param id 账户id</span><br><span class="line">     * @return 账户信息</span><br><span class="line">     *&#x2F;</span><br><span class="line">    Account findById(Integer id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>IAccountDao.xml：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;&#x2F;DTD Mapper 3.0&#x2F;&#x2F;EN&quot;</span><br><span class="line">        &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace&#x3D;&quot;com.ivyzh.dao.IAccountDao&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--配置Account的resultMap--&gt;</span><br><span class="line">    &lt;resultMap id&#x3D;&quot;acMap&quot; type&#x3D;&quot;account&quot;&gt;</span><br><span class="line">        &lt;id property&#x3D;&quot;id&quot; column&#x3D;&quot;aid&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;money&quot; column&#x3D;&quot;money&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;uid&quot; column&#x3D;&quot;uid&quot;&#x2F;&gt;</span><br><span class="line">        &lt;!--配置account对象中customer集合的映射--&gt;</span><br><span class="line">        &lt;collection property&#x3D;&quot;customer&quot; ofType&#x3D;&quot;customer&quot;&gt;</span><br><span class="line">            &lt;id property&#x3D;&quot;id&quot; column&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result property&#x3D;&quot;username&quot; column&#x3D;&quot;username&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result property&#x3D;&quot;password&quot; column&#x3D;&quot;password&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result property&#x3D;&quot;sex&quot; column&#x3D;&quot;sex&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result property&#x3D;&quot;birthday&quot; column&#x3D;&quot;birthday&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result property&#x3D;&quot;address&quot; column&#x3D;&quot;address&quot;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;collection&gt;</span><br><span class="line">    &lt;&#x2F;resultMap&gt;</span><br><span class="line">    &lt;!--查询所有--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findById&quot; parameterType&#x3D;&quot;int&quot; resultMap&#x3D;&quot;acMap&quot;&gt;</span><br><span class="line">       SELECT a.id AS aid,a.money AS money,a.uid AS uid, c.* FROM t_account a,t_customer c WHERE a.id &#x3D; #&#123;aid&#125; AND a.uid &#x3D; c.id</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br></pre></td></tr></table></figure>

<p>测试类AccountTest：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">&#x2F;**</span><br><span class="line"> * 根据id查询账户信息</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Test</span><br><span class="line">public void testFindById() &#123;</span><br><span class="line">    IAccountDao mapper &#x3D; sqlSession.getMapper(IAccountDao.class);</span><br><span class="line">    Account account &#x3D; mapper.findById(4);</span><br><span class="line">    System.out.println(account);</span><br><span class="line">    System.out.println(account.getCustomer());</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>输出日志：</p>
<p>SQL：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&gt;  Preparing: SELECT a.id AS aid,a.money AS money,a.uid AS uid, c.* FROM t_account a,t_customer c WHERE a.id &#x3D; ? AND a.uid &#x3D; c.id </span><br><span class="line">&#x3D;&#x3D;&gt; Parameters: 4(Integer)</span><br><span class="line">&lt;&#x3D;&#x3D;      Total: 1</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Account&#123;id&#x3D;4, money&#x3D;4000, uid&#x3D;2&#125;</span><br><span class="line">Customer(id&#x3D;2, username&#x3D;TBB, password&#x3D;123456, birthday&#x3D;Tue Dec 10 08:00:00 CST 2019, sex&#x3D;false, address&#x3D;上海, accounts&#x3D;null)</span><br></pre></td></tr></table></figure>



<p>可以发现不仅仅查询到了Account信息，连带着Customer信息也查询出来了。</p>
<p>那么我们改造一下，只有调用的时候才查询。</p>
<h4 id="延迟加载-1"><a href="#延迟加载-1" class="headerlink" title="延迟加载"></a>延迟加载</h4><p>这里我们要用Assocation实现延迟加载。</p>
<p>IAccountDao里面新加一个方法findById2来演示延迟加载，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public interface IAccountDao &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据id查询账户信息，立即加载</span><br><span class="line">     *</span><br><span class="line">     * @param id 账户id</span><br><span class="line">     * @return 账户信息</span><br><span class="line">     *&#x2F;</span><br><span class="line">    Account findById(Integer id);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据id查询账户信息，延迟加载</span><br><span class="line">     *</span><br><span class="line">     * @param id 账户id</span><br><span class="line">     * @return 账户信息</span><br><span class="line">     *&#x2F;</span><br><span class="line">    Account findById2(Integer id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>改造IAccountDao.xml加入acMapLazy的resultMap和findById2方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;&#x2F;DTD Mapper 3.0&#x2F;&#x2F;EN&quot;</span><br><span class="line">        &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace&#x3D;&quot;com.ivyzh.dao.IAccountDao&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--配置Account的resultMap--&gt;</span><br><span class="line">    &lt;resultMap id&#x3D;&quot;acMap&quot; type&#x3D;&quot;account&quot;&gt;</span><br><span class="line">        &lt;id property&#x3D;&quot;id&quot; column&#x3D;&quot;aid&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;money&quot; column&#x3D;&quot;money&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;uid&quot; column&#x3D;&quot;uid&quot;&#x2F;&gt;</span><br><span class="line">        &lt;!--配置account对象中customer集合的映射--&gt;</span><br><span class="line">        &lt;collection property&#x3D;&quot;customer&quot; ofType&#x3D;&quot;customer&quot;&gt;</span><br><span class="line">            &lt;id property&#x3D;&quot;id&quot; column&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result property&#x3D;&quot;username&quot; column&#x3D;&quot;username&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result property&#x3D;&quot;password&quot; column&#x3D;&quot;password&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result property&#x3D;&quot;sex&quot; column&#x3D;&quot;sex&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result property&#x3D;&quot;birthday&quot; column&#x3D;&quot;birthday&quot;&#x2F;&gt;</span><br><span class="line">            &lt;result property&#x3D;&quot;address&quot; column&#x3D;&quot;address&quot;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;collection&gt;</span><br><span class="line">    &lt;&#x2F;resultMap&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--配置Account的resultMap 延迟加载--&gt;</span><br><span class="line">    &lt;resultMap id&#x3D;&quot;acMapLazy&quot; type&#x3D;&quot;account&quot;&gt;</span><br><span class="line">        &lt;id property&#x3D;&quot;id&quot; column&#x3D;&quot;aid&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;money&quot; column&#x3D;&quot;money&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;uid&quot; column&#x3D;&quot;uid&quot;&#x2F;&gt;</span><br><span class="line">        &lt;!--配置account对象中customer集合的映射--&gt;</span><br><span class="line">        &lt;association property&#x3D;&quot;customer&quot; column&#x3D;&quot;uid&quot; javaType&#x3D;&quot;customer&quot; select&#x3D;&quot;com.ivyzh.dao.ICustomerDao.findById&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;resultMap&gt;</span><br><span class="line">    &lt;!--查询所有--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findById&quot; parameterType&#x3D;&quot;int&quot; resultMap&#x3D;&quot;acMap&quot;&gt;</span><br><span class="line">       SELECT a.id AS aid,a.money AS money,a.uid AS uid, c.* FROM t_account a,t_customer c WHERE a.id &#x3D; #&#123;aid&#125; AND a.uid &#x3D; c.id</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;select id&#x3D;&quot;findById2&quot; parameterType&#x3D;&quot;int&quot; resultMap&#x3D;&quot;acMapLazy&quot;&gt;</span><br><span class="line">      select * from t_account where id &#x3D; #&#123;aid&#125;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br></pre></td></tr></table></figure>

<p>可以发现用到了ICustomerDao的findById方法，这个时候我们也要改造ICustomerDao和ICustomerDao.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">public interface ICustomerDao &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 查询所有</span><br><span class="line">     *</span><br><span class="line">     * @return 返回数据集合</span><br><span class="line">     *&#x2F;</span><br><span class="line">    List&lt;Customer&gt; findAll();</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 查询所有并包含账户信息</span><br><span class="line">     *</span><br><span class="line">     * @return 返回数据集合</span><br><span class="line">     *&#x2F;</span><br><span class="line">    List&lt;Customer&gt; findAllWithAccount();</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据id查询用户信息</span><br><span class="line">     *</span><br><span class="line">     * @param id 用户id</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    Customer findById(Integer id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ICustomerDao.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">&lt;!--根据id查询用户信息--&gt;</span><br><span class="line">&lt;select id&#x3D;&quot;findById&quot; parameterType&#x3D;&quot;int&quot; resultType&#x3D;&quot;customer&quot;&gt;</span><br><span class="line">   select * from t_customer where id &#x3D; #&#123;uid&#125;</span><br><span class="line">&lt;&#x2F;select&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>



<p>AccountTest测试类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">&#x2F;**</span><br><span class="line"> * 根据id查询账户信息-延迟加载</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Test</span><br><span class="line">public void testFindById2() &#123;</span><br><span class="line">    IAccountDao mapper &#x3D; sqlSession.getMapper(IAccountDao.class);</span><br><span class="line">    Account account &#x3D; mapper.findById2(1);</span><br><span class="line">    &#x2F;&#x2F;System.out.println(account);</span><br><span class="line">    &#x2F;&#x2F;System.out.println(account.getCustomer());</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>为了方便演示，我们将输出注释，只看sql语句就行。</p>
<p>我们运行<code>testFindById2</code>方法，观察日志输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&gt;  Preparing: select * from t_account where id &#x3D; ? </span><br><span class="line">&#x3D;&#x3D;&gt; Parameters: 1(Integer)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&gt;  Preparing: select * from t_customer where id &#x3D; ? </span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&gt; Parameters: 1(Integer)</span><br><span class="line">&lt;&#x3D;&#x3D;&#x3D;&#x3D;      Total: 1</span><br><span class="line">&lt;&#x3D;&#x3D;      Total: 1</span><br></pre></td></tr></table></figure>

<p>可以发现执行了两条sql语句，并没有延迟加载啊？原因在哪里呢？</p>
<p>因为Mybatis默认是不开启延迟加载的，如果要开启需要在SqlMapConfig.xml文件里面配置：</p>
<p><img src="/" class="lazyload" data-src="/img/assets/1576576895349.png"  alt="1576576895349"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    &lt;!--配置参数--&gt;</span><br><span class="line">    &lt;settings&gt;</span><br><span class="line">        &lt;setting name&#x3D;&quot;lazyLoadingEnabled&quot; value&#x3D;&quot;true&quot;&#x2F;&gt;</span><br><span class="line">        &lt;setting name&#x3D;&quot;aggressiveLazyLoading&quot; value&#x3D;&quot;false&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;settings&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>配置完成之后运行，看日志，发现只有一条SQL语句执行了，说明实现了延迟加载：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&gt;  Preparing: select * from t_account where id &#x3D; ? </span><br><span class="line">&#x3D;&#x3D;&gt; Parameters: 1(Integer)</span><br><span class="line">&lt;&#x3D;&#x3D;      Total: 1</span><br></pre></td></tr></table></figure>

<p>只有主动调用<code>account.getCustomer()</code>方法才会执行另一条查询sql。</p>
<h3 id="一对多实现延迟加载"><a href="#一对多实现延迟加载" class="headerlink" title="一对多实现延迟加载"></a>一对多实现延迟加载</h3><p>之前CustomerTest测试类中的testFindAllWithAccount是查询所有信息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Customer(id&#x3D;1, username&#x3D;TAA, password&#x3D;123456, birthday&#x3D;Fri Dec 13 08:00:00 CST 2019, sex&#x3D;true, address&#x3D;北京, accounts&#x3D;[Account&#123;id&#x3D;1, money&#x3D;1000, uid&#x3D;1&#125;, Account&#123;id&#x3D;2, money&#x3D;2000, uid&#x3D;1&#125;, Account&#123;id&#x3D;3, money&#x3D;3000, uid&#x3D;1&#125;])</span><br><span class="line">Customer(id&#x3D;2, username&#x3D;TBB, password&#x3D;123456, birthday&#x3D;Tue Dec 10 08:00:00 CST 2019, sex&#x3D;false, address&#x3D;上海, accounts&#x3D;[Account&#123;id&#x3D;4, money&#x3D;4000, uid&#x3D;2&#125;, Account&#123;id&#x3D;5, money&#x3D;5000, uid&#x3D;2&#125;])</span><br><span class="line">Customer(id&#x3D;3, username&#x3D;TCC, password&#x3D;123456, birthday&#x3D;Wed Dec 04 08:00:00 CST 2019, sex&#x3D;true, address&#x3D;广州, accounts&#x3D;[Account&#123;id&#x3D;6, money&#x3D;6000, uid&#x3D;3&#125;])</span><br></pre></td></tr></table></figure>

<p>我们改造一下这个方法，期望的效果是当调用查询用户方法的时候，不主动查询与其关联的账户信息。</p>
<p>IAccountDao加入findByUid方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">public interface IAccountDao &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据id查询账户信息，立即加载</span><br><span class="line">     *</span><br><span class="line">     * @param id 账户id</span><br><span class="line">     * @return 账户信息</span><br><span class="line">     *&#x2F;</span><br><span class="line">    Account findById(Integer id);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据用户id查询账户信息</span><br><span class="line">     *</span><br><span class="line">     * @param id 用户id</span><br><span class="line">     * @return 账户信息</span><br><span class="line">     *&#x2F;</span><br><span class="line">    List&lt;Account&gt; findByUid(Integer id);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据id查询账户信息，延迟加载</span><br><span class="line">     *</span><br><span class="line">     * @param id 账户id</span><br><span class="line">     * @return 账户信息</span><br><span class="line">     *&#x2F;</span><br><span class="line">    Account findById2(Integer id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>IAccountDao.xml实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    &lt;select id&#x3D;&quot;findByUid&quot; parameterType&#x3D;&quot;int&quot; resultType&#x3D;&quot;account&quot;&gt;</span><br><span class="line">      select * from t_account where uid &#x3D; #&#123;uid&#125;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>



<p>ICustomerDao加入findAllWithAccount2方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">public interface ICustomerDao &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 查询所有</span><br><span class="line">     *</span><br><span class="line">     * @return 返回数据集合</span><br><span class="line">     *&#x2F;</span><br><span class="line">    List&lt;Customer&gt; findAll();</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 查询所有并包含账户信息</span><br><span class="line">     *</span><br><span class="line">     * @return 返回数据集合</span><br><span class="line">     *&#x2F;</span><br><span class="line">    List&lt;Customer&gt; findAllWithAccount();</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 查询所有并包含账户信息，延迟加载</span><br><span class="line">     *</span><br><span class="line">     * @return 返回数据集合</span><br><span class="line">     *&#x2F;</span><br><span class="line">    List&lt;Customer&gt; findAllWithAccount2();</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据id查询用户信息</span><br><span class="line">     *</span><br><span class="line">     * @param id 用户id</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    Customer findById(Integer id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ICustomerDao.xml实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    &lt;!--配置Customer的resultMap--&gt;</span><br><span class="line">    &lt;resultMap id&#x3D;&quot;caMapLazy&quot; type&#x3D;&quot;customer&quot;&gt;</span><br><span class="line">        &lt;id property&#x3D;&quot;id&quot; column&#x3D;&quot;id&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;username&quot; column&#x3D;&quot;username&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;password&quot; column&#x3D;&quot;password&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;sex&quot; column&#x3D;&quot;sex&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;birthday&quot; column&#x3D;&quot;birthday&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;address&quot; column&#x3D;&quot;address&quot;&#x2F;&gt;</span><br><span class="line">        &lt;!--配置customer对象中accounts集合的映射--&gt;</span><br><span class="line">        &lt;collection property&#x3D;&quot;accounts&quot; column&#x3D;&quot;id&quot; ofType&#x3D;&quot;account&quot; select&#x3D;&quot;com.ivyzh.dao.IAccountDao.findByUid&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;resultMap&gt;</span><br><span class="line">    &lt;!--查询所有并包含账户信息-延迟加载--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findAllWithAccount2&quot; resultMap&#x3D;&quot;caMapLazy&quot;&gt;</span><br><span class="line">       select * from t_customer</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>



<p>CustomerTest测试类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    @Test</span><br><span class="line">    public void testFindAllWithAccount2() &#123;</span><br><span class="line">        ICustomerDao mapper &#x3D; sqlSession.getMapper(ICustomerDao.class);</span><br><span class="line">        List&lt;Customer&gt; customers &#x3D; mapper.findAllWithAccount2();</span><br><span class="line">        for (Customer customer : customers) &#123;</span><br><span class="line">            System.out.println(&quot;+++&quot; + customer);</span><br><span class="line">            List&lt;Account&gt; accounts &#x3D; customer.getAccounts();</span><br><span class="line">            for (Account account : accounts) &#123;</span><br><span class="line">                System.out.println(&quot;---&quot; + account);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>输出日志：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&gt;  Preparing: select * from t_customer </span><br><span class="line">&#x3D;&#x3D;&gt; Parameters: </span><br><span class="line">&lt;&#x3D;&#x3D;      Total: 3</span><br><span class="line">&#x3D;&#x3D;&gt;  Preparing: select * from t_account where uid &#x3D; ? </span><br><span class="line">&#x3D;&#x3D;&gt; Parameters: 1(Integer)</span><br><span class="line">&lt;&#x3D;&#x3D;      Total: 3</span><br><span class="line">+++Customer&#123;id&#x3D;1, username&#x3D;&#39;TAA&#39;, password&#x3D;&#39;123456&#39;, birthday&#x3D;Fri Dec 13 08:00:00 CST 2019, sex&#x3D;true, address&#x3D;&#39;北京&#39;&#125;</span><br><span class="line">---Account&#123;id&#x3D;1, money&#x3D;1000, uid&#x3D;1&#125;</span><br><span class="line">---Account&#123;id&#x3D;2, money&#x3D;2000, uid&#x3D;1&#125;</span><br><span class="line">---Account&#123;id&#x3D;3, money&#x3D;3000, uid&#x3D;1&#125;</span><br><span class="line">&#x3D;&#x3D;&gt;  Preparing: select * from t_account where uid &#x3D; ? </span><br><span class="line">&#x3D;&#x3D;&gt; Parameters: 2(Integer)</span><br><span class="line">&lt;&#x3D;&#x3D;      Total: 2</span><br><span class="line">+++Customer&#123;id&#x3D;2, username&#x3D;&#39;TBB&#39;, password&#x3D;&#39;123456&#39;, birthday&#x3D;Tue Dec 10 08:00:00 CST 2019, sex&#x3D;false, address&#x3D;&#39;上海&#39;&#125;</span><br><span class="line">---Account&#123;id&#x3D;4, money&#x3D;4000, uid&#x3D;2&#125;</span><br><span class="line">---Account&#123;id&#x3D;5, money&#x3D;5000, uid&#x3D;2&#125;</span><br><span class="line">&#x3D;&#x3D;&gt;  Preparing: select * from t_account where uid &#x3D; ? </span><br><span class="line">&#x3D;&#x3D;&gt; Parameters: 3(Integer)</span><br><span class="line">&lt;&#x3D;&#x3D;      Total: 1</span><br><span class="line">+++Customer&#123;id&#x3D;3, username&#x3D;&#39;TCC&#39;, password&#x3D;&#39;123456&#39;, birthday&#x3D;Wed Dec 04 08:00:00 CST 2019, sex&#x3D;true, address&#x3D;&#39;广州&#39;&#125;</span><br><span class="line">---Account&#123;id&#x3D;6, money&#x3D;6000, uid&#x3D;3&#125;</span><br></pre></td></tr></table></figure>

<p>把for循环注释了，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testFindAllWithAccount2() &#123;</span><br><span class="line">    ICustomerDao mapper &#x3D; sqlSession.getMapper(ICustomerDao.class);</span><br><span class="line">    List&lt;Customer&gt; customers &#x3D; mapper.findAllWithAccount2();</span><br><span class="line">   &#x2F;* for (Customer customer : customers) &#123;</span><br><span class="line">        System.out.println(&quot;+++&quot; + customer);</span><br><span class="line">        List&lt;Account&gt; accounts &#x3D; customer.getAccounts();</span><br><span class="line">        for (Account account : accounts) &#123;</span><br><span class="line">            System.out.println(&quot;---&quot; + account);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;*&#x2F;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>观察输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&gt;  Preparing: select * from t_customer </span><br><span class="line">&#x3D;&#x3D;&gt; Parameters: </span><br><span class="line">&lt;&#x3D;&#x3D;      Total: 3</span><br></pre></td></tr></table></figure>

<p>至此，完成了一对多的延迟加载</p>
<h2 id="一级缓存"><a href="#一级缓存" class="headerlink" title="一级缓存"></a>一级缓存</h2><p>一级缓存：</p>
<p>​    它指的是Mybatis中SqlSession对象的缓存。</p>
<p>​    当我们执行查询之后，查询的结果会同时存入到SqlSession为我们提供一块区域中。</p>
<p>​    该区域的结构是一个Map。当我们再次查询同样的数据，mybatis会先去sqlsession中</p>
<p>​    查询是否有，有的话直接拿出来用。</p>
<p>​    当SqlSession对象消失时，mybatis的一级缓存也就消失了。</p>
<p>触发清空一级缓存的情况：</p>
<p>​    一级缓存是 SqlSession 范围的缓存，当调用 SqlSession 的修改，添加，删除，commit()，close()等方法时，就会清空一级缓存。</p>
<p>使用AccountTest这个测试类来演示一级缓存：</p>
<ul>
<li>查询id=4的账户信息</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * AccountFirstCacheTest一级缓存测试</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class AccountFirstCacheTest &#123;</span><br><span class="line"></span><br><span class="line">    InputStream is;</span><br><span class="line">    SqlSession sqlSession;</span><br><span class="line">    SqlSessionFactory factory;</span><br><span class="line"></span><br><span class="line">    @Before</span><br><span class="line">    public void init() throws IOException &#123;</span><br><span class="line">        &#x2F;&#x2F;1. 读取配置文件</span><br><span class="line">        is &#x3D; Resources.getResourceAsStream(&quot;SqlMapConfig.xml&quot;);</span><br><span class="line">        &#x2F;&#x2F;2. 创建SqlSessionFactory工厂</span><br><span class="line">        SqlSessionFactoryBuilder builder &#x3D; new SqlSessionFactoryBuilder();</span><br><span class="line">        factory &#x3D; builder.build(is);</span><br><span class="line">        &#x2F;&#x2F;3. 使用工厂生产SqlSession对象</span><br><span class="line">        sqlSession &#x3D; factory.openSession();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据id查询账户信息</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void testFindById() &#123;</span><br><span class="line">        IAccountDao mapper &#x3D; sqlSession.getMapper(IAccountDao.class);</span><br><span class="line">        Account account &#x3D; mapper.findById(4);</span><br><span class="line">        Account account2 &#x3D; mapper.findById(4);</span><br><span class="line">        System.out.println(account);</span><br><span class="line">        System.out.println(account2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行日志输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&gt;  Preparing: SELECT a.id AS aid,a.money AS money,a.uid AS uid, c.* FROM t_account a,t_customer c WHERE a.id &#x3D; ? AND a.uid &#x3D; c.id </span><br><span class="line">&#x3D;&#x3D;&gt; Parameters: 4(Integer)</span><br><span class="line">&lt;&#x3D;&#x3D;      Total: 1</span><br><span class="line">Account&#123;id&#x3D;4, money&#x3D;4000, uid&#x3D;2&#125;</span><br><span class="line">Account&#123;id&#x3D;4, money&#x3D;4000, uid&#x3D;2&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><p>查询不同账户id</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">...  </span><br><span class="line">   @Test</span><br><span class="line">    public void testFindById() &#123;</span><br><span class="line">        IAccountDao mapper &#x3D; sqlSession.getMapper(IAccountDao.class);</span><br><span class="line">        Account account &#x3D; mapper.findById(4);</span><br><span class="line">        Account account2 &#x3D; mapper.findById(1);</span><br><span class="line">        System.out.println(account);</span><br><span class="line">        System.out.println(account2);</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>日志输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&gt;  Preparing: SELECT a.id AS aid,a.money AS money,a.uid AS uid, c.* FROM t_account a,t_customer c WHERE a.id &#x3D; ? AND a.uid &#x3D; c.id </span><br><span class="line">&#x3D;&#x3D;&gt; Parameters: 4(Integer)</span><br><span class="line">&lt;&#x3D;&#x3D;      Total: 1</span><br><span class="line">&#x3D;&#x3D;&gt;  Preparing: SELECT a.id AS aid,a.money AS money,a.uid AS uid, c.* FROM t_account a,t_customer c WHERE a.id &#x3D; ? AND a.uid &#x3D; c.id </span><br><span class="line">&#x3D;&#x3D;&gt; Parameters: 1(Integer)</span><br><span class="line">&lt;&#x3D;&#x3D;      Total: 1</span><br><span class="line"></span><br><span class="line">Account&#123;id&#x3D;4, money&#x3D;4000, uid&#x3D;2&#125;</span><br><span class="line">Account&#123;id&#x3D;1, money&#x3D;1000, uid&#x3D;1&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>清空sqlSession缓存</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    public void testFindById() &#123;</span><br><span class="line">        IAccountDao mapper &#x3D; sqlSession.getMapper(IAccountDao.class);</span><br><span class="line">        Account account &#x3D; mapper.findById(4);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;此方法也可以清空缓存</span><br><span class="line">        &#x2F;&#x2F;sqlSession.clearCache();</span><br><span class="line">        sqlSession.close();</span><br><span class="line">        sqlSession &#x3D; factory.openSession();</span><br><span class="line">        mapper &#x3D; sqlSession.getMapper(IAccountDao.class);</span><br><span class="line"></span><br><span class="line">        Account account2 &#x3D; mapper.findById(4);</span><br><span class="line">        System.out.println(account);</span><br><span class="line">        System.out.println(account2);</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>日志：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&gt;  Preparing: SELECT a.id AS aid,a.money AS money,a.uid AS uid, c.* FROM t_account a,t_customer c WHERE a.id &#x3D; ? AND a.uid &#x3D; c.id </span><br><span class="line">&#x3D;&#x3D;&gt; Parameters: 4(Integer)</span><br><span class="line">&lt;&#x3D;&#x3D;      Total: 1</span><br><span class="line">Resetting autocommit to true on JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@78e117e3]</span><br><span class="line">Closing JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@78e117e3]</span><br><span class="line">Returned connection 2028017635 to pool.</span><br><span class="line">Opening JDBC Connection</span><br><span class="line">Checked out connection 2028017635 from pool.</span><br><span class="line">Setting autocommit to false on JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@78e117e3]</span><br><span class="line">&#x3D;&#x3D;&gt;  Preparing: SELECT a.id AS aid,a.money AS money,a.uid AS uid, c.* FROM t_account a,t_customer c WHERE a.id &#x3D; ? AND a.uid &#x3D; c.id </span><br><span class="line">&#x3D;&#x3D;&gt; Parameters: 4(Integer)</span><br><span class="line">&lt;&#x3D;&#x3D;      Total: 1</span><br><span class="line"></span><br><span class="line">Account&#123;id&#x3D;4, money&#x3D;4000, uid&#x3D;2&#125;</span><br><span class="line">Account&#123;id&#x3D;4, money&#x3D;4000, uid&#x3D;2&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>clearCache</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testFindById() &#123;</span><br><span class="line">    IAccountDao mapper &#x3D; sqlSession.getMapper(IAccountDao.class);</span><br><span class="line">    Account account &#x3D; mapper.findById(4);</span><br><span class="line">  </span><br><span class="line">    &#x2F;&#x2F;此方法也可以清空缓存</span><br><span class="line">    sqlSession.clearCache();</span><br><span class="line">    &#x2F;*sqlSession.close();</span><br><span class="line">    sqlSession &#x3D; factory.openSession();</span><br><span class="line">    mapper &#x3D; sqlSession.getMapper(IAccountDao.class);*&#x2F;</span><br><span class="line">  </span><br><span class="line">    Account account2 &#x3D; mapper.findById(4);</span><br><span class="line">    System.out.println(account);</span><br><span class="line">    System.out.println(account2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>日志：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&gt;  Preparing: SELECT a.id AS aid,a.money AS money,a.uid AS uid, c.* FROM t_account a,t_customer c WHERE a.id &#x3D; ? AND a.uid &#x3D; c.id </span><br><span class="line">&#x3D;&#x3D;&gt; Parameters: 4(Integer)</span><br><span class="line">&lt;&#x3D;&#x3D;      Total: 1</span><br><span class="line">&#x3D;&#x3D;&gt;  Preparing: SELECT a.id AS aid,a.money AS money,a.uid AS uid, c.* FROM t_account a,t_customer c WHERE a.id &#x3D; ? AND a.uid &#x3D; c.id </span><br><span class="line">&#x3D;&#x3D;&gt; Parameters: 4(Integer)</span><br><span class="line">&lt;&#x3D;&#x3D;      Total: 1</span><br><span class="line"></span><br><span class="line">Account&#123;id&#x3D;4, money&#x3D;4000, uid&#x3D;2&#125;</span><br><span class="line">Account&#123;id&#x3D;4, money&#x3D;4000, uid&#x3D;2&#125;</span><br></pre></td></tr></table></figure>





</li>
</ul>
<h2 id="二级缓存"><a href="#二级缓存" class="headerlink" title="二级缓存"></a>二级缓存</h2><p>二级缓存:</p>
<p>​    它指的是Mybatis中SqlSessionFactory对象的缓存。由同一个SqlSessionFactory对象创建的SqlSession共享其缓存。</p>
<p>​    二级缓存的使用步骤：</p>
<p>​        第一步：让Mybatis框架支持二级缓存（在SqlMapConfig.xml中配置）</p>
<p>​        第二步：让当前的映射文件支持二级缓存（在IAccountDao.xml中配置）</p>
<p>​        第三步：让当前的操作支持二级缓存（在select标签中配置）</p>
<p>AccountSecondCacheTest：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * AccountFirstCacheTest一级缓存测试</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class AccountSecondCacheTest &#123;</span><br><span class="line"></span><br><span class="line">    InputStream is;</span><br><span class="line">    SqlSession sqlSession;</span><br><span class="line">    SqlSessionFactory factory;</span><br><span class="line"></span><br><span class="line">    @Before</span><br><span class="line">    public void init() throws IOException &#123;</span><br><span class="line">        &#x2F;&#x2F;1. 读取配置文件</span><br><span class="line">        is &#x3D; Resources.getResourceAsStream(&quot;SqlMapConfig.xml&quot;);</span><br><span class="line">        &#x2F;&#x2F;2. 创建SqlSessionFactory工厂</span><br><span class="line">        SqlSessionFactoryBuilder builder &#x3D; new SqlSessionFactoryBuilder();</span><br><span class="line">        factory &#x3D; builder.build(is);</span><br><span class="line">        &#x2F;&#x2F;3. 使用工厂生产SqlSession对象</span><br><span class="line">        sqlSession &#x3D; factory.openSession();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据id查询账户信息</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Test</span><br><span class="line">    public void testFindById() &#123;</span><br><span class="line">        IAccountDao mapper &#x3D; sqlSession.getMapper(IAccountDao.class);</span><br><span class="line">        Account account &#x3D; mapper.findById(4);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;一级缓存消失，注意这里不能用clearCache方法了</span><br><span class="line">        sqlSession.close();</span><br><span class="line"></span><br><span class="line">        SqlSession sqlSession2 &#x3D; factory.openSession();</span><br><span class="line">        IAccountDao mapper2 &#x3D; sqlSession2.getMapper(IAccountDao.class);</span><br><span class="line">        Account account2 &#x3D; mapper2.findById(4);</span><br><span class="line">        System.out.println(account);</span><br><span class="line">        System.out.println(account2);</span><br><span class="line">        System.out.println(account &#x3D;&#x3D; account2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SqlMapConfig.xml开启二级缓存setting标签：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    &lt;!--配置参数--&gt;</span><br><span class="line">    &lt;settings&gt;</span><br><span class="line">        &lt;!--开启二级缓存--&gt;</span><br><span class="line">        &lt;setting name&#x3D;&quot;cacheEnabled&quot; value&#x3D;&quot;true&quot;&#x2F;&gt;</span><br><span class="line">        &lt;!--开启延迟加载功能--&gt;</span><br><span class="line">        &lt;setting name&#x3D;&quot;lazyLoadingEnabled&quot; value&#x3D;&quot;true&quot;&#x2F;&gt;</span><br><span class="line">        &lt;setting name&#x3D;&quot;aggressiveLazyLoading&quot; value&#x3D;&quot;false&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;settings&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>



<p>IAccountDao.xml映射文件支持二级缓存cache标签：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;mapper namespace&#x3D;&quot;com.ivyzh.dao.IAccountDao&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--开启account支持二级缓存--&gt;</span><br><span class="line">    &lt;cache&#x2F;&gt;</span><br><span class="line">    ...</span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br></pre></td></tr></table></figure>

<p>让当前操作支持二级缓存useCache=”true”：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    &lt;!--配置Account的resultMap 延迟加载--&gt;</span><br><span class="line">    &lt;resultMap id&#x3D;&quot;acMapLazy&quot; type&#x3D;&quot;account&quot;&gt;</span><br><span class="line">        &lt;id property&#x3D;&quot;id&quot; column&#x3D;&quot;aid&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;money&quot; column&#x3D;&quot;money&quot;&#x2F;&gt;</span><br><span class="line">        &lt;result property&#x3D;&quot;uid&quot; column&#x3D;&quot;uid&quot;&#x2F;&gt;</span><br><span class="line">        &lt;!--配置account对象中customer集合的映射--&gt;</span><br><span class="line">        &lt;association property&#x3D;&quot;customer&quot; column&#x3D;&quot;uid&quot; javaType&#x3D;&quot;customer&quot; select&#x3D;&quot;com.ivyzh.dao.ICustomerDao.findById&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;resultMap&gt;</span><br><span class="line">    &lt;!--查询所有--&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;findById&quot; parameterType&#x3D;&quot;int&quot; resultMap&#x3D;&quot;acMap&quot; useCache&#x3D;&quot;true&quot;&gt;</span><br><span class="line">       SELECT a.id AS aid,a.money AS money,a.uid AS uid, c.* FROM t_account a,t_customer c WHERE a.id &#x3D; #&#123;aid&#125; AND a.uid &#x3D; c.id</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>



<h2 id="Mybatis注解开发"><a href="#Mybatis注解开发" class="headerlink" title="Mybatis注解开发"></a>Mybatis注解开发</h2><ul>
<li>支持常规CRUD和其他操作<ul>
<li>@Select</li>
<li>@Insert</li>
<li>@Update</li>
<li>@Delete</li>
</ul>
</li>
<li>支持一对一查询<ul>
<li>@One<ul>
<li>fetchType：LAZY、EAGER、DEAFULT</li>
</ul>
</li>
</ul>
</li>
<li>支持一对多查询，含延迟功能。<ul>
<li>@Many<ul>
<li>fetchType：LAZY、EAGER、DEAFULT</li>
</ul>
</li>
</ul>
</li>
<li>支持二级缓存（一级缓存不用开启，自动就有了）<ul>
<li>@CacheNamespace(blocking = true)</li>
</ul>
</li>
</ul>
<p>因为在实际开发当中很少使用注解形式，所以具体案例以后再补充。</p>
<h2 id="PageHelper插件"><a href="#PageHelper插件" class="headerlink" title="PageHelper插件"></a>PageHelper插件</h2><p><a href="https://pagehelper.github.io/" target="_blank" rel="noopener">https://pagehelper.github.io/</a></p>
<p>作者有本书《MyBatis 从入门到精通》</p>
<p>PageHelper说白了，是一个拦截器。</p>
<p>pom.xml引入坐标：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;com.github.pagehelper&#x2F;pagehelper --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.github.pagehelper&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;pagehelper&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.1.11&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>在 MyBatis 配置 SqlMapConfig.xml 中配置拦截器插件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- </span><br><span class="line">    plugins在配置文件中的位置必须符合要求，否则会报错，顺序如下:</span><br><span class="line">    properties?, settings?, </span><br><span class="line">    typeAliases?, typeHandlers?, </span><br><span class="line">    objectFactory?,objectWrapperFactory?, </span><br><span class="line">    plugins?, </span><br><span class="line">    environments?, databaseIdProvider?, mappers?</span><br><span class="line">--&gt;</span><br><span class="line">&lt;plugins&gt;</span><br><span class="line">    &lt;!-- com.github.pagehelper为PageHelper类所在包名 --&gt;</span><br><span class="line">    &lt;plugin interceptor&#x3D;&quot;com.github.pagehelper.PageInterceptor&quot;&gt;</span><br><span class="line">        &lt;!-- 使用下面的方式配置参数，后面会有所有的参数介绍 --&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;param1&quot; value&#x3D;&quot;value1&quot;&#x2F;&gt;</span><br><span class="line">	&lt;&#x2F;plugin&gt;</span><br><span class="line">&lt;&#x2F;plugins&gt;</span><br></pre></td></tr></table></figure>

<p>分页插件支持以下几种调用方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;第一种，RowBounds方式的调用</span><br><span class="line">List&lt;User&gt; list &#x3D; sqlSession.selectList(&quot;x.y.selectIf&quot;, null, new RowBounds(0, 10));</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;第二种，Mapper接口方式的调用，推荐这种使用方式。</span><br><span class="line">PageHelper.startPage(1, 10);</span><br><span class="line">List&lt;User&gt; list &#x3D; userMapper.selectIf(1);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;第三种，Mapper接口方式的调用，推荐这种使用方式。</span><br><span class="line">PageHelper.offsetPage(1, 10);</span><br><span class="line">List&lt;User&gt; list &#x3D; userMapper.selectIf(1);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;第四种，参数方法调用</span><br><span class="line">&#x2F;&#x2F;存在以下 Mapper 接口方法，你不需要在 xml 处理后两个参数</span><br><span class="line">public interface CountryMapper &#123;</span><br><span class="line">    List&lt;User&gt; selectByPageNumSize(</span><br><span class="line">            @Param(&quot;user&quot;) User user,</span><br><span class="line">            @Param(&quot;pageNum&quot;) int pageNum, </span><br><span class="line">            @Param(&quot;pageSize&quot;) int pageSize);</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;配置supportMethodsArguments&#x3D;true</span><br><span class="line">&#x2F;&#x2F;在代码中直接调用：</span><br><span class="line">List&lt;User&gt; list &#x3D; userMapper.selectByPageNumSize(user, 1, 10);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;第五种，参数对象</span><br><span class="line">&#x2F;&#x2F;如果 pageNum 和 pageSize 存在于 User 对象中，只要参数有值，也会被分页</span><br><span class="line">&#x2F;&#x2F;有如下 User 对象</span><br><span class="line">public class User &#123;</span><br><span class="line">    &#x2F;&#x2F;其他fields</span><br><span class="line">    &#x2F;&#x2F;下面两个参数名和 params 配置的名字一致</span><br><span class="line">    private Integer pageNum;</span><br><span class="line">    private Integer pageSize;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;存在以下 Mapper 接口方法，你不需要在 xml 处理后两个参数</span><br><span class="line">public interface CountryMapper &#123;</span><br><span class="line">    List&lt;User&gt; selectByPageNumSize(User user);</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;当 user 中的 pageNum!&#x3D; null &amp;&amp; pageSize!&#x3D; null 时，会自动分页</span><br><span class="line">List&lt;User&gt; list &#x3D; userMapper.selectByPageNumSize(user);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;第六种，ISelect 接口方式</span><br><span class="line">&#x2F;&#x2F;jdk6,7用法，创建接口</span><br><span class="line">Page&lt;User&gt; page &#x3D; PageHelper.startPage(1, 10).doSelectPage(new ISelect() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void doSelect() &#123;</span><br><span class="line">        userMapper.selectGroupBy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#x2F;&#x2F;jdk8 lambda用法</span><br><span class="line">Page&lt;User&gt; page &#x3D; PageHelper.startPage(1, 10).doSelectPage(()-&gt; userMapper.selectGroupBy());</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;也可以直接返回PageInfo，注意doSelectPageInfo方法和doSelectPage</span><br><span class="line">pageInfo &#x3D; PageHelper.startPage(1, 10).doSelectPageInfo(new ISelect() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void doSelect() &#123;</span><br><span class="line">        userMapper.selectGroupBy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#x2F;&#x2F;对应的lambda用法</span><br><span class="line">pageInfo &#x3D; PageHelper.startPage(1, 10).doSelectPageInfo(() -&gt; userMapper.selectGroupBy());</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;count查询，返回一个查询语句的count数</span><br><span class="line">long total &#x3D; PageHelper.count(new ISelect() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void doSelect() &#123;</span><br><span class="line">        userMapper.selectLike(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#x2F;&#x2F;lambda</span><br><span class="line">total &#x3D; PageHelper.count(()-&gt;userMapper.selectLike(user));</span><br></pre></td></tr></table></figure>



<p>推荐第二种和第三种。</p>
<h2 id="逆向工程MyBatis-Generotor"><a href="#逆向工程MyBatis-Generotor" class="headerlink" title="逆向工程MyBatis-Generotor"></a>逆向工程MyBatis-Generotor</h2><p>一句话总结：项目初期可以使用，后面就不推荐使用了。</p>
<p>以后再找案例说明。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h3 id="待完善内容"><a href="#待完善内容" class="headerlink" title="待完善内容"></a>待完善内容</h3><ul>
<li>mybatis入门案例中的设计模式分析</li>
<li>自定义Mybatis</li>
<li>事务控制</li>
</ul>
<h3 id="问题记录"><a href="#问题记录" class="headerlink" title="问题记录"></a>问题记录</h3><ul>
<li>package标签在封装mapper的时候，报错。<ul>
<li>已解决：<a href="https://blog.csdn.net/weixin_43951534/article/details/90416363" target="_blank" rel="noopener">https://blog.csdn.net/weixin_43951534/article/details/90416363</a></li>
<li>适用于类路径下,接口文件与映射文件在<strong>同一路径</strong>下,且接口名与映射<strong>文件名相同</strong>,并且映射文件命名为接口全类名的情况</li>
</ul>
</li>
</ul>
<h3 id="欢迎反馈"><a href="#欢迎反馈" class="headerlink" title="欢迎反馈"></a>欢迎反馈</h3><p>文章不足之处，还望指正交流。有啥意见和建议的都可以提出来，后续会继续改进:smiley:</p>
<p>准备写一系列的文章MyBatis、MyBatisPlus、Spring、SpringMVC、Oracle、Maven、ElasticSearch、SpringBoot、SpringCloud、RabbitMQ、Nginx…</p>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><ol>
<li><a href="https://www.w3cschool.cn/mybatis/" target="_blank" rel="noopener">https://www.w3cschool.cn/mybatis/</a></li>
<li><a href="https://blog.csdn.net/hellozpc/article/details/80878563" target="_blank" rel="noopener">https://blog.csdn.net/hellozpc/article/details/80878563</a></li>
</ol>
<p><strong>END</strong></p>
</div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a><a class="post-meta__tags" href="/tags/MyBatis/">MyBatis</a><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A1%86%E6%9E%B6/">数据库框架</a></div><div class="post_share"><div class="social-share" data-image="/img/post.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/04/16/Android%20Studio3.x%E4%B8%8A%E4%BD%BF%E7%94%A8Lombok/"><img class="prev_cover lazyload" data-src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1587041127112&amp;di=7668cf504c2ca89b87b95ca8a8cd4e5f&amp;imgtype=0&amp;src=http%3A%2F%2F5b0988e595225.cdn.sohucs.com%2Fimages%2F20171116%2F234a497834c444a9a502efd31d514538.jpeg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Android Studio3.x上使用Lombok</div></div></a></div><div class="next-post pull_right"><a href="/2020/04/16/hello-world/"><img class="next_cover lazyload" data-src="/img/post.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Hello World</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/05/08/SSM整合/" title="SSM整合"><img class="relatedPosts_cover lazyload"data-src="http://5b0988e595225.cdn.sohucs.com/images/20200330/ebea1c5b0b214729882128861c7354b9.jpeg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-08</div><div class="relatedPosts_title">SSM整合</div></div></a></div><div class="relatedPosts_item"><a href="/2020/05/21/博文地址推荐/" title="博文地址推荐"><img class="relatedPosts_cover lazyload"data-src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1591889554697&di=6cd48317171455e6e367313f3430a2e2&imgtype=0&src=http%3A%2F%2F5b0988e595225.cdn.sohucs.com%2Fimages%2F20180717%2Fab8a30734c7f45ad847ca089864e25e4.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-21</div><div class="relatedPosts_title">博文地址推荐</div></div></a></div><div class="relatedPosts_item"><a href="/2020/05/13/开发技能汇总/" title="开发技能汇总"><img class="relatedPosts_cover lazyload"data-src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1589358596541&di=ec2608777052785cb20f0d366f2d82b7&imgtype=0&src=http%3A%2F%2F5b0988e595225.cdn.sohucs.com%2Fimages%2F20170830%2F544fed872efd40a5acf7ebcec0067fc1.jpeg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-13</div><div class="relatedPosts_title">开发技能汇总</div></div></a></div><div class="relatedPosts_item"><a href="/2020/05/07/SpringMVC使用详解/" title="SpringMVC使用详解"><img class="relatedPosts_cover lazyload"data-src="https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=1640451212,3045819206&fm=26&gp=0.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-07</div><div class="relatedPosts_title">SpringMVC使用详解</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/26/Spring使用详解/" title="Spring使用详解"><img class="relatedPosts_cover lazyload"data-src="https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=1640451212,3045819206&fm=26&gp=0.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-26</div><div class="relatedPosts_title">Spring使用详解</div></div></a></div></div><div class="clear_both"></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By Kai</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script></body></html>