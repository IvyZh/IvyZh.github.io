<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Top团队大牛带你玩转Android性能分析与优化 | K的小屋</title><meta name="description" content="Top团队大牛带你玩转Android性能分析与优化"><meta name="keywords" content="Android,性能优化"><meta name="author" content="Kai"><meta name="copyright" content="Kai"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Top团队大牛带你玩转Android性能分析与优化"><meta name="twitter:description" content="Top团队大牛带你玩转Android性能分析与优化"><meta name="twitter:image" content="https://coding.imooc.com/static/module/class/content/img/308/section1-2.png"><meta property="og:type" content="article"><meta property="og:title" content="Top团队大牛带你玩转Android性能分析与优化"><meta property="og:url" content="https://www.google.com/2020/06/29/Top%E5%9B%A2%E9%98%9F%E5%A4%A7%E7%89%9B%E5%B8%A6%E4%BD%A0%E7%8E%A9%E8%BD%ACAndroid%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E4%B8%8E%E4%BC%98%E5%8C%96/"><meta property="og:site_name" content="K的小屋"><meta property="og:description" content="Top团队大牛带你玩转Android性能分析与优化"><meta property="og:image" content="https://coding.imooc.com/static/module/class/content/img/308/section1-2.png"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://www.google.com/2020/06/29/Top%E5%9B%A2%E9%98%9F%E5%A4%A7%E7%89%9B%E5%B8%A6%E4%BD%A0%E7%8E%A9%E8%BD%ACAndroid%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E4%B8%8E%E4%BC%98%E5%8C%96/"><link rel="next" title="Ubuntu18.04编译安卓" href="https://www.google.com/2020/06/25/Ubuntu18.04%E7%BC%96%E8%AF%91%E5%AE%89%E5%8D%93/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: true
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">24</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">28</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">12</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#第1章-课程导学与学习指南"><span class="toc-number">1.</span> <span class="toc-text">第1章 课程导学与学习指南</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第2章-App性能概览与平台化实践"><span class="toc-number">2.</span> <span class="toc-text">第2章 App性能概览与平台化实践</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第3章-App启动优化"><span class="toc-number">3.</span> <span class="toc-text">第3章 App启动优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#App启动分类"><span class="toc-number">3.1.</span> <span class="toc-text">App启动分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#冷启动"><span class="toc-number">3.1.1.</span> <span class="toc-text">冷启动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#热启动"><span class="toc-number">3.1.2.</span> <span class="toc-text">热启动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#温启动"><span class="toc-number">3.1.3.</span> <span class="toc-text">温启动</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#相关任务"><span class="toc-number">3.2.</span> <span class="toc-text">相关任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#优化方向"><span class="toc-number">3.3.</span> <span class="toc-text">优化方向</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#启动时间测量方式"><span class="toc-number">3.4.</span> <span class="toc-text">启动时间测量方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#adb命令"><span class="toc-number">3.4.1.</span> <span class="toc-text">adb命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#手动打点"><span class="toc-number">3.4.2.</span> <span class="toc-text">手动打点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#启动优化工具"><span class="toc-number">3.5.</span> <span class="toc-text">启动优化工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#TraceView"><span class="toc-number">3.5.1.</span> <span class="toc-text">TraceView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Systrace"><span class="toc-number">3.5.2.</span> <span class="toc-text">Systrace</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#获取方法执行耗时实践"><span class="toc-number">3.6.</span> <span class="toc-text">获取方法执行耗时实践</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#常规方式"><span class="toc-number">3.6.1.</span> <span class="toc-text">常规方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOP方式"><span class="toc-number">3.6.2.</span> <span class="toc-text">AOP方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#优化技巧"><span class="toc-number">3.7.</span> <span class="toc-text">优化技巧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#异步优化（常规）"><span class="toc-number">3.8.</span> <span class="toc-text">异步优化（常规）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#异步初始化（最优解）"><span class="toc-number">3.9.</span> <span class="toc-text">异步初始化（最优解）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#常规异步痛点"><span class="toc-number">3.9.1.</span> <span class="toc-text">常规异步痛点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#启动器实现异步初始化"><span class="toc-number">3.9.2.</span> <span class="toc-text">启动器实现异步初始化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#延迟初始化"><span class="toc-number">3.10.</span> <span class="toc-text">延迟初始化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#常规方案"><span class="toc-number">3.10.1.</span> <span class="toc-text">常规方案</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#更优方案"><span class="toc-number">3.10.2.</span> <span class="toc-text">更优方案</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#本章总结"><span class="toc-number">3.11.</span> <span class="toc-text">本章总结</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#获取方法耗时"><span class="toc-number">3.11.1.</span> <span class="toc-text">获取方法耗时</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#优化总方针"><span class="toc-number">3.11.2.</span> <span class="toc-text">优化总方针</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#注意事项"><span class="toc-number">3.11.3.</span> <span class="toc-text">注意事项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#其他方案"><span class="toc-number">3.11.4.</span> <span class="toc-text">其他方案</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第4章-App内存优化"><span class="toc-number">4.</span> <span class="toc-text">第4章 App内存优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第5章-App布局优化"><span class="toc-number">5.</span> <span class="toc-text">第5章 App布局优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第6章-App卡顿优化"><span class="toc-number">6.</span> <span class="toc-text">第6章 App卡顿优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第7章-App线程优化"><span class="toc-number">7.</span> <span class="toc-text">第7章 App线程优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第8章-App网络优化"><span class="toc-number">8.</span> <span class="toc-text">第8章 App网络优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第9章-App电量优化"><span class="toc-number">9.</span> <span class="toc-text">第9章 App电量优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第10章-App瘦身优化"><span class="toc-number">10.</span> <span class="toc-text">第10章 App瘦身优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第11章-App稳定性优化"><span class="toc-number">11.</span> <span class="toc-text">第11章 App稳定性优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第12章-App专项技术优化"><span class="toc-number">12.</span> <span class="toc-text">第12章 App专项技术优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第13章-课程总结"><span class="toc-number">13.</span> <span class="toc-text">第13章 课程总结</span></a></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://coding.imooc.com/static/module/class/content/img/308/section1-2.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">K的小屋</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Top团队大牛带你玩转Android性能分析与优化</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-06-29 10:30:00"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-06-29</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-07-01 14:36:22"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-07-01</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">性能优化</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">3.2k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 13 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><h2 id="第1章-课程导学与学习指南"><a href="#第1章-课程导学与学习指南" class="headerlink" title="第1章 课程导学与学习指南"></a>第1章 课程导学与学习指南</h2><h2 id="第2章-App性能概览与平台化实践"><a href="#第2章-App性能概览与平台化实践" class="headerlink" title="第2章 App性能概览与平台化实践"></a>第2章 App性能概览与平台化实践</h2><h2 id="第3章-App启动优化"><a href="#第3章-App启动优化" class="headerlink" title="第3章 App启动优化"></a>第3章 App启动优化</h2><p>说在前面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">优化方向：Application和Activity生命周期</span><br></pre></td></tr></table></figure>









<h3 id="App启动分类"><a href="#App启动分类" class="headerlink" title="App启动分类"></a>App启动分类</h3><ul>
<li>冷启动</li>
<li>热启动</li>
<li>温启动</li>
</ul>
<h4 id="冷启动"><a href="#冷启动" class="headerlink" title="冷启动"></a>冷启动</h4><p>耗时最多，衡量标准：</p>
<blockquote>
<p>Click Event-&gt;IPC-&gt;Process.start-&gt;ActivityThread-&gt;bindApplication-&gt;LifeCycle-&gt;ViewRootImpl</p>
</blockquote>
<h4 id="热启动"><a href="#热启动" class="headerlink" title="热启动"></a>热启动</h4><p>最快</p>
<blockquote>
<p>后台-&gt;前台</p>
</blockquote>
<h4 id="温启动"><a href="#温启动" class="headerlink" title="温启动"></a>温启动</h4><p>较快</p>
<blockquote>
<p>LifeCycle</p>
</blockquote>
<h3 id="相关任务"><a href="#相关任务" class="headerlink" title="相关任务"></a>相关任务</h3><ul>
<li>启动之前<ul>
<li>启动App</li>
<li>加载空白Window</li>
<li>创建进程</li>
</ul>
</li>
<li>随后任务<ul>
<li>创建Application</li>
<li>启动主线程</li>
<li>创建MainActivity</li>
<li>加载布局</li>
<li>布置屏幕</li>
<li>首帧绘制</li>
</ul>
</li>
</ul>
<h3 id="优化方向"><a href="#优化方向" class="headerlink" title="优化方向"></a>优化方向</h3><ul>
<li>Application和Activity生命周期</li>
</ul>
<h3 id="启动时间测量方式"><a href="#启动时间测量方式" class="headerlink" title="启动时间测量方式"></a>启动时间测量方式</h3><ul>
<li>adb命令</li>
<li>手动打点</li>
</ul>
<h4 id="adb命令"><a href="#adb命令" class="headerlink" title="adb命令"></a>adb命令</h4><blockquote>
<p>adb shell am start -W packagename/首屏Activity</p>
</blockquote>
<p>如：adb shell am start -W com.github.chinesepoetry/com.github.chinesepoetry.MainActivity</p>
<p><img src="/" class="lazyload" data-src="https://gitee.com/vxo/img/raw/master/blog/20200630181507.png"  alt="adb命令测量启动时间"></p>
<ul>
<li>ThisTime：最后一个Activity启动耗时</li>
<li>TotalTime：所有Activity启动耗时，由于这个App只有一个界面，所以ThisTime=TotalTime</li>
<li>WaitTime：AMS启动Activity的总耗时</li>
</ul>
<p><strong>adb命令方式总结：</strong></p>
<ol>
<li>线下使用方便，不能带到线上</li>
<li>非严谨、精确的时间统计</li>
</ol>
<h4 id="手动打点"><a href="#手动打点" class="headerlink" title="手动打点"></a>手动打点</h4><blockquote>
<p>原理：启动时埋点，启动结束埋点，二者差值</p>
</blockquote>
<p>其实就是一个工具类在对应地方进行调用，获取前后差值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LauncherTimer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> sTime;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">startRecord</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        sTime = System.currentTimeMillis();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">endRecord</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        endRecord(<span class="string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">endRecord</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> cost = System.currentTimeMillis() - sTime;</span><br><span class="line">        L.d(msg + <span class="string">" cost "</span> + cost);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意点：<code>onWindowFocusChanged</code>只是首帧时间，这里不建议将埋点放在这里，可以放在数据回显的时候调用endRecord方法，比如如果是List则可以获取第一条数据的时候进行统计。</p>
<p><img src="/" class="lazyload" data-src="https://gitee.com/vxo/img/raw/master/blog/20200630191612.png"  alt="使用ViewTree统计"></p>
<p><strong>手动打点总结：</strong></p>
<ul>
<li>精确，可带到线上，推荐使用</li>
<li>避开误区，采用Feed第一条展示</li>
<li>addOnDrawListener要求Api16</li>
</ul>
<h3 id="启动优化工具"><a href="#启动优化工具" class="headerlink" title="启动优化工具"></a>启动优化工具</h3><ul>
<li>TraceView</li>
<li>Systrace</li>
</ul>
<p>两种方式互相补充，正确认识工具及不同场景选择合适的工具</p>
<h4 id="TraceView"><a href="#TraceView" class="headerlink" title="TraceView"></a>TraceView</h4><ul>
<li>图形的形式展示执行时间、调用栈等</li>
<li>信息全面，包含所有线程</li>
<li>使用方式<ul>
<li>Debug.startMethodTracing(“”);</li>
<li>Debug.stopMethodTracing();</li>
<li>生成的文件路径：/storage/emulated/0/Android/datapackageName/files</li>
</ul>
</li>
</ul>
<p>代码实践：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        <span class="comment">//存放位置/storage/emulated/0/Android/data/com.github.chinesepoetry/files</span></span><br><span class="line">        File externalFilesDir = getExternalFilesDir(<span class="keyword">null</span>);</span><br><span class="line">        L.e(<span class="string">"getExternalFilesDir:"</span> + externalFilesDir.getAbsolutePath());</span><br><span class="line">        Debug.startMethodTracing(<span class="string">"CpApp"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            为了保证运营数据的准确性，建议不要在异步线程初始化Bugly</span></span><br><span class="line"><span class="comment">            输出详细的Bugly SDK的Log；</span></span><br><span class="line"><span class="comment">            每一条Crash都会被立即上报；</span></span><br><span class="line"><span class="comment">            自定义日志将会在Logcat中输出。</span></span><br><span class="line"><span class="comment">            建议在测试阶段建议设置成true，发布时设置为false。</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        String processName = AppInfoUtils.getProcessName(android.os.Process.myPid());</span><br><span class="line">        L.d(processName);</span><br><span class="line">        CrashReport.UserStrategy strategy = <span class="keyword">new</span> CrashReport.UserStrategy(<span class="keyword">this</span>);</span><br><span class="line">        strategy.setUploadProcess(processName == <span class="keyword">null</span> || processName.equals(getPackageName()));</span><br><span class="line">        CrashReport.initCrashReport(getApplicationContext(), <span class="string">"abc123"</span>, BuildConfig.DEBUG, strategy);</span><br><span class="line"></span><br><span class="line">        Debug.stopMethodTracing();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">attachBaseContext</span><span class="params">(Context base)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.attachBaseContext(base);</span><br><span class="line">        MultiDex.install(<span class="keyword">this</span>);</span><br><span class="line">        LauncherTimer.startRecord();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>得到的Trace文件分析图如下：</p>
<p><img src="/" class="lazyload" data-src="https://gitee.com/vxo/img/raw/master/blog/20200630201452.png"  alt="TraceView分析图"></p>
<p><img src="/" class="lazyload" data-src="https://gitee.com/vxo/img/raw/master/blog/20200630201519.png"  alt="TraceView分析图"></p>
<p><strong>TraceView使用总结：</strong></p>
<ul>
<li>运行时开销严重，整体会变慢</li>
<li>可能会带偏优化方向</li>
<li>traceview与cpu profile</li>
</ul>
<h4 id="Systrace"><a href="#Systrace" class="headerlink" title="Systrace"></a>Systrace</h4><ul>
<li><p>结合Android内核数据，生成Html报告</p>
</li>
<li><p>API18以上使用，推荐TraceCompat</p>
</li>
<li><p>使用方式</p>
<ul>
<li><p>TraceCompat.beginSection(“”)</p>
</li>
<li><p>TraceCompat.endSection()</p>
</li>
<li><p>Python</p>
<blockquote>
<p>python systrace.py -t 10 [other-options] [categories]</p>
</blockquote>
</li>
<li><p>在线</p>
<ul>
<li><a href="https://developer.android.com/studio/command-line/systrace" target="_blank" rel="noopener">https://developer.android.com/studio/command-line/systrace</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python D:\develop\Android\sdk\platform-tools\systrace\systrace.py -t 20 sched gfx view wm am app webview -a &quot;packageName&quot; -o log.html</span><br><span class="line"></span><br><span class="line">如：</span><br><span class="line">python D:\develop\Android\sdk\platform-tools\systrace\systrace.py -t 20 sched gfx view wm am app webview -a com.github.chinesepoetry -o log.html</span><br></pre></td></tr></table></figure>

<p>但是这样有个问题：只支持Python 2.7</p>
<blockquote>
<p>Systrace does not support Python 3.6. Please use Python 2.7.</p>
</blockquote>
<p>可以参考：<a href="https://www.jianshu.com/p/19b3245207e8" target="_blank" rel="noopener">https://www.jianshu.com/p/19b3245207e8</a></p>
<p><strong>Systrace使用总结：</strong></p>
<ul>
<li>轻量级，开销小</li>
<li>直观反映CPU利用率</li>
<li>cpu time与wall time的区别<ul>
<li>wall time是代码执行时间</li>
<li>cpu time是代码消耗cpu的时间（重点指标）</li>
<li>举例：锁冲突</li>
</ul>
</li>
</ul>
<h3 id="获取方法执行耗时实践"><a href="#获取方法执行耗时实践" class="headerlink" title="获取方法执行耗时实践"></a>获取方法执行耗时实践</h3><h4 id="常规方式"><a href="#常规方式" class="headerlink" title="常规方式"></a>常规方式</h4><ul>
<li>背景：需要知道启动阶段所有方法耗时</li>
<li>实现：手动埋点<ul>
<li>long time = System.currentTimeMillis();//或者SystemClock.currentThreadTimeMillis()</li>
<li>long cost =  System.currentTimeMillis() - time;</li>
<li>将上述的时间计算要挨个放在每个启动方法的前后</li>
</ul>
</li>
<li>总结<ul>
<li>侵入性强</li>
<li>工作量大</li>
</ul>
</li>
</ul>
<h4 id="AOP方式"><a href="#AOP方式" class="headerlink" title="AOP方式"></a>AOP方式</h4><ul>
<li><p>Aspect Oriented Programming，面向切面编程</p>
<ul>
<li>针对同一类问题的统一处理</li>
<li>无侵入添加代码</li>
</ul>
</li>
<li><p>AspectJ使用（AspectJ就是用来辅助AOP的）</p>
<ul>
<li><p>classpath ‘com.hujiang.aspectjx:gradle-android-plugin-aspectjx:2.0.8’</p>
<ul>
<li><a href="https://github.com/HujiangTechnology/gradle_plugin_android_aspectjx" target="_blank" rel="noopener">https://github.com/HujiangTechnology/gradle_plugin_android_aspectjx</a></li>
</ul>
</li>
<li><p>implementation ‘org.aspectj:aspectjrt:1.8.13’</p>
</li>
</ul>
</li>
<li><p>总结</p>
<ul>
<li>无侵入性</li>
<li>修改方便</li>
</ul>
</li>
</ul>
<p>说明：但是我在用这种方式的时候，发现无法切Application，正常的Activity是可以获取到方法耗时的。</p>
<p>针对上面说明继续说明：后来我在Application里面sleep了3s发现可以正常aop到里面的耗时方法了</p>
<p>参考文章：<a href="https://juejin.im/post/5e0b06ab5188253a82107b32" target="_blank" rel="noopener">https://juejin.im/post/5e0b06ab5188253a82107b32</a></p>
<h3 id="优化技巧"><a href="#优化技巧" class="headerlink" title="优化技巧"></a>优化技巧</h3><ul>
<li>Theme切换：感觉上快</li>
</ul>
<p><img src="/" class="lazyload" data-src="https://gitee.com/vxo/img/raw/master/blog/20200701105949.png"  alt="Theme切换"></p>
<p><img src="/" class="lazyload" data-src="https://gitee.com/vxo/img/raw/master/blog/20200701110012.png"  alt="Theme切换"></p>
<h3 id="异步优化（常规）"><a href="#异步优化（常规）" class="headerlink" title="异步优化（常规）"></a>异步优化（常规）</h3><ul>
<li>核心思想：子线程分担主线程任务，并行减少时间</li>
<li>方式：通过线程池将诸如Bugly、Umeng、Jpush、Fresco等三方SDK的初始化工作提交给子线程执行</li>
<li>注意：针对无法在异步初始化的情况下我们就不能优化了，然后还有一种，比如在Splash页面需要用到Weex相关组件，但是Weex是在子线程初始化的，就没法保证Weex能在Splash中使用了，可以通过CountDownLatch来解决</li>
</ul>
<p>接下来演示正常初始化和异步优化的对比：</p>
<p>先看不使用异步优化的效果，这里为了效果对比我们将Bugly和Weex的初始化分别睡眠了2s和3s</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Github</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@createtime</span> 2020/7/1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desc</span> Application</span></span><br><span class="line"><span class="comment"> * Bugly、Umeng统计、高德地图、Fresco、Jpush推送、Weex、Stetho...</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> MyApplication mApplication;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> CPU_COUNT = Runtime.getRuntime().availableProcessors();</span><br><span class="line">    <span class="keyword">int</span> CORE_POOL_SIZE = Math.max(<span class="number">2</span>, Math.min(CPU_COUNT - <span class="number">1</span>, <span class="number">4</span>));</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        mApplication = <span class="keyword">this</span>;</span><br><span class="line">        LauncherTimer.startRecord();</span><br><span class="line">        ExecutorService service = Executors.newFixedThreadPool(CORE_POOL_SIZE);<span class="comment">//建议使用ThreadPoolExecutors创建</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//存放位置/storage/emulated/0/Android/data/com.github.chinesepoetry/files</span></span><br><span class="line">        <span class="comment">//File externalFilesDir = getExternalFilesDir(null);</span></span><br><span class="line">        <span class="comment">//L.e("getExternalFilesDir:" + externalFilesDir.getAbsolutePath());</span></span><br><span class="line">        <span class="comment">//Debug.startMethodTracing("CpApp");</span></span><br><span class="line">        <span class="comment">//TraceCompat.beginSection("CpApp2");</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            Bugly</span></span><br><span class="line"><span class="comment">            为了保证运营数据的准确性，建议不要在异步线程初始化Bugly</span></span><br><span class="line"><span class="comment">            输出详细的Bugly SDK的Log；</span></span><br><span class="line"><span class="comment">            每一条Crash都会被立即上报；</span></span><br><span class="line"><span class="comment">            自定义日志将会在Logcat中输出。</span></span><br><span class="line"><span class="comment">            建议在测试阶段建议设置成true，发布时设置为false。</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        initBugly();</span><br><span class="line">        <span class="comment">/*service.submit(new Runnable() &#123;</span></span><br><span class="line"><span class="comment">            @Override</span></span><br><span class="line"><span class="comment">            public void run() &#123;</span></span><br><span class="line"><span class="comment">                initBugly();</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        &#125;);*/</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         Fresco</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Fresco.initialize(mApplication);</span><br><span class="line">        <span class="comment">/*service.submit(new Runnable() &#123;</span></span><br><span class="line"><span class="comment">            @Override</span></span><br><span class="line"><span class="comment">            public void run() &#123;</span></span><br><span class="line"><span class="comment">                Fresco.initialize(mApplication);</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        &#125;);*/</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            Umeng初始化SDK</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        initUmeng();</span><br><span class="line">        <span class="comment">/*service.submit(new Runnable() &#123;</span></span><br><span class="line"><span class="comment">            @Override</span></span><br><span class="line"><span class="comment">            public void run() &#123;</span></span><br><span class="line"><span class="comment">                initUmeng();</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        &#125;);*/</span></span><br><span class="line"></span><br><span class="line">        initWeex();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Debug.stopMethodTracing();</span></span><br><span class="line">        <span class="comment">//TraceCompat.endSection();</span></span><br><span class="line">        LauncherTimer.endRecord(<span class="string">"Application启动时间"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initUmeng</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        UMConfigure.init(mApplication, <span class="string">"xxid"</span>, <span class="string">"Umeng"</span>, UMConfigure.DEVICE_TYPE_PHONE, <span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">// 选用MANUAL页面采集模式</span></span><br><span class="line">        MobclickAgent.setPageCollectionMode(MobclickAgent.PageMode.AUTO);</span><br><span class="line">        <span class="comment">// 打开统计SDK调试模式</span></span><br><span class="line">        UMConfigure.setLogEnabled(BuildConfig.DEBUG);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">attachBaseContext</span><span class="params">(Context base)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.attachBaseContext(base);</span><br><span class="line">        MultiDex.install(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">//LauncherTimer.startRecord();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 模拟初始化Weex</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initWeex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化Bugly</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initBugly</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        String processName = AppInfoUtils.getProcessName(android.os.Process.myPid());</span><br><span class="line">        <span class="comment">//L.d(processName);</span></span><br><span class="line">        CrashReport.UserStrategy strategy = <span class="keyword">new</span> CrashReport.UserStrategy(mApplication);</span><br><span class="line">        strategy.setUploadProcess(processName == <span class="keyword">null</span> || processName.equals(getPackageName()));</span><br><span class="line">        CrashReport.initCrashReport(getApplicationContext(), <span class="string">"xxid"</span>, BuildConfig.DEBUG, strategy);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>日志输出：</p>
<blockquote>
<p>===&gt;: MyApplication.initBugly() aop_cost 2146<br>===&gt;: MyApplication.initUmeng() aop_cost 116<br>===&gt;: MyApplication.initWeex() aop_cost 3000<br>===&gt;: Application启动时间 cost 5312<br>===&gt;: MainActivity.request(..) aop_cost 23<br>===&gt;: 结果：WeatherModel{status=101, message=’AK参数不存在’}</p>
</blockquote>
<p>可以发现耗时为5s，同时MainActivity里面的请求是在Application初始化之后才执行的。</p>
<p>那么，接下来我们通过线程池进行异步初始化看效果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate();</span><br><span class="line">    mApplication = <span class="keyword">this</span>;</span><br><span class="line">    LauncherTimer.startRecord();</span><br><span class="line">    ExecutorService service = Executors.newFixedThreadPool(CORE_POOL_SIZE);<span class="comment">//建议使用ThreadPoolExecutors创建</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//存放位置/storage/emulated/0/Android/data/com.github.chinesepoetry/files</span></span><br><span class="line">    <span class="comment">//File externalFilesDir = getExternalFilesDir(null);</span></span><br><span class="line">    <span class="comment">//L.e("getExternalFilesDir:" + externalFilesDir.getAbsolutePath());</span></span><br><span class="line">    <span class="comment">//Debug.startMethodTracing("CpApp");</span></span><br><span class="line">    <span class="comment">//TraceCompat.beginSection("CpApp2");</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        Bugly</span></span><br><span class="line"><span class="comment">        为了保证运营数据的准确性，建议不要在异步线程初始化Bugly</span></span><br><span class="line"><span class="comment">        输出详细的Bugly SDK的Log；</span></span><br><span class="line"><span class="comment">        每一条Crash都会被立即上报；</span></span><br><span class="line"><span class="comment">        自定义日志将会在Logcat中输出。</span></span><br><span class="line"><span class="comment">        建议在测试阶段建议设置成true，发布时设置为false。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//initBugly();</span></span><br><span class="line">    service.submit(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            initBugly();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     Fresco</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//Fresco.initialize(mApplication);</span></span><br><span class="line">    service.submit(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            Fresco.initialize(mApplication);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        Umeng初始化SDK</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//initUmeng();</span></span><br><span class="line">    service.submit(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            initUmeng();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//initWeex();</span></span><br><span class="line">    service.submit(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            initWeex();</span><br><span class="line">            <span class="comment">//mCountDownLatch.countDown();</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Debug.stopMethodTracing();</span></span><br><span class="line">    <span class="comment">//TraceCompat.endSection();</span></span><br><span class="line">    <span class="comment">/*try &#123;</span></span><br><span class="line"><span class="comment">        mCountDownLatch.await();</span></span><br><span class="line"><span class="comment">    &#125; catch (InterruptedException e) &#123;</span></span><br><span class="line"><span class="comment">        e.printStackTrace();</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    LauncherTimer.endRecord(<span class="string">"Application启动时间"</span>);</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>日志输出：</p>
<blockquote>
<p>===&gt;: Application启动时间 cost 3<br>===&gt;: MainActivity.request(..) aop_cost 37<br>===&gt;: MyApplication.initUmeng() aop_cost 177<br>===&gt;: MyApplication.access$200(..) aop_cost 177<br>===&gt;: 结果：WeatherModel{status=101, message=’AK参数不存在’}</p>
<p>===&gt;: MyApplication.initBugly() aop_cost 2075<br>===&gt;: MyApplication.access$000(..) aop_cost 2075<br>===&gt;: MyApplication.initWeex() aop_cost 3003<br>===&gt;: MyApplication.access$300(..) aop_cost 3003</p>
</blockquote>
<p>可以发现 Application启动时间 cost 3毫秒,同时MainActivity已经加载好了，并发送了请求。</p>
<p><strong>特殊场景：</strong></p>
<p>但假如有如下场景就比如Weex的初始化完成要在SplashActivity或MainActivity加载之前加载，那么我们应该如何操作呢？方案是使用CountDownLatch。</p>
<p>这里我们模拟要求initWeex初始化完毕之后才能调用MainActivity的request请求：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">   ...</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">super</span>.onCreate();</span><br><span class="line">       mApplication = <span class="keyword">this</span>;</span><br><span class="line">       LauncherTimer.startRecord();</span><br><span class="line">       ExecutorService service = Executors.newFixedThreadPool(CORE_POOL_SIZE);<span class="comment">//建议使用ThreadPoolExecutors创建</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">//存放位置/storage/emulated/0/Android/data/com.github.chinesepoetry/files</span></span><br><span class="line">       <span class="comment">//File externalFilesDir = getExternalFilesDir(null);</span></span><br><span class="line">       <span class="comment">//L.e("getExternalFilesDir:" + externalFilesDir.getAbsolutePath());</span></span><br><span class="line">       <span class="comment">//Debug.startMethodTracing("CpApp");</span></span><br><span class="line">       <span class="comment">//TraceCompat.beginSection("CpApp2");</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">/*</span></span><br><span class="line"><span class="comment">           Bugly</span></span><br><span class="line"><span class="comment">           为了保证运营数据的准确性，建议不要在异步线程初始化Bugly</span></span><br><span class="line"><span class="comment">           输出详细的Bugly SDK的Log；</span></span><br><span class="line"><span class="comment">           每一条Crash都会被立即上报；</span></span><br><span class="line"><span class="comment">           自定义日志将会在Logcat中输出。</span></span><br><span class="line"><span class="comment">           建议在测试阶段建议设置成true，发布时设置为false。</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       <span class="comment">//initBugly();</span></span><br><span class="line">       service.submit(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">               initBugly();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line"></span><br><span class="line">       <span class="comment">/*</span></span><br><span class="line"><span class="comment">        Fresco</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       <span class="comment">//Fresco.initialize(mApplication);</span></span><br><span class="line">       service.submit(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">               Fresco.initialize(mApplication);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line"></span><br><span class="line">       <span class="comment">/*</span></span><br><span class="line"><span class="comment">           Umeng初始化SDK</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       <span class="comment">//initUmeng();</span></span><br><span class="line">       service.submit(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">               initUmeng();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//initWeex();</span></span><br><span class="line">       service.submit(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">               initWeex();</span><br><span class="line">               mCountDownLatch.countDown();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//Debug.stopMethodTracing();</span></span><br><span class="line">       <span class="comment">//TraceCompat.endSection();</span></span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           mCountDownLatch.await();</span><br><span class="line">       &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">       LauncherTimer.endRecord(<span class="string">"Application启动时间"</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   ...</span><br></pre></td></tr></table></figure>

<p>日志输出：</p>
<blockquote>
<p>===&gt;: MyApplication.initUmeng() aop_cost 97<br>===&gt;: MyApplication.access$200(..) aop_cost 97<br>===&gt;: MyApplication.initBugly() aop_cost 2076<br>===&gt;: MyApplication.access$000(..) aop_cost 2076<br>===&gt;: MyApplication.initWeex() aop_cost 3001<br>===&gt;: MyApplication.access$300(..) aop_cost 3003<br>===&gt;: Application启动时间 cost 3120<br>===&gt;: MainActivity.request(..) aop_cost 20<br>===&gt;: 结果：WeatherModel{status=101, message=’AK参数不存在’}</p>
</blockquote>
<p>通过日志发现，Application执行时间为3s，即为Weex的初始化时间，且当Application初始化Weex之后，MainActivity的request请求才会发出。</p>
<p>补充：假如Umeng初始化需要10s，我们看下日志输出，我们大概猜测因为umeng初始化是放在子线程当中的，日志输出顺序应该为 Application.initWeex–MainActivity.request-Application.initUmeng</p>
<blockquote>
<p>===&gt;: MyApplication.initBugly() aop_cost 2138<br>===&gt;: MyApplication.access$000(..) aop_cost 2138<br>===&gt;: MyApplication.<strong>initWeex</strong>() aop_cost 3001<br>===&gt;: MyApplication.access$300(..) aop_cost 3001<br>===&gt;: Application启动时间 cost 5141<br>===&gt;: MainActivity.<strong>request</strong>(..) aop_cost 22<br>===&gt;: 结果：WeatherModel{status=101, message=’AK参数不存在’}<br>===&gt;: MyApplication.<strong>initUmeng</strong>() aop_cost 10075<br>===&gt;: MyApplication.access$200(..) aop_cost 10075</p>
</blockquote>
<p><strong>异步优化注意事项</strong></p>
<ul>
<li>不符合异步要求的要认真判断一下</li>
<li>需要在某阶段完成</li>
<li>区分CPU密集和IO密集型任务</li>
</ul>
<h3 id="异步初始化（最优解）"><a href="#异步初始化（最优解）" class="headerlink" title="异步初始化（最优解）"></a>异步初始化（最优解）</h3><h4 id="常规异步痛点"><a href="#常规异步痛点" class="headerlink" title="常规异步痛点"></a>常规异步痛点</h4><ul>
<li>代码不优雅</li>
<li>场景不好处理（依赖关系）</li>
<li>维护成本高</li>
</ul>
<h4 id="启动器实现异步初始化"><a href="#启动器实现异步初始化" class="headerlink" title="启动器实现异步初始化"></a>启动器实现异步初始化</h4><ul>
<li>启动器介绍<ul>
<li>核心思想：充分利用CPU多核，自动梳理任务顺序</li>
<li>启动器流程<ul>
<li>代码Task化，启动逻辑抽象为Task</li>
<li>根据所有任务依赖关系排序生成一个<strong>有向无环图（拓扑图）</strong></li>
<li>多线程按照排序后的优先级依次执行</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/" class="lazyload" data-src="https://gitee.com/vxo/img/raw/master/blog/20200701140502.png"  alt="启动器流程图"></p>
<p><strong>代码实践</strong></p>
<p>涉及到的类有：TaskDispatcher、ITask、Task、TaskSortUtil、DispatcherRunnable</p>
<blockquote>
<p>代码后续贴出</p>
</blockquote>
<h3 id="延迟初始化"><a href="#延迟初始化" class="headerlink" title="延迟初始化"></a>延迟初始化</h3><h4 id="常规方案"><a href="#常规方案" class="headerlink" title="常规方案"></a>常规方案</h4><ul>
<li>new Handler().postDelayed</li>
<li>Feed展示后调用</li>
</ul>
<p><img src="/" class="lazyload" data-src="https://gitee.com/vxo/img/raw/master/blog/20200701141226.png"  alt="常规方案"></p>
<p><img src="/" class="lazyload" data-src="https://gitee.com/vxo/img/raw/master/blog/20200701141320.png"  alt="常规方案"></p>
<p><img src="/" class="lazyload" data-src="https://gitee.com/vxo/img/raw/master/blog/20200701141341.png"  alt="常规方案"></p>
<p><strong>常规方案总结：</strong></p>
<ul>
<li>时机不变控制</li>
<li>导致Feed卡顿</li>
</ul>
<h4 id="更优方案"><a href="#更优方案" class="headerlink" title="更优方案"></a>更优方案</h4><ul>
<li>核心思想：对延迟任务进行分批初始化<ul>
<li>利用IdleHandler特性，空闲执行</li>
</ul>
</li>
</ul>
<p>涉及到的类：DelayInitDispatcher</p>
<p>代码后续贴出</p>
<p>更优方案总结：</p>
<ul>
<li>执行时机明确</li>
<li>缓解Feed卡顿</li>
</ul>
<h3 id="本章总结"><a href="#本章总结" class="headerlink" title="本章总结"></a>本章总结</h3><h4 id="获取方法耗时"><a href="#获取方法耗时" class="headerlink" title="获取方法耗时"></a>获取方法耗时</h4><ul>
<li>常规方案</li>
<li>AOP</li>
<li>wall time 与 cpu time区别</li>
</ul>
<h4 id="优化总方针"><a href="#优化总方针" class="headerlink" title="优化总方针"></a>优化总方针</h4><ul>
<li>异步、延迟、懒加载</li>
<li>技术、业务相结合</li>
</ul>
<h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><ul>
<li>wall time与cpu time<ul>
<li>cpu time才是优化方向</li>
<li>按照systrace及cpu time跑满cpu</li>
</ul>
</li>
<li>监控的完善<ul>
<li>线上监控多阶段时间（App、Activity、生命周期间隔时间）</li>
<li>处理聚合看趋势</li>
</ul>
</li>
<li>收敛启动代码修改权限<ul>
<li>结合Ci修改启动代码需要Review或通知</li>
</ul>
</li>
</ul>
<h4 id="其他方案"><a href="#其他方案" class="headerlink" title="其他方案"></a>其他方案</h4><ul>
<li>提前加载SharedPreferences<ul>
<li>Multidex之前加载，利用此阶段的CPU</li>
<li>复写getApplicationContext()返回this</li>
</ul>
</li>
<li>启动阶段不启动子线程<ul>
<li>子线程会共享CPU资源，导致主线程CPU紧张</li>
<li>注意启动顺序：App OnCreate之前是ContentProvider</li>
</ul>
</li>
<li>类加载优化：提前异步类加载<ul>
<li>Class.forName() 只加载类本身及其静态变量的引用类</li>
<li>new 类实例可以额外加载类成员变量的引用类</li>
</ul>
</li>
<li>启动阶段抑制GC</li>
<li>CPU锁频</li>
</ul>
<h2 id="第4章-App内存优化"><a href="#第4章-App内存优化" class="headerlink" title="第4章 App内存优化"></a>第4章 App内存优化</h2><h2 id="第5章-App布局优化"><a href="#第5章-App布局优化" class="headerlink" title="第5章 App布局优化"></a>第5章 App布局优化</h2><h2 id="第6章-App卡顿优化"><a href="#第6章-App卡顿优化" class="headerlink" title="第6章 App卡顿优化"></a>第6章 App卡顿优化</h2><h2 id="第7章-App线程优化"><a href="#第7章-App线程优化" class="headerlink" title="第7章 App线程优化"></a>第7章 App线程优化</h2><h2 id="第8章-App网络优化"><a href="#第8章-App网络优化" class="headerlink" title="第8章 App网络优化"></a>第8章 App网络优化</h2><h2 id="第9章-App电量优化"><a href="#第9章-App电量优化" class="headerlink" title="第9章 App电量优化"></a>第9章 App电量优化</h2><h2 id="第10章-App瘦身优化"><a href="#第10章-App瘦身优化" class="headerlink" title="第10章 App瘦身优化"></a>第10章 App瘦身优化</h2><h2 id="第11章-App稳定性优化"><a href="#第11章-App稳定性优化" class="headerlink" title="第11章 App稳定性优化"></a>第11章 App稳定性优化</h2><h2 id="第12章-App专项技术优化"><a href="#第12章-App专项技术优化" class="headerlink" title="第12章 App专项技术优化"></a>第12章 App专项技术优化</h2><h2 id="第13章-课程总结"><a href="#第13章-课程总结" class="headerlink" title="第13章 课程总结"></a>第13章 课程总结</h2><p><strong>END.</strong></p>
</div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Android/">Android</a><a class="post-meta__tags" href="/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">性能优化</a></div><div class="post_share"><div class="social-share" data-image="https://gitee.com/vxo/img/raw/master/blog/20200622205247.jpeg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="next-post pull-full"><a href="/2020/06/25/Ubuntu18.04%E7%BC%96%E8%AF%91%E5%AE%89%E5%8D%93/"><img class="next_cover lazyload" data-src="/img/post.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Ubuntu18.04编译安卓</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/05/25/Android源码分析——Dagger2（未完）/" title="Android源码分析——Dagger2（未完）"><img class="relatedPosts_cover lazyload"data-src="https://img.cniao5.com/o_1b3rl8h6mk8d162i1i0p1ha6p989.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-25</div><div class="relatedPosts_title">Android源码分析——Dagger2（未完）</div></div></a></div><div class="relatedPosts_item"><a href="/2020/05/18/Android源码分析——Retrofit/" title="Android源码分析——Retrofit"><img class="relatedPosts_cover lazyload"data-src="https://img.cniao5.com/o_1avp1uvsgh7irrvv158jn7mf9.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-18</div><div class="relatedPosts_title">Android源码分析——Retrofit</div></div></a></div><div class="relatedPosts_item"><a href="/2020/05/21/Android源码分析——Glide/" title="Android源码分析——Glide"><img class="relatedPosts_cover lazyload"data-src="http://inthecheesefactory.com/uploads/source/glidepicasso/cover.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-21</div><div class="relatedPosts_title">Android源码分析——Glide</div></div></a></div><div class="relatedPosts_item"><a href="/2020/05/21/博文地址推荐/" title="博文地址推荐"><img class="relatedPosts_cover lazyload"data-src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1591889554697&di=6cd48317171455e6e367313f3430a2e2&imgtype=0&src=http%3A%2F%2F5b0988e595225.cdn.sohucs.com%2Fimages%2F20180717%2Fab8a30734c7f45ad847ca089864e25e4.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-21</div><div class="relatedPosts_title">博文地址推荐</div></div></a></div><div class="relatedPosts_item"><a href="/2020/05/13/开发技能汇总/" title="开发技能汇总"><img class="relatedPosts_cover lazyload"data-src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1589358596541&di=ec2608777052785cb20f0d366f2d82b7&imgtype=0&src=http%3A%2F%2F5b0988e595225.cdn.sohucs.com%2Fimages%2F20170830%2F544fed872efd40a5acf7ebcec0067fc1.jpeg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-13</div><div class="relatedPosts_title">开发技能汇总</div></div></a></div><div class="relatedPosts_item"><a href="/2020/05/25/Android源码分析——EventBus/" title="Android源码分析——EventBus"><img class="relatedPosts_cover lazyload"data-src="https://img-blog.csdnimg.cn/20181208105518324.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-25</div><div class="relatedPosts_title">Android源码分析——EventBus</div></div></a></div></div><div class="clear_both"></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By Kai</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script></body></html>